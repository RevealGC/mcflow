[
    {
        "id": "67991373.45438c",
        "type": "tab",
        "label": "Dynamic Rules From Parameters Files",
        "disabled": true,
        "info": ""
    },
    {
        "id": "2e37e573b3c922d6",
        "type": "tab",
        "label": "Notifications",
        "disabled": false,
        "info": "# Will Send notifications.\n\nEnd point is a post in localhost:80/notification\n\nIts payload is comprised of:\n\nmsg.payload = {\n    data: [],\n    message: \"Submitting a job\",\n    sentFrom: \"QFlow\",\n    sentTo: \"Qbes\"\n}\n\nexports.params = {\n    forceTls: false,\n    params: {\n        DEBUG:    {\n            type: 'bool',\n            source: ['body', 'headers', 'query'],\n            required: false,\n            default: (v) => {\n                if (typeof v !== 'undefined' && v != '') return JSON.parse(v);\n                return false;\n            }\n        },\n        api_token: {\n            type: 'string',\n            source: ['body', 'headers', 'query'],\n            required: false\n        },\n        id:{\n            type: 'int',\n            required: false,\n            source: ['body', 'headers', 'query'],\n        },\n        data: {\n            type: 'json',\n            source: ['body'],\n            required: true,\n            default: []\n        },\n        message: {\n            type:'string',\n            source: ['body'],\n            required: true,\n            default: ''\n        },\n        sentFrom: {\n            type:'string',\n            source: ['body', 'params', 'query'],\n            required: true,\n            default: 'Qbes'\n        },\n\n        sentTo: {\n            type:'string',\n            source: ['body', 'params', 'query'],\n            required: true,\n            default: 'QFlow'\n        },\n        parent_id:{ \n            type: 'int',\n            source: ['params', 'query', 'body', 'headers'],\n            required: false,\n            default: 0\n        }\n\n    },\n    authContext: {\n        super: false,\n        server: false\n    }\n}",
        "env": []
    },
    {
        "id": "d103860e993c1512",
        "type": "tab",
        "label": "Validate RID",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d886a3864a88d832",
        "type": "tab",
        "label": "Processing Parameters",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "ae7e9f579855357c",
        "type": "tab",
        "label": "Spad",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "908af5a748b37aba",
        "type": "tab",
        "label": "Rules",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c702b495.9cc2f8",
        "type": "tab",
        "label": "validate",
        "disabled": false,
        "info": ""
    },
    {
        "id": "7d4690e10f209584",
        "type": "tab",
        "label": "Flow 3",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "4821a41b2fd327fb",
        "type": "tab",
        "label": "Form 2",
        "disabled": false,
        "info": ""
    },
    {
        "id": "813a171cf0470b24",
        "type": "tab",
        "label": "Flow 2",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "ebc615704b7e2ae8",
        "type": "tab",
        "label": "Balance Module",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "01f5b46ca228a07e",
        "type": "tab",
        "label": "Set NONNORM",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b658ecf4c9aae708",
        "type": "tab",
        "label": "Modules Data Table",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5e1c7c0d7569a4cb",
        "type": "tab",
        "label": "Generate Module",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6f369789c773517d",
        "type": "tab",
        "label": "Modules Flow",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a1c50a528dd6cf36",
        "type": "tab",
        "label": "Completeness Check",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d772b64609d590ad",
        "type": "tab",
        "label": "Main Estab",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "7904b0afeb2b68c0",
        "type": "tab",
        "label": "Microservice (Jobs)",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "50e56d1290888d82",
        "type": "tab",
        "label": "Microservice (api)",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5b93d75bf6b1464b",
        "type": "tab",
        "label": "Microservice (gauges&charts)",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "762437ab597e66e7",
        "type": "tab",
        "label": "Balance Test",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6e9fd4ed1a3126bb",
        "type": "tab",
        "label": "Modules Flow w/o Imputation",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b2e59c2394f7c26c",
        "type": "tab",
        "label": "QFlow",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6399b853963e761e",
        "type": "tab",
        "label": "Logical Edits",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "e1c94d5011366338",
        "type": "tab",
        "label": "Batch Mode 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "cd5dca18afec6561",
        "type": "tab",
        "label": "Batch Mode 2",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c3f84f3ada80a59f",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "de517a9172230cbe",
        "type": "tab",
        "label": "AIES NAPCS PREP",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "3248e82e44cba772",
        "type": "tab",
        "label": "Completeness",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "624a1e6caab6a819",
        "type": "tab",
        "label": "BR_STAT evaluation",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5e1a962405c84d2b",
        "type": "tab",
        "label": "Derive NAICS Code",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "2245e192a734f1bb",
        "type": "tab",
        "label": "Best Admin Receipts",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0a014270e6816fdf",
        "type": "tab",
        "label": "Critical Error",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a51d10c50d9dbbe0",
        "type": "tab",
        "label": "NONNORM",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f06fc99b8cb78464",
        "type": "tab",
        "label": "RCPT_TOT_VAL",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0e31453ffacd3b3c",
        "type": "tab",
        "label": "EMP_MAR12_NUM",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0a690414bffb7c2e",
        "type": "tab",
        "label": "PAY_QTR1_VAL",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "10a17d9f63b31aef",
        "type": "tab",
        "label": "NONNORM: Init Set ACTVMIO & OPSTATS",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0a29fbfc598a6eb6",
        "type": "tab",
        "label": "NONNORM: Router",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "1ff0abce01e8a9b4",
        "type": "tab",
        "label": "NONNORM: Set OPSTATS & ACTVMIO",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "749f57d4ab869e77",
        "type": "tab",
        "label": "NONNORM: Set NONORM",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "cc39e0013d1bbd14",
        "type": "tab",
        "label": "NONNORM: Set Basic to 0",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "2214caf84b0847ec",
        "type": "tab",
        "label": "NONNORM: Special Season final",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "bb181ffb5aeab92c",
        "type": "tab",
        "label": "mfg_payqtr1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "83d1ac7cb83077ea",
        "type": "tab",
        "label": "mfg_payann",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c2d60c8918a1622a",
        "type": "tab",
        "label": "mfg_empq1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "fe75af5be53552a9",
        "type": "tab",
        "label": "NAPCS HDICAT",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6ca99eb94adab0b6",
        "type": "tab",
        "label": "NAPCS NO DONOR",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5f0ae7529035d4ee",
        "type": "tab",
        "label": "NAPCS RECALCULATE BALANCE",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "601cd75dc2c42d32",
        "type": "tab",
        "label": "NAPCS BL Rounding",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "05f553d24173a3fe",
        "type": "tab",
        "label": "NAPCS Balance - Balancing",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "184cce6ee0df3c6f",
        "type": "tab",
        "label": "NAPCS Balance",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "05f39827e3106c22",
        "type": "tab",
        "label": "MIV: NonLIFORANDOMModule",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "306dda6a5dd83c4d",
        "type": "tab",
        "label": "MIV: EvaluateNoNLIFOValuationMethodModule",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "ad669800801ee84f",
        "type": "tab",
        "label": "MIV: EvaluateDetailValuationMethods",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f75347023218039f",
        "type": "tab",
        "label": "MIV: EvaluateNoNLIFOValuationMethodsModule",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "944313b2df8d5d35",
        "type": "tab",
        "label": "MIV:  NONLIFOValuationMethodsModule",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f61aed28e038a8f6",
        "type": "tab",
        "label": "MIV: Evaluate LIFO Module",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "3ace7cf3e57a1ba5",
        "type": "tab",
        "label": "MIV: EvaluateLIFOReverseModule",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "23d58ce1d9a3a4af",
        "type": "tab",
        "label": "MIV: LIFOValuationMethod",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "538d3e65e0f18773",
        "type": "tab",
        "label": "MIV: InventoriesBalance",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "2eed7cf661bbf727",
        "type": "tab",
        "label": "KAU To Company Additivity Check",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "9edb2d8ae946822f",
        "type": "tab",
        "label": "Unit Balance",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "236c2e1a5554a6f0",
        "type": "tab",
        "label": "Valid Zero",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "067b1d1ff9443ad3",
        "type": "tab",
        "label": "Valid Negative Value",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "69164b36a28c9eff",
        "type": "tab",
        "label": "NAPCS M GOCO",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "4afed9425459216e",
        "type": "tab",
        "label": "PAY_ANN_VAL",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "475c4bbdee672833",
        "type": "tab",
        "label": "Geography",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d416a739a235277c",
        "type": "tab",
        "label": "ElectricEnergyModule",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c54f3247808fdf7f",
        "type": "tab",
        "label": "Electric Energy Module Cont",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "ed71400b88bb6305",
        "type": "tab",
        "label": "Derived Naics",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "1c6c32346fee9416",
        "type": "tab",
        "label": "Electric Impute Module",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "112a2e5b60c3f3a8",
        "type": "tab",
        "label": "Classification",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b03832cc4c2422fd",
        "type": "tab",
        "label": "Load Referrals",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d85ecef9a21f8c9c",
        "type": "tab",
        "label": "NAPCS_PREP",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8d66eac23e096d21",
        "type": "tab",
        "label": "derive_mfg_naics",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f63af22e81ed47a8",
        "type": "tab",
        "label": "Derived Items",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "91e923b1d58a25de",
        "type": "tab",
        "label": "Post Edit",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0952db06f674f8bc",
        "type": "tab",
        "label": "Logical Edits",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "dad88d9a3132fed6",
        "type": "tab",
        "label": "Run Modules",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c3ae207e8a0fdafa",
        "type": "tab",
        "label": "estab_to_kau_additivity",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8790b12c7efb6fa0",
        "type": "tab",
        "label": "Interactive Mode",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "d7d109e0d89be1c6",
        "type": "tab",
        "label": "Kafka MS",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "01ca257e61eeb577",
        "type": "tab",
        "label": "Database Interactive Mode",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "e491b71b4df205b0",
        "type": "tab",
        "label": "estab_to_kau_raking",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "63ad4b8acb7dc59d",
        "type": "tab",
        "label": "MFG_MU_SU_to_KAU",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "14722d65464a3727",
        "type": "tab",
        "label": "NonMFG_SU_to_KAU",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6aaf6e8f6ac2727e",
        "type": "tab",
        "label": "SU_to_Ent_MFG_nonMFG",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "968bb86866f42913",
        "type": "tab",
        "label": "KAU_to_SU",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "4b3e389076bee580",
        "type": "tab",
        "label": "histstat",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c5ce2d38887016b2",
        "type": "subflow",
        "name": "Apply rules by level type",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 20,
                "y": 220,
                "wires": [
                    {
                        "id": "a288d737bb052e78"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1580,
                "y": 220,
                "wires": [
                    {
                        "id": "e2519c448954167b",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1580,
                "y": 320,
                "wires": [
                    {
                        "id": "1ef95ce134a911b9",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "b99b7893add8c369",
        "type": "subflow",
        "name": "Subflow 1",
        "info": "",
        "in": [
            {
                "x": 50,
                "y": 30,
                "wires": [
                    {
                        "id": "bcba475dfd370f23"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 420,
                "y": 60,
                "wires": [
                    {
                        "id": "bcba475dfd370f23",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "27fccef587c0b218",
        "type": "subflow",
        "name": "Subflow 2",
        "info": "",
        "in": [
            {
                "x": 50,
                "y": 30,
                "wires": [
                    {
                        "id": "89b27031e68b3415"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 520,
                "y": 60,
                "wires": [
                    {
                        "id": "89b27031e68b3415",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "3fa869ffe40596e5",
        "type": "subflow",
        "name": "Subflow 3",
        "info": "",
        "in": [
            {
                "x": 50,
                "y": 30,
                "wires": [
                    {
                        "id": "6ed3a94bca74bb19"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 160,
                "y": 30,
                "wires": [
                    {
                        "id": "6ed3a94bca74bb19",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "98b684914b5fce08",
        "type": "subflow",
        "name": "Subflow 4",
        "info": "",
        "in": [
            {
                "x": 50,
                "y": 30,
                "wires": [
                    {
                        "id": "ac1127915ee1fd4b"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 160,
                "y": 30,
                "wires": [
                    {
                        "id": "ac1127915ee1fd4b",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "2e55e3e8510e62d0",
        "type": "subflow",
        "name": "Subflow 5",
        "info": "",
        "in": [
            {
                "x": 50,
                "y": 30,
                "wires": [
                    {
                        "id": "f40a55ca93f943db"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 440,
                "y": 40,
                "wires": [
                    {
                        "id": "f40a55ca93f943db",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "2ad5fa373c21d0a3",
        "type": "subflow",
        "name": "Subflow 6",
        "info": "",
        "in": [
            {
                "x": 50,
                "y": 30,
                "wires": [
                    {
                        "id": "42dbbd9f093bf42e"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 160,
                "y": 30,
                "wires": [
                    {
                        "id": "42dbbd9f093bf42e",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "045ba1012eb08b50",
        "type": "subflow",
        "name": "Subflow 8",
        "info": "",
        "in": [
            {
                "x": 40,
                "y": 80,
                "wires": [
                    {
                        "id": "57bc9e5538773197"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 340,
                "y": 80,
                "wires": [
                    {
                        "id": "57bc9e5538773197",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "82cc831b154f3133",
        "type": "subflow",
        "name": "SUB FLOW Dynamic Rules from Parameter Files",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 140,
                "wires": [
                    {
                        "id": "6681b08b.4a688"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1320,
                "y": 240,
                "wires": [
                    {
                        "id": "fff3d06b988e5233",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "c0092c0f75376452",
        "type": "subflow",
        "name": "Subflow 9",
        "info": "",
        "in": [],
        "out": []
    },
    {
        "id": "03552ca229e3a7a0",
        "type": "subflow",
        "name": "Subflow 10",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 100,
                "wires": [
                    {
                        "id": "fc793926435fab57"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 340,
                "y": 100,
                "wires": [
                    {
                        "id": "fc793926435fab57",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99",
        "status": {
            "x": 200,
            "y": 40,
            "wires": [
                {
                    "id": "0d6b190eb1914ef7",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "f4b783dd9228239a",
        "type": "subflow",
        "name": "Subflow 11",
        "info": "",
        "in": [],
        "out": []
    },
    {
        "id": "acd9862f30af144d",
        "type": "subflow",
        "name": "PV Subflow",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 180,
                "wires": [
                    {
                        "id": "934d95644c951dfc"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 340,
                "y": 180,
                "wires": [
                    {
                        "id": "934d95644c951dfc",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99",
        "status": {
            "x": 200,
            "y": 40,
            "wires": [
                {
                    "id": "4c82868047e24054",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "fd9469a0efbb8a77",
        "type": "subflow",
        "name": "Balance Subflow",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 220,
                "wires": [
                    {
                        "id": "b434c43de5c1d938"
                    },
                    {
                        "id": "3de7d4b88b6bc5dc"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1980,
                "y": 180,
                "wires": [
                    {
                        "id": "e2d5eecae0459e01",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99",
        "status": {
            "x": 1160,
            "y": 100,
            "wires": [
                {
                    "id": "92892d34775a5fc5",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "e28cd8ccfbe21b33",
        "type": "subflow",
        "name": "Fetch DB DATA",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 280,
                "y": 240,
                "wires": [
                    {
                        "id": "b768655d4c7a4024"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 880,
                "y": 240,
                "wires": [
                    {
                        "id": "a209d5855b2b60f9",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "2c46d53f4cdbe93f",
        "type": "subflow",
        "name": "Subflow 12",
        "info": "",
        "in": [],
        "out": []
    },
    {
        "id": "5eae5184a8f175fd",
        "type": "subflow",
        "name": "NONNORM",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 320,
                "y": 180,
                "wires": [
                    {
                        "id": "d97e7c0dec380b3d"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 620,
                "y": 180,
                "wires": [
                    {
                        "id": "d97e7c0dec380b3d",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "24afab78ca973c73",
        "type": "subflow",
        "name": "KAU To Company Additivity Check",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 560,
                "y": 60,
                "wires": [
                    {
                        "id": "7dbfcdc951fc4a9f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 60,
                "wires": [
                    {
                        "id": "7dbfcdc951fc4a9f",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "6e56f7f07e320f38",
        "type": "subflow",
        "name": "Estab To KAU",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 680,
                "y": 60,
                "wires": [
                    {
                        "id": "87790c3eda62986b"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 60,
                "wires": [
                    {
                        "id": "87790c3eda62986b",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "0be109393cb5f28a",
        "type": "subflow",
        "name": "Lookup Cache Subflow",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 600,
                "y": 100,
                "wires": [
                    {
                        "id": "8c066284600dbc44"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1620,
                "y": 100,
                "wires": [
                    {
                        "id": "f5dbe24054de29ce",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "8032608991ae0162",
        "type": "subflow",
        "name": "DBConn",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 840,
                "y": 100,
                "wires": [
                    {
                        "id": "e547d07fb4b3e318"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1060,
                "y": 100,
                "wires": [
                    {
                        "id": "e547d07fb4b3e318",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "e825fc8e32eb1364",
        "type": "subflow",
        "name": "ESTAB QFLOW 2",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 640,
                "y": 40,
                "wires": [
                    {
                        "id": "aab0f5d7be30ad59"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1500,
                "y": 380,
                "wires": [
                    {
                        "id": "ae433fa4228520c2",
                        "port": 0
                    },
                    {
                        "id": "319c5fef8300c280",
                        "port": 0
                    },
                    {
                        "id": "83cbcd1e98fc4cc2",
                        "port": 0
                    },
                    {
                        "id": "9f3ad64be44f7098",
                        "port": 0
                    },
                    {
                        "id": "7ac782997ef097e8",
                        "port": 0
                    },
                    {
                        "id": "9d789008caa8ba51",
                        "port": 0
                    },
                    {
                        "id": "4c6ceb5e898b5479",
                        "port": 0
                    },
                    {
                        "id": "c8552ac5cfd4a57b",
                        "port": 0
                    },
                    {
                        "id": "06729ee2b17699f5",
                        "port": 0
                    },
                    {
                        "id": "5900496486cdfe9f",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "a2511614f51e5116",
        "type": "subflow",
        "name": "ENT QFLOW 8",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 520,
                "y": 60,
                "wires": [
                    {
                        "id": "4e95996f9340ca3f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1580,
                "y": 320,
                "wires": [
                    {
                        "id": "6700f51af1ec1fa4",
                        "port": 0
                    },
                    {
                        "id": "8f9fba43c8083d31",
                        "port": 0
                    },
                    {
                        "id": "c91361335e197281",
                        "port": 0
                    },
                    {
                        "id": "5da81a3679e71ea4",
                        "port": 0
                    },
                    {
                        "id": "261af4f23f3799f9",
                        "port": 0
                    },
                    {
                        "id": "d555c694ed9727e0",
                        "port": 0
                    },
                    {
                        "id": "922597150c5628c7",
                        "port": 0
                    },
                    {
                        "id": "a8113eded2e20f82",
                        "port": 0
                    },
                    {
                        "id": "5ace2b986f5525ec",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "88823d21c11ae7b5",
        "type": "subflow",
        "name": "KAU QFLOW 5",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 640,
                "y": 60,
                "wires": [
                    {
                        "id": "263d12a695ae25c7"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1900,
                "y": 600,
                "wires": [
                    {
                        "id": "9e9b4cee68be6e9c",
                        "port": 0
                    },
                    {
                        "id": "3f056fce77befeb6",
                        "port": 0
                    },
                    {
                        "id": "e4f66c7916ddf51b",
                        "port": 0
                    },
                    {
                        "id": "52b0141e97338396",
                        "port": 0
                    },
                    {
                        "id": "4d5edc2ef2a2765f",
                        "port": 0
                    },
                    {
                        "id": "927b048b92d700b0",
                        "port": 0
                    },
                    {
                        "id": "ca3f2d5ace132159",
                        "port": 0
                    },
                    {
                        "id": "c5fd0c1367eb5718",
                        "port": 0
                    },
                    {
                        "id": "c5fd0c1367eb5718",
                        "port": 3
                    },
                    {
                        "id": "36eb5b1bc3f37a3f",
                        "port": 0
                    },
                    {
                        "id": "2c12356bd9caa505",
                        "port": 0
                    },
                    {
                        "id": "52e06895cfe7a9e6",
                        "port": 0
                    },
                    {
                        "id": "478bc0c651014446",
                        "port": 0
                    },
                    {
                        "id": "8333d3a99f8e7e21",
                        "port": 0
                    },
                    {
                        "id": "7ba256c934b12f11",
                        "port": 0
                    },
                    {
                        "id": "c16f32959166880c",
                        "port": 0
                    },
                    {
                        "id": "e5012db73e035f03",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "e14f077595377a58",
        "type": "subflow",
        "name": "Estab QFLOW1 PREPV",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 140,
                "wires": [
                    {
                        "id": "6ba9ddc736a3e71f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1700,
                "y": 600,
                "wires": [
                    {
                        "id": "982c220cddec7b9e",
                        "port": 0
                    },
                    {
                        "id": "e29018e0e821766d",
                        "port": 0
                    },
                    {
                        "id": "becd4f267d7bebe1",
                        "port": 0
                    },
                    {
                        "id": "3fb8657c58c0b96a",
                        "port": 0
                    },
                    {
                        "id": "fd75f640d7ac55f9",
                        "port": 0
                    },
                    {
                        "id": "1c967b0b7f6535cc",
                        "port": 0
                    },
                    {
                        "id": "37794fbf4726f868",
                        "port": 0
                    },
                    {
                        "id": "c7c93637080bb37a",
                        "port": 0
                    },
                    {
                        "id": "c7c93637080bb37a",
                        "port": 3
                    },
                    {
                        "id": "8b7d688028229f6a",
                        "port": 0
                    },
                    {
                        "id": "0e421a8775d3359f",
                        "port": 0
                    },
                    {
                        "id": "7b9d9404cfeb99a9",
                        "port": 0
                    },
                    {
                        "id": "b9767a492667090b",
                        "port": 0
                    },
                    {
                        "id": "fe6143ae0ee78339",
                        "port": 0
                    },
                    {
                        "id": "8a0ec78248fea72d",
                        "port": 0
                    },
                    {
                        "id": "1dc183ab4a8e863f",
                        "port": 0
                    },
                    {
                        "id": "50650294e1916d2a",
                        "port": 0
                    },
                    {
                        "id": "846313c80863bec1",
                        "port": 0
                    },
                    {
                        "id": "55a0f64d6e87c32e",
                        "port": 0
                    },
                    {
                        "id": "ee52a2b66cdd88bd",
                        "port": 0
                    },
                    {
                        "id": "969c3b5329eb0481",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "e3961d077dbf1770",
        "type": "subflow",
        "name": "Interactive",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 1080,
                "wires": [
                    {
                        "id": "06d17a6bdfc37b22"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 3060,
                "y": 1140,
                "wires": [
                    {
                        "id": "45bb5e2345aab7b4",
                        "port": 0
                    },
                    {
                        "id": "d31a515ec0b1407d",
                        "port": 0
                    },
                    {
                        "id": "1ea6bf1688faa74b",
                        "port": 0
                    },
                    {
                        "id": "3e9afa1acdca1e32",
                        "port": 4
                    },
                    {
                        "id": "0c13b9d9bca75c6f",
                        "port": 1
                    },
                    {
                        "id": "e5e2d32280b18101",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "9327a343376a53f9",
        "type": "subflow",
        "name": "KAU QFLOW 0",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 200,
                "y": 180,
                "wires": [
                    {
                        "id": "a09933b51e0ca1e6"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 700,
                "y": 280,
                "wires": [
                    {
                        "id": "34c3fba005671a29",
                        "port": 0
                    },
                    {
                        "id": "c8d865456d28d484",
                        "port": 0
                    },
                    {
                        "id": "8814e76868a358a9",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "c1249a800f33a884",
        "type": "subflow",
        "name": "KAU QFLOW 7",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 100,
                "wires": [
                    {
                        "id": "9cc268ba9544a600"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1420,
                "y": 100,
                "wires": [
                    {
                        "id": "830498417c682834",
                        "port": 0
                    },
                    {
                        "id": "5e57335b6495d3dc",
                        "port": 0
                    },
                    {
                        "id": "af4e4f77189ff57f",
                        "port": 0
                    },
                    {
                        "id": "2a3171df667cae95",
                        "port": 0
                    },
                    {
                        "id": "1a201df59ad60252",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "2313e47e41070980",
        "type": "subflow",
        "name": "KAU QFLOW 6",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 60,
                "wires": [
                    {
                        "id": "091b290531e1645c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 760,
                "y": 200,
                "wires": [
                    {
                        "id": "21ad1273aa88b69a",
                        "port": 0
                    },
                    {
                        "id": "0aeccdef357aeb12",
                        "port": 0
                    },
                    {
                        "id": "721901718b909c7b",
                        "port": 0
                    },
                    {
                        "id": "3f6dd7fcc05a08b1",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "326ee5d4d26564c7",
        "type": "subflow",
        "name": "Estab QFLOW 4",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 220,
                "y": 80,
                "wires": [
                    {
                        "id": "e1834279ae066fd6"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1000,
                "y": 260,
                "wires": [
                    {
                        "id": "d6f8e720b596f834",
                        "port": 0
                    },
                    {
                        "id": "8a44f6b08ad2985a",
                        "port": 0
                    },
                    {
                        "id": "4a37c9068b162a16",
                        "port": 0
                    },
                    {
                        "id": "6f835983aa2e0505",
                        "port": 0
                    },
                    {
                        "id": "d425fb90caf5253f",
                        "port": 0
                    },
                    {
                        "id": "cf5cf8ceb0ba463f",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "010b1368b661e966",
        "type": "subflow",
        "name": "Estab QFLOW 3",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 260,
                "y": 200,
                "wires": [
                    {
                        "id": "053216ce9454e2cd"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 960,
                "y": 240,
                "wires": [
                    {
                        "id": "45426c909f20f8e7",
                        "port": 0
                    },
                    {
                        "id": "13b54fc672b81998",
                        "port": 0
                    },
                    {
                        "id": "d97d4e2bef6902c3",
                        "port": 0
                    },
                    {
                        "id": "73c34119d81f4d73",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "537136f85533687f",
        "type": "subflow",
        "name": "KAU General Queries",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 320,
                "wires": [
                    {
                        "id": "9439ebdee9655ac1"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 920,
                "y": 320,
                "wires": [
                    {
                        "id": "57163764df0bab81",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "23c54fc1c5be665e",
        "type": "subflow",
        "name": "Estab General Queries",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 360,
                "y": 160,
                "wires": [
                    {
                        "id": "ccdba6272bdef534"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1100,
                "y": 280,
                "wires": [
                    {
                        "id": "f26fb28e6a088104",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "5da8a5ef555890fb",
        "type": "subflow",
        "name": "Batch",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 1260,
                "wires": [
                    {
                        "id": "fe1bb24f16a5db46"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2880,
                "y": 1180,
                "wires": [
                    {
                        "id": "789bd77c010226b7",
                        "port": 0
                    },
                    {
                        "id": "cbaef742bf0eeb8b",
                        "port": 0
                    },
                    {
                        "id": "6d57931c901151c4",
                        "port": 0
                    },
                    {
                        "id": "0ad4cebef3e64c46",
                        "port": 4
                    },
                    {
                        "id": "3560976c9c238e09",
                        "port": 1
                    },
                    {
                        "id": "6c299fa0da28810e",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "6f23d11cf5bb4bde",
        "type": "subflow",
        "name": "MIV: NonLIFORANDOMModule",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 620,
                "y": 60,
                "wires": [
                    {
                        "id": "5c958e901a16d2a1"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1000,
                "y": 60,
                "wires": [
                    {
                        "id": "5c958e901a16d2a1",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "625b8c982fed66b7",
        "type": "subflow",
        "name": "MIV: EvaluateNoNLIFOValuationMethodModule",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 500,
                "y": 100,
                "wires": [
                    {
                        "id": "be66adc632710827"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 100,
                "wires": [
                    {
                        "id": "be66adc632710827",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "3e0275f580e2d77c",
        "type": "subflow",
        "name": "MIV: EvaluateDetailValuationMethods",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 300,
                "y": 180,
                "wires": [
                    {
                        "id": "7c98b0321d9624dd"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1860,
                "y": 180,
                "wires": [
                    {
                        "id": "1850df34045d729c",
                        "port": 0
                    },
                    {
                        "id": "edaf1561308b996d",
                        "port": 0
                    },
                    {
                        "id": "0830d4165d5f9095",
                        "port": 0
                    },
                    {
                        "id": "05101f8d4d776a37",
                        "port": 0
                    },
                    {
                        "id": "5898adbd68d45d05",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "0ab9d9d713d5103c",
        "type": "subflow",
        "name": "MIV: EvaluateNoNLIFOValuationMethodsModule",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 480,
                "y": 60,
                "wires": [
                    {
                        "id": "c313e698b0913790"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1780,
                "y": 180,
                "wires": [
                    {
                        "id": "fe4e35d89f423462",
                        "port": 0
                    },
                    {
                        "id": "d7d779a3019dab22",
                        "port": 1
                    },
                    {
                        "id": "b7c456c9d73bae60",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "379e12b168b021d1",
        "type": "subflow",
        "name": "MIV:  NONLIFOValuationMethodsModule",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 500,
                "y": 60,
                "wires": [
                    {
                        "id": "597772c0df7454ff"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1040,
                "y": 60,
                "wires": [
                    {
                        "id": "597772c0df7454ff",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "c65f463988b11e12",
        "type": "subflow",
        "name": "MIV: Evaluate LIFO Module",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 580,
                "y": 80,
                "wires": [
                    {
                        "id": "b78377ba255063ad"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 960,
                "y": 80,
                "wires": [
                    {
                        "id": "b78377ba255063ad",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "17fe2bc799b77fa4",
        "type": "subflow",
        "name": "MIV: EvaluateLIFOReverseModule",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 460,
                "y": 60,
                "wires": [
                    {
                        "id": "2aefe1848ae82c98"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 920,
                "y": 60,
                "wires": [
                    {
                        "id": "2aefe1848ae82c98",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "7d33e2bb432d595f",
        "type": "subflow",
        "name": "MIV: LIFOValuationMethod",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 400,
                "y": 140,
                "wires": [
                    {
                        "id": "891b913677e339d8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1140,
                "y": 140,
                "wires": [
                    {
                        "id": "6c38654b72078fd7",
                        "port": 0
                    },
                    {
                        "id": "d0b3dadd28a0d4eb",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "75eae7f006cc0f8a",
        "type": "subflow",
        "name": "MIV: InventoriesBalance",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 180,
                "y": 80,
                "wires": [
                    {
                        "id": "0ba7321c6aef2c00"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1680,
                "y": 80,
                "wires": [
                    {
                        "id": "26c648f63ad22868",
                        "port": 0
                    },
                    {
                        "id": "1ce2615d35152c7e",
                        "port": 0
                    },
                    {
                        "id": "fdc951bca47d6b65",
                        "port": 0
                    },
                    {
                        "id": "8b0da9af9c4353e0",
                        "port": 0
                    },
                    {
                        "id": "3e7d2bc8b39370e3",
                        "port": 0
                    },
                    {
                        "id": "685933e5fe069ed9",
                        "port": 0
                    },
                    {
                        "id": "81e7e229db0fa280",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "3ccae806a14cca8d",
        "type": "subflow",
        "name": "ElectricImputeModule",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 560,
                "y": 60,
                "wires": [
                    {
                        "id": "8a4a29f10142c232"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 940,
                "y": 60,
                "wires": [
                    {
                        "id": "8a4a29f10142c232",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "aadd13b9b9077fc3",
        "type": "subflow",
        "name": "ElectricEnergyModuleCont",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 560,
                "y": 60,
                "wires": [
                    {
                        "id": "cc3b332a2e1dd3b1"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1740,
                "y": 140,
                "wires": [
                    {
                        "id": "b8e346bc389719b0",
                        "port": 0
                    },
                    {
                        "id": "da72f5fb7dbd5250",
                        "port": 1
                    },
                    {
                        "id": "09e748f3e37ff59e",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "1159e6c8f76efda3",
        "type": "subflow",
        "name": "ElectricEnergyModule",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 420,
                "y": 240,
                "wires": [
                    {
                        "id": "9373014f1bd2d06a"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1580,
                "y": 320,
                "wires": [
                    {
                        "id": "cad24aee2b94b325",
                        "port": 1
                    },
                    {
                        "id": "19fa911974a88c47",
                        "port": 0
                    },
                    {
                        "id": "3dd7cceafaacfd0d",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "9f8b85fce167ad51",
        "type": "subflow",
        "name": "mfg_empq1",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 680,
                "y": 180,
                "wires": [
                    {
                        "id": "e1c3e5836e2b8eca"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 940,
                "y": 180,
                "wires": [
                    {
                        "id": "e1c3e5836e2b8eca",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "05d1a91987f08f14",
        "type": "subflow",
        "name": "mfg_payqtr1",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 560,
                "y": 120,
                "wires": [
                    {
                        "id": "c660fc494a2e76e6"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 820,
                "y": 120,
                "wires": [
                    {
                        "id": "c660fc494a2e76e6",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "48bdd199705157b9",
        "type": "subflow",
        "name": "mfg_payann",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 500,
                "y": 180,
                "wires": [
                    {
                        "id": "b2865a1824aff9ec"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1340,
                "y": 220,
                "wires": [
                    {
                        "id": "416362dcdd1a7e66",
                        "port": 0
                    },
                    {
                        "id": "be2c852c16e1ae5f",
                        "port": 0
                    },
                    {
                        "id": "2180ef194be6834d",
                        "port": 0
                    },
                    {
                        "id": "50b781040e269caa",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "9e4e212b0811233d",
        "type": "subflow",
        "name": "Pre Db Write Back For Leased",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 340,
                "y": 220,
                "wires": [
                    {
                        "id": "e4588ba92d2276e3"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 780,
                "y": 220,
                "wires": [
                    {
                        "id": "e4588ba92d2276e3",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "1a584bfe7f4a2458",
        "type": "subflow",
        "name": "Load Referrals",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 880,
                "y": 220,
                "wires": [
                    {
                        "id": "08eaf81ec10ed752"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1220,
                "y": 220,
                "wires": [
                    {
                        "id": "08eaf81ec10ed752",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "96f29b19e2260e65",
        "type": "subflow",
        "name": "Post Edit Subflow",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 520,
                "y": 60,
                "wires": [
                    {
                        "id": "0306a6b0d0775ddc"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1200,
                "y": 100,
                "wires": [
                    {
                        "id": "bfd858ed62920660",
                        "port": 0
                    },
                    {
                        "id": "b016a32cf3993765",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "e4fb9739caef0397",
        "type": "subflow",
        "name": "Balance Module Subflow",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 660,
                "y": 60,
                "wires": [
                    {
                        "id": "992878fea3e496b2"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 60,
                "wires": [
                    {
                        "id": "992878fea3e496b2",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "5e2c6717be2fdd36",
        "type": "subflow",
        "name": "Logical Edits",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 560,
                "y": 80,
                "wires": [
                    {
                        "id": "0c4def347547a284"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 900,
                "y": 80,
                "wires": [
                    {
                        "id": "0c4def347547a284",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "b68b1cdb465a831c",
        "type": "subflow",
        "name": "Derived Items",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 440,
                "y": 100,
                "wires": [
                    {
                        "id": "0fe0c5b4f51e33b6"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 840,
                "y": 100,
                "wires": [
                    {
                        "id": "0fe0c5b4f51e33b6",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "4781d07fda613850",
        "type": "subflow",
        "name": "EMP_MAR12_NUM",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 680,
                "y": 320,
                "wires": [
                    {
                        "id": "8ffe802b67aef5e3"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 320,
                "wires": [
                    {
                        "id": "8ffe802b67aef5e3",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "253763f13152858b",
        "type": "subflow",
        "name": "PAY_QTR1_VAL",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 480,
                "y": 240,
                "wires": [
                    {
                        "id": "8b5375b4024c9c0b"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 740,
                "y": 240,
                "wires": [
                    {
                        "id": "8b5375b4024c9c0b",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "7c71f52633d8c794",
        "type": "subflow",
        "name": "RCPT_TOT_VAL",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 560,
                "y": 520,
                "wires": [
                    {
                        "id": "9cd4f165207e607e"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 820,
                "y": 520,
                "wires": [
                    {
                        "id": "9cd4f165207e607e",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "27c40a87c581e266",
        "type": "subflow",
        "name": "PAY_ANN_VAL",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 680,
                "y": 320,
                "wires": [
                    {
                        "id": "32987fccfff7af52"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 940,
                "y": 320,
                "wires": [
                    {
                        "id": "32987fccfff7af52",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "89f071f1deb9a1b1",
        "type": "subflow",
        "name": "Completeness",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 820,
                "y": 240,
                "wires": [
                    {
                        "id": "44cfe99b5f9e273f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 2300,
                "y": 220,
                "wires": [
                    {
                        "id": "8d172b24625dc196",
                        "port": 0
                    },
                    {
                        "id": "cb75b2a1c3d302c2",
                        "port": 0
                    },
                    {
                        "id": "b0dd9d17962e9f8a",
                        "port": 0
                    },
                    {
                        "id": "4714c577aefc14d1",
                        "port": 0
                    },
                    {
                        "id": "2ff2c2898d08dd1b",
                        "port": 0
                    },
                    {
                        "id": "16fe085358f3d589",
                        "port": 0
                    },
                    {
                        "id": "917c64f63bd2f19c",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "bfe1ab19e0cbe2cf",
        "type": "subflow",
        "name": "Classification",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 640,
                "y": 60,
                "wires": [
                    {
                        "id": "0a9f67e1bc33b824"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 970,
                "y": 60,
                "wires": [
                    {
                        "id": "0a9f67e1bc33b824",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "c79b244779411ead",
        "type": "subflow",
        "name": "Valid Negative",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 580,
                "y": 40,
                "wires": [
                    {
                        "id": "dd9091221ca2c1cf"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 900,
                "y": 40,
                "wires": [
                    {
                        "id": "dd9091221ca2c1cf",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "7e80c62ce8c753dc",
        "type": "subflow",
        "name": "Derived MFG NAICS",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 560,
                "y": 220,
                "wires": [
                    {
                        "id": "7af8a7f283b27373"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 920,
                "y": 220,
                "wires": [
                    {
                        "id": "7af8a7f283b27373",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "f07c9ae4084738fc",
        "type": "subflow",
        "name": "Derived Naics",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 640,
                "y": 60,
                "wires": [
                    {
                        "id": "b160a0ca86eee401"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 920,
                "y": 60,
                "wires": [
                    {
                        "id": "b160a0ca86eee401",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "998aa04bd1bb677d",
        "type": "subflow",
        "name": "Valid Zero",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 640,
                "y": 40,
                "wires": [
                    {
                        "id": "15222fbe79033cfa"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 880,
                "y": 40,
                "wires": [
                    {
                        "id": "15222fbe79033cfa",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "aadaa91727c0d579",
        "type": "subflow",
        "name": "Best Admin Receipts",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 940,
                "y": 600,
                "wires": [
                    {
                        "id": "71a05b6359f45791"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1480,
                "y": 600,
                "wires": [
                    {
                        "id": "71a05b6359f45791",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "b22812dba408ab8f",
        "type": "subflow",
        "name": "Geography",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 560,
                "y": 60,
                "wires": [
                    {
                        "id": "310c654aa32dd481"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 900,
                "y": 60,
                "wires": [
                    {
                        "id": "310c654aa32dd481",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "42be4655fd3a8c84",
        "type": "subflow",
        "name": "Critical Error",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 560,
                "y": 260,
                "wires": [
                    {
                        "id": "f2eeed6f42b8a31c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 820,
                "y": 260,
                "wires": [
                    {
                        "id": "f2eeed6f42b8a31c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "20d530cc0b193752",
        "type": "subflow",
        "name": "BR_STAT evaluation",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 800,
                "y": 80,
                "wires": [
                    {
                        "id": "31739108a9b57e14"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1020,
                "y": 80,
                "wires": [
                    {
                        "id": "31739108a9b57e14",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "e09a92672a809eab",
        "type": "subflow",
        "name": "Estab temp qflow",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 280,
                "y": 240,
                "wires": [
                    {
                        "id": "46b3677a66484905"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1280,
                "y": 240,
                "wires": [
                    {
                        "id": "a241a27d91c97bd0",
                        "port": 0
                    },
                    {
                        "id": "29636a3b9b9bf654",
                        "port": 0
                    },
                    {
                        "id": "a6ecbb0f804243ba",
                        "port": 0
                    },
                    {
                        "id": "ebd10c9f307211a6",
                        "port": 0
                    },
                    {
                        "id": "da1041380073a9cd",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "848cf3fa24ade3ee",
        "type": "subflow",
        "name": "Kau temp qflow",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 420,
                "y": 300,
                "wires": [
                    {
                        "id": "464674c4029c73d2"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1740,
                "y": 200,
                "wires": [
                    {
                        "id": "4504eca1eab0f0d6",
                        "port": 0
                    },
                    {
                        "id": "19086e3898d97bcf",
                        "port": 0
                    },
                    {
                        "id": "ddcfb9ab334353de",
                        "port": 0
                    },
                    {
                        "id": "37fd0022f9cf94d8",
                        "port": 0
                    },
                    {
                        "id": "a87b0bc5e57096a7",
                        "port": 0
                    },
                    {
                        "id": "37fd0022f9cf94d8",
                        "port": 1
                    },
                    {
                        "id": "0ac0ff658a0a1649",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "2cc271394c47d59b",
        "type": "subflow",
        "name": "ENT temp qflow",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 120,
                "wires": [
                    {
                        "id": "54eb107c0332181c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 220,
                "wires": [
                    {
                        "id": "92fdd684beea9454",
                        "port": 0
                    },
                    {
                        "id": "215fc0dfced8954c",
                        "port": 0
                    },
                    {
                        "id": "37794b0f554a07e3",
                        "port": 0
                    },
                    {
                        "id": "e81f3652bc8e327b",
                        "port": 0
                    },
                    {
                        "id": "372b45912e271aab",
                        "port": 0
                    },
                    {
                        "id": "62488e09ea38855f",
                        "port": 0
                    },
                    {
                        "id": "62488e09ea38855f",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "50ae5f8d28de46c8",
        "type": "subflow",
        "name": "Upfront Raking Estab_to_KAU",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 300,
                "wires": [
                    {
                        "id": "6a6c20afbe8a3a43"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1260,
                "y": 220,
                "wires": [
                    {
                        "id": "6a6c20afbe8a3a43",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "f9a2a2262f95bae3",
        "type": "subflow",
        "name": "NonNORM Init Set ACTVMIO & OPSTATS",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 580,
                "y": 160,
                "wires": [
                    {
                        "id": "2e5501e16398d095"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 960,
                "y": 160,
                "wires": [
                    {
                        "id": "2e5501e16398d095",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "e1f601e2c56dfda4",
        "type": "subflow",
        "name": "NONNORM: Special Season final",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 620,
                "y": 80,
                "wires": [
                    {
                        "id": "e2f7739eee5de74c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 940,
                "y": 80,
                "wires": [
                    {
                        "id": "e2f7739eee5de74c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "b8154c600987e319",
        "type": "subflow",
        "name": "NONNORM: Set Basic to 0",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 480,
                "y": 260,
                "wires": [
                    {
                        "id": "46531482d43b4cae"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 760,
                "y": 260,
                "wires": [
                    {
                        "id": "46531482d43b4cae",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "5251d9acce14d156",
        "type": "subflow",
        "name": "NONNORM: Set NONORM",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 540,
                "y": 240,
                "wires": [
                    {
                        "id": "1bb9ec440766bd2c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 820,
                "y": 240,
                "wires": [
                    {
                        "id": "1bb9ec440766bd2c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "a661e33a6e4be4fe",
        "type": "subflow",
        "name": "Set OPSTATS & ACTVMIO",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 340,
                "y": 200,
                "wires": [
                    {
                        "id": "9511bc37f025a9ac"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 700,
                "y": 200,
                "wires": [
                    {
                        "id": "9511bc37f025a9ac",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "b93bf22bc3258992",
        "type": "subflow",
        "name": "NONNORM: Router",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 100,
                "y": 540,
                "wires": [
                    {
                        "id": "67d7853d425a88ed"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1360,
                "y": 1040,
                "wires": [
                    {
                        "id": "8236aa72a4466f04",
                        "port": 0
                    },
                    {
                        "id": "523d7db5c28b97c6",
                        "port": 1
                    },
                    {
                        "id": "7421111e8e6f6628",
                        "port": 0
                    },
                    {
                        "id": "5fc9a4338bfcf05c",
                        "port": 0
                    },
                    {
                        "id": "0c24ccfcfab4286e",
                        "port": 0
                    },
                    {
                        "id": "10dd3dc15f8c51f7",
                        "port": 0
                    },
                    {
                        "id": "2b2ac02cd102febb",
                        "port": 0
                    },
                    {
                        "id": "7a35a2a22d05ef32",
                        "port": 0
                    },
                    {
                        "id": "5aa9633017e8d63e",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "e7b7501b29427db9",
        "type": "subflow",
        "name": "NAPCS_PREP",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 640,
                "y": 420,
                "wires": [
                    {
                        "id": "d831e0513adcc48e"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1000,
                "y": 420,
                "wires": [
                    {
                        "id": "d831e0513adcc48e",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "0179503501c47e39",
        "type": "subflow",
        "name": "mfg_mu_su_to_kau",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 100,
                "wires": [
                    {
                        "id": "83e6537885e334ae"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 400,
                "y": 100,
                "wires": [
                    {
                        "id": "83e6537885e334ae",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "f9cd233b8803b29d",
        "type": "subflow",
        "name": "nonmfg_su_to_kau",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 60,
                "wires": [
                    {
                        "id": "c44aad574a2c2638"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 480,
                "y": 60,
                "wires": [
                    {
                        "id": "c44aad574a2c2638",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "1ff4019fd0378d4a",
        "type": "subflow",
        "name": "su_to_ent_mfg_nonmfg",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 210,
                "y": 120,
                "wires": [
                    {
                        "id": "dbd2be51e81b1072"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 560,
                "y": 120,
                "wires": [
                    {
                        "id": "dbd2be51e81b1072",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "6ace7023ea973ebe",
        "type": "subflow",
        "name": "kau_to_su",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 120,
                "wires": [
                    {
                        "id": "eb7d69628314219e"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 500,
                "y": 120,
                "wires": [
                    {
                        "id": "eb7d69628314219e",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "1a2581dce20863e3",
        "type": "subflow",
        "name": "Check_Scope",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 240,
                "y": 80,
                "wires": [
                    {
                        "id": "513fe743c07a7cac"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 540,
                "y": 80,
                "wires": [
                    {
                        "id": "513fe743c07a7cac",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "7c74ea1220a33f32",
        "type": "subflow",
        "name": "Sector_31",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 260,
                "y": 100,
                "wires": [
                    {
                        "id": "af6b654eb7fd90cf"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 500,
                "y": 100,
                "wires": [
                    {
                        "id": "af6b654eb7fd90cf",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "a307acf02307bc62",
        "type": "subflow",
        "name": "Check_Nontabfl_estab",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 40,
                "wires": [
                    {
                        "id": "264c6fe27b557bb8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 440,
                "y": 40,
                "wires": [
                    {
                        "id": "264c6fe27b557bb8",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "b3b1701e035827dc",
        "type": "subflow",
        "name": "NAPCS HDICAT",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 580,
                "y": 280,
                "wires": [
                    {
                        "id": "f6885c586821c8cd"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 900,
                "y": 280,
                "wires": [
                    {
                        "id": "f6885c586821c8cd",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "b576348e42469acf",
        "type": "subflow",
        "name": "M_GOCO",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 660,
                "y": 60,
                "wires": [
                    {
                        "id": "d1b1713300484045"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 960,
                "y": 60,
                "wires": [
                    {
                        "id": "d1b1713300484045",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "4b2a066dec42e6f4",
        "type": "subflow",
        "name": "NAPCS NO DONOR",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 360,
                "y": 500,
                "wires": [
                    {
                        "id": "3f577bb0f73d0ae2"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1700,
                "y": 500,
                "wires": [
                    {
                        "id": "6f8e4805c41cb820",
                        "port": 0
                    },
                    {
                        "id": "99aa6097013685ea",
                        "port": 0
                    },
                    {
                        "id": "bd6cd891b972f30a",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "e77217f4bfc52a38",
        "type": "subflow",
        "name": "NAPCS RECALCULATE BALANCE",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 580,
                "y": 260,
                "wires": [
                    {
                        "id": "e07677c8e679affd"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 960,
                "y": 260,
                "wires": [
                    {
                        "id": "e07677c8e679affd",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "fbb1e70dfe5fe82f",
        "type": "subflow",
        "name": "NAPCS BL Rounding",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 640,
                "y": 200,
                "wires": [
                    {
                        "id": "b2afff84193f1485"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 200,
                "wires": [
                    {
                        "id": "b2afff84193f1485",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "c706d1ca2706f3bf",
        "type": "subflow",
        "name": "NAPCS Balance - Balancing",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 720,
                "y": 100,
                "wires": [
                    {
                        "id": "1fe10b7b2609c70b"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 960,
                "y": 100,
                "wires": [
                    {
                        "id": "1fe10b7b2609c70b",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "d32a58c0544f501c",
        "type": "subflow",
        "name": "NAPCS Balance",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 620,
                "y": 140,
                "wires": [
                    {
                        "id": "401fdae063b57aa5"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1820,
                "y": 120,
                "wires": [
                    {
                        "id": "03b8fb7bd5b0caa5",
                        "port": 0
                    },
                    {
                        "id": "0265195f902cf9bb",
                        "port": 0
                    },
                    {
                        "id": "75879436990d7deb",
                        "port": 0
                    },
                    {
                        "id": "72b2653deb32a23b",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "1088c7f7eed8781b",
        "type": "subflow",
        "name": "histstat",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 140,
                "y": 80,
                "wires": [
                    {
                        "id": "8484fa1c86e06482"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 440,
                "y": 80,
                "wires": [
                    {
                        "id": "8484fa1c86e06482",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "e50e4180ad305262",
        "type": "subflow",
        "name": "histstat after job1",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 100,
                "wires": [
                    {
                        "id": "b853872c4456ce78"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 460,
                "y": 100,
                "wires": [
                    {
                        "id": "b853872c4456ce78",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "f0920ac3618eb45b",
        "type": "subflow",
        "name": "Check writeback",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 260,
                "y": 120,
                "wires": [
                    {
                        "id": "670fcf981f211fb3"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 660,
                "y": 120,
                "wires": [
                    {
                        "id": "670fcf981f211fb3",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "7dc18555ca029842",
        "type": "group",
        "z": "d103860e993c1512",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "f3903be4e24d8dca",
            "97d2bd49cb3742bc",
            "999bbdaf976e7feb",
            "d529da54696a9982",
            "d1e0f39ddacfeb20",
            "d015bbe8f3761f7f"
        ],
        "x": 54,
        "y": -1
    },
    {
        "id": "5a28e866a67c90ec",
        "type": "group",
        "z": "d103860e993c1512",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "a52599d1e82370ad",
            "3773a11cc06cd9db",
            "f47d58da6a345fa9",
            "12d8ce370fc2153f",
            "6970f9e5cadfae30",
            "eee34fb243fcc025",
            "8764792a5250d529",
            "da904483e17171f2",
            "2afe1b70382b1d3c"
        ],
        "x": 14,
        "y": 299
    },
    {
        "id": "c0b83f35fdc02130",
        "type": "group",
        "z": "67991373.45438c",
        "name": "FACS FROM DB -Select Reporting IDs from DropDown",
        "style": {
            "label": true
        },
        "nodes": [
            "0cd9973f643e23da",
            "3b55370ad9fd31f5",
            "e76e13639b1f0475",
            "7ce52ec9ef003b44",
            "d394b61bcc4755e6"
        ],
        "x": 14,
        "y": 939,
        "w": 1532,
        "h": 82
    },
    {
        "id": "ef50b77b253a7883",
        "type": "group",
        "z": "67991373.45438c",
        "name": "Rules Types",
        "style": {
            "label": true
        },
        "nodes": [
            "fb483894819a453e",
            "5f12a638967ad520",
            "199e84df3d73b845",
            "79f4bff451119fb7",
            "645a9d4772fcd00f",
            "739c4193fa8fce2c",
            "d587f5de3f4014c8"
        ],
        "x": 14,
        "y": 239,
        "w": 1802,
        "h": 182
    },
    {
        "id": "62708d0bbe922798",
        "type": "group",
        "z": "67991373.45438c",
        "name": "FACTS: From File",
        "style": {
            "label": true
        },
        "nodes": [
            "97cb22c43553888b",
            "04f3b0fb456d2117",
            "100234cf93c195b8",
            "c047c871d9c0e70d",
            "c9c9ca415ab95910",
            "16550455147cd747",
            "211d46862546b6bf",
            "571a7beaed3ab093",
            "24856db77f81d8bb",
            "21a2308db46311bb",
            "58df41cd8e54a653"
        ],
        "x": 14,
        "y": 519,
        "w": 1432,
        "h": 322
    },
    {
        "id": "19463268a6c67561",
        "type": "group",
        "z": "67991373.45438c",
        "name": "Rules: From Parameter Files",
        "style": {
            "label": true
        },
        "nodes": [
            "9a7a7971.dbc4b8",
            "1e5beed02674863a",
            "b5c53653a76681bf",
            "06db3e224b379422"
        ],
        "x": 14,
        "y": 99,
        "w": 1432,
        "h": 82,
        "info": "# Rules from Parameter Files"
    },
    {
        "id": "4099bf03141f3710",
        "type": "group",
        "z": "dad88d9a3132fed6",
        "name": "Upload a file /simple. Change look of the form in the {html node",
        "style": {
            "label": true
        },
        "nodes": [
            "7c30fb48.99cd2c",
            "3153fbd3.203a64",
            "737e44d2.373a64",
            "7d8e179a.283e4",
            "25859a94.7d9976",
            "e1643981.20d7c8",
            "d7e5df8b.97a4e8",
            "0464e4eb98976890",
            "81e3239593f9f1d1",
            "2319e5574f035f21",
            "2e210837e211c8be",
            "20ef4922bea8d7fd",
            "89e7e315b3a8c30b",
            "ba5d5bdad0bc957e",
            "8434c6c16c1fbaaf",
            "399608507ce305d7",
            "24ae978c7feb5fc3",
            "b9b9acc35bdd0b75",
            "43545e3b96e7f60c",
            "d5aac8a297ee6dd2",
            "5d05b108e4e3f722",
            "28494dbc74f30091",
            "8272974b9a32a0ac",
            "270941def4b7c8b6",
            "65738b3d68734570",
            "fbcbf9510de0509c",
            "05b67576d444bda4",
            "039e4172b173ea18",
            "45b768d58693d73d",
            "854cd7a417cbbc6e",
            "6c8827ce7a4c83d8",
            "6386460ff91d3960",
            "6982bc340b585149",
            "d990e40c5e545d4e",
            "08daf4161eddc269",
            "733a9e511bb97033",
            "395ec4e45f0e2746",
            "dc2a2ca809797dbd",
            "f14b49f36a5b83fc",
            "4a50e74e63590ec7",
            "81f5d75ffbcd549e",
            "b1540f3459d95049",
            "32b24311da4a3220",
            "cd8a05808eedb5f3",
            "ff27924ce01b7894",
            "3fd3586e01a6e2dc",
            "1597f28db268d317",
            "48c2bbd321b77688",
            "a0a9a69afb297619",
            "879c5a04e7f7b3ba",
            "601d06243349006e",
            "9924458ebb7935cd",
            "51d4f6e460537ff8",
            "8cc4aec631b9f7ab",
            "6e0891f1d9b0f50b",
            "405380585cc28809",
            "be79a45237eac5df",
            "961d21f9c9d6935d",
            "256113e429ce586b",
            "6e4d6926b48c4bfc",
            "6a7a578fbd272b1f",
            "ac696618fbdb5b2b",
            "ff930476a898868c",
            "17eb7e821e3b7ea0",
            "8ab5edfeddc79fdc",
            "9a0ffed7eefbb31e",
            "2197046546278bb4",
            "0f1620a9dfb42cf6",
            "f2d1653b5ba3e5d2",
            "03b4a30c8b73aaa1",
            "0695b3dc79291692",
            "903ab3bdc5e84545",
            "62a7ab56c461f544",
            "26d5116b6bd90d58",
            "eec857548bfbe6b5",
            "193adf68b854c196",
            "2fd70cb03d1b3cb7",
            "23ffb00caa077b23",
            "6b05d518e4c1bc47",
            "302cb8040ecade52",
            "2b5207ce5d20fc0a",
            "184f643c8c0c9483",
            "13026c6f9554fd48",
            "628a357ebf92b85e",
            "23110971cf0ed68c",
            "f96645ae14ef8fb7",
            "9ff082949b495698",
            "76ae33256827ae89",
            "f192e59528bfd677",
            "aecaf71d99c7d88b",
            "3a09eefeb46e3070",
            "9e0c70dcbb4236fd",
            "4009a991edd2db54",
            "3243d670e9d24a2d",
            "070b2c6eb42b2ee1",
            "1b801f920c932ed1",
            "f49fb32690ddbe1a",
            "bf91ad9e062838cc",
            "5bf7f51448d5e055",
            "bbfea30cdba9957b",
            "2c7eaaca104f6a2c",
            "5e674b959c1b250a"
        ],
        "x": 14,
        "y": 599
    },
    {
        "id": "302cb8040ecade52",
        "type": "group",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "Initialize File Name and Global set moduleFacts",
        "style": {
            "label": true
        },
        "nodes": [
            "12c94ce38056fc20",
            "a47c991027033263"
        ],
        "x": 704,
        "y": 719
    },
    {
        "id": "d1e0f39ddacfeb20",
        "type": "group",
        "z": "d103860e993c1512",
        "g": "7dc18555ca029842",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "e5ca7c9975e3a6b5"
        ],
        "x": 474,
        "y": 99
    },
    {
        "id": "748ca46ea16faad4",
        "type": "junction",
        "z": "67991373.45438c",
        "x": 2161.7333374023438,
        "y": 1642.7333374023438,
        "wires": [
            []
        ]
    },
    {
        "id": "ea3e0b5d6b96f47a",
        "type": "digitaloak-postgresql-connection-manager",
        "d": true,
        "name": "PGAIES",
        "host": "aies-cloud-aurora-pg-dev-instance-1.cjflqg3bd6i9.us-gov-east-1.rds.amazonaws.com",
        "port": "5432",
        "database": "space_ite",
        "tls": "",
        "use_tls": false,
        "pool_max_clients": "10",
        "pool_client_max_idle": "10000",
        "client_query_timeout": "",
        "client_statement_timeout": "",
        "client_connection_timeout_millis": "",
        "is_client_enabled": "1"
    },
    {
        "id": "1f48566b.e8958a",
        "type": "ui_group",
        "d": true,
        "name": "2. Processed PreRules",
        "tab": "da612906.998368",
        "order": 9,
        "disp": true,
        "width": 24,
        "collapse": true,
        "className": ""
    },
    {
        "id": "fe5119d6c50995ed",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#6e6e6e",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#e3ffe8",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "reset": false
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#6e6e6e",
                    "edited": true
                },
                "page-titlebar-backgroundColor": {
                    "value": "#6e6e6e",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#949494",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#6e6e6e",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "QFlow",
            "hideToolbar": "true",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "none",
            "dateFormat": "MM/DD/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 6,
                "py": 6
            }
        }
    },
    {
        "id": "18e6e44c.b0561c",
        "type": "ui_group",
        "name": "Tables",
        "tab": "",
        "order": 8,
        "disp": true,
        "width": "6"
    },
    {
        "id": "24e6f02ee5d4fe37",
        "type": "ui_group",
        "name": "Workflows",
        "tab": "",
        "order": 2,
        "disp": true,
        "width": "13",
        "collapse": false,
        "className": ""
    },
    {
        "id": "aaf91b7e.c5ca7",
        "type": "ui_group",
        "name": "PreData",
        "tab": "",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "d7c16b88.658fa8",
        "type": "ui_group",
        "name": "iframe",
        "tab": "",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "99274104.d1d6",
        "type": "ui_group",
        "name": "Weather",
        "tab": "",
        "order": 3,
        "disp": false,
        "width": "5",
        "collapse": false
    },
    {
        "id": "e7dc0c12a87bf783",
        "type": "ui_tab",
        "d": true,
        "name": "Rules",
        "icon": "dashboard",
        "order": 6,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "b42243a688b5a996",
        "type": "ui_group",
        "name": "Enter Workflows",
        "tab": "e7dc0c12a87bf783",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "fe9b4de4.dcd72",
        "type": "ui_group",
        "name": "Name list",
        "tab": "e7dc0c12a87bf783",
        "order": 1,
        "disp": true,
        "width": "15",
        "collapse": false
    },
    {
        "id": "da612906.998368",
        "type": "ui_tab",
        "d": true,
        "name": "Parameters",
        "icon": "home",
        "order": 4,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "440f78388bf9306a",
        "type": "ui_group",
        "name": "Rules for Workflows",
        "tab": "e7dc0c12a87bf783",
        "order": 3,
        "disp": true,
        "width": 30,
        "collapse": false,
        "className": ""
    },
    {
        "id": "5c07c02344a2bd3d",
        "type": "ui_group",
        "d": true,
        "name": "1. Parameters File",
        "tab": "da612906.998368",
        "order": 8,
        "disp": true,
        "width": 24,
        "collapse": true,
        "className": ""
    },
    {
        "id": "1f86b2145e7e556a",
        "type": "ui_group",
        "name": "Facts",
        "tab": "da612906.998368",
        "order": 5,
        "disp": true,
        "width": 16,
        "collapse": false,
        "className": ""
    },
    {
        "id": "18a5a593fcd64912",
        "type": "ui_group",
        "name": "Dynamic Rules from Parameters File",
        "tab": "da612906.998368",
        "order": 11,
        "disp": true,
        "width": 24,
        "collapse": true,
        "className": ""
    },
    {
        "id": "134f09c88dd005fc",
        "type": "ui_group",
        "name": "Assert Facts",
        "tab": "da612906.998368",
        "order": 12,
        "disp": true,
        "width": "24",
        "collapse": true,
        "className": ""
    },
    {
        "id": "160e81fb.f1c86e",
        "type": "ui_group",
        "name": "File Browser",
        "tab": "b63d1f91.68095",
        "order": 1,
        "disp": true,
        "width": "18",
        "collapse": false
    },
    {
        "id": "b63d1f91.68095",
        "type": "ui_tab",
        "d": true,
        "name": "Files",
        "icon": "dashboard",
        "order": 7,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "c33a1024a72aa169",
        "type": "ui_group",
        "name": "Default",
        "tab": "",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "8b3784e33ba42593",
        "type": "ui_group",
        "name": "JSON2tree",
        "tab": "",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "4060ccd3b1b979fd",
        "type": "ui_group",
        "name": "Gauges",
        "tab": "da612906.998368",
        "order": 1,
        "disp": false,
        "width": "18",
        "collapse": false,
        "className": ""
    },
    {
        "id": "d5b306fd70950040",
        "type": "ui_group",
        "name": "Rules",
        "tab": "da612906.998368",
        "order": 3,
        "disp": true,
        "width": 16,
        "collapse": false,
        "className": ""
    },
    {
        "id": "1d5401bf95a96f03",
        "type": "ui_group",
        "name": "JOBS",
        "tab": "da612906.998368",
        "order": 10,
        "disp": true,
        "width": "24",
        "collapse": true,
        "className": ""
    },
    {
        "id": "d68e7be3.88f088",
        "type": "ui_group",
        "name": "Forms Example",
        "tab": "67ff17e9.83751",
        "order": 1,
        "disp": true,
        "width": "8",
        "collapse": false
    },
    {
        "id": "54bca71e.4287f",
        "type": "ui_group",
        "name": "Form",
        "tab": "67ff17e9.83751",
        "order": 2,
        "disp": true,
        "width": "8",
        "collapse": false
    },
    {
        "id": "67ff17e9.83751",
        "type": "ui_tab",
        "d": true,
        "name": "Forms Example ",
        "icon": "home",
        "order": 10,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "785c383535b14b7d",
        "type": "ui_group",
        "z": "4821a41b2fd327fb",
        "name": "Dashboard Event Log",
        "tab": "67ff17e9.83751",
        "order": 3,
        "disp": true,
        "width": "8",
        "collapse": false
    },
    {
        "id": "fc893c6c.aaeff",
        "type": "ui_group",
        "name": "Leaderboard",
        "tab": "c79bed56.dc9bd",
        "order": 1,
        "disp": true,
        "width": "10",
        "collapse": false,
        "className": ""
    },
    {
        "id": "c79bed56.dc9bd",
        "type": "ui_tab",
        "d": true,
        "name": "LeaderBoard",
        "icon": "dashboard",
        "order": 11,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "779fdd53a3120890",
        "type": "ui_group",
        "name": "Submit Job",
        "tab": "da612906.998368",
        "order": 7,
        "disp": true,
        "width": 16,
        "collapse": false,
        "className": ""
    },
    {
        "id": "6c5eaeae4cddb9b5",
        "type": "ui_group",
        "name": "Notifications",
        "tab": "da612906.998368",
        "order": 2,
        "disp": true,
        "width": "24",
        "collapse": true,
        "className": ""
    },
    {
        "id": "4c1a66c045af9fe9",
        "type": "ui_group",
        "name": "Dummy 11",
        "tab": "da612906.998368",
        "order": 6,
        "disp": false,
        "width": 24,
        "collapse": false,
        "className": ""
    },
    {
        "id": "90b2b640d0604f0c",
        "type": "ui_group",
        "name": "Dummy  12",
        "tab": "da612906.998368",
        "order": 4,
        "disp": true,
        "width": 24,
        "collapse": false,
        "className": ""
    },
    {
        "id": "5d2c762b30aa4565",
        "type": "ui_group",
        "name": "Group 13",
        "tab": "da612906.998368",
        "order": 13,
        "disp": true,
        "width": 6
    },
    {
        "id": "89738f37a85241c4",
        "type": "ui_group",
        "name": "Group 14",
        "tab": "da612906.998368",
        "order": 14,
        "disp": true,
        "width": 6
    },
    {
        "id": "6f46629ba1286c64",
        "type": "ui_tab",
        "d": true,
        "name": "Jobs",
        "icon": "fa-hand-o-right ",
        "order": 5,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "48c415689cc2322d",
        "type": "ui_group",
        "name": "Submit Jobs",
        "tab": "6f46629ba1286c64",
        "order": 1,
        "disp": true,
        "width": 23,
        "collapse": false,
        "className": ""
    },
    {
        "id": "feff05cd26e0da54",
        "type": "ui_spacer",
        "z": "67991373.45438c",
        "name": "spacer",
        "group": "440f78388bf9306a",
        "order": 2,
        "width": 1,
        "height": 1
    },
    {
        "id": "34fc56d907f44e90",
        "type": "ui_spacer",
        "z": "67991373.45438c",
        "name": "spacer",
        "group": "440f78388bf9306a",
        "order": 3,
        "width": 1,
        "height": 1
    },
    {
        "id": "f081928bfa9474f1",
        "type": "ui_spacer",
        "z": "67991373.45438c",
        "name": "spacer",
        "group": "440f78388bf9306a",
        "order": 4,
        "width": 1,
        "height": 1
    },
    {
        "id": "8d5c276b9010e981",
        "type": "ui_spacer",
        "z": "67991373.45438c",
        "name": "spacer",
        "group": "440f78388bf9306a",
        "order": 5,
        "width": 1,
        "height": 1
    },
    {
        "id": "5b0ed2ae974ff3e1",
        "type": "ui_spacer",
        "z": "67991373.45438c",
        "name": "spacer",
        "group": "440f78388bf9306a",
        "order": 6,
        "width": 1,
        "height": 1
    },
    {
        "id": "8333ef5178609617",
        "type": "ui_spacer",
        "z": "67991373.45438c",
        "name": "spacer",
        "group": "440f78388bf9306a",
        "order": 7,
        "width": 1,
        "height": 1
    },
    {
        "id": "2a87ea2fcd055deb",
        "type": "ui_spacer",
        "z": "2e37e573b3c922d6",
        "name": "spacer",
        "group": "48c415689cc2322d",
        "order": 3,
        "width": 3,
        "height": 1
    },
    {
        "id": "1a149df4230a25af",
        "type": "ui_spacer",
        "z": "dad88d9a3132fed6",
        "name": "spacer",
        "group": "b833e8c774d49527",
        "order": 3,
        "width": "12",
        "height": "1"
    },
    {
        "id": "a5b67787a0857995",
        "type": "ui_group",
        "name": "Test Modules",
        "tab": "bdf641dc7b5208f4",
        "order": 1,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "96ded9aa7c8ec809",
        "type": "ui_group",
        "name": "RunButton",
        "tab": "bdf641dc7b5208f4",
        "order": 2,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "bdf641dc7b5208f4",
        "type": "ui_tab",
        "name": "Test Modules",
        "icon": "low_priority",
        "order": 4,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "1d1a43b7179c848f",
        "type": "ui_group",
        "name": "Modules Data",
        "tab": "bdf641dc7b5208f4",
        "order": 4,
        "disp": false,
        "width": "12",
        "collapse": false,
        "className": ""
    },
    {
        "id": "22fec4fdabbf9dd8",
        "type": "ui_group",
        "name": "Test Workflow",
        "tab": "bdf641dc7b5208f4",
        "order": 3,
        "disp": true,
        "width": "18",
        "collapse": true,
        "className": ""
    },
    {
        "id": "67fb647abfca8480",
        "type": "ui_tab",
        "d": true,
        "name": "Generate Module",
        "icon": "create",
        "order": 11,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "a54754fb1b7c0694",
        "type": "ui_group",
        "name": "Generate Module",
        "tab": "67fb647abfca8480",
        "order": 1,
        "disp": true,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "cda97de97a6ab5af",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "4060ccd3b1b979fd",
        "order": 5,
        "width": 2,
        "height": 1
    },
    {
        "id": "4056c92d3a414fd7",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "4060ccd3b1b979fd",
        "order": 6,
        "width": 2,
        "height": 1
    },
    {
        "id": "833d7d828f8328c3",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "4060ccd3b1b979fd",
        "order": 7,
        "width": 2,
        "height": 1
    },
    {
        "id": "b71fc71692bc6998",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "4060ccd3b1b979fd",
        "order": 8,
        "width": 2,
        "height": 1
    },
    {
        "id": "86991d3793824c70",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 3,
        "width": 1,
        "height": 1
    },
    {
        "id": "93c16abbd60e16e9",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 4,
        "width": 1,
        "height": 1
    },
    {
        "id": "4d2c5d1e634706f6",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 5,
        "width": 1,
        "height": 1
    },
    {
        "id": "6c8945e62b438f68",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 6,
        "width": 7,
        "height": 1
    },
    {
        "id": "cd5d8f7c483cf0fc",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 7,
        "width": 7,
        "height": 1
    },
    {
        "id": "ecb503ea12a48f34",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 8,
        "width": 24,
        "height": 1
    },
    {
        "id": "cab7c0490b969b39",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 10,
        "width": 1,
        "height": 1
    },
    {
        "id": "1ef59fc55a23dbad",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 11,
        "width": 1,
        "height": 1
    },
    {
        "id": "99f0f80f5f6d3888",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 12,
        "width": 1,
        "height": 1
    },
    {
        "id": "ea3da41992b12683",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 13,
        "width": 1,
        "height": 1
    },
    {
        "id": "3a6a13848cf97e33",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 14,
        "width": 1,
        "height": 1
    },
    {
        "id": "111523e01594e21a",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 15,
        "width": 1,
        "height": 1
    },
    {
        "id": "79e8b37bd2f09079",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 16,
        "width": 1,
        "height": 1
    },
    {
        "id": "7058dd9de41c265d",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 17,
        "width": 1,
        "height": 1
    },
    {
        "id": "35ada157080b586f",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1f48566b.e8958a",
        "order": 18,
        "width": 1,
        "height": 1
    },
    {
        "id": "21e596d96f158341",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "1d5401bf95a96f03",
        "order": 4,
        "width": 16,
        "height": 1
    },
    {
        "id": "55560d79181246b2",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "18a5a593fcd64912",
        "order": 3,
        "width": 19,
        "height": 1
    },
    {
        "id": "ef4f9868d6da5e21",
        "type": "ui_group",
        "name": "Group 3",
        "tab": "67fb647abfca8480",
        "order": 3,
        "disp": false,
        "width": "16",
        "collapse": false,
        "className": ""
    },
    {
        "id": "1fd1ba27e7ae64a1",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "ef4f9868d6da5e21",
        "order": 1,
        "width": 16,
        "height": 1
    },
    {
        "id": "6146efe4fbffe50e",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "ef4f9868d6da5e21",
        "order": 3,
        "width": 16,
        "height": 1
    },
    {
        "id": "e73ad52bf519244c",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "ef4f9868d6da5e21",
        "order": 4,
        "width": 16,
        "height": 1
    },
    {
        "id": "ac5c58b8b6cfd606",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "ef4f9868d6da5e21",
        "order": 5,
        "width": 16,
        "height": 1
    },
    {
        "id": "53dfa9c43a688027",
        "type": "ui_spacer",
        "z": "5e1c7c0d7569a4cb",
        "name": "spacer",
        "group": "ef4f9868d6da5e21",
        "order": 6,
        "width": 16,
        "height": 1
    },
    {
        "id": "ff743e3024d7db10",
        "type": "ui_group",
        "name": "Group 3",
        "tab": "67fb647abfca8480",
        "order": 3,
        "disp": true,
        "width": 6
    },
    {
        "id": "da64493a5c1e0b09",
        "type": "ui_tab",
        "name": "Modules Flow",
        "icon": "dvr",
        "order": 12,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "6414e38571345793",
        "type": "ui_group",
        "name": "Modules Flow",
        "tab": "da64493a5c1e0b09",
        "order": 1,
        "disp": true,
        "width": "18",
        "collapse": false,
        "className": ""
    },
    {
        "id": "eb430edea69b48da",
        "type": "ui_group",
        "name": "JOBS",
        "tab": "07c042ece455f3bd",
        "order": 4,
        "disp": true,
        "width": "24",
        "collapse": true,
        "className": ""
    },
    {
        "id": "07c042ece455f3bd",
        "type": "ui_tab",
        "d": true,
        "name": "Microservice",
        "icon": "show_chart",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "01239f0e2e5d8173",
        "type": "Kafka Broker",
        "name": "Connect to kafka",
        "hosts": [
            {
                "host": "kafka",
                "port": 9092
            }
        ],
        "hostsEnvVar": "",
        "connectTimeout": "10000",
        "requestTimeout": "30000",
        "autoConnect": "true",
        "idleConnection": "5",
        "reconnectOnIdle": "true",
        "maxAsyncRequests": "10",
        "checkInterval": "10",
        "selfSign": true,
        "usetls": false,
        "useCredentials": false
    },
    {
        "id": "44b7aa4c.212894",
        "type": "Kafka Broker",
        "name": "Kafta",
        "hosts": [
            {
                "host": "127.0.0.1",
                "port": 9092
            }
        ],
        "hostsEnvVar": "",
        "connectTimeout": "10000",
        "requestTimeout": "30000",
        "autoConnect": "true",
        "idleConnection": "5",
        "reconnectOnIdle": "true",
        "maxAsyncRequests": "10",
        "checkInterval": "10",
        "selfSign": true,
        "usetls": false,
        "useCredentials": false
    },
    {
        "id": "a734a95fe6c7b3dc",
        "type": "kafka-broker",
        "name": "broker",
        "hosts": "kafka:9092",
        "selfsign": false,
        "usetls": false,
        "cacert": "",
        "clientcert": "",
        "privatekey": "",
        "passphrase": ""
    },
    {
        "id": "48f7a1eaae28d5a3",
        "type": "ui_group",
        "name": "factsAndRules",
        "tab": "07c042ece455f3bd",
        "order": 1,
        "disp": false,
        "width": "8",
        "collapse": false,
        "className": ""
    },
    {
        "id": "996eec6072a83356",
        "type": "ui_group",
        "name": "gotQBES",
        "tab": "07c042ece455f3bd",
        "order": 2,
        "disp": false,
        "width": "8",
        "collapse": false,
        "className": ""
    },
    {
        "id": "114d7a8d369bd580",
        "type": "ui_group",
        "name": "gotFLOW",
        "tab": "07c042ece455f3bd",
        "order": 3,
        "disp": false,
        "width": "8",
        "collapse": false,
        "className": ""
    },
    {
        "id": "e9f83f755d518ecd",
        "type": "ui_group",
        "name": "Clear",
        "tab": "07c042ece455f3bd",
        "order": 5,
        "disp": false,
        "width": "1",
        "collapse": false,
        "className": ""
    },
    {
        "id": "363a5e14b79b0d91",
        "type": "ui_spacer",
        "z": "5b93d75bf6b1464b",
        "name": "spacer",
        "group": "6aa5bf7487c31263",
        "order": 1,
        "width": 3,
        "height": 1
    },
    {
        "id": "47cdc2e371d44f95",
        "type": "ui_spacer",
        "z": "5b93d75bf6b1464b",
        "name": "spacer",
        "group": "6aa5bf7487c31263",
        "order": 2,
        "width": 3,
        "height": 1
    },
    {
        "id": "1ccc2ab592ae4ac3",
        "type": "ui_spacer",
        "z": "5b93d75bf6b1464b",
        "name": "spacer",
        "group": "6aa5bf7487c31263",
        "order": 3,
        "width": 3,
        "height": 1
    },
    {
        "id": "e72f590098c84fb5",
        "type": "ui_spacer",
        "z": "5b93d75bf6b1464b",
        "name": "spacer",
        "group": "c33a1024a72aa169",
        "order": 1,
        "width": 1,
        "height": 1
    },
    {
        "id": "d25654593e23b264",
        "type": "digitaloak-postgresql-connection-manager",
        "d": true,
        "name": "postgres",
        "host": "aies-cloud-aurora-pg-dev-instance-1.cjflqg3bd6i9.us-gov-east-1.rds.amazonaws.com",
        "port": "5432",
        "database": "space_ite",
        "tls": "",
        "use_tls": false,
        "pool_max_clients": "10",
        "pool_client_max_idle": "10000",
        "client_query_timeout": "",
        "client_statement_timeout": "",
        "client_connection_timeout_millis": "",
        "is_client_enabled": "1"
    },
    {
        "id": "1662f824ae61bd7c",
        "type": "ui_tab",
        "d": true,
        "name": "Balance Test",
        "icon": "dashboard",
        "order": 11,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "f1ba9b7b3ccb3021",
        "type": "ui_group",
        "name": "After QBES",
        "tab": "1662f824ae61bd7c",
        "order": 1,
        "disp": true,
        "width": 8,
        "collapse": false,
        "className": ""
    },
    {
        "id": "05ad88d05dd28ef3",
        "type": "ui_group",
        "name": "After Balance Module",
        "tab": "1662f824ae61bd7c",
        "order": 2,
        "disp": true,
        "width": 8,
        "collapse": false,
        "className": ""
    },
    {
        "id": "20ae1e52d1eef983",
        "type": "postgreSQLConfig",
        "name": "myuser@timescale:5432/iot",
        "host": "timescale",
        "hostFieldType": "str",
        "port": "5432",
        "portFieldType": "num",
        "database": "iot",
        "databaseFieldType": "str",
        "ssl": "false",
        "sslFieldType": "bool",
        "max": "10",
        "maxFieldType": "num",
        "idle": "1000",
        "idleFieldType": "num",
        "connectionTimeout": "10000",
        "connectionTimeoutFieldType": "num",
        "user": "myuser",
        "userFieldType": "str",
        "password": "???",
        "passwordFieldType": "str"
    },
    {
        "id": "96a4a629f038cff3",
        "type": "tls-config",
        "z": "e28cd8ccfbe21b33",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "b7b0a64e307b71f5",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "481a641c4005d1c8",
        "type": "postgreSQLConfig",
        "name": "conn",
        "host": "aies-cloud-aurora-pg-dev-instance-1.cjflqg3bd6i9.us-gov-east-1.rds.amazonaws.com",
        "hostFieldType": "str",
        "port": "DB_PORT",
        "portFieldType": "env",
        "database": "DB_DATABASE",
        "databaseFieldType": "env",
        "ssl": "false",
        "sslFieldType": "bool",
        "applicationName": "",
        "applicationNameType": "str",
        "max": "10",
        "maxFieldType": "num",
        "idle": "10000",
        "idleFieldType": "num",
        "connectionTimeout": "10000",
        "connectionTimeoutFieldType": "num",
        "user": "DB_USER",
        "userFieldType": "env",
        "password": "RootNew123!!",
        "passwordFieldType": "str"
    },
    {
        "id": "9a0d32273f30aad5",
        "type": "comment",
        "z": "c5ce2d38887016b2",
        "name": "Apply level type rules",
        "info": "",
        "x": 200,
        "y": 80,
        "wires": []
    },
    {
        "id": "7fabfc204b7200d7",
        "type": "switch",
        "z": "c5ce2d38887016b2",
        "name": "Sort By Level Type",
        "property": "payload.facts.level_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "c",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "d",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "e",
                "vt": "str"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 570,
        "y": 320,
        "wires": [
            [
                "2ea82a98af688f5a"
            ],
            [
                "f533c299c2a137bd"
            ],
            [
                "8a476e37206a1b82"
            ],
            [
                "8a476e37206a1b82"
            ]
        ]
    },
    {
        "id": "2ea82a98af688f5a",
        "type": "function",
        "z": "c5ce2d38887016b2",
        "name": "Execute Company level rules",
        "func": "msg.query = `select id, name, description, active, type, rvs,    parsed_rule->>'event' as event ,parsed_rule->>'conditions' as conditions,  (parsed_rule)::TEXT parsed_rule, data   from aies.rules_repository where type like '%' `\nmsg.topic = 'facts'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 280,
        "wires": [
            [
                "769cdae6ee0fb68f"
            ]
        ]
    },
    {
        "id": "f533c299c2a137bd",
        "type": "function",
        "z": "c5ce2d38887016b2",
        "name": "Execute KAU/ESTAB RULES",
        "func": "msg.query = `select id, name, description, active, type, rvs,    parsed_rule->>'event' as event ,parsed_rule->>'conditions' as conditions,  (parsed_rule)::TEXT parsed_rule, data   from aies.rules_repository where type = 'KAU/ESTAB' `\nmsg.topic = 'facts'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 320,
        "wires": [
            [
                "769cdae6ee0fb68f"
            ]
        ]
    },
    {
        "id": "8a476e37206a1b82",
        "type": "function",
        "z": "c5ce2d38887016b2",
        "name": "Execute Estab Level Rules",
        "func": "msg.query = `select id, name, description, active, type, rvs,    parsed_rule->>'event' as event ,parsed_rule->>'conditions' as conditions,  (parsed_rule)::TEXT parsed_rule, data   from aies.rules_repository where type = 'estab' `\nmsg.topic='facts'\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 360,
        "wires": [
            [
                "769cdae6ee0fb68f"
            ]
        ]
    },
    {
        "id": "769cdae6ee0fb68f",
        "type": "digitaloak-postgresql-query",
        "z": "c5ce2d38887016b2",
        "name": "PG-AIES: Get rules",
        "server": "ea3e0b5d6b96f47a",
        "inputs": 1,
        "outputs": 1,
        "x": 1130,
        "y": 320,
        "wires": [
            [
                "1ef95ce134a911b9"
            ]
        ]
    },
    {
        "id": "1ef95ce134a911b9",
        "type": "function",
        "z": "c5ce2d38887016b2",
        "name": "Get rules",
        "func": "msg.payload = msg.payload.rows\nmsg.topic = 'rules'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1320,
        "y": 320,
        "wires": [
            [
                "715ae02.ffcb82"
            ]
        ]
    },
    {
        "id": "e2519c448954167b",
        "type": "function",
        "z": "c5ce2d38887016b2",
        "name": "Qbes: Call Rule Editor",
        "func": "msg.factsArray = [msg.facts]\nmsg.payload = {factsArray: [msg.facts], facts: msg.facts, rules: msg.rules}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1420,
        "y": 220,
        "wires": [
            [
                "8c5e71d5a2a04ba2"
            ]
        ]
    },
    {
        "id": "715ae02.ffcb82",
        "type": "function",
        "z": "c5ce2d38887016b2",
        "name": "Merge Facts and Rules",
        "func": "context.data = context.data || new Object();\n\nswitch (msg.topic) {\n    case \"facts\":\n        context.data.facts = msg.payload.data[0].facts;\n        msg = null;\n        break;\n    case \"rules\":\n        context.data.rules = msg.payload;\n        msg = null;\n        break;\n    case \"task3\":\n        context.data.task3 = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n\n}\n\nif(context.data.rules != null && context.data.facts != null && context.data.task3 == null) {\n\tlet msg2 = new Object();\n    msg2 = context.data;\n    context.data=null;\n\treturn msg2;\n} else return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 220,
        "wires": [
            [
                "e2519c448954167b"
            ]
        ]
    },
    {
        "id": "a288d737bb052e78",
        "type": "function",
        "z": "c5ce2d38887016b2",
        "name": "Input Facts",
        "func": "// msg.payload.facts = msg.payload.data[0].facts\nmsg.topic = 'facts'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 130,
        "y": 220,
        "wires": [
            [
                "b98b1004c0382a3d"
            ]
        ]
    },
    {
        "id": "b98b1004c0382a3d",
        "type": "function",
        "z": "c5ce2d38887016b2",
        "name": "Split to get facts and rules",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 220,
        "wires": [
            [
                "715ae02.ffcb82",
                "7fabfc204b7200d7"
            ]
        ]
    },
    {
        "id": "8c5e71d5a2a04ba2",
        "type": "debug",
        "z": "c5ce2d38887016b2",
        "name": "debug 11",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1340,
        "y": 120,
        "wires": []
    },
    {
        "id": "bcba475dfd370f23",
        "type": "function",
        "z": "b99b7893add8c369",
        "name": "5.0 Logical Check",
        "func": "msg.action = 'Logical Check'\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "89b27031e68b3415",
        "type": "function",
        "z": "27fccef587c0b218",
        "name": "6.0 Ratio/Range Testing",
        "func": "msg.actions.ratioRangeTestingCompleted = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "6ed3a94bca74bb19",
        "type": "function",
        "z": "3fa869ffe40596e5",
        "name": "7.0 Post Ratio/Range",
        "func": "msg.actions.postRatioRangeCompleted = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "ac1127915ee1fd4b",
        "type": "function",
        "z": "98b684914b5fce08",
        "name": "8.0 Unit Balance",
        "func": "msg.actions.unitBalanceCompleted = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "f40a55ca93f943db",
        "type": "function",
        "z": "2e55e3e8510e62d0",
        "name": "9.0 Company Additivity Check",
        "func": "msg.actions.companyAdditivityCheckCompleted = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "42dbbd9f093bf42e",
        "type": "function",
        "z": "2ad5fa373c21d0a3",
        "name": "10.0 Derived Items",
        "func": "msg.actions.derivedItemsCompleted = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "57bc9e5538773197",
        "type": "function",
        "z": "045ba1012eb08b50",
        "name": "3.0 All Units",
        "func": "msg.actions.allUnitsCompleted = true\nmsg.actions.determineStatusCompleted = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "6681b08b.4a688",
        "type": "file in",
        "z": "82cc831b154f3133",
        "name": "Read File",
        "filename": "payload",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 200,
        "y": 140,
        "wires": [
            [
                "e843fa29.885718"
            ]
        ]
    },
    {
        "id": "e843fa29.885718",
        "type": "csv",
        "z": "82cc831b154f3133",
        "name": "",
        "sep": ",",
        "hdrin": true,
        "hdrout": "none",
        "multi": "mult",
        "ret": "\\r\\n",
        "temp": "",
        "skip": "0",
        "strings": true,
        "include_empty_strings": false,
        "include_null_values": false,
        "x": 350,
        "y": 140,
        "wires": [
            [
                "99680b80968eef8c",
                "a2cbb8c5837a6f57"
            ]
        ]
    },
    {
        "id": "99680b80968eef8c",
        "type": "function",
        "z": "82cc831b154f3133",
        "name": "Convert Parameter File to Pre-Processed Rules",
        "func": "let preRules = []\n\nmsg.payload.map((r, k) => {\n\n\n// Build conditionstring cs\nlet cs  = r['CONDITION'] || 'PAY_ANN > 0'\n\nlet shortCondition = r['Short Condition'] || ''\n\ncs = (shortCondition == '') ? cs : shortCondition + ' and ' + cs\n\n\n\n\n    let actionStringRHS = ''\n    let action =[] // [{ 'FAILURE': true }]\n    let actionString = (r['ACTIONSTRING']).trim()\n\n    // actionString = (actionString.endsWith(\";\")) ? actionString.slice(0, -1) + \"\" : \"\"\n    \n\n\n  \n\n    let arr = actionString.split(\";\");\n\n    for (let i = 0; i < arr.length; i++) {\n        const equation = arr[i];\n        const [key, val] = equation.split(/(?<=^[^\\=]+)\\=/) //split(\"=\");\n\n\n        let c_key = key.replace(/[^\\x20-\\x7E]/g, \"\").trim()\n        let c_value = val.replace(\" eq \", \"=\").trim()\n\n        if (key)\n            action.push({ [c_key]: c_value });\n    }\n    \n   \n// GET DETAIL TOTALS:\nlet SUM_DET = ''\nlet SUM_DET_ARRAY = []\n\n\n\n\nfor(let j = 0 ; j < 14; ++j){\n    \n    let detVar = r['DETAIL ' + j] ? r['DETAIL ' + j] : ''\n   if(detVar !=='') SUM_DET_ARRAY.push(detVar) \n}\n\n\nif(SUM_DET_ARRAY.length > 0){\n    action.push({ [\"TOTAL\"]: r['TOTAL'] }) \nSUM_DET = SUM_DET_ARRAY.join(' + ')\naction.push({\"SUM_DET\":SUM_DET })\n\n\n}\n    let sector = r['SECTOR/TRADE'] ? r['SECTOR/TRADE'] : \"All\"\n    let validationType = \"Sector \"+sector\n\n\n\n //&& r['ACTIONSTRING'] != '' ? r['ACTIONSTRING'] :  [{'FAILURE': true}]\n    preRules.push({ \n    key: k+2, \n    ruleId: k+2,\n    type: k+2,\n    priority: r['PRIORITY'] || 5,\n    conditionstring:  cs ,\n    message: r['DESCRIPTION'], \n    action,\n    actionString: JSON.stringify(action),\n    validationType,\n    sector\n    })\n\n})\n\nmsg.preRules = preRules\nmsg.params = preRules\nmsg.payload = {paramFile: preRules}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 200,
        "wires": [
            [
                "5ab2c885ede5e880",
                "fff3d06b988e5233",
                "da484b090d083d49"
            ]
        ]
    },
    {
        "id": "5ab2c885ede5e880",
        "type": "function",
        "z": "82cc831b154f3133",
        "name": "Load the pre-rules table",
        "func": "msg.payload = msg.params\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 180,
        "wires": [
            [
                "4440c71e.f88f18"
            ]
        ]
    },
    {
        "id": "fff3d06b988e5233",
        "type": "http request",
        "z": "82cc831b154f3133",
        "name": "API call to Analyse Parameters Rules File",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/rulesrepo/stringsToRules?DEBUG=true",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            }
        ],
        "x": 1040,
        "y": 420,
        "wires": [
            [
                "8302074bca046e52",
                "a53fbc532450d88c",
                "c370fdc0adea4b18",
                "634a65c934af51b3",
                "62671df4cfe27264",
                "6c832fce46c1bafb",
                "a6cace27ff79a8fb"
            ]
        ]
    },
    {
        "id": "5cfa292979246c14",
        "type": "ui_table",
        "z": "82cc831b154f3133",
        "group": "5c07c02344a2bd3d",
        "name": "1.0 CSV Import Parameters File",
        "order": 1,
        "width": 24,
        "height": 5,
        "columns": [
            {
                "field": "key",
                "title": "Row",
                "width": "80",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "SECTOR/TRADE",
                "title": "SECTOR/TRADE",
                "width": "80",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "NAICS",
                "title": "NAICS",
                "width": "40%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "Short Condition",
                "title": "Message",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "CONDITION",
                "title": "CONDITION",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "DESCRIPTION",
                "title": "DESCRIPTION",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "UNIT TYPE",
                "title": "UNIT TYPE",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "TOTAL",
                "title": "",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 990,
        "y": 80,
        "wires": []
    },
    {
        "id": "4440c71e.f88f18",
        "type": "ui_table",
        "z": "82cc831b154f3133",
        "group": "1f48566b.e8958a",
        "name": "2. Processed Pre-Rule",
        "order": 1,
        "width": 17,
        "height": 5,
        "columns": [
            {
                "field": "key",
                "title": "Row",
                "width": "80",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "conditionstring",
                "title": "Condition",
                "width": "40%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "message",
                "title": "Message",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "actionString",
                "title": "Action",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 1300,
        "y": 180,
        "wires": []
    },
    {
        "id": "7deb55a4c358e093",
        "type": "ui_table",
        "z": "82cc831b154f3133",
        "group": "18a5a593fcd64912",
        "name": "3. Processed Rules",
        "order": 1,
        "width": 24,
        "height": 5,
        "columns": [
            {
                "field": "rule.event.ruleId",
                "title": "Row",
                "width": "80",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "conditionstring",
                "title": "Condition",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "actiontring",
                "title": "Action",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "output.success",
                "title": "Success",
                "width": "",
                "align": "left",
                "formatter": "tickCross",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "output.message",
                "title": "Error Message",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "output.value",
                "title": "Condition Value",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "JSON.stringify(output)",
                "title": "Output",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 1710,
        "y": 500,
        "wires": []
    },
    {
        "id": "8302074bca046e52",
        "type": "change",
        "z": "82cc831b154f3133",
        "name": "Results from rules compilation",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.results",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1430,
        "y": 500,
        "wires": [
            [
                "7deb55a4c358e093"
            ]
        ]
    },
    {
        "id": "a53fbc532450d88c",
        "type": "change",
        "z": "82cc831b154f3133",
        "name": "Errors in condition from compilation",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.conditionError",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1440,
        "y": 560,
        "wires": [
            [
                "10cad444a2f23d2e"
            ]
        ]
    },
    {
        "id": "10cad444a2f23d2e",
        "type": "ui_table",
        "z": "82cc831b154f3133",
        "group": "18a5a593fcd64912",
        "name": "3.1. Condition Errors",
        "order": 4,
        "width": 24,
        "height": 3,
        "columns": [
            {
                "field": "ruleId",
                "title": "Row",
                "width": "80",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "message",
                "title": "Error Message",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "expression",
                "title": "Condition",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 1720,
        "y": 560,
        "wires": []
    },
    {
        "id": "c370fdc0adea4b18",
        "type": "change",
        "z": "82cc831b154f3133",
        "name": "Facts Needed from compilation",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.factsNeededNameValue",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1430,
        "y": 620,
        "wires": [
            [
                "2451d69dcbe26c12"
            ]
        ]
    },
    {
        "id": "2451d69dcbe26c12",
        "type": "ui_table",
        "z": "82cc831b154f3133",
        "group": "18a5a593fcd64912",
        "name": "3.2. Facts Needed",
        "order": 5,
        "width": 24,
        "height": 2,
        "columns": [
            {
                "field": "name",
                "title": "Row",
                "width": "80",
                "align": "left",
                "formatter": "rownum",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "name",
                "title": "Name",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "value",
                "title": "Value",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 1710,
        "y": 620,
        "wires": []
    },
    {
        "id": "a2cbb8c5837a6f57",
        "type": "function",
        "z": "82cc831b154f3133",
        "name": "Add Key to the csv rows",
        "func": "\n\nmsg.payload = msg.payload.map((p, k) => { return { ...p, ...{ key: k+2 } } })\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 80,
        "wires": [
            [
                "5cfa292979246c14"
            ]
        ]
    },
    {
        "id": "634a65c934af51b3",
        "type": "ui_gauge",
        "z": "82cc831b154f3133",
        "name": "Gauge for Errors",
        "group": "4060ccd3b1b979fd",
        "order": 2,
        "width": 4,
        "height": 4,
        "gtype": "gage",
        "title": "Errors",
        "label": "units",
        "format": "{{msg.payload.outputErrorCount}}",
        "min": 0,
        "max": "10",
        "colors": [
            "#a4110e",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1440,
        "y": 280,
        "wires": []
    },
    {
        "id": "62671df4cfe27264",
        "type": "ui_gauge",
        "z": "82cc831b154f3133",
        "name": "Gauge for Rules",
        "group": "4060ccd3b1b979fd",
        "order": 1,
        "width": 4,
        "height": 4,
        "gtype": "gage",
        "title": "Rules",
        "label": "rules",
        "format": "{{msg.payload.results.length}}",
        "min": 0,
        "max": "500",
        "colors": [
            "#3cb226",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1440,
        "y": 340,
        "wires": []
    },
    {
        "id": "6c832fce46c1bafb",
        "type": "ui_gauge",
        "z": "82cc831b154f3133",
        "name": "Gauge for Params",
        "group": "4060ccd3b1b979fd",
        "order": 3,
        "width": 4,
        "height": 4,
        "gtype": "gage",
        "title": "Params",
        "label": "units",
        "format": "{{msg.payload.factsNeededNameValue.length}}",
        "min": 0,
        "max": "1000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1430,
        "y": 400,
        "wires": []
    },
    {
        "id": "aea84a7e33de6f9b",
        "type": "function",
        "z": "82cc831b154f3133",
        "name": "Utility Functions",
        "func": "\n    // function to convert string of equations to JSON array\n    function stringToJSON (str){\n    \n\n        // function cleanupString(str) { return str.replace(/[^\\x20-\\x7E]/g, \"\").trim(); }\n    \n    let arr = str.split(\";\");\n    let json = [];\n    for (let i = 0; i < arr.length; i++) {\n        const equation = arr[i];\n        const [key, val] = equation.split(/(?<=^[^\\=]+)\\=/) //split(\"=\");\n\n        if (key)\n            json.push({ [cleanupString(key)]: cleanupString(val.replace(\" eq \", \"=\")) });\n    }\n    return json;\n}\n\nfunction cleanupString(str){ return str.replace(/[^\\x20-\\x7E]/g, \"\").trim(); }",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "c7bbcb8e289cfe40",
        "type": "catch",
        "z": "82cc831b154f3133",
        "name": "Catch read file errors",
        "scope": null,
        "uncaught": false,
        "x": 220,
        "y": 520,
        "wires": [
            [
                "e5ae3f0c5950f841"
            ]
        ]
    },
    {
        "id": "260189c8c6ed366b",
        "type": "ui_toast",
        "z": "82cc831b154f3133",
        "position": "top right",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 690,
        "y": 520,
        "wires": []
    },
    {
        "id": "e5ae3f0c5950f841",
        "type": "function",
        "z": "82cc831b154f3133",
        "name": "function 9",
        "func": "msg.payload = msg.error.message\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 600,
        "wires": [
            [
                "260189c8c6ed366b",
                "ba709063e175e036"
            ]
        ]
    },
    {
        "id": "ba709063e175e036",
        "type": "debug",
        "z": "82cc831b154f3133",
        "name": "debug 27",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 620,
        "wires": []
    },
    {
        "id": "da484b090d083d49",
        "type": "debug",
        "z": "82cc831b154f3133",
        "name": "debug 30",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 280,
        "wires": []
    },
    {
        "id": "a6cace27ff79a8fb",
        "type": "debug",
        "z": "82cc831b154f3133",
        "name": "debug 31",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1780,
        "y": 320,
        "wires": []
    },
    {
        "id": "fc793926435fab57",
        "type": "function",
        "z": "03552ca229e3a7a0",
        "name": "Unit balance",
        "func": "// node.status({ fill: \"green\", shape: \"dot\", text: \"processing\" });\n\n// // msg.payload.csv[0].module = \"_\"\n\n// // setTimeout(function () {\n//     node.status({ fill: \"gray\", shape: \"ring\", text: \"complete\" });\n// //     node.send(msg);\n// // }, 1000);\n\n// return msg;\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "0d6b190eb1914ef7",
        "type": "status",
        "z": "03552ca229e3a7a0",
        "name": "",
        "scope": null,
        "x": 80,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "934d95644c951dfc",
        "type": "function",
        "z": "acd9862f30af144d",
        "name": "pv function",
        "func": "node.status({ fill: \"green\", shape: \"dot\", text: \"processing\" });\n\nmsg.payload.csv[0].module = \"PV\"\n\nsetTimeout(function () {\n    node.status({ fill: \"gray\", shape: \"ring\", text: \"complete\" });\n    node.send(msg);\n}, 1000);\n\n// return msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 200,
        "y": 180,
        "wires": [
            [
                "e8e5ce05e046c9d9"
            ]
        ]
    },
    {
        "id": "e8e5ce05e046c9d9",
        "type": "debug",
        "z": "acd9862f30af144d",
        "name": "debug pv",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 390,
        "y": 80,
        "wires": []
    },
    {
        "id": "4c82868047e24054",
        "type": "status",
        "z": "acd9862f30af144d",
        "name": "",
        "scope": null,
        "x": 80,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "b434c43de5c1d938",
        "type": "switch",
        "z": "fd9469a0efbb8a77",
        "name": "Failure Present?",
        "property": "payload.csv[0].failure",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 200,
        "y": 220,
        "wires": [
            [
                "d66fac8c4c3bb78d"
            ],
            [
                "9a55ae0518d49324"
            ]
        ]
    },
    {
        "id": "a050c1e9c09bb79b",
        "type": "debug",
        "z": "fd9469a0efbb8a77",
        "name": "Go To: Company Additivity Check",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 80,
        "wires": []
    },
    {
        "id": "d66fac8c4c3bb78d",
        "type": "function",
        "z": "fd9469a0efbb8a77",
        "name": "Failure is not present",
        "func": "msg.payload.csv[0].action = \"Go To: Company Additivity Check\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 80,
        "wires": [
            [
                "a050c1e9c09bb79b",
                "e2d5eecae0459e01"
            ]
        ]
    },
    {
        "id": "9a55ae0518d49324",
        "type": "switch",
        "z": "fd9469a0efbb8a77",
        "name": "SUM(DET) = 0 || SUM(DET) > 0",
        "property": "payload.csv[0][\"SUM(DET)\"]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 470,
        "y": 400,
        "wires": [
            [
                "9b1962c64c2c07e2"
            ],
            [
                "4cc6035382f3ea7a"
            ]
        ]
    },
    {
        "id": "9b1962c64c2c07e2",
        "type": "switch",
        "z": "fd9469a0efbb8a77",
        "name": "SUM(DET)=0 && [TOT = 0 || TOT >0]",
        "property": "payload.csv[0][\"TOT\"]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 810,
        "y": 320,
        "wires": [
            [
                "6053781493dfb0b1"
            ],
            [
                "6317702816aa4ba2"
            ]
        ]
    },
    {
        "id": "4cc6035382f3ea7a",
        "type": "switch",
        "z": "fd9469a0efbb8a77",
        "name": "SUM(DET)=0 && [TOT = 0 || TOT >0]",
        "property": "payload.csv[0][\"TOT\"]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 810,
        "y": 480,
        "wires": [
            [
                "c2fe26e13a6e3760"
            ],
            [
                "2d18e26adfa1b919"
            ]
        ]
    },
    {
        "id": "c2fe26e13a6e3760",
        "type": "function",
        "z": "fd9469a0efbb8a77",
        "name": "SUM(DET)>0 and TOT=0",
        "func": "msg.payload.csv[0][\"TOT\"] = msg.payload.csv[0][\"SUM(DET)\"]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 460,
        "wires": [
            [
                "460a791591a2945d",
                "e2d5eecae0459e01"
            ]
        ]
    },
    {
        "id": "6317702816aa4ba2",
        "type": "function",
        "z": "fd9469a0efbb8a77",
        "name": "SUM(DET)=0 and TOT>0",
        "func": "msg.payload.csv[0].action = \"Proate data based on X(DET) = TOT\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 340,
        "wires": [
            [
                "29bfadfdb81eb75c",
                "e2d5eecae0459e01"
            ]
        ]
    },
    {
        "id": "6053781493dfb0b1",
        "type": "function",
        "z": "fd9469a0efbb8a77",
        "name": "SUM(DET)=0 and TOT=0",
        "func": "msg.payload.csv[0].action = \"Impute?\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 300,
        "wires": [
            [
                "398160dcf99fe49a",
                "e2d5eecae0459e01"
            ]
        ]
    },
    {
        "id": "2d18e26adfa1b919",
        "type": "function",
        "z": "fd9469a0efbb8a77",
        "name": "SUM(DET)>0 and TOT>0",
        "func": "msg.payload.csv[0][\"ESMD\"] = msg.payload.csv[0][\"SUM(DET)\"] / msg.payload.csv[0][\"TOT\"]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 580,
        "wires": [
            [
                "47685bf5fb1ed88c"
            ]
        ]
    },
    {
        "id": "398160dcf99fe49a",
        "type": "debug",
        "z": "fd9469a0efbb8a77",
        "name": "balance output 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 300,
        "wires": []
    },
    {
        "id": "29bfadfdb81eb75c",
        "type": "debug",
        "z": "fd9469a0efbb8a77",
        "name": "balance output 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 340,
        "wires": []
    },
    {
        "id": "460a791591a2945d",
        "type": "debug",
        "z": "fd9469a0efbb8a77",
        "name": "balance output 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 460,
        "wires": []
    },
    {
        "id": "47685bf5fb1ed88c",
        "type": "switch",
        "z": "fd9469a0efbb8a77",
        "name": "msg.payload[\"ESMD\"]",
        "property": "payload.csv[0][\"ESMD\"]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "btwn",
                "v": "0.8",
                "vt": "num",
                "v2": "1.2",
                "v2t": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1320,
        "y": 580,
        "wires": [
            [
                "466e6266875d4f84"
            ],
            [
                "1523c9203f9b1679"
            ]
        ]
    },
    {
        "id": "466e6266875d4f84",
        "type": "function",
        "z": "fd9469a0efbb8a77",
        "name": "Set TOTAL = SUM(DET)",
        "func": "msg.payload.csv[0][\"TOTAL\"] = msg.payload.csv[0][\"SUM(DET)\"]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1570,
        "y": 540,
        "wires": [
            [
                "49177b2204272b93",
                "e2d5eecae0459e01"
            ]
        ]
    },
    {
        "id": "1523c9203f9b1679",
        "type": "switch",
        "z": "fd9469a0efbb8a77",
        "name": "INDP(ind and geo)>1?",
        "property": "payload.csv[0].INDP",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1560,
        "y": 640,
        "wires": [
            [
                "a80c397a4f5c5239"
            ],
            [
                "ce5bb9d4308895db"
            ]
        ]
    },
    {
        "id": "49177b2204272b93",
        "type": "debug",
        "z": "fd9469a0efbb8a77",
        "name": "balance output 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1790,
        "y": 540,
        "wires": []
    },
    {
        "id": "1d6bdfbeb72fbec3",
        "type": "debug",
        "z": "fd9469a0efbb8a77",
        "name": "balance output 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2010,
        "y": 620,
        "wires": []
    },
    {
        "id": "f0325560707bbd38",
        "type": "debug",
        "z": "fd9469a0efbb8a77",
        "name": "balance output 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1970,
        "y": 660,
        "wires": []
    },
    {
        "id": "a80c397a4f5c5239",
        "type": "function",
        "z": "fd9469a0efbb8a77",
        "name": "SET IMPUTATION FLAG",
        "func": "msg.payload.csv[0].action = \"SET IMPUTATION FLAG?\"\nmsg.payload.csv[0][\"Varx-IMBALANCE\"] = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1790,
        "y": 620,
        "wires": [
            [
                "1d6bdfbeb72fbec3",
                "e2d5eecae0459e01"
            ]
        ]
    },
    {
        "id": "ce5bb9d4308895db",
        "type": "function",
        "z": "fd9469a0efbb8a77",
        "name": "Rake (DET) = TOT",
        "func": "msg.payload.csv[0][\"Rake(DET)\"] = msg.payload.csv[0][\"TOT\"]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1770,
        "y": 660,
        "wires": [
            [
                "f0325560707bbd38",
                "e2d5eecae0459e01"
            ]
        ]
    },
    {
        "id": "92892d34775a5fc5",
        "type": "status",
        "z": "fd9469a0efbb8a77",
        "name": "",
        "scope": null,
        "x": 1000,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "e2d5eecae0459e01",
        "type": "function",
        "z": "fd9469a0efbb8a77",
        "name": "function 24",
        "func": "node.status({ fill: \"green\", shape: \"dot\", text: \"processing\" });\n\nmsg.payload.csv[0].module = \"Unit Balance\"\n\nsetTimeout(function () {\n    node.status({ fill: \"gray\", shape: \"ring\", text: \"complete\" });\n    node.send(msg);\n}, 1000);\n\n// return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1830,
        "y": 180,
        "wires": [
            [
                "0855387c3dd8f9d0"
            ]
        ]
    },
    {
        "id": "3de7d4b88b6bc5dc",
        "type": "debug",
        "z": "fd9469a0efbb8a77",
        "name": "debug 52",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 140,
        "y": 320,
        "wires": []
    },
    {
        "id": "0855387c3dd8f9d0",
        "type": "debug",
        "z": "fd9469a0efbb8a77",
        "name": "BALANCE OUTPUT",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2000,
        "y": 100,
        "wires": []
    },
    {
        "id": "a209d5855b2b60f9",
        "type": "function",
        "z": "e28cd8ccfbe21b33",
        "name": "Get Body",
        "func": "msg.payload.NODE_TLS_REJECT_UNAUTHORIZED = env.get('NODE_TLS_REJECT_UNAUTHORIZED')\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "5507f546d88c96b5",
        "type": "http request",
        "z": "e28cd8ccfbe21b33",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "96a4a629f038cff3",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": true,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 570,
        "y": 240,
        "wires": [
            [
                "a209d5855b2b60f9"
            ]
        ]
    },
    {
        "id": "b768655d4c7a4024",
        "type": "function",
        "z": "e28cd8ccfbe21b33",
        "name": "POST API ",
        "func": "// msg.url = \"https://a301cb45559c445acaec11ab01bbbee1-2115632777.us-gov-east-1.elb.amazonaws.com/api/db_query/q\";\n\nmsg.url = \"https://mc.edl-7529180-ite.ite.edl.census.gov/api/db_query/q\";\n\nmsg.headers = {\n    \"Content-Type\": \"application/json\"\n};\nmsg.payload = {\n        q: \"SELECT * from space_product_aies.item_estabs limit 100\" \n};\nreturn msg;\n\n// q: \"SELECT * from space_uat.space_product_aies.item_estabs limit 100\" \n// curl --location 'https://mc.edl-7529180-ite.ite.edl.census.gov/api/db_query/q' --header 'Content-Type: application/json' --data '{ \"q\": \"SELECT * from space_product_aies.item_estabs limit 1\" }'",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 240,
        "wires": [
            [
                "5507f546d88c96b5"
            ]
        ]
    },
    {
        "id": "d97e7c0dec380b3d",
        "type": "function",
        "z": "5eae5184a8f175fd",
        "name": "nonnorm function",
        "func": "const setCharAtPosition = (str, index, char) => {\n    if (index > str.length - 1) return str;\n    return str.substring(0, index) + char + str.substring(index + 1);\n};\nfunction setCharAt(str, index, chr) {\n    if (typeof str === 'undefined' || str === null || str === '') {\n        return '__' + chr;\n    } else {\n        if (index > str.length - 1) {\n            return str.padEnd(index, '_') + chr;\n        }\n        return str.substring(0, index) + chr + str.substring(index + 1);\n    }\n}\nconst pathA = (record) => {\n    if (record.OPSTATS === '4') {\n        record.OPSTATS = 'N';\n    } else if (record.OPSTATS === '5' && parseInt(record.ACTV_MIO_NUM) > 12) {\n        record.OPSTATS = 'Y';\n    }\n};\n\nconst pathB = (record) => {\n    record.OPSTATS = setCharAtPosition(record.OPSTATS || '   ', 2, 'R');\n};\n\nconst pathC = (record) => {\n    record.OPSTATS = setCharAtPosition(record.OPSTATS || '   ', 2, '*');\n};\n\nconst pathD = (record) => {\n    record.OPSTATS = 'N';\n};\n\nconst pathX = (record) => {\n   record['ACTION'] = \"Invalid RECORD_TYP_TXT value\";\n};\n\nconst initACTVMIONUMAndSetOPSTATS = (record) => {\n    const mioNum = parseInt(record.ACTV_MIO_NUM) || 0;\n    if (mioNum === 0 || mioNum > 12) {\n        record.ACTV_MIO_NUM = '12';\n        record[\"ACTV_MIO_NUM_F\"] = setCharAt(record[\"ACTV_MIO_NUM_F\"], 2, 'J');\n        record.OPSTATS = ' ';\n        return pathC(record);\n    } else {\n        return setOPSTATS_RorAsterisk(record);\n    }\n};\n\nconst setOPSTATS_RorAsterisk = (record) => {\n    if ((record.COVCODE === '111' || record.COVCODE === '113' || record.COVCODE === '791') &&\n        parseInt(record.ACTV_MIO_NUM) < 12 &&\n        record.COVC_CHG_DATE.startsWith('JAN-204')) {\n        record.OPSTATS = setCharAtPosition(record.OPSTATS || '   ', 2, 'R');\n    } else {\n        record.OPSTATS = setCharAtPosition(record.OPSTATS || '   ', 1, '*');\n    }\n    return pathC(record);\n};\n\nconst processRecord = (record) => {\n    if (!['10', '20', '30', '90'].includes(record.RECORD_TYP_TXT)) {\n        return pathX(record);\n    }\n    initACTVMIONUMAndSetOPSTATS(record);\n\n    if (record.OPSTAT_STAT === '4') {\n        pathD(record);\n    } else if (record.OPSTAT_STAT === '5' && parseInt(record.ACTV_MIO_NUM) > 12) {\n        pathA(record);\n    } else {\n        pathC(record);\n    }\n};\n\nlet record_idx = global.get(\"ptrModuleFacts\");\nconst record = msg.payload.csv[record_idx];\n\ntry {\n    processRecord(record);\n} catch (error) {\n    console.error(\"Error:\", error.message);\n    record.ACTION = \"Error processing record\";\n}\n\nmsg.payload.csv[record_idx] = record;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "7dbfcdc951fc4a9f",
        "type": "function",
        "z": "24afab78ca973c73",
        "name": "KAU To Company Additivity Check",
        "func": "function setCharAt(str, index, chr) {\n    if ([null, undefined].includes(str)) {\n        let newstr = ''\n        for (let i = 0; i < index; i++) {\n            newstr = newstr + ' ';\n        }\n        newstr = newstr + chr\n        return newstr;\n    } else {\n        if (index > str.length - 1) {\n            let addstr = index - str.length\n            let newstr = str\n            for (let i = 0; i < addstr; i++) {\n                newstr = newstr + ' ';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            return str.substring(0, index) + chr + str.substring(index + 1);\n        }\n    }\n}\n\nlet record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\nconst PAY_ANN_VAL = parseFloat(record['PAY_ANN_VAL'])\nconst PAY_ANN_PRDWRK_VAL = parseFloat(record['PAY_ANN_PRDWRK_VAL'])\nconst PAY_ANN_NONPRDWRK_VAL = parseFloat(record['PAY_ANN_NONPRDWRK_VAL'])\nconst EMP_MAR12_NUM = parseFloat(record['EMP_MAR12_NUM'])\nconst EMP_MAR12_PRDWRK_NUM = parseFloat(record['EMP_MAR12_PRDWRK_NUM'])\nconst EMP_MAR12_NONPRDWRK_NUM = parseFloat(record['EMP_MAR12_NONPRDWRK_NUM'])\nconst PAY_QTR1_VAL = parseFloat(record['PAY_QTR1_VAL'])\nconst PAY_QTR1_PRDWRK_VAL = parseFloat(record['PAY_QTR1_PRDWRK_VAL'])\nconst PAY_QTR1_NONPRDWRK_VAL = parseFloat(record['PAY_QTR1_NONPRDWRK_VAL'])\n\nif ((EMP_MAR12_PRDWRK_NUM + EMP_MAR12_NONPRDWRK_NUM == 0) && EMP_MAR12_NUM > 0) {\n    if (PAY_ANN_PRDWRK_VAL > 0 && PAY_ANN_NONPRDWRK_VAL > 0 && PAY_ANN_VAL > 0) {\n        record['EMP_MAR12_PRDWRK_NUM'] = Math.round((PAY_ANN_PRDWRK_VAL / PAY_ANN_VAL) * EMP_MAR12_NUM)\n        record['EMP_MAR12_NONPRDWRK_NUM'] = Math.round((PAY_ANN_NONPRDWRK_VAL / PAY_ANN_VAL) * EMP_MAR12_NUM)\n        record['EMP_MAR12_PRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_PRDWRK_NUM_F'], 2, 'J');\n        record['EMP_MAR12_NONPRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_NONPRDWRK_NUM_F'], 2, 'J');\n    } else if (PAY_QTR1_NONPRDWRK_VAL > 0 && PAY_QTR1_PRDWRK_VAL > 0 && PAY_QTR1_VAL > 0) {\n        record['EMP_MAR12_PRDWRK_NUM'] = Math.round((PAY_QTR1_PRDWRK_VAL / PAY_QTR1_VAL) * EMP_MAR12_NUM)\n        record['EMP_MAR12_NONPRDWRK_NUM'] = Math.round((PAY_QTR1_NONPRDWRK_VAL / PAY_QTR1_VAL) * EMP_MAR12_NUM)\n        record['EMP_MAR12_PRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_PRDWRK_NUM_F'], 2, 'J');\n        record['EMP_MAR12_NONPRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_NONPRDWRK_NUM_F'], 2, 'J');\n    } else {\n        record['EMP_MAR12_PRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_PRDWRK_NUM_F'], 2, 'X');\n        record['EMP_MAR12_NONPRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_NONPRDWRK_NUM_F'], 2, 'X');\n    }\n} else if ((EMP_MAR12_NONPRDWRK_NUM + EMP_MAR12_PRDWRK_NUM > 0) && EMP_MAR12_NUM > 0) {\n    if (EMP_MAR12_NONPRDWRK_NUM + EMP_MAR12_PRDWRK_NUM != EMP_MAR12_NUM) {\n        if (EMP_MAR12_PRDWRK_NUM == 0 && (EMP_MAR12_NONPRDWRK_NUM < EMP_MAR12_NUM)) {\n            record['EMP_MAR12_PRDWRK_NUM'] = EMP_MAR12_NUM - EMP_MAR12_NONPRDWRK_NUM\n            record['EMP_MAR12_PRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_PRDWRK_NUM_F'], 2, 'J');\n        } else if (EMP_MAR12_NONPRDWRK_NUM == 0 && (EMP_MAR12_PRDWRK_NUM < EMP_MAR12_NUM)) {\n            record['EMP_MAR12_NONPRDWRK_NUM'] = EMP_MAR12_NUM - EMP_MAR12_PRDWRK_NUM\n            record['EMP_MAR12_NONPRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_NONPRDWRK_NUM_F'], 2, 'J');\n        } else if (.8 <= (EMP_MAR12_PRDWRK_NUM + EMP_MAR12_NONPRDWRK_NUM) / EMP_MAR12_NUM &&\n            (EMP_MAR12_PRDWRK_NUM + EMP_MAR12_NONPRDWRK_NUM) / EMP_MAR12_NUM <= 1.2) {\n            const TEMP_DET_TOT = EMP_MAR12_PRDWRK_NUM + EMP_MAR12_NONPRDWRK_NUM\n            const TEMP_EMP_PRDWORK = Math.round((EMP_MAR12_PRDWRK_NUM / TEMP_DET_TOT) * EMP_MAR12_NUM)\n            const TEMP_EMP_NONPRDWORK = Math.round((EMP_MAR12_NONPRDWRK_NUM / TEMP_DET_TOT) * EMP_MAR12_NUM)\n            if (TEMP_EMP_PRDWORK + TEMP_EMP_NONPRDWORK == EMP_MAR12_NUM) {\n                record['EMP_MAR12_NONPRDWRK_NUM'] = TEMP_EMP_NONPRDWORK\n                record['EMP_MAR12_PRDWRK_NUM'] = TEMP_EMP_PRDWORK\n            } else if (TEMP_EMP_PRDWORK > TEMP_EMP_NONPRDWORK) {\n                record['EMP_MAR12_PRDWRK_NUM'] = TEMP_EMP_PRDWORK + Math.round(EMP_MAR12_NUM - TEMP_EMP_NONPRDWORK)\n                record['EMP_MAR12_PRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_PRDWRK_NUM_F'], 2, 'K');\n            } else {\n                record['EMP_MAR12_NONPRDWRK_NUM'] = TEMP_EMP_NONPRDWORK + Math.round(EMP_MAR12_NUM - TEMP_EMP_PRDWORK)\n                record['EMP_MAR12_NONPRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_NONPRDWRK_NUM_F'], 2, 'K');\n            }\n        } else {\n            record['EMP_MAR12_PRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_PRDWRK_NUM_F'], 2, 'X');\n            record['EMP_MAR12_NONPRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_NONPRDWRK_NUM_F'], 2, 'X');\n        }\n    }\n}\n\nrecord['ACTION'] = 'Go To: PAYQTR1'\n// global.set('action', 'Go To: PAYQTR1')\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "09b6017c32b68df0",
        "type": "function",
        "z": "6e56f7f07e320f38",
        "name": "estab_to_kau database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts\n    let record = msg.payload.csv[record_idx];\n    let estabs = msg.estabs\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function childFlagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            let id = record?.KAU_ID\n            for (let i in details) {\n                let detail = details[i]\n                for (let j in estabs) {\n                    let row = estabs[j].facts\n                    if (row?.['KAU_ID'] == id && row?.TABSTAT == 'Y' && ['MU', 'SU'].includes(row?.REPORTING_ID_TYP_TXT)) {\n                        if (row?.[detail]) {\n                            if (['R_', 'K_', 'T_'].includes(row?.[detail].substring(0, 2))) {\n                                found = 'Y'\n                            } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(row?.[detail]?.charAt(1))) {\n                                found = 'Y'\n                            } else {\n                                found = 'N'\n                                break\n                            }\n                            // } else {\n                            //     found = 'N'\n                            //     break\n                        }\n                    }\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    let list = ['RCPT_TOT_VAL', 'EMP_MAR12_NUM', 'PAY_ANN_VAL', 'PAY_QTR1_VAL', 'CAPEX_NEW_TOT_DVAL']\n\n    for (let i in list) {\n        let name = list[i]\n        let name_f = name + '_F'\n        let temptot = 0\n        let id = record?.KAU_ID\n        for (let i in estabs) {\n            let row = estabs[i].facts\n            if (row?.KAU_ID == id && row?.TABSTAT == 'Y' && ['MU', 'SU'].includes(row?.REPORTING_ID_TYP_TXT)) {\n                temptot = temptot + parseFloat(row?.[name])\n            }\n        }\n        if (parseFloat(record?.[name]) == parseFloat(temptot)) {\n        } else if (parseFloat(record?.[name]) == 0 && parseFloat(temptot) > 0) {\n            record[name] = temptot\n            childFlagRules(name, [name_f])\n        } else if (0.8 <= parseFloat(record?.[name]) / parseFloat(temptot) && parseFloat(record?.[name]) / parseFloat(temptot) <= 1.2) {\n            record[name] = temptot\n            childFlagRules(name, [name_f])\n        } else {\n            record[name_f] = setCharAt(record?.[name_f],2,'X')\n        }\n    }\n\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Estab to KAU'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "87790c3eda62986b",
        "type": "function",
        "z": "6e56f7f07e320f38",
        "name": "estab_to_kau",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\")\n    let record = msg.payload.csv[record_idx];\n    let estabs = msg.payload.csv\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function childFlagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            let id = record?.KAU_ID\n            for (let i in details) {\n                let detail = details[i]\n                for (let j in estabs) {\n                    let row = estabs[j]\n                    if (row?.['KAU_ID'] == id && row?.TABSTAT == 'Y' && ['MU','SU'].includes(row?.REPORTING_ID_TYP_TXT)) {\n                        if (row?.[detail]) {\n                            if (['R_', 'K_', 'T_'].includes(row?.[detail].substring(0, 2))) {\n                                found = 'Y'\n                            } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(row?.[detail]?.charAt(1))) {\n                                found = 'Y'\n                            } else {\n                                found = 'N'\n                                break\n                            }\n                            // } else {\n                            //     found = 'N'\n                            //     break\n                        }\n                    }\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    let list = ['RCPT_TOT_VAL', 'EMP_MAR12_NUM', 'PAY_ANN_VAL', 'PAY_QTR1_VAL', 'CAPEX_NEW_TOT_DVAL']\n\n    for (let i in list) {\n        let name = list[i]\n        let name_f = name + '_F'\n        let temptot = 0\n        let id = record?.KAU_ID\n        for (let i in estabs) {\n            let row = estabs[i]\n            if (row?.KAU_ID == id && row?.TABSTAT == 'Y' && ['MU','SU'].includes(row?.REPORTING_ID_TYP_TXT)) {\n                temptot = temptot + parseFloat(row?.[name])\n            }\n        }\n        if (parseFloat(record?.[name]) == parseFloat(temptot)) {\n        } else if (parseFloat(record?.[name]) == 0 && parseFloat(temptot) > 0) {\n            record[name] = temptot\n            childFlagRules(name, [name_f])\n        } else if (0.8 <= parseFloat(record?.[name]) / parseFloat(temptot) && parseFloat(record?.[name]) / parseFloat(temptot) <= 1.2) {\n            record[name] = temptot\n            childFlagRules(name, [name_f])\n        } else {\n            record[name_f] = setCharAt(record?.[name_f],2,'X')\n        }\n    }\n\n    return msg;\n} catch (e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'Estab to KAU'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "06c65e098f9bf276",
        "type": "function",
        "z": "6e56f7f07e320f38",
        "name": "reset msg",
        "func": "msg.estabs = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 280,
        "wires": [
            [
                "09b6017c32b68df0"
            ]
        ]
    },
    {
        "id": "8161f4cc1389a89c",
        "type": "function",
        "z": "6e56f7f07e320f38",
        "name": "query_estabs",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.KAU_ID\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where kau_id = '\" + id + \"' and type = 'ESTAB' and jobname = '\" + job +\"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 160,
        "wires": [
            [
                "781ba1f7b3fe37f0"
            ]
        ]
    },
    {
        "id": "781ba1f7b3fe37f0",
        "type": "subflow:8032608991ae0162",
        "z": "6e56f7f07e320f38",
        "name": "",
        "x": 560,
        "y": 160,
        "wires": [
            [
                "06c65e098f9bf276"
            ]
        ]
    },
    {
        "id": "8c066284600dbc44",
        "type": "function",
        "z": "0be109393cb5f28a",
        "name": "check cache",
        "func": "// Retrieve the lookupCache\nlet cache = global.get(\"lookupCache\") || { data: [] };\n\n// Initialize msg.payload.lookup if it's not already an object\nmsg.payload.lookup = msg.payload.lookup || {};\n\n// List to keep track of missing parameters\nlet missingParams = [];\n\n// Check if the required params and their types exist in the cache\nif (msg?.payload?.lookup?.params){\n    for (let param of msg.payload.lookup.params.split(\",\")) {\n        let cachedValue = cache?.data && cache.data.find(\n            (cacheItem) =>\n                cacheItem.param === param.key && cacheItem.type === param.type\n        );\n\n        if (!cachedValue) {\n            missingParams.push(param);\n        }\n    }\n}\n\n\n// If there are missing parameters, set msg.payload.lookup.needsFetch to true\nif (missingParams.length > 0) {\n    msg.payload.lookup.needsFetch = true;\n    msg.payload.lookup.missingParams = missingParams;\n} else {\n    msg.payload.lookup.needsFetch = false;\n}\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 100,
        "wires": [
            [
                "ce1e0380f0f1b0f9"
            ]
        ]
    },
    {
        "id": "ce1e0380f0f1b0f9",
        "type": "function",
        "z": "0be109393cb5f28a",
        "name": "prepare API Request",
        "func": "const { moduleName, program, unit_type, missingParams } = msg.payload.lookup;\nconst params = (missingParams.length && missingParams.join(\",\")) || \"\";\n// const apiurl = `${(env.get('CENSUS_API') || 'https://mc.edl-7529180-ite.ite.edl.census.gov/api/').trim()}params?module=${moduleName}&params=${params}&program=${program}&unit_type=${unit_type}`;\nconst apiurl = `${('a301cb45559c445acaec11ab01bbbee1-2115632777.us-gov-east-1.elb.amazonaws.com/api/').trim()}params?module=${moduleName}&params=${params}&program=${program}&unit_type=${unit_type}`;\nmsg.url = apiurl;\nmsg.payloadBackup = msg.payload;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 100,
        "wires": [
            [
                "6c16d5bbc3143a33"
            ]
        ]
    },
    {
        "id": "6c16d5bbc3143a33",
        "type": "http request",
        "z": "0be109393cb5f28a",
        "name": "Lookup data API",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 1210,
        "y": 100,
        "wires": [
            [
                "f5dbe24054de29ce"
            ]
        ]
    },
    {
        "id": "f5dbe24054de29ce",
        "type": "function",
        "z": "0be109393cb5f28a",
        "name": "cache result",
        "func": "let cache = global.get(\"lookupCache\");\ncache = Array.isArray(cache?.data) ? cache : {\"data\":[]}\n\n// Get the payload\nlet payload = msg.payload;\n\n// Check if the API call was successful\nif (payload.status === \"success\") {\n\n    // Get the data array\n    let dataArr = payload.data;\n\n    // Extract the necessary fields from the API response and update the cache\n    for (let item of dataArr) {\n        const { id, module, param, values, json_values, program, unit_type } = item;\n        cache.data.push({ id, module, param, values, json_values, program, unit_type });\n    }\n    msg.payload = { ...msg.payloadBackup, dataArr };\n\n}\n// Save the updated cache\nglobal.set(\"lookupCache\", cache)\n// msg.payload = { ...msg.payloadBackup, dataArr };\n// msg.payload.cache = cache;\ndelete msg.payloadBackup;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1430,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "331014954d894fe9",
        "type": "postgresql",
        "z": "8032608991ae0162",
        "name": "Select",
        "query": "",
        "postgreSQLConfig": "481a641c4005d1c8",
        "split": false,
        "rowsPerMsg": "1",
        "outputs": 1,
        "x": 950,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "e547d07fb4b3e318",
        "type": "postgresql",
        "z": "8032608991ae0162",
        "name": "Select",
        "query": "",
        "postgreSQLConfig": "481a641c4005d1c8",
        "split": false,
        "rowsPerMsg": "1",
        "outputs": 1,
        "x": 950,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "73281bb1471fee97",
        "type": "subflow:d32a58c0544f501c",
        "z": "e825fc8e32eb1364",
        "name": "",
        "x": 800,
        "y": 400,
        "wires": [
            [
                "ae433fa4228520c2"
            ]
        ]
    },
    {
        "id": "ae433fa4228520c2",
        "type": "switch",
        "z": "e825fc8e32eb1364",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 400,
        "wires": [
            [],
            [
                "319c5fef8300c280"
            ]
        ]
    },
    {
        "id": "319c5fef8300c280",
        "type": "switch",
        "z": "e825fc8e32eb1364",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 460,
        "wires": [
            [],
            [
                "a75e4e7f7aa178a5"
            ]
        ]
    },
    {
        "id": "a75e4e7f7aa178a5",
        "type": "subflow:48bdd199705157b9",
        "z": "e825fc8e32eb1364",
        "name": "",
        "x": 790,
        "y": 540,
        "wires": [
            [
                "83cbcd1e98fc4cc2"
            ]
        ]
    },
    {
        "id": "7c2706e2338f0d18",
        "type": "subflow:5e2c6717be2fdd36",
        "z": "e825fc8e32eb1364",
        "name": "",
        "x": 790,
        "y": 620,
        "wires": [
            [
                "9f3ad64be44f7098"
            ]
        ]
    },
    {
        "id": "83cbcd1e98fc4cc2",
        "type": "switch",
        "z": "e825fc8e32eb1364",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 540,
        "wires": [
            [],
            [
                "7c2706e2338f0d18"
            ]
        ]
    },
    {
        "id": "7ac782997ef097e8",
        "type": "subflow:b68b1cdb465a831c",
        "z": "e825fc8e32eb1364",
        "name": "",
        "x": 1020,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "9f3ad64be44f7098",
        "type": "switch",
        "z": "e825fc8e32eb1364",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 620,
        "wires": [
            [],
            [
                "7ac782997ef097e8"
            ]
        ]
    },
    {
        "id": "a32e7e21ab60c93b",
        "type": "subflow:7c74ea1220a33f32",
        "z": "e825fc8e32eb1364",
        "name": "",
        "x": 800,
        "y": 280,
        "wires": [
            [
                "9d789008caa8ba51"
            ]
        ]
    },
    {
        "id": "9d789008caa8ba51",
        "type": "switch",
        "z": "e825fc8e32eb1364",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 280,
        "wires": [
            [],
            [
                "4c6ceb5e898b5479"
            ]
        ]
    },
    {
        "id": "4c6ceb5e898b5479",
        "type": "switch",
        "z": "e825fc8e32eb1364",
        "name": "sector check",
        "property": "naicsSector",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 340,
        "wires": [
            [],
            [
                "73281bb1471fee97"
            ]
        ]
    },
    {
        "id": "135a1a788946edb0",
        "type": "subflow:f9cd233b8803b29d",
        "z": "e825fc8e32eb1364",
        "name": "",
        "x": 790,
        "y": 120,
        "wires": [
            [
                "c8552ac5cfd4a57b"
            ]
        ]
    },
    {
        "id": "c8552ac5cfd4a57b",
        "type": "switch",
        "z": "e825fc8e32eb1364",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 120,
        "wires": [
            [],
            [
                "06729ee2b17699f5"
            ]
        ]
    },
    {
        "id": "06729ee2b17699f5",
        "type": "switch",
        "z": "e825fc8e32eb1364",
        "name": "tabstat",
        "property": "tabstat",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "N",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "N",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1030,
        "y": 200,
        "wires": [
            [],
            [
                "a32e7e21ab60c93b"
            ]
        ]
    },
    {
        "id": "aab0f5d7be30ad59",
        "type": "subflow:e50e4180ad305262",
        "z": "e825fc8e32eb1364",
        "name": "",
        "x": 780,
        "y": 40,
        "wires": [
            [
                "5900496486cdfe9f"
            ]
        ]
    },
    {
        "id": "5900496486cdfe9f",
        "type": "switch",
        "z": "e825fc8e32eb1364",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 40,
        "wires": [
            [],
            [
                "135a1a788946edb0"
            ]
        ]
    },
    {
        "id": "889cdcc114ad738b",
        "type": "subflow:20d530cc0b193752",
        "z": "a2511614f51e5116",
        "name": "",
        "x": 700,
        "y": 240,
        "wires": [
            [
                "6700f51af1ec1fa4"
            ]
        ]
    },
    {
        "id": "6281647b8ba6014b",
        "type": "switch",
        "z": "a2511614f51e5116",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 950,
        "y": 300,
        "wires": [
            [
                "d555c694ed9727e0"
            ],
            [
                "03286cf55b146e4a"
            ]
        ]
    },
    {
        "id": "6700f51af1ec1fa4",
        "type": "switch",
        "z": "a2511614f51e5116",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 960,
        "y": 240,
        "wires": [
            [],
            [
                "6281647b8ba6014b"
            ]
        ]
    },
    {
        "id": "03286cf55b146e4a",
        "type": "subflow:b68b1cdb465a831c",
        "z": "a2511614f51e5116",
        "name": "",
        "x": 700,
        "y": 360,
        "wires": [
            [
                "8f9fba43c8083d31"
            ]
        ]
    },
    {
        "id": "a9c3ba8821f44f81",
        "type": "subflow:5e2c6717be2fdd36",
        "z": "a2511614f51e5116",
        "name": "",
        "x": 690,
        "y": 420,
        "wires": [
            [
                "c91361335e197281"
            ]
        ]
    },
    {
        "id": "8f9fba43c8083d31",
        "type": "switch",
        "z": "a2511614f51e5116",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 960,
        "y": 360,
        "wires": [
            [],
            [
                "a9c3ba8821f44f81"
            ]
        ]
    },
    {
        "id": "375da7f27ce5d62e",
        "type": "subflow:e4fb9739caef0397",
        "z": "a2511614f51e5116",
        "name": "",
        "x": 730,
        "y": 480,
        "wires": [
            [
                "5da81a3679e71ea4"
            ]
        ]
    },
    {
        "id": "c91361335e197281",
        "type": "switch",
        "z": "a2511614f51e5116",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 960,
        "y": 420,
        "wires": [
            [],
            [
                "375da7f27ce5d62e"
            ]
        ]
    },
    {
        "id": "5da81a3679e71ea4",
        "type": "switch",
        "z": "a2511614f51e5116",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 960,
        "y": 480,
        "wires": [
            [],
            [
                "9741b4afd2a3c405"
            ]
        ]
    },
    {
        "id": "9741b4afd2a3c405",
        "type": "subflow:b68b1cdb465a831c",
        "z": "a2511614f51e5116",
        "name": "",
        "x": 700,
        "y": 540,
        "wires": [
            [
                "261af4f23f3799f9"
            ]
        ]
    },
    {
        "id": "261af4f23f3799f9",
        "type": "switch",
        "z": "a2511614f51e5116",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 960,
        "y": 540,
        "wires": [
            [],
            [
                "922597150c5628c7"
            ]
        ]
    },
    {
        "id": "922597150c5628c7",
        "type": "subflow:96f29b19e2260e65",
        "z": "a2511614f51e5116",
        "name": "",
        "x": 1190,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "d555c694ed9727e0",
        "type": "subflow:96f29b19e2260e65",
        "z": "a2511614f51e5116",
        "name": "",
        "x": 1230,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "4e95996f9340ca3f",
        "type": "subflow:1ff4019fd0378d4a",
        "z": "a2511614f51e5116",
        "name": "",
        "x": 710,
        "y": 60,
        "wires": [
            [
                "a8113eded2e20f82"
            ]
        ]
    },
    {
        "id": "a8113eded2e20f82",
        "type": "switch",
        "z": "a2511614f51e5116",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 980,
        "y": 60,
        "wires": [
            [],
            [
                "d95a9e57db30c870"
            ]
        ]
    },
    {
        "id": "d95a9e57db30c870",
        "type": "subflow:f0920ac3618eb45b",
        "z": "a2511614f51e5116",
        "name": "",
        "x": 700,
        "y": 120,
        "wires": [
            [
                "5ace2b986f5525ec"
            ]
        ]
    },
    {
        "id": "5ace2b986f5525ec",
        "type": "switch",
        "z": "a2511614f51e5116",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 980,
        "y": 120,
        "wires": [
            [],
            [
                "4d97322daa54a9b6"
            ]
        ]
    },
    {
        "id": "4d97322daa54a9b6",
        "type": "switch",
        "z": "a2511614f51e5116",
        "name": "exit check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 980,
        "y": 180,
        "wires": [
            [
                "d555c694ed9727e0"
            ],
            [
                "889cdcc114ad738b"
            ]
        ]
    },
    {
        "id": "dbaacd53577bf3a4",
        "type": "subflow:20d530cc0b193752",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 820,
        "y": 360,
        "wires": [
            [
                "9e9b4cee68be6e9c"
            ]
        ]
    },
    {
        "id": "3f056fce77befeb6",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1050,
        "y": 420,
        "wires": [
            [],
            [
                "46ca51c8baab9696"
            ]
        ]
    },
    {
        "id": "c89db042ff61a895",
        "type": "subflow:c79b244779411ead",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 1360,
        "y": 880,
        "wires": [
            [
                "4d5edc2ef2a2765f"
            ]
        ]
    },
    {
        "id": "bbd77d5e5517779e",
        "type": "subflow:998aa04bd1bb677d",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 1340,
        "y": 820,
        "wires": [
            [
                "52b0141e97338396"
            ]
        ]
    },
    {
        "id": "1b840bc520e7c89c",
        "type": "subflow:89f071f1deb9a1b1",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 1360,
        "y": 940,
        "wires": [
            [
                "36eb5b1bc3f37a3f"
            ]
        ]
    },
    {
        "id": "9e9b4cee68be6e9c",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1040,
        "y": 360,
        "wires": [
            [],
            [
                "3f056fce77befeb6"
            ]
        ]
    },
    {
        "id": "e4f66c7916ddf51b",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1480,
        "y": 720,
        "wires": [
            [],
            [
                "bbd77d5e5517779e"
            ]
        ]
    },
    {
        "id": "52b0141e97338396",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1500,
        "y": 820,
        "wires": [
            [],
            [
                "c89db042ff61a895"
            ]
        ]
    },
    {
        "id": "4d5edc2ef2a2765f",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1560,
        "y": 880,
        "wires": [
            [],
            [
                "1b840bc520e7c89c"
            ]
        ]
    },
    {
        "id": "46ca51c8baab9696",
        "type": "subflow:bfe1ab19e0cbe2cf",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 790,
        "y": 480,
        "wires": [
            [
                "ca3f2d5ace132159"
            ]
        ]
    },
    {
        "id": "ca3f2d5ace132159",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1040,
        "y": 480,
        "wires": [
            [],
            [
                "c5fd0c1367eb5718"
            ]
        ]
    },
    {
        "id": "c5fd0c1367eb5718",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Go to: Derive NAICS Code Module",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Go to Main Routing",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 810,
        "y": 560,
        "wires": [
            [],
            [
                "24be28c88279c85e"
            ],
            [
                "bbd77d5e5517779e"
            ],
            []
        ]
    },
    {
        "id": "24be28c88279c85e",
        "type": "subflow:f07c9ae4084738fc",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 1040,
        "y": 620,
        "wires": [
            [
                "927b048b92d700b0"
            ]
        ]
    },
    {
        "id": "927b048b92d700b0",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1240,
        "y": 620,
        "wires": [
            [],
            [
                "c965214462093151"
            ]
        ]
    },
    {
        "id": "c965214462093151",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Action Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Go to: Derive MFG NAICS from NAPCS",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Go to: Derive MFG NAICS from NAPCS",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1230,
        "y": 680,
        "wires": [
            [
                "969a8179dd9281f7"
            ],
            [
                "bbd77d5e5517779e"
            ]
        ]
    },
    {
        "id": "969a8179dd9281f7",
        "type": "subflow:7e80c62ce8c753dc",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 1460,
        "y": 660,
        "wires": [
            [
                "e4f66c7916ddf51b"
            ]
        ]
    },
    {
        "id": "2c12356bd9caa505",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1570,
        "y": 1000,
        "wires": [
            [],
            [
                "52e06895cfe7a9e6"
            ]
        ]
    },
    {
        "id": "36eb5b1bc3f37a3f",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1560,
        "y": 940,
        "wires": [
            [],
            [
                "2c12356bd9caa505"
            ]
        ]
    },
    {
        "id": "52e06895cfe7a9e6",
        "type": "subflow:b68b1cdb465a831c",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 1580,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "89974ffc29206e69",
        "type": "subflow:6e56f7f07e320f38",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 800,
        "y": 300,
        "wires": [
            [
                "478bc0c651014446"
            ]
        ]
    },
    {
        "id": "478bc0c651014446",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1040,
        "y": 300,
        "wires": [
            [],
            [
                "dbaacd53577bf3a4"
            ]
        ]
    },
    {
        "id": "263d12a695ae25c7",
        "type": "subflow:7c74ea1220a33f32",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 820,
        "y": 60,
        "wires": [
            [
                "8333d3a99f8e7e21"
            ]
        ]
    },
    {
        "id": "8333d3a99f8e7e21",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1040,
        "y": 60,
        "wires": [
            [],
            [
                "7ba256c934b12f11"
            ]
        ]
    },
    {
        "id": "7ba256c934b12f11",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "sector check",
        "property": "naicsSector",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1050,
        "y": 120,
        "wires": [
            [],
            [
                "596b207b8eb4f966"
            ]
        ]
    },
    {
        "id": "596b207b8eb4f966",
        "type": "subflow:f0920ac3618eb45b",
        "z": "88823d21c11ae7b5",
        "name": "",
        "x": 860,
        "y": 180,
        "wires": [
            [
                "e5012db73e035f03"
            ]
        ]
    },
    {
        "id": "e5012db73e035f03",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1060,
        "y": 180,
        "wires": [
            [],
            [
                "c16f32959166880c"
            ]
        ]
    },
    {
        "id": "c16f32959166880c",
        "type": "switch",
        "z": "88823d21c11ae7b5",
        "name": "exit check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1040,
        "y": 240,
        "wires": [
            [],
            [
                "89974ffc29206e69"
            ]
        ]
    },
    {
        "id": "b8dffbc837e09dbf",
        "type": "subflow:20d530cc0b193752",
        "z": "e14f077595377a58",
        "name": "",
        "x": 340,
        "y": 320,
        "wires": [
            [
                "982c220cddec7b9e"
            ]
        ]
    },
    {
        "id": "667d49ec5c152ff6",
        "type": "subflow:42be4655fd3a8c84",
        "z": "e14f077595377a58",
        "name": "",
        "x": 370,
        "y": 440,
        "wires": [
            [
                "becd4f267d7bebe1"
            ]
        ]
    },
    {
        "id": "a8d0afe0ad18c9fd",
        "type": "subflow:b22812dba408ab8f",
        "z": "e14f077595377a58",
        "name": "",
        "x": 850,
        "y": 1040,
        "wires": [
            [
                "7b9d9404cfeb99a9"
            ]
        ]
    },
    {
        "id": "06a0625994ac9011",
        "type": "subflow:aadaa91727c0d579",
        "z": "e14f077595377a58",
        "name": "",
        "x": 840,
        "y": 1160,
        "wires": [
            [
                "fe6143ae0ee78339"
            ]
        ]
    },
    {
        "id": "314d98c5d25492d9",
        "type": "subflow:998aa04bd1bb677d",
        "z": "e14f077595377a58",
        "name": "",
        "x": 880,
        "y": 1240,
        "wires": [
            [
                "8a0ec78248fea72d"
            ]
        ]
    },
    {
        "id": "23b43e42c810bf25",
        "type": "subflow:f9a2a2262f95bae3",
        "z": "e14f077595377a58",
        "name": "",
        "x": 280,
        "y": 560,
        "wires": [
            [
                "fd75f640d7ac55f9"
            ]
        ]
    },
    {
        "id": "7a1fea64c667e62f",
        "type": "subflow:b93bf22bc3258992",
        "z": "e14f077595377a58",
        "name": "",
        "x": 340,
        "y": 620,
        "wires": [
            [
                "1c967b0b7f6535cc"
            ]
        ]
    },
    {
        "id": "e29018e0e821766d",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 380,
        "wires": [
            [],
            [
                "667d49ec5c152ff6"
            ]
        ]
    },
    {
        "id": "3fb8657c58c0b96a",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 500,
        "wires": [
            [],
            [
                "23b43e42c810bf25"
            ]
        ]
    },
    {
        "id": "c7c93637080bb37a",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Go to: Derive NAICS Code Module",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Go to Main Routing",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 590,
        "y": 820,
        "wires": [
            [],
            [
                "6d75a8d39cc75309"
            ],
            [
                "a8d0afe0ad18c9fd"
            ],
            []
        ]
    },
    {
        "id": "6d75a8d39cc75309",
        "type": "subflow:f07c9ae4084738fc",
        "z": "e14f077595377a58",
        "name": "",
        "x": 900,
        "y": 820,
        "wires": [
            [
                "8b7d688028229f6a"
            ]
        ]
    },
    {
        "id": "b9767a492667090b",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1090,
        "y": 1100,
        "wires": [
            [],
            [
                "06a0625994ac9011"
            ]
        ]
    },
    {
        "id": "982c220cddec7b9e",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 580,
        "y": 320,
        "wires": [
            [],
            [
                "e29018e0e821766d"
            ]
        ]
    },
    {
        "id": "becd4f267d7bebe1",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 580,
        "y": 440,
        "wires": [
            [],
            [
                "3fb8657c58c0b96a"
            ]
        ]
    },
    {
        "id": "fd75f640d7ac55f9",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 580,
        "y": 560,
        "wires": [
            [],
            [
                "7a1fea64c667e62f"
            ]
        ]
    },
    {
        "id": "1c967b0b7f6535cc",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 580,
        "y": 620,
        "wires": [
            [],
            [
                "29eb453255f19080"
            ]
        ]
    },
    {
        "id": "37794fbf4726f868",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 580,
        "y": 740,
        "wires": [
            [],
            [
                "c7c93637080bb37a"
            ]
        ]
    },
    {
        "id": "8b7d688028229f6a",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1100,
        "y": 820,
        "wires": [
            [],
            [
                "afd4c16e678e8c91"
            ]
        ]
    },
    {
        "id": "7b9d9404cfeb99a9",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1080,
        "y": 1040,
        "wires": [
            [],
            [
                "b9767a492667090b"
            ]
        ]
    },
    {
        "id": "fe6143ae0ee78339",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1080,
        "y": 1160,
        "wires": [
            [],
            [
                "314d98c5d25492d9"
            ]
        ]
    },
    {
        "id": "8a0ec78248fea72d",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1080,
        "y": 1240,
        "wires": [
            [],
            [
                "c448b41ae77a3f25"
            ]
        ]
    },
    {
        "id": "1dc183ab4a8e863f",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1080,
        "y": 1320,
        "wires": [
            [],
            [
                "50650294e1916d2a"
            ]
        ]
    },
    {
        "id": "29eb453255f19080",
        "type": "subflow:e7b7501b29427db9",
        "z": "e14f077595377a58",
        "name": "",
        "x": 360,
        "y": 680,
        "wires": [
            [
                "846313c80863bec1"
            ]
        ]
    },
    {
        "id": "433199b7a17d6ed6",
        "type": "subflow:7e80c62ce8c753dc",
        "z": "e14f077595377a58",
        "name": "",
        "x": 1060,
        "y": 900,
        "wires": [
            [
                "0e421a8775d3359f"
            ]
        ]
    },
    {
        "id": "afd4c16e678e8c91",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Action Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Go to: Derive MFG NAICS from NAPCS",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Go to: Derive MFG NAICS from NAPCS",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 830,
        "y": 900,
        "wires": [
            [
                "433199b7a17d6ed6"
            ],
            [
                "a8d0afe0ad18c9fd"
            ]
        ]
    },
    {
        "id": "0e421a8775d3359f",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1080,
        "y": 960,
        "wires": [
            [],
            [
                "a8d0afe0ad18c9fd"
            ]
        ]
    },
    {
        "id": "c448b41ae77a3f25",
        "type": "subflow:c79b244779411ead",
        "z": "e14f077595377a58",
        "name": "",
        "x": 860,
        "y": 1320,
        "wires": [
            [
                "1dc183ab4a8e863f"
            ]
        ]
    },
    {
        "id": "33b7f2bf8eb4a2b1",
        "type": "subflow:bfe1ab19e0cbe2cf",
        "z": "e14f077595377a58",
        "name": "",
        "x": 370,
        "y": 740,
        "wires": [
            [
                "37794fbf4726f868"
            ]
        ]
    },
    {
        "id": "50650294e1916d2a",
        "type": "subflow:89f071f1deb9a1b1",
        "z": "e14f077595377a58",
        "name": "",
        "x": 1080,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "846313c80863bec1",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 580,
        "y": 680,
        "wires": [
            [],
            [
                "33b7f2bf8eb4a2b1"
            ]
        ]
    },
    {
        "id": "6ba9ddc736a3e71f",
        "type": "subflow:a307acf02307bc62",
        "z": "e14f077595377a58",
        "name": "",
        "x": 340,
        "y": 140,
        "wires": [
            [
                "55a0f64d6e87c32e"
            ]
        ]
    },
    {
        "id": "ee52a2b66cdd88bd",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 200,
        "wires": [
            [],
            [
                "7fc303034f2f837f"
            ]
        ]
    },
    {
        "id": "55a0f64d6e87c32e",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 580,
        "y": 140,
        "wires": [
            [],
            [
                "ee52a2b66cdd88bd"
            ]
        ]
    },
    {
        "id": "7fc303034f2f837f",
        "type": "subflow:1088c7f7eed8781b",
        "z": "e14f077595377a58",
        "name": "",
        "x": 330,
        "y": 260,
        "wires": [
            [
                "969c3b5329eb0481"
            ]
        ]
    },
    {
        "id": "969c3b5329eb0481",
        "type": "switch",
        "z": "e14f077595377a58",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 580,
        "y": 260,
        "wires": [
            [],
            [
                "b8dffbc837e09dbf"
            ]
        ]
    },
    {
        "id": "3e9afa1acdca1e32",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "reporting_id_typ_txt",
        "property": "reporting_id_typ_txt",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "SU",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "MU",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "KAU",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ENT",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 750,
        "y": 1080,
        "wires": [
            [
                "fc0c85ce082b26e4"
            ],
            [
                "fc0c85ce082b26e4"
            ],
            [
                "39050c3eef239ea1"
            ],
            [
                "773cb441a5d13b57"
            ],
            []
        ]
    },
    {
        "id": "1f8d2cb257e19b70",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2130,
        "y": 1020,
        "wires": [
            [
                "1ea6bf1688faa74b"
            ],
            [
                "1ea6bf1688faa74b"
            ]
        ]
    },
    {
        "id": "1e5319cbac33e97f",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2120,
        "y": 960,
        "wires": [
            [
                "1ea6bf1688faa74b"
            ],
            [
                "1f8d2cb257e19b70"
            ]
        ]
    },
    {
        "id": "bfc3a1bacf9af003",
        "type": "subflow:e14f077595377a58",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 1840,
        "y": 80,
        "wires": [
            [
                "1c45742cdc12965c"
            ]
        ]
    },
    {
        "id": "1c45742cdc12965c",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2080,
        "y": 80,
        "wires": [
            [
                "45bb5e2345aab7b4"
            ],
            [
                "bd278438baa90fee"
            ]
        ]
    },
    {
        "id": "bd278438baa90fee",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2090,
        "y": 120,
        "wires": [
            [
                "45bb5e2345aab7b4"
            ],
            [
                "45bb5e2345aab7b4"
            ]
        ]
    },
    {
        "id": "5b233b4cdb3e2eae",
        "type": "subflow:88823d21c11ae7b5",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 1860,
        "y": 580,
        "wires": [
            [
                "abf305bf5f16e7c0"
            ]
        ]
    },
    {
        "id": "abf305bf5f16e7c0",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2100,
        "y": 580,
        "wires": [
            [
                "d31a515ec0b1407d"
            ],
            [
                "a233ce1a38eca575"
            ]
        ]
    },
    {
        "id": "a233ce1a38eca575",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1850,
        "y": 640,
        "wires": [
            [
                "aabad68ca0355312"
            ],
            [
                "7086890ee73ff32c"
            ]
        ]
    },
    {
        "id": "433c7f59a03e99a5",
        "type": "subflow:a2511614f51e5116",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 1860,
        "y": 960,
        "wires": [
            [
                "1e5319cbac33e97f"
            ]
        ]
    },
    {
        "id": "f97298133a129359",
        "type": "subflow:e825fc8e32eb1364",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 1850,
        "y": 180,
        "wires": [
            [
                "c9a93f4233c80146"
            ]
        ]
    },
    {
        "id": "c9a93f4233c80146",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2080,
        "y": 180,
        "wires": [
            [
                "45bb5e2345aab7b4"
            ],
            [
                "778dfdc9d15b5aa8"
            ]
        ]
    },
    {
        "id": "778dfdc9d15b5aa8",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2090,
        "y": 240,
        "wires": [
            [
                "45bb5e2345aab7b4"
            ],
            [
                "45bb5e2345aab7b4"
            ]
        ]
    },
    {
        "id": "09ea6838f40719cc",
        "type": "subflow:010b1368b661e966",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 1860,
        "y": 300,
        "wires": [
            [
                "cc810ce419b9d88c"
            ]
        ]
    },
    {
        "id": "cc810ce419b9d88c",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2100,
        "y": 300,
        "wires": [
            [
                "45bb5e2345aab7b4"
            ],
            [
                "a79c24aeea972d5a"
            ]
        ]
    },
    {
        "id": "a79c24aeea972d5a",
        "type": "subflow:326ee5d4d26564c7",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 1860,
        "y": 380,
        "wires": [
            [
                "a4e9fc2100454480"
            ]
        ]
    },
    {
        "id": "a4e9fc2100454480",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2100,
        "y": 380,
        "wires": [
            [
                "45bb5e2345aab7b4"
            ],
            [
                "45bb5e2345aab7b4"
            ]
        ]
    },
    {
        "id": "aabad68ca0355312",
        "type": "subflow:2313e47e41070980",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 2100,
        "y": 640,
        "wires": [
            [
                "6bf1f479b159aa9c"
            ]
        ]
    },
    {
        "id": "6bf1f479b159aa9c",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2100,
        "y": 700,
        "wires": [
            [
                "d31a515ec0b1407d"
            ],
            [
                "7086890ee73ff32c"
            ]
        ]
    },
    {
        "id": "7086890ee73ff32c",
        "type": "subflow:c1249a800f33a884",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 1860,
        "y": 760,
        "wires": [
            [
                "908be280009d4bf0"
            ]
        ]
    },
    {
        "id": "908be280009d4bf0",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2100,
        "y": 760,
        "wires": [
            [
                "d31a515ec0b1407d"
            ],
            [
                "d31a515ec0b1407d"
            ]
        ]
    },
    {
        "id": "fc0c85ce082b26e4",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "flow_path",
        "property": "flowPath",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "job1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "job2",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1220,
        "y": 420,
        "wires": [
            [
                "bfc3a1bacf9af003"
            ],
            [
                "f97298133a129359"
            ],
            [
                "2982ba6de4980a03"
            ]
        ]
    },
    {
        "id": "39050c3eef239ea1",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "flow_path",
        "property": "flowPath",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "job1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "job3",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1360,
        "y": 800,
        "wires": [
            [
                "9b1693c8a01686d2"
            ],
            [
                "5b233b4cdb3e2eae"
            ],
            [
                "d31a515ec0b1407d"
            ]
        ]
    },
    {
        "id": "45bb5e2345aab7b4",
        "type": "function",
        "z": "e3961d077dbf1770",
        "name": "consolidate",
        "func": "return msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2790,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "d31a515ec0b1407d",
        "type": "function",
        "z": "e3961d077dbf1770",
        "name": "consolidate",
        "func": "return msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2790,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "1ea6bf1688faa74b",
        "type": "function",
        "z": "e3961d077dbf1770",
        "name": "consolidate",
        "func": "return msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2790,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "773cb441a5d13b57",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "flow_path",
        "property": "flowPath",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "job3",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1240,
        "y": 1060,
        "wires": [
            [
                "433c7f59a03e99a5"
            ],
            [
                "1ea6bf1688faa74b"
            ]
        ]
    },
    {
        "id": "9b1693c8a01686d2",
        "type": "subflow:9327a343376a53f9",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 1860,
        "y": 520,
        "wires": [
            [
                "31cab1a65412800f"
            ]
        ]
    },
    {
        "id": "31cab1a65412800f",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2100,
        "y": 520,
        "wires": [
            [
                "d31a515ec0b1407d"
            ],
            [
                "d31a515ec0b1407d"
            ]
        ]
    },
    {
        "id": "6ed4c958a0230c04",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "flow_path",
        "property": "flowPath",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "job3",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1540,
        "y": 400,
        "wires": [
            [
                "09ea6838f40719cc"
            ],
            [
                "45bb5e2345aab7b4"
            ]
        ]
    },
    {
        "id": "2982ba6de4980a03",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "tabstat",
        "property": "tabstat",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "N",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "N",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1390,
        "y": 440,
        "wires": [
            [
                "6ed4c958a0230c04"
            ],
            [
                "58e570e006305931"
            ]
        ]
    },
    {
        "id": "58e570e006305931",
        "type": "subflow:96f29b19e2260e65",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 1870,
        "y": 440,
        "wires": [
            [
                "45bb5e2345aab7b4"
            ]
        ]
    },
    {
        "id": "06d17a6bdfc37b22",
        "type": "subflow:1a2581dce20863e3",
        "z": "e3961d077dbf1770",
        "name": "",
        "x": 170,
        "y": 1200,
        "wires": [
            [
                "e5e2d32280b18101"
            ]
        ]
    },
    {
        "id": "e5e2d32280b18101",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 360,
        "y": 1200,
        "wires": [
            [
                "0c13b9d9bca75c6f"
            ],
            []
        ]
    },
    {
        "id": "0c13b9d9bca75c6f",
        "type": "switch",
        "z": "e3961d077dbf1770",
        "name": "scopecheck",
        "property": "scope",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 530,
        "y": 1160,
        "wires": [
            [
                "3e9afa1acdca1e32"
            ],
            []
        ]
    },
    {
        "id": "34c3fba005671a29",
        "type": "subflow:50ae5f8d28de46c8",
        "z": "9327a343376a53f9",
        "name": "",
        "x": 450,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "a09933b51e0ca1e6",
        "type": "subflow:7c74ea1220a33f32",
        "z": "9327a343376a53f9",
        "name": "",
        "x": 320,
        "y": 180,
        "wires": [
            [
                "c8d865456d28d484"
            ]
        ]
    },
    {
        "id": "c8d865456d28d484",
        "type": "switch",
        "z": "9327a343376a53f9",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 500,
        "y": 180,
        "wires": [
            [],
            [
                "8814e76868a358a9"
            ]
        ]
    },
    {
        "id": "8814e76868a358a9",
        "type": "switch",
        "z": "9327a343376a53f9",
        "name": "sector check",
        "property": "naicsSector",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 350,
        "y": 260,
        "wires": [
            [],
            [
                "34c3fba005671a29"
            ]
        ]
    },
    {
        "id": "6f2cfc149ad8c588",
        "type": "subflow:b68b1cdb465a831c",
        "z": "c1249a800f33a884",
        "name": "",
        "x": 800,
        "y": 180,
        "wires": [
            [
                "830498417c682834"
            ]
        ]
    },
    {
        "id": "830498417c682834",
        "type": "switch",
        "z": "c1249a800f33a884",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1000,
        "y": 180,
        "wires": [
            [],
            [
                "f44b99488ee8859a"
            ]
        ]
    },
    {
        "id": "f44b99488ee8859a",
        "type": "subflow:96f29b19e2260e65",
        "z": "c1249a800f33a884",
        "name": "",
        "x": 810,
        "y": 240,
        "wires": [
            [
                "af4e4f77189ff57f"
            ]
        ]
    },
    {
        "id": "9cc268ba9544a600",
        "type": "subflow:7c74ea1220a33f32",
        "z": "c1249a800f33a884",
        "name": "",
        "x": 160,
        "y": 100,
        "wires": [
            [
                "5e57335b6495d3dc"
            ]
        ]
    },
    {
        "id": "5e57335b6495d3dc",
        "type": "switch",
        "z": "c1249a800f33a884",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 340,
        "y": 100,
        "wires": [
            [],
            [
                "06c17232e6204585"
            ]
        ]
    },
    {
        "id": "06c17232e6204585",
        "type": "switch",
        "z": "c1249a800f33a884",
        "name": "sector check",
        "property": "naicsSector",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 210,
        "y": 160,
        "wires": [
            [
                "c0dbc83808816924"
            ],
            [
                "1a201df59ad60252"
            ]
        ]
    },
    {
        "id": "1a201df59ad60252",
        "type": "subflow:0179503501c47e39",
        "z": "c1249a800f33a884",
        "name": "",
        "x": 970,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "af66e212735460aa",
        "type": "subflow:6ace7023ea973ebe",
        "z": "c1249a800f33a884",
        "name": "",
        "x": 790,
        "y": 320,
        "wires": [
            [
                "2a3171df667cae95"
            ]
        ]
    },
    {
        "id": "af4e4f77189ff57f",
        "type": "switch",
        "z": "c1249a800f33a884",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 240,
        "wires": [
            [],
            [
                "af66e212735460aa"
            ]
        ]
    },
    {
        "id": "2a3171df667cae95",
        "type": "switch",
        "z": "c1249a800f33a884",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 320,
        "wires": [
            [],
            [
                "1a201df59ad60252"
            ]
        ]
    },
    {
        "id": "c0dbc83808816924",
        "type": "switch",
        "z": "c1249a800f33a884",
        "name": "tabstat",
        "property": "tabstat",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "N",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "N",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 160,
        "wires": [
            [
                "50ca1ad5bc59ce79"
            ],
            [
                "f44b99488ee8859a"
            ]
        ]
    },
    {
        "id": "50ca1ad5bc59ce79",
        "type": "switch",
        "z": "c1249a800f33a884",
        "name": "action check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 570,
        "y": 160,
        "wires": [
            [
                "6f2cfc149ad8c588"
            ],
            [
                "f44b99488ee8859a"
            ]
        ]
    },
    {
        "id": "e61f378b2eae2b98",
        "type": "subflow:5e2c6717be2fdd36",
        "z": "2313e47e41070980",
        "name": "",
        "x": 230,
        "y": 180,
        "wires": [
            [
                "0aeccdef357aeb12"
            ]
        ]
    },
    {
        "id": "21ad1273aa88b69a",
        "type": "subflow:e4fb9739caef0397",
        "z": "2313e47e41070980",
        "name": "",
        "x": 270,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "0aeccdef357aeb12",
        "type": "switch",
        "z": "2313e47e41070980",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 420,
        "y": 180,
        "wires": [
            [],
            [
                "21ad1273aa88b69a"
            ]
        ]
    },
    {
        "id": "091b290531e1645c",
        "type": "subflow:7c74ea1220a33f32",
        "z": "2313e47e41070980",
        "name": "",
        "x": 200,
        "y": 60,
        "wires": [
            [
                "3f6dd7fcc05a08b1"
            ]
        ]
    },
    {
        "id": "3f6dd7fcc05a08b1",
        "type": "switch",
        "z": "2313e47e41070980",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 420,
        "y": 60,
        "wires": [
            [],
            [
                "721901718b909c7b"
            ]
        ]
    },
    {
        "id": "721901718b909c7b",
        "type": "switch",
        "z": "2313e47e41070980",
        "name": "sector check",
        "property": "naicsSector",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 120,
        "wires": [
            [],
            [
                "e61f378b2eae2b98"
            ]
        ]
    },
    {
        "id": "8d7f02887466fd92",
        "type": "subflow:1159e6c8f76efda3",
        "z": "326ee5d4d26564c7",
        "name": "",
        "x": 380,
        "y": 200,
        "wires": [
            [
                "d6f8e720b596f834"
            ]
        ]
    },
    {
        "id": "d6f8e720b596f834",
        "type": "switch",
        "z": "326ee5d4d26564c7",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 200,
        "wires": [
            [],
            [
                "e9f1a8076794f857"
            ]
        ]
    },
    {
        "id": "e9f1a8076794f857",
        "type": "subflow:75eae7f006cc0f8a",
        "z": "326ee5d4d26564c7",
        "name": "",
        "x": 390,
        "y": 280,
        "wires": [
            [
                "8a44f6b08ad2985a"
            ]
        ]
    },
    {
        "id": "8a44f6b08ad2985a",
        "type": "switch",
        "z": "326ee5d4d26564c7",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 280,
        "wires": [
            [],
            [
                "81ed7748570e9368"
            ]
        ]
    },
    {
        "id": "81ed7748570e9368",
        "type": "subflow:b68b1cdb465a831c",
        "z": "326ee5d4d26564c7",
        "name": "",
        "x": 360,
        "y": 340,
        "wires": [
            [
                "4a37c9068b162a16"
            ]
        ]
    },
    {
        "id": "4a37c9068b162a16",
        "type": "switch",
        "z": "326ee5d4d26564c7",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 340,
        "wires": [
            [],
            [
                "6f835983aa2e0505"
            ]
        ]
    },
    {
        "id": "6f835983aa2e0505",
        "type": "subflow:96f29b19e2260e65",
        "z": "326ee5d4d26564c7",
        "name": "",
        "x": 390,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "e1834279ae066fd6",
        "type": "subflow:7c74ea1220a33f32",
        "z": "326ee5d4d26564c7",
        "name": "",
        "x": 360,
        "y": 80,
        "wires": [
            [
                "d425fb90caf5253f"
            ]
        ]
    },
    {
        "id": "d425fb90caf5253f",
        "type": "switch",
        "z": "326ee5d4d26564c7",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 580,
        "y": 80,
        "wires": [
            [],
            [
                "9cfaa4ae76ee60c6"
            ]
        ]
    },
    {
        "id": "9cfaa4ae76ee60c6",
        "type": "switch",
        "z": "326ee5d4d26564c7",
        "name": "sector check",
        "property": "naicsSector",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 110,
        "y": 140,
        "wires": [
            [
                "30f55bd9979b5ac1"
            ],
            [
                "6f835983aa2e0505"
            ]
        ]
    },
    {
        "id": "cf5cf8ceb0ba463f",
        "type": "switch",
        "z": "326ee5d4d26564c7",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 600,
        "y": 140,
        "wires": [
            [],
            [
                "8d7f02887466fd92"
            ]
        ]
    },
    {
        "id": "30f55bd9979b5ac1",
        "type": "subflow:e50e4180ad305262",
        "z": "326ee5d4d26564c7",
        "name": "",
        "x": 360,
        "y": 140,
        "wires": [
            [
                "cf5cf8ceb0ba463f"
            ]
        ]
    },
    {
        "id": "45426c909f20f8e7",
        "type": "subflow:e4fb9739caef0397",
        "z": "010b1368b661e966",
        "name": "",
        "x": 590,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "053216ce9454e2cd",
        "type": "subflow:7c74ea1220a33f32",
        "z": "010b1368b661e966",
        "name": "",
        "x": 400,
        "y": 200,
        "wires": [
            [
                "d97d4e2bef6902c3"
            ]
        ]
    },
    {
        "id": "d97d4e2bef6902c3",
        "type": "switch",
        "z": "010b1368b661e966",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 200,
        "wires": [
            [],
            [
                "13b54fc672b81998"
            ]
        ]
    },
    {
        "id": "13b54fc672b81998",
        "type": "switch",
        "z": "010b1368b661e966",
        "name": "sector check",
        "property": "naicsSector",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 630,
        "y": 260,
        "wires": [
            [],
            [
                "3df5b123d3d00dc7"
            ]
        ]
    },
    {
        "id": "73c34119d81f4d73",
        "type": "switch",
        "z": "010b1368b661e966",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 320,
        "wires": [
            [],
            [
                "45426c909f20f8e7"
            ]
        ]
    },
    {
        "id": "3df5b123d3d00dc7",
        "type": "subflow:e50e4180ad305262",
        "z": "010b1368b661e966",
        "name": "",
        "x": 420,
        "y": 320,
        "wires": [
            [
                "73c34119d81f4d73"
            ]
        ]
    },
    {
        "id": "57163764df0bab81",
        "type": "function",
        "z": "537136f85533687f",
        "name": "reset msg",
        "func": "function keysToUpperCase(obj) {\n    const output = {};\n    for (let key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            if (typeof obj[key] === 'object' && obj[key] !== null) {\n                output[key.toUpperCase()] = keysToUpperCase(obj[key]);\n            } else {\n                output[key.toUpperCase()] = obj[key];\n            }\n        }\n    }\n    return output;\n}\n\nlet p = msg.payload.map(keysToUpperCase);\nmsg.payload = p\nmsg.aies_rp = msg.payload\n\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "9439ebdee9655ac1",
        "type": "function",
        "z": "537136f85533687f",
        "name": "reset_msg_and_query_kau_rp",
        "func": "msg.records = msg.payload\n\nlet record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.records.csv[record_idx];\nlet id = record.REPORTING_ID\nlet ref_per = record.REF_PER\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_KAU_TABLE = env.get('DB_KAU_TABLE')\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_KAU_TABLE + \" where reporting_id = '\" + id + \"' and version = 'RP' and ref_per = '\" + ref_per + \"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 320,
        "wires": [
            [
                "2750588c4bb5654a"
            ]
        ]
    },
    {
        "id": "2750588c4bb5654a",
        "type": "subflow:8032608991ae0162",
        "z": "537136f85533687f",
        "name": "",
        "x": 600,
        "y": 320,
        "wires": [
            [
                "57163764df0bab81"
            ]
        ]
    },
    {
        "id": "f26fb28e6a088104",
        "type": "function",
        "z": "23c54fc1c5be665e",
        "name": "reset msg",
        "func": "function keysToUpperCase(obj) {\n    const output = {};\n    for (let key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            if (typeof obj[key] === 'object' && obj[key] !== null) {\n                output[key.toUpperCase()] = keysToUpperCase(obj[key]);\n            } else {\n                output[key.toUpperCase()] = obj[key];\n            }\n        }\n    }\n    return output;\n}\n\nlet p = msg.payload.map(keysToUpperCase);\nmsg.payload = p\nmsg.aies_rp = msg.payload\n\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "ccdba6272bdef534",
        "type": "function",
        "z": "23c54fc1c5be665e",
        "name": "reset_msg_and_query_ec_2022",
        "func": "msg.records = msg.payload\n\nlet record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.records.csv[record_idx];\nlet id = record.REPORTING_ID\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_EC_TABLE = env.get('DB_EC_TABLE')\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_EC_TABLE + \" where reporting_id = '\" + id + \"' and version = 'PO' and substring(ref_per,1,4) = '2022';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 160,
        "wires": [
            [
                "abf66e39e37740ad"
            ]
        ]
    },
    {
        "id": "d589485d274c9869",
        "type": "function",
        "z": "23c54fc1c5be665e",
        "name": "reset_msg_and_query_aies_refper_minus_one",
        "func": "function keysToUpperCase(obj) {\n    const output = {};\n    for (let key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            if (typeof obj[key] === 'object' && obj[key] !== null) {\n                output[key.toUpperCase()] = keysToUpperCase(obj[key]);\n            } else {\n                output[key.toUpperCase()] = obj[key];\n            }\n        }\n    }\n    return output;\n}\n\nlet p = msg.payload.map(keysToUpperCase);\nmsg.payload = p\nmsg.ec_2022 = msg.payload\n\nlet record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.records.csv[record_idx];\nlet id = record.REPORTING_ID\nlet ref_per = parseInt(record.REF_PER.substring(0,4)) - 1\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_ESTAB_TABLE = env.get('DB_ESTAB_TABLE')\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_ESTAB_TABLE + \" where reporting_id = '\" + id + \"' and version = 'PO' and substring(ref_per,1,4) = '\" + ref_per + \"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 220,
        "wires": [
            [
                "0428603b3b320228"
            ]
        ]
    },
    {
        "id": "21b9dbce17389f21",
        "type": "function",
        "z": "23c54fc1c5be665e",
        "name": "reset_msg_and_query_aies_rp",
        "func": "function keysToUpperCase(obj) {\n    const output = {};\n    for (let key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            if (typeof obj[key] === 'object' && obj[key] !== null) {\n                output[key.toUpperCase()] = keysToUpperCase(obj[key]);\n            } else {\n                output[key.toUpperCase()] = obj[key];\n            }\n        }\n    }\n    return output;\n}\n\nlet p = msg.payload.map(keysToUpperCase);\nmsg.payload = p\nmsg.aies_minus = msg.payload\n\nlet record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.records.csv[record_idx];\nlet id = record.REPORTING_ID\nlet ref_per = record.REF_PER\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_ESTAB_TABLE = env.get('DB_ESTAB_TABLE')\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_ESTAB_TABLE + \" where reporting_id = '\" + id + \"' and version = 'RP' and ref_per = '\" + ref_per + \"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 280,
        "wires": [
            [
                "94feae92a8bf2849"
            ]
        ]
    },
    {
        "id": "abf66e39e37740ad",
        "type": "subflow:8032608991ae0162",
        "z": "23c54fc1c5be665e",
        "name": "",
        "x": 800,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "0428603b3b320228",
        "type": "subflow:8032608991ae0162",
        "z": "23c54fc1c5be665e",
        "name": "",
        "x": 800,
        "y": 220,
        "wires": [
            [
                "21b9dbce17389f21"
            ]
        ]
    },
    {
        "id": "94feae92a8bf2849",
        "type": "subflow:8032608991ae0162",
        "z": "23c54fc1c5be665e",
        "name": "",
        "x": 800,
        "y": 280,
        "wires": [
            [
                "f26fb28e6a088104"
            ]
        ]
    },
    {
        "id": "0ad4cebef3e64c46",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "reporting_id_typ_txt",
        "property": "reporting_id_typ_txt",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "SU",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "MU",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "KAU",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ENT",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 770,
        "y": 1140,
        "wires": [
            [
                "f41dd537cd635ab1"
            ],
            [
                "f41dd537cd635ab1"
            ],
            [
                "f36b81adf4c0b121"
            ],
            [
                "4c2ed9f29e043d26"
            ],
            []
        ]
    },
    {
        "id": "b22c431cb589a25a",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2050,
        "y": 1100,
        "wires": [
            [
                "789bd77c010226b7"
            ],
            [
                "789bd77c010226b7"
            ]
        ]
    },
    {
        "id": "a4793e2a9a72bd65",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2040,
        "y": 1040,
        "wires": [
            [
                "789bd77c010226b7"
            ],
            [
                "b22c431cb589a25a"
            ]
        ]
    },
    {
        "id": "59804c96b508e102",
        "type": "subflow:e14f077595377a58",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 1770,
        "y": 40,
        "wires": [
            [
                "a6d3800fb2f396d9"
            ]
        ]
    },
    {
        "id": "a6d3800fb2f396d9",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2010,
        "y": 40,
        "wires": [
            [
                "6d57931c901151c4"
            ],
            [
                "23d64a76b4ce56dc"
            ]
        ]
    },
    {
        "id": "23d64a76b4ce56dc",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2020,
        "y": 80,
        "wires": [
            [
                "6d57931c901151c4"
            ],
            [
                "6d57931c901151c4"
            ]
        ]
    },
    {
        "id": "fa5c41613b5e2e46",
        "type": "subflow:88823d21c11ae7b5",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 1780,
        "y": 560,
        "wires": [
            [
                "de77fbbdfbe17ad1"
            ]
        ]
    },
    {
        "id": "de77fbbdfbe17ad1",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2020,
        "y": 560,
        "wires": [
            [
                "cbaef742bf0eeb8b"
            ],
            [
                "4e10752459d8d43e"
            ]
        ]
    },
    {
        "id": "4e10752459d8d43e",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2030,
        "y": 620,
        "wires": [
            [
                "cbaef742bf0eeb8b"
            ],
            [
                "cbaef742bf0eeb8b"
            ]
        ]
    },
    {
        "id": "dd118778765ce796",
        "type": "subflow:a2511614f51e5116",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 1780,
        "y": 1040,
        "wires": [
            [
                "a4793e2a9a72bd65"
            ]
        ]
    },
    {
        "id": "d7c309c2046d0f6d",
        "type": "subflow:e825fc8e32eb1364",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 1780,
        "y": 140,
        "wires": [
            [
                "51e81381cbfc2a56"
            ]
        ]
    },
    {
        "id": "51e81381cbfc2a56",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2010,
        "y": 140,
        "wires": [
            [],
            [
                "2d2deffadab2c504"
            ]
        ]
    },
    {
        "id": "2d2deffadab2c504",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2020,
        "y": 200,
        "wires": [
            [
                "6d57931c901151c4"
            ],
            [
                "6d57931c901151c4"
            ]
        ]
    },
    {
        "id": "c8f5b6a3e28abf46",
        "type": "subflow:010b1368b661e966",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 1780,
        "y": 260,
        "wires": [
            [
                "10f81ce5b1b9cf48"
            ]
        ]
    },
    {
        "id": "10f81ce5b1b9cf48",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2020,
        "y": 260,
        "wires": [
            [
                "6d57931c901151c4"
            ],
            [
                "6d57931c901151c4"
            ]
        ]
    },
    {
        "id": "2061b1226db9d3f4",
        "type": "subflow:326ee5d4d26564c7",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 1780,
        "y": 340,
        "wires": [
            [
                "fcf840dac9c8a3c4"
            ]
        ]
    },
    {
        "id": "fcf840dac9c8a3c4",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2020,
        "y": 340,
        "wires": [
            [
                "6d57931c901151c4"
            ],
            [
                "6d57931c901151c4"
            ]
        ]
    },
    {
        "id": "a59647fc4786dd91",
        "type": "subflow:2313e47e41070980",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 1780,
        "y": 640,
        "wires": [
            [
                "9f3f44cc17d5de50"
            ]
        ]
    },
    {
        "id": "3c18741b24a35d6b",
        "type": "subflow:c1249a800f33a884",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 1780,
        "y": 740,
        "wires": [
            [
                "c7dbb37c9565e1e9"
            ]
        ]
    },
    {
        "id": "f41dd537cd635ab1",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "flow_path",
        "property": "flowPath",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "job1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "job2",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1220,
        "y": 400,
        "wires": [
            [
                "59804c96b508e102"
            ],
            [
                "d7c309c2046d0f6d"
            ],
            [
                "899b93521bd0f2f9"
            ]
        ]
    },
    {
        "id": "f36b81adf4c0b121",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "flow_path",
        "property": "flowPath",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "job1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "job4",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1220,
        "y": 780,
        "wires": [
            [
                "763b5a7e67d846f1"
            ],
            [
                "fa5c41613b5e2e46"
            ],
            [
                "ed79614e245d1f56"
            ]
        ]
    },
    {
        "id": "6d57931c901151c4",
        "type": "function",
        "z": "5da8a5ef555890fb",
        "name": "consolidate",
        "func": "return msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2590,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "cbaef742bf0eeb8b",
        "type": "function",
        "z": "5da8a5ef555890fb",
        "name": "consolidate",
        "func": "return msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2590,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "789bd77c010226b7",
        "type": "function",
        "z": "5da8a5ef555890fb",
        "name": "consolidate",
        "func": "return msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2590,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "4c2ed9f29e043d26",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "flow_path",
        "property": "flowPath",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "job6",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1220,
        "y": 1120,
        "wires": [
            [
                "dd118778765ce796"
            ],
            [
                "789bd77c010226b7"
            ]
        ]
    },
    {
        "id": "763b5a7e67d846f1",
        "type": "subflow:9327a343376a53f9",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 1780,
        "y": 500,
        "wires": [
            [
                "375aebc55426201b"
            ]
        ]
    },
    {
        "id": "899b93521bd0f2f9",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "tabstat",
        "property": "tabstat",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "N",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "N",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1390,
        "y": 400,
        "wires": [
            [
                "2c92d5746ac7e0b8"
            ],
            [
                "5c6a4f60d3349a0d"
            ]
        ]
    },
    {
        "id": "2c92d5746ac7e0b8",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "flow_path",
        "property": "flowPath",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "job3",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "job4",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1540,
        "y": 340,
        "wires": [
            [
                "c8f5b6a3e28abf46"
            ],
            [
                "2061b1226db9d3f4"
            ],
            [
                "6d57931c901151c4"
            ]
        ]
    },
    {
        "id": "ed79614e245d1f56",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "flow_path",
        "property": "flowPath",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "job5",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "job6",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1420,
        "y": 780,
        "wires": [
            [
                "70cf301d70b47c50"
            ],
            [
                "3c18741b24a35d6b"
            ],
            [
                "cbaef742bf0eeb8b"
            ]
        ]
    },
    {
        "id": "d4422fca2227f5c1",
        "type": "subflow:96f29b19e2260e65",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 1770,
        "y": 400,
        "wires": [
            [
                "6d57931c901151c4"
            ]
        ]
    },
    {
        "id": "5c6a4f60d3349a0d",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "flow_path",
        "property": "flowPath",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "job4",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1540,
        "y": 440,
        "wires": [
            [
                "d4422fca2227f5c1"
            ],
            [
                "6d57931c901151c4"
            ]
        ]
    },
    {
        "id": "375aebc55426201b",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2020,
        "y": 500,
        "wires": [
            [
                "cbaef742bf0eeb8b"
            ],
            [
                "cbaef742bf0eeb8b"
            ]
        ]
    },
    {
        "id": "9f3f44cc17d5de50",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2020,
        "y": 680,
        "wires": [
            [
                "cbaef742bf0eeb8b"
            ],
            [
                "cbaef742bf0eeb8b"
            ]
        ]
    },
    {
        "id": "c7dbb37c9565e1e9",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2020,
        "y": 740,
        "wires": [
            [
                "cbaef742bf0eeb8b"
            ],
            [
                "cbaef742bf0eeb8b"
            ]
        ]
    },
    {
        "id": "fe1bb24f16a5db46",
        "type": "subflow:1a2581dce20863e3",
        "z": "5da8a5ef555890fb",
        "name": "",
        "x": 190,
        "y": 1260,
        "wires": [
            [
                "3560976c9c238e09"
            ]
        ]
    },
    {
        "id": "3560976c9c238e09",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 380,
        "y": 1260,
        "wires": [
            [
                "6c299fa0da28810e"
            ],
            []
        ]
    },
    {
        "id": "6c299fa0da28810e",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "scopecheck",
        "property": "scope",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 550,
        "y": 1220,
        "wires": [
            [
                "0ad4cebef3e64c46"
            ],
            []
        ]
    },
    {
        "id": "70cf301d70b47c50",
        "type": "switch",
        "z": "5da8a5ef555890fb",
        "name": "tabstat",
        "property": "tabstat",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "N",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "N",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1610,
        "y": 680,
        "wires": [
            [
                "a59647fc4786dd91"
            ],
            [
                "cbaef742bf0eeb8b"
            ]
        ]
    },
    {
        "id": "5c958e901a16d2a1",
        "type": "function",
        "z": "6f23d11cf5bb4bde",
        "name": "MIV: NonLIFORANDOMModule",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n    function NonLIFORANDOMModulePath(variable) {\n        let avg = ''\n        let avg_f = ''\n        let fifo = ''\n        let fifo_f = ''\n        let std = ''\n        let std_f = ''\n        let othnl = ''\n        let othnl_f = ''\n        let ival_tot = ''\n        let ival_tot_f = ''\n        let nl_tot = ''\n        let nl_tot_f = ''\n        let lifo = ''\n        let lifo_f = ''\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            avg_f = 'INV_E_AVG_VAL_F'\n            fifo = 'INV_E_FIFO_VAL'\n            fifo_f = 'INV_E_FIFO_VAL_F'\n            std = 'INV_E_STD_VAL'\n            std_f = 'INV_E_STD_VAL_F'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n            ival_tot = 'INV_E_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_E_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_E_NL_TOT_DVAL'\n            nl_tot_f = 'INV_E_NL_TOT_DVAL_F'\n            lifo = 'INV_E_LIFO_VAL'\n            lifo_f = 'INV_E_LIFO_VAL_F'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            avg_f = 'INV_B_AVG_VAL_F'\n            fifo = 'INV_B_FIFO_VAL'\n            fifo_f = 'INV_B_FIFO_VAL_F'\n            std = 'INV_B_STD_VAL'\n            std_f = 'INV_B_STD_VAL_F'\n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n            ival_tot = 'INV_B_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_B_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_B_NL_TOT_DVAL'\n            nl_tot_f = 'INV_B_NL_TOT_DVAL_F'\n            lifo = 'INV_B_LIFO_VAL'\n            lifo_f = 'INV_B_LIFO_VAL_F'\n        }\n        if ((0 <= parseInt(record?.NLFLO)) && (30 >= parseInt(record?.NLFLO))) {\n            record[std] = parseFloat(record?.[ival_tot]) - parseFloat(record?.[lifo])\n            flagRules(std, [ival_tot_f, lifo_f])\n            record[fifo] = 0\n            record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'Z')\n            record[avg] = 0\n            record[avg_f] = setCharAt(record?.[avg_f], 2, 'Z')\n            record[othnl] = 0\n            record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'Z')\n\n        } else if ((31 <= parseInt(record?.NLFLO)) && (40 >= parseInt(record?.NLFLO))) {\n            record[avg] = parseFloat(record?.[ival_tot]) - parseFloat(record?.[lifo])\n            flagRules(avg, [ival_tot_f, lifo_f])\n            record[fifo] = 0\n            record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'Z')\n            record[std] = 0\n            record[std_f] = setCharAt(record?.[std_f], 2, 'Z')\n            record[othnl] = 0\n            record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'Z')\n\n        } else if ((41 <= parseInt(record?.NLFLO)) && (50 >= parseInt(record?.NLFLO))) {\n            record[othnl] = parseFloat(record?.[ival_tot]) - parseFloat(record?.[lifo])\n            flagRules(othnl, [ival_tot_f, lifo_f])\n            record[fifo] = 0\n            record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'Z')\n            record[std] = 0\n            record[std_f] = setCharAt(record?.[std_f], 2, 'Z')\n            record[avg] = 0\n            record[avg_f] = setCharAt(record?.[avg_f], 2, 'Z')\n\n        } else {\n            record[fifo] = parseFloat(record?.[ival_tot]) - parseFloat(record?.[lifo])\n            flagRules(fifo, [ival_tot_f, lifo_f])\n            record[avg] = 0\n            record[avg_f] = setCharAt(record?.[avg_f], 2, 'Z')\n            record[std] = 0\n            record[std_f] = setCharAt(record?.[std_f], 2, 'Z')\n            record[othnl] = 0\n            record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'Z')\n        }\n        record[nl_tot] = parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl])\n        flagRules(nl_tot, [avg_f, std_f, othnl_f])\n    }\n    function NonLIFORANDOMModule() {\n        let NLFLOin = global.get('nlflo')\n        record.NLFLO = NLFLOin\n        let letter = global.get('miv')\n        NonLIFORANDOMModulePath(letter)\n        record.ACTION = 'Return to Evaluate Details Valuation Methods'\n    }\n\n    NonLIFORANDOMModule()\n    return msg\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MIV NonLIFO Random'\n    return msg \n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "1fc0572397f37a7f",
        "type": "function",
        "z": "6f23d11cf5bb4bde",
        "name": "MIV: NonLIFORANDOMModule",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n    function NonLIFORANDOMModulePath(variable) {\n        let avg = ''\n        let avg_f = ''\n        let fifo = ''\n        let fifo_f = ''\n        let std = ''\n        let std_f = ''\n        let othnl = ''\n        let othnl_f = ''\n        let ival_tot = ''\n        let ival_tot_f = ''\n        let nl_tot = ''\n        let nl_tot_f = ''\n        let lifo = ''\n        let lifo_f = ''\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            avg_f = 'INV_E_AVG_VAL_F'\n            fifo = 'INV_E_FIFO_VAL'\n            fifo_f = 'INV_E_FIFO_VAL_F'\n            std = 'INV_E_STD_VAL'\n            std_f = 'INV_E_STD_VAL_F'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n            ival_tot = 'INV_E_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_E_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_E_NL_TOT_DVAL'\n            nl_tot_f = 'INV_E_NL_TOT_DVAL_F'\n            lifo = 'INV_E_LIFO_VAL'\n            lifo_f = 'INV_E_LIFO_VAL_F'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            avg_f = 'INV_B_AVG_VAL_F'\n            fifo = 'INV_B_FIFO_VAL'\n            fifo_f = 'INV_B_FIFO_VAL_F'\n            std = 'INV_B_STD_VAL'\n            std_f = 'INV_B_STD_VAL_F'\n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n            ival_tot = 'INV_B_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_B_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_B_NL_TOT_DVAL'\n            nl_tot_f = 'INV_B_NL_TOT_DVAL_F'\n            lifo = 'INV_B_LIFO_VAL'\n            lifo_f = 'INV_B_LIFO_VAL_F'\n        }\n        if ((0 <= parseInt(record?.NLFLO)) && (30 >= parseInt(record?.NLFLO))) {\n            record[std] = parseFloat(record?.[ival_tot]) - parseFloat(record?.[lifo])\n            flagRules(std, [ival_tot_f, lifo_f])\n            record[fifo] = 0\n            record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'Z')\n            record[avg] = 0\n            record[avg_f] = setCharAt(record?.[avg_f], 2, 'Z')\n            record[othnl] = 0\n            record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'Z')\n\n        } else if ((31 <= parseInt(record?.NLFLO)) && (40 >= parseInt(record?.NLFLO))) {\n            record[avg] = parseFloat(record?.[ival_tot]) - parseFloat(record?.[lifo])\n            flagRules(avg, [ival_tot_f, lifo_f])\n            record[fifo] = 0\n            record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'Z')\n            record[std] = 0\n            record[std_f] = setCharAt(record?.[std_f], 2, 'Z')\n            record[othnl] = 0\n            record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'Z')\n\n        } else if ((41 <= parseInt(record?.NLFLO)) && (50 >= parseInt(record?.NLFLO))) {\n            record[othnl] = parseFloat(record?.[ival_tot]) - parseFloat(record?.[lifo])\n            flagRules(othnl, [ival_tot_f, lifo_f])\n            record[fifo] = 0\n            record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'Z')\n            record[std] = 0\n            record[std_f] = setCharAt(record?.[std_f], 2, 'Z')\n            record[avg] = 0\n            record[avg_f] = setCharAt(record?.[avg_f], 2, 'Z')\n\n        } else {\n            record[fifo] = parseFloat(record?.[ival_tot]) - parseFloat(record?.[lifo])\n            flagRules(fifo, [ival_tot_f, lifo_f])\n            record[avg] = 0\n            record[avg_f] = setCharAt(record?.[avg_f], 2, 'Z')\n            record[std] = 0\n            record[std_f] = setCharAt(record?.[std_f], 2, 'Z')\n            record[othnl] = 0\n            record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'Z')\n        }\n        record[nl_tot] = parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl])\n        flagRules(nl_tot, [avg_f, std_f, othnl_f])\n    }\n    function NonLIFORANDOMModule() {\n        let NLFLOin = msg.nlflo\n        record.NLFLO = NLFLOin\n        let letter = msg.miv\n        NonLIFORANDOMModulePath(letter)\n    }\n\n    NonLIFORANDOMModule()\n    return msg\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'MIV NonLIFO Random'\n    return msg \n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "be66adc632710827",
        "type": "function",
        "z": "625b8c982fed66b7",
        "name": "MIV: EvaluateNoNLIFOValuationMethodModule",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n    function EvaluateNoNLIFOValuationMethod(variable) {\n        let avg = ''\n        let avg_f = ''\n        let fifo = ''\n        let fifo_f = ''\n        let std = ''\n        let std_f = ''\n        let othnl = ''\n        let othnl_f = ''\n        let ival_tot = ''\n        let ival_tot_f = ''\n        let nl_tot = ''\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            avg_f = 'INV_E_AVG_VAL_F'\n            fifo = 'INV_E_FIFO_VAL'\n            fifo_f = 'INV_E_FIFO_VAL_F'\n            std = 'INV_E_STD_VAL'\n            std_f = 'INV_E_STD_VAL_F'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n            ival_tot = 'INV_E_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_E_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_E_NL_TOT_DVAL'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            avg_f = 'INV_B_AVG_VAL_F'\n            fifo = 'INV_B_FIFO_VAL'\n            fifo_f = 'INV_B_FIFO_VAL_F'\n            std = 'INV_B_STD_VAL'\n            std_f = 'INV_B_STD_VAL_F'\n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n            ival_tot = 'INV_B_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_B_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_B_NL_TOT_DVAL'\n        }\n        if (parseFloat(record?.[fifo]) > 0) {\n            if (0 == (parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl]))) {\n                if (parseFloat(record?.[fifo]) != parseFloat(record?.[ival_tot])) {\n                    record[fifo] = record?.[ival_tot]\n                    flagRules(fifo, [ival_tot_f])\n                }\n            } else {\n                record[fifo] = Math.round((parseFloat(record?.[fifo]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'K')\n                record[avg] = Math.round((parseFloat(record?.[avg]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[avg_f] = setCharAt(record?.[avg_f], 2, 'K')\n                record[std] = Math.round((parseFloat(record?.[std]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[std_f] = setCharAt(record?.[std_f], 2, 'K')\n                record[othnl] = Math.round(parseFloat(record?.[ival_tot]) - (parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std])))\n                record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'K')\n            }\n        } else if (parseFloat(record?.[avg]) > 0) {\n            if ((parseFloat(record?.[std]) + parseFloat(record?.[othnl])) == 0) {\n                if (parseFloat(record?.[avg]) != parseFloat(record?.[ival_tot])) {\n                    record[avg] = record?.[ival_tot]\n                    flagRules(avg, [ival_tot_f])\n                }\n            } else {\n                record[avg] = Math.round((parseFloat(record?.[avg]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[avg_f] = setCharAt(record?.[avg_f], 2, 'K')\n                record[std] = Math.round((parseFloat(record?.[std]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[std_f] = setCharAt(record?.[std_f], 2, 'K')\n                record[othnl] = Math.round(parseFloat(record?.[ival_tot]) - (parseFloat(record?.[avg]) + parseFloat(record?.[std])))\n                record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'K')\n            }\n\n        } else if (parseFloat(record?.[std]) > 0) {\n            if (parseFloat(record?.[othnl]) == 0) {\n                if (parseFloat(record?.[std]) != parseFloat(record?.[ival_tot])) {\n                    record[std] = record?.[ival_tot]\n                    flagRules(std, [ival_tot_f])\n                }\n            } else {\n                record[std] = Math.round((parseFloat(record?.[std]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[std_f] = setCharAt(record?.[std_f], 2, 'K')\n                record[othnl] = Math.round(parseFloat(record?.[ival_tot]) - parseFloat(record?.[std]))\n                record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'K')\n            }\n        } else if (parseFloat(record?.[othnl]) == parseFloat(record?.[ival_tot])) {\n        } else {\n            record[othnl] = parseFloat(record?.[ival_tot])\n            flagRules(othnl, [ival_tot_f])\n        }\n    }\n\n    function EvaluateNoNLIFOValuationMethodModule() {\n        let letter = global.get('miv')\n        EvaluateNoNLIFOValuationMethod(letter)\n    }\n\n    EvaluateNoNLIFOValuationMethodModule()\n    return msg\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MIV EvaluateNoNLIFOValuationMethodModule'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "3f8e37ac204ac9fc",
        "type": "function",
        "z": "625b8c982fed66b7",
        "name": "MIV: EvaluateNoNLIFOValuationMethodModule Database",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n    function EvaluateNoNLIFOValuationMethod(variable) {\n        let avg = ''\n        let avg_f = ''\n        let fifo = ''\n        let fifo_f = ''\n        let std = ''\n        let std_f = ''\n        let othnl = ''\n        let othnl_f = ''\n        let ival_tot = ''\n        let ival_tot_f = ''\n        let nl_tot = ''\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            avg_f = 'INV_E_AVG_VAL_F'\n            fifo = 'INV_E_FIFO_VAL'\n            fifo_f = 'INV_E_FIFO_VAL_F'\n            std = 'INV_E_STD_VAL'\n            std_f = 'INV_E_STD_VAL_F'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n            ival_tot = 'INV_E_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_E_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_E_NL_TOT_DVAL'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            avg_f = 'INV_B_AVG_VAL_F'\n            fifo = 'INV_B_FIFO_VAL'\n            fifo_f = 'INV_B_FIFO_VAL_F'\n            std = 'INV_B_STD_VAL'\n            std_f = 'INV_B_STD_VAL_F'\n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n            ival_tot = 'INV_B_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_B_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_B_NL_TOT_DVAL'\n        }\n        if (parseFloat(record?.[fifo]) > 0) {\n            if (0 == (parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl]))) {\n                if (parseFloat(record?.[fifo]) != parseFloat(record?.[ival_tot])) {\n                    record[fifo] = record?.[ival_tot]\n                    flagRules(fifo, [ival_tot_f])\n                }\n            } else {\n                record[fifo] = Math.round((parseFloat(record?.[fifo]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'K')\n                record[avg] = Math.round((parseFloat(record?.[avg]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[avg_f] = setCharAt(record?.[avg_f], 2, 'K')\n                record[std] = Math.round((parseFloat(record?.[std]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[std_f] = setCharAt(record?.[std_f], 2, 'K')\n                record[othnl] = Math.round(parseFloat(record?.[ival_tot]) - (parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std])))\n                record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'K')\n            }\n        } else if (parseFloat(record?.[avg]) > 0) {\n            if ((parseFloat(record?.[std]) + parseFloat(record?.[othnl])) == 0) {\n                if (parseFloat(record?.[avg]) != parseFloat(record?.[ival_tot])) {\n                    record[avg] = record?.[ival_tot]\n                    flagRules(avg, [ival_tot_f])\n                }\n            } else {\n                record[avg] = Math.round((parseFloat(record?.[avg]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[avg_f] = setCharAt(record?.[avg_f], 2, 'K')\n                record[std] = Math.round((parseFloat(record?.[std]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[std_f] = setCharAt(record?.[std_f], 2, 'K')\n                record[othnl] = Math.round(parseFloat(record?.[ival_tot]) - (parseFloat(record?.[avg]) + parseFloat(record?.[std])))\n                record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'K')\n            }\n\n        } else if (parseFloat(record?.[std]) > 0) {\n            if (parseFloat(record?.[othnl]) == 0) {\n                if (parseFloat(record?.[std]) != parseFloat(record?.[ival_tot])) {\n                    record[std] = record?.[ival_tot]\n                    flagRules(std, [ival_tot_f])\n                }\n            } else {\n                record[std] = Math.round((parseFloat(record?.[std]) / parseFloat(record?.[nl_tot])) * parseFloat(record?.[ival_tot]))\n                record[std_f] = setCharAt(record?.[std_f], 2, 'K')\n                record[othnl] = Math.round(parseFloat(record?.[ival_tot]) - parseFloat(record?.[std]))\n                record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'K')\n            }\n        } else if (parseFloat(record?.[othnl]) == parseFloat(record?.[ival_tot])) {\n        } else {\n            record[othnl] = parseFloat(record?.[ival_tot])\n            flagRules(othnl, [ival_tot_f])\n        }\n    }\n\n    function EvaluateNoNLIFOValuationMethodModule() {\n        let letter = msg.miv\n        EvaluateNoNLIFOValuationMethod(letter)\n    }\n\n    EvaluateNoNLIFOValuationMethodModule()\n    return msg\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'MIV EvaluateNoNLIFOValuationMethodModule'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "7c98b0321d9624dd",
        "type": "function",
        "z": "3e0275f580e2d77c",
        "name": "MIV: EvaluateDetailValuationMethods",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    function EvaluateDetailValuationMethods(variable) {\n        let avg = ''\n        let avg_f = ''\n        let fifo = ''\n        let fifo_f = ''\n        let std = ''\n        let std_f = ''\n        let othnl = ''\n        let othnl_f = ''\n        let ival_tot = ''\n        let ival_tot_f = ''\n        let nl_tot = ''\n        let nl_tot_f = ''\n        let lifo = ''\n        let lifo_f = ''\n        let ec_std = ''\n        let ec_avg = ''\n        let ec_fifo = ''\n        let ec_ival_tot = ''\n        let INVVSUMx = flow.get('$parent.invvsumx')\n        let INVDIFFx = flow.get('$parent.invdiffx')\n\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            avg_f = 'INV_E_AVG_VAL_F'\n            fifo = 'INV_E_FIFO_VAL'\n            fifo_f = 'INV_E_FIFO_VAL_F'\n            std = 'INV_E_STD_VAL'\n            std_f = 'INV_E_STD_VAL_F'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n            ival_tot = 'INV_E_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_E_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_E_NL_TOT_DVAL'\n            nl_tot_f = 'INV_E_NL_TOT_DVAL_F'\n            lifo = 'INV_E_LIFO_VAL'\n            lifo_f = 'INV_E_LIFO_VAL_F'\n            ec_std = 'EC_INV_E_STD_VAL'\n            ec_avg = 'EC_INV_E_AVG_VAL'\n            ec_fifo = 'EC_INV_E_FIFO_VAL'\n            ec_ival_tot = 'EC_INV_E_IVAL_TOT_DVAL'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            avg_f = 'INV_B_AVG_VAL_F'\n            fifo = 'INV_B_FIFO_VAL'\n            fifo_f = 'INV_B_FIFO_VAL_F'\n            std = 'INV_B_STD_VAL'\n            std_f = 'INV_B_STD_VAL_F'\n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n            ival_tot = 'INV_B_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_B_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_B_NL_TOT_DVAL'\n            nl_tot_f = 'INV_B_NL_TOT_DVAL_F'\n            lifo = 'INV_B_LIFO_VAL'\n            lifo_f = 'INV_B_LIFO_VAL_F'\n            ec_std = 'EC_INV_B_STD_VAL'\n            ec_avg = 'EC_INV_B_AVG_VAL'\n            ec_fifo = 'EC_INV_B_FIFO_VAL'\n            ec_ival_tot = 'EC_INV_B_IVAL_TOT_DVAL'\n        }\n\n        if (parseFloat(record?.[lifo]) == 0) {\n            if (parseFloat(INVVSUMx) == 0) {\n                if (parseFloat(record?.[ec_ival_tot]) == 0) {\n                    flow.set('mivDetail','Call Random')\n                } else {\n                    record[fifo] = Math.round((parseFloat(record?.[ec_fifo]) / parseFloat(record?.[ec_ival_tot])) * parseFloat(record?.[ival_tot]))\n                    record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'H')\n                    record[avg] = Math.round((parseFloat(record?.[ec_avg]) / parseFloat(record?.[ec_ival_tot])) * parseFloat(record?.[ival_tot]))\n                    record[avg_f] = setCharAt(record?.[avg_f], 2, 'H')\n                    record[std] = Math.round((parseFloat(record?.[ec_std]) / parseFloat(record?.[ec_ival_tot])) * parseFloat(record?.[ival_tot]))\n                    record[std_f] = setCharAt(record?.[std_f], 2, 'H')\n                    record[othnl] = Math.round(parseFloat(record?.[ival_tot]) -\n                        (\n                            parseFloat(record?.[lifo]) + parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std])\n                        ))\n                    record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'H')\n                    flow.set('mivDetail','Route C')\n                }\n            } else {\n                    flow.set('mivDetail','Call NonLifo Valuation')\n            }\n        } else if (parseFloat(INVVSUMx) == 0) {\n            if (parseFloat(record?.[lifo]) == parseFloat(record?.[ival_tot])) {\n                    flow.set('mivDetail','Route A')\n            } else {\n                record[lifo] = record?.[ival_tot]\n                flagRules(lifo, [ival_tot_f])\n                    flow.set('mivDetail','Route A')\n            }\n        } else {\n            record[fifo] = Math.round((parseFloat(record?.[fifo]) / parseFloat(INVVSUMx)) * parseFloat(INVDIFFx))\n            record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'K')\n\n            record[avg] = Math.round((parseFloat(record?.[avg]) / parseFloat(INVVSUMx)) * parseFloat(INVDIFFx));\n            record[avg_f] = setCharAt(record?.[avg_f], 2, 'K');\n\n            record[std] = Math.round((parseFloat(record?.[std]) / parseFloat(INVVSUMx)) * parseFloat(INVDIFFx));\n            record[std_f] = setCharAt(record?.[std_f], 2, 'K');\n\n            record[othnl] = Math.round(parseFloat(record?.[ival_tot]) - (parseFloat(record?.[lifo]) + parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std])));\n            record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'K');\n\n            flow.set('mivDetail','Route C')\n        }\n    }\n    function EvaluateDetailValuationMethodsModule() {\n        let letter = global.get('miv')\n        flow.set('mivDetail','')\n        EvaluateDetailValuationMethods(letter)\n    }\n    EvaluateDetailValuationMethodsModule()\n    return msg\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MIV Evaluate Detail'\n    return msg\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 180,
        "wires": [
            [
                "edaf1561308b996d"
            ]
        ]
    },
    {
        "id": "a0b67ba3e5bf4c49",
        "type": "subflow:625b8c982fed66b7",
        "z": "3e0275f580e2d77c",
        "name": "",
        "x": 1380,
        "y": 260,
        "wires": [
            [
                "0830d4165d5f9095"
            ]
        ]
    },
    {
        "id": "1850df34045d729c",
        "type": "subflow:6f23d11cf5bb4bde",
        "z": "3e0275f580e2d77c",
        "name": "",
        "x": 1330,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "7eb0d19b8020414b",
        "type": "switch",
        "z": "3e0275f580e2d77c",
        "name": "",
        "property": "mivDetail",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "Call Random",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Call NonLifo Valuation",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Route C",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Route A",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1070,
        "y": 240,
        "wires": [
            [
                "1850df34045d729c"
            ],
            [
                "a0b67ba3e5bf4c49"
            ],
            [
                "db55a21f33144cc1"
            ],
            [
                "5898adbd68d45d05"
            ]
        ]
    },
    {
        "id": "db55a21f33144cc1",
        "type": "function",
        "z": "3e0275f580e2d77c",
        "name": "Route C",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n\n    function EvaluateDetailPathC(variable) {\n        let othnl = ''\n        let avg = ''\n        let fifo = ''\n        let std = ''\n        let othnl_f = ''\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            fifo = 'INV_E_FIFO_VAL'\n            std = 'INV_E_STD_VAL'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            fifo = 'INV_B_FIFO_VAL'\n            std = 'INV_B_STD_VAL'\n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n        }\n        if (parseFloat(record?.[othnl]) < 0) {\n            record[othnl] = Math.abs(record?.[othnl])\n\n            var max = Math.max(...[parseFloat(record?.[fifo]), parseFloat(record?.[avg]), parseFloat(record?.[std])])\n            if (parseFloat(record?.[fifo]) == max) {\n                record[fifo] = record?.[fifo] - record?.[othnl]\n            } else if (parseFloat(record?.[avg]) == max) {\n                record[avg] = record?.[avg] - record?.[othnl]\n            } else {\n                record[std] = record?.[std] - record?.[othnl]\n            }\n            record[othnl] = 0\n            record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'Z');\n        }\n    }\n    \n    function EvaluateDetailValuationMethodsModulePathC() {\n        let letter = global.get('miv')\n        EvaluateDetailPathC(letter)\n    }\n    EvaluateDetailValuationMethodsModulePathC()\n    return msg\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MIV Evaluate Detail'\n    return msg\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1320,
        "y": 420,
        "wires": [
            [
                "05101f8d4d776a37"
            ]
        ]
    },
    {
        "id": "5898adbd68d45d05",
        "type": "function",
        "z": "3e0275f580e2d77c",
        "name": "Route A",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }    //[fifo_f, avg_f, std_f, othnl_f]\n\n    function EvaluateDetailPathA(variable) {\n        let othnl = ''\n        let othnl_f = ''\n        let avg = ''\n        let avg_f = ''\n        let fifo = ''\n        let fifo_f = ''\n        let std = ''\n        let std_f = ''\n        let nl_tot = ''\n        let nl_tot_f = ''\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            avg_f = 'INV_E_AVG_VAL_F'\n            fifo = 'INV_E_FIFO_VAL'\n            fifo_f = 'INV_E_FIFO_VAL_F'\n            std = 'INV_E_STD_VAL'\n            std_f = 'INV_E_STD_VAL_F'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n            nl_tot = 'INV_E_NL_TOT_DVAL'\n            nl_tot_f = 'INV_E_NL_TOT_DVAL_F'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            avg_f = 'INV_B_AVG_VAL_F'\n            fifo = 'INV_B_FIFO_VAL'\n            fifo_f = 'INV_B_FIFO_VAL_F'\n            std = 'INV_B_STD_VAL'\n            std_f = 'INV_B_STD_VAL_F'            \n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n            nl_tot = 'INV_B_NL_TOT_DVAL'\n            nl_tot_f = 'INV_B_NL_TOT_DVAL_F'\n        }\n        if (parseFloat(record?.[nl_tot]) != (parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl]))) {\n            record[nl_tot] = parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl])\n            flagRules(nl_tot, [fifo_f, avg_f, std_f, othnl_f])\n            \n        }\n    }\n\n    function EvaluateDetailValuationMethodsModulePathA() {\n        let letter = global.get('miv')\n        EvaluateDetailPathA(letter)\n    }\n    EvaluateDetailValuationMethodsModulePathA()\n    return msg\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MIV Evaluate Detail'\n    return msg\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "0352308a0506973d",
        "type": "function",
        "z": "3e0275f580e2d77c",
        "name": "MIV: EvaluateDetailValuationMethods (Database)",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n    function EvaluateDetailValuationMethods(variable) {\n        let avg = ''\n        let avg_f = ''\n        let fifo = ''\n        let fifo_f = ''\n        let std = ''\n        let std_f = ''\n        let othnl = ''\n        let othnl_f = ''\n        let ival_tot = ''\n        let ival_tot_f = ''\n        let nl_tot = ''\n        let nl_tot_f = ''\n        let lifo = ''\n        let lifo_f = ''\n        let ec_std = ''\n        let ec_avg = ''\n        let ec_fifo = ''\n        let ec_ival_tot = ''\n        let INVVSUMx = msg.invvsumx\n        let INVDIFFx = msg.invdiffx\n\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            avg_f = 'INV_E_AVG_VAL_F'\n            fifo = 'INV_E_FIFO_VAL'\n            fifo_f = 'INV_E_FIFO_VAL_F'\n            std = 'INV_E_STD_VAL'\n            std_f = 'INV_E_STD_VAL_F'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n            ival_tot = 'INV_E_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_E_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_E_NL_TOT_DVAL'\n            nl_tot_f = 'INV_E_NL_TOT_DVAL_F'\n            lifo = 'INV_E_LIFO_VAL'\n            lifo_f = 'INV_E_LIFO_VAL_F'\n            ec_std = 'INV_E_STD_VAL'\n            ec_avg = 'INV_E_AVG_VAL'\n            ec_fifo = 'INV_E_FIFO_VAL'\n            ec_ival_tot = 'INV_E_IVAL_TOT_DVAL'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            avg_f = 'INV_B_AVG_VAL_F'\n            fifo = 'INV_B_FIFO_VAL'\n            fifo_f = 'INV_B_FIFO_VAL_F'\n            std = 'INV_B_STD_VAL'\n            std_f = 'INV_B_STD_VAL_F'\n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n            ival_tot = 'INV_B_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_B_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_B_NL_TOT_DVAL'\n            nl_tot_f = 'INV_B_NL_TOT_DVAL_F'\n            lifo = 'INV_B_LIFO_VAL'\n            lifo_f = 'INV_B_LIFO_VAL_F'\n            ec_std = 'INV_B_STD_VAL'\n            ec_avg = 'INV_B_AVG_VAL'\n            ec_fifo = 'INV_B_FIFO_VAL'\n            ec_ival_tot = 'INV_B_IVAL_TOT_DVAL'\n        }\n\n        if (parseFloat(record?.[lifo]) == 0) {\n            if (parseFloat(INVVSUMx) == 0) {\n                if (parseFloat(ec?.[ec_ival_tot]) == 0) {\n                    msg.mivDetail = 'Call Random'\n                } else {\n                    record[fifo] = Math.round((parseFloat(ec?.[ec_fifo]) / parseFloat(ec?.[ec_ival_tot])) * parseFloat(record?.[ival_tot]))\n                    record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'H')\n                    record[avg] = Math.round((parseFloat(ec?.[ec_avg]) / parseFloat(ec?.[ec_ival_tot])) * parseFloat(record?.[ival_tot]))\n                    record[avg_f] = setCharAt(record?.[avg_f], 2, 'H')\n                    record[std] = Math.round((parseFloat(ec?.[ec_std]) / parseFloat(ec?.[ec_ival_tot])) * parseFloat(record?.[ival_tot]))\n                    record[std_f] = setCharAt(record?.[std_f], 2, 'H')\n                    record[othnl] = Math.round(parseFloat(record?.[ival_tot]) -\n                        (\n                            parseFloat(record?.[lifo]) + parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std])\n                        ))\n                    record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'H')\n                    msg.mivDetail='Route C'\n                }\n            } else {\n                    msg.mivDetail='Call NonLifo Valuation'\n            }\n        } else if (parseFloat(INVVSUMx) == 0) {\n            if (parseFloat(record?.[lifo]) == parseFloat(record?.[ival_tot])) {\n                    msg.mivDetail='Route A'\n            } else {\n                record[lifo] = record?.[ival_tot]\n                flagRules(lifo, [ival_tot_f])\n                    msg.mivDetail='Route A'\n            }\n        } else {\n            record[fifo] = Math.round((parseFloat(record?.[fifo]) / parseFloat(INVVSUMx)) * parseFloat(INVDIFFx))\n            record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'K')\n\n            record[avg] = Math.round((parseFloat(record?.[avg]) / parseFloat(INVVSUMx)) * parseFloat(INVDIFFx));\n            record[avg_f] = setCharAt(record?.[avg_f], 2, 'K');\n\n            record[std] = Math.round((parseFloat(record?.[std]) / parseFloat(INVVSUMx)) * parseFloat(INVDIFFx));\n            record[std_f] = setCharAt(record?.[std_f], 2, 'K');\n\n            record[othnl] = Math.round(parseFloat(record?.[ival_tot]) - (parseFloat(record?.[lifo]) + parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std])));\n            record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'K');\n\n            msg.mivDetail='Route C'\n        }\n    }\n    function EvaluateDetailValuationMethodsModule() {\n        let letter = msg.miv\n        msg.mivDetail=''\n        EvaluateDetailValuationMethods(letter)\n    }\n    EvaluateDetailValuationMethodsModule()\n    return msg\n}catch(e){\n    msg.err='Exit Edit'\n    msg.payload.exit = 'MIV Evaluate Detail'\n    return msg\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "edaf1561308b996d",
        "type": "switch",
        "z": "3e0275f580e2d77c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 860,
        "y": 180,
        "wires": [
            [],
            [
                "7eb0d19b8020414b"
            ]
        ]
    },
    {
        "id": "0830d4165d5f9095",
        "type": "switch",
        "z": "3e0275f580e2d77c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1360,
        "y": 340,
        "wires": [
            [],
            [
                "db55a21f33144cc1"
            ]
        ]
    },
    {
        "id": "05101f8d4d776a37",
        "type": "switch",
        "z": "3e0275f580e2d77c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1360,
        "y": 480,
        "wires": [
            [],
            [
                "5898adbd68d45d05"
            ]
        ]
    },
    {
        "id": "58fd2f764b05e12f",
        "type": "function",
        "z": "3e0275f580e2d77c",
        "name": "Route C",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n\n    function EvaluateDetailPathC(variable) {\n        let othnl = ''\n        let avg = ''\n        let fifo = ''\n        let std = ''\n        let othnl_f = ''\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            fifo = 'INV_E_FIFO_VAL'\n            std = 'INV_E_STD_VAL'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            fifo = 'INV_B_FIFO_VAL'\n            std = 'INV_B_STD_VAL'\n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n        }\n        if (parseFloat(record?.[othnl]) < 0) {\n            record[othnl] = Math.abs(record?.[othnl])\n\n            var max = Math.max(...[parseFloat(record?.[fifo]), parseFloat(record?.[avg]), parseFloat(record?.[std])])\n            if (parseFloat(record?.[fifo]) == max) {\n                record[fifo] = record?.[fifo] - record?.[othnl]\n            } else if (parseFloat(record?.[avg]) == max) {\n                record[avg] = record?.[avg] - record?.[othnl]\n            } else {\n                record[std] = record?.[std] - record?.[othnl]\n            }\n            record[othnl] = 0\n            record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'Z');\n        }\n    }\n    \n    function EvaluateDetailValuationMethodsModulePathC() {\n        let letter = msg.miv\n        EvaluateDetailPathC(letter)\n    }\n    EvaluateDetailValuationMethodsModulePathC()\n    return msg\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'MIV Evaluate Detail'\n    return msg\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 564.6124877929688,
        "y": 356.82501220703125,
        "wires": [
            []
        ]
    },
    {
        "id": "e9edc6f342a620dd",
        "type": "function",
        "z": "3e0275f580e2d77c",
        "name": "Route A",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }    //[fifo_f, avg_f, std_f, othnl_f]\n\n    function EvaluateDetailPathA(variable) {\n        let othnl = ''\n        let othnl_f = ''\n        let avg = ''\n        let avg_f = ''\n        let fifo = ''\n        let fifo_f = ''\n        let std = ''\n        let std_f = ''\n        let nl_tot = ''\n        let nl_tot_f = ''\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            avg_f = 'INV_E_AVG_VAL_F'\n            fifo = 'INV_E_FIFO_VAL'\n            fifo_f = 'INV_E_FIFO_VAL_F'\n            std = 'INV_E_STD_VAL'\n            std_f = 'INV_E_STD_VAL_F'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n            nl_tot = 'INV_E_NL_TOT_DVAL'\n            nl_tot_f = 'INV_E_NL_TOT_DVAL_F'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            avg_f = 'INV_B_AVG_VAL_F'\n            fifo = 'INV_B_FIFO_VAL'\n            fifo_f = 'INV_B_FIFO_VAL_F'\n            std = 'INV_B_STD_VAL'\n            std_f = 'INV_B_STD_VAL_F'            \n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n            nl_tot = 'INV_B_NL_TOT_DVAL'\n            nl_tot_f = 'INV_B_NL_TOT_DVAL_F'\n        }\n        if (parseFloat(record?.[nl_tot]) != (parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl]))) {\n            record[nl_tot] = parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl])\n            flagRules(nl_tot, [fifo_f, avg_f, std_f, othnl_f])\n            \n        }\n    }\n\n    function EvaluateDetailValuationMethodsModulePathA() {\n        let letter = msg.miv\n        EvaluateDetailPathA(letter)\n    }\n    EvaluateDetailValuationMethodsModulePathA()\n    return msg\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'MIV Evaluate Detail'\n    return msg\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "fe4e35d89f423462",
        "type": "subflow:3e0275f580e2d77c",
        "z": "0ab9d9d713d5103c",
        "name": "",
        "x": 1250,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "c313e698b0913790",
        "type": "function",
        "z": "0ab9d9d713d5103c",
        "name": "MIV: EvaluateNoNLIFOValuationMethodsModule",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    function EvaluateNoNLIFOValuationMethodsModulePathA(variable, INVVSUMx) {\n        let ival_tot = ''\n        let lifo = ''\n        if (variable == 'E') {\n            ival_tot = 'INV_E_IVAL_TOT_DVAL'\n            lifo = 'INV_E_LIFO_VAL'\n        } else if (variable == 'B') {\n            ival_tot = 'INV_B_IVAL_TOT_DVAL'\n            lifo = 'INV_B_LIFO_VAL'\n        }\n        var INVDIFFx = parseFloat(record?.[ival_tot]) - parseFloat(record?.[lifo])\n        flow.set('invvsumx',INVVSUMx)\n        flow.set('invdiffx',INVDIFFx)\n        flow.set('callDet','Call Details')\n    }\n\n    function EvaluateValuationMethods(variable) {\n        let avg = ''\n        let avg_f = ''\n        let fifo = ''\n        let fifo_f = ''\n        let std = ''\n        let std_f = ''\n        let othnl = ''\n        let othnl_f = ''\n        let tot = ''\n        let tot_f = ''\n        let ival_tot = ''\n        let ival_tot_f = ''\n        let nl_tot = ''\n        let nl_tot_f = ''\n        let lifo = ''\n        let lifo_f = ''\n        let lifo_rsv = ''\n        let lifo_rsv_f = ''\n\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            avg_f = 'INV_E_AVG_VAL_F'\n            fifo = 'INV_E_FIFO_VAL'\n            fifo_f = 'INV_E_FIFO_VAL_F'\n            std = 'INV_E_STD_VAL'\n            std_f = 'INV_E_STD_VAL_F'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n            tot = 'INV_E_TOT_VAL'\n            tot_f = 'INV_E_TOT_VAL_F'\n            ival_tot = 'INV_E_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_E_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_E_NL_TOT_DVAL'\n            nl_tot_f = 'INV_E_NL_TOT_DVAL_F'\n            lifo = 'INV_E_LIFO_VAL'\n            lifo_f = 'INV_E_LIFO_VAL_F'\n            lifo_rsv = 'INV_E_LIFO_RSV_VAL'\n            lifo_rsv_f = 'INV_E_LIFO_RSV_VAL_F'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            avg_f = 'INV_B_AVG_VAL_F'\n            fifo = 'INV_B_FIFO_VAL'\n            fifo_f = 'INV_B_FIFO_VAL_F'\n            std = 'INV_B_STD_VAL'\n            std_f = 'INV_B_STD_VAL_F'\n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n            tot = 'INV_B_TOT_VAL'\n            tot_f = 'INV_B_TOT_VAL_F'\n            ival_tot = 'INV_B_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_B_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_B_NL_TOT_DVAL'\n            nl_tot_f = 'INV_B_NL_TOT_DVAL_F'\n            lifo = 'INV_B_LIFO_VAL'\n            lifo_f = 'INV_B_LIFO_VAL_F'\n            lifo_rsv = 'INV_B_LIFO_RSV_VAL'\n            lifo_rsv_f = 'INV_B_LIFO_RSV_VAL_F'\n        }\n        var INVVSUMx = parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl])\n\n        if (parseInt(record?.[tot]) == 0) {\n            if ((parseFloat(record?.[lifo]) + parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl]) + parseFloat(record?.[ival_tot]) + parseFloat(record?.[nl_tot])) > 0 || parseInt(record?.[lifo_rsv]) != 0) {\n                record[lifo] = 0;\n                record[lifo_f] = setCharAt(record?.[lifo_f], 2, 'Z');\n                record[fifo] = 0\n                record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'Z');\n                record[avg] = 0;\n                record[avg_f] = setCharAt(record?.[avg_f], 2, 'Z');\n                record[std] = 0;\n                record[std_f] = setCharAt(record?.[std_f], 2, 'Z');\n                record[othnl] = 0;\n                record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'Z');\n                record[ival_tot] = 0;\n                record[ival_tot_f] = setCharAt(record?.[ival_tot_f], 2, 'Z');\n                record[nl_tot] = 0;\n                record[nl_tot_f] = setCharAt(record?.[nl_tot_f], 2, 'Z');\n                record[lifo_rsv] = 0;\n                record[lifo_rsv_f] = setCharAt(record?.[lifo_rsv_f], 2, 'Z');\n            }\n\n        } else if (parseFloat(record?.[tot]) == parseFloat(record?.[ival_tot])) {\n            if (parseFloat(record?.[ival_tot]) == parseFloat(record?.[lifo]) + parseFloat(INVVSUMx)) {\n                if (parseFloat(record?.[nl_tot]) == parseFloat(INVVSUMx)) {\n                } else {\n                    record[nl_tot] = INVVSUMx\n                    flagRules(nl_tot, [fifo_f,avg_f,std_f,othnl_f])\n                }\n            } else {\n                EvaluateNoNLIFOValuationMethodsModulePathA(variable, INVVSUMx)\n            }\n        } else {\n            record[ival_tot] = record[tot]\n            flagRules(ival_tot,[tot_f])\n            EvaluateNoNLIFOValuationMethodsModulePathA(variable, INVVSUMx)\n        }\n    }\n    function EvaluateValuationMethodsModule() {\n        flow.set('invvsumx','')\n        flow.set('invdiffx','')\n        flow.set('callDet','')\n        let letter = global.get('miv')\n        EvaluateValuationMethods(letter)\n    }\n\n    EvaluateValuationMethodsModule()\n    record.ACTION = 'Return to Non-LIFO Valuation Methods'\n\n    return msg;\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MIV EvaluateNoNLIFOValuationMethodsModule'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 60,
        "wires": [
            [
                "b7c456c9d73bae60"
            ]
        ]
    },
    {
        "id": "46a4448ac47c0607",
        "type": "function",
        "z": "0ab9d9d713d5103c",
        "name": "MIV: EvaluateNoNLIFOValuationMethodsModule_Database",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    function EvaluateNoNLIFOValuationMethodsModulePathA(variable, INVVSUMx) {\n        let ival_tot = ''\n        let lifo = ''\n        if (variable == 'E') {\n            ival_tot = 'INV_E_IVAL_TOT_DVAL'\n            lifo = 'INV_E_LIFO_VAL'\n        } else if (variable == 'B') {\n            ival_tot = 'INV_B_IVAL_TOT_DVAL'\n            lifo = 'INV_B_LIFO_VAL'\n        }\n        var INVDIFFx = parseFloat(record?.[ival_tot]) - parseFloat(record?.[lifo])\n        msg.invvsumx = INVVSUMx\n        msg.invdiffx = INVDIFFx\n        msg.callDet = 'Call Details'\n    }\n\n    function EvaluateValuationMethods(variable) {\n        let avg = ''\n        let avg_f = ''\n        let fifo = ''\n        let fifo_f = ''\n        let std = ''\n        let std_f = ''\n        let othnl = ''\n        let othnl_f = ''\n        let tot = ''\n        let tot_f = ''\n        let ival_tot = ''\n        let ival_tot_f = ''\n        let nl_tot = ''\n        let nl_tot_f = ''\n        let lifo = ''\n        let lifo_f = ''\n        let lifo_rsv = ''\n        let lifo_rsv_f = ''\n\n        if (variable == 'E') {\n            avg = 'INV_E_AVG_VAL'\n            avg_f = 'INV_E_AVG_VAL_F'\n            fifo = 'INV_E_FIFO_VAL'\n            fifo_f = 'INV_E_FIFO_VAL_F'\n            std = 'INV_E_STD_VAL'\n            std_f = 'INV_E_STD_VAL_F'\n            othnl = 'INV_E_OTHNL_VAL'\n            othnl_f = 'INV_E_OTHNL_VAL_F'\n            tot = 'INV_E_TOT_VAL'\n            tot_f = 'INV_E_TOT_VAL_F'\n            ival_tot = 'INV_E_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_E_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_E_NL_TOT_DVAL'\n            nl_tot_f = 'INV_E_NL_TOT_DVAL_F'\n            lifo = 'INV_E_LIFO_VAL'\n            lifo_f = 'INV_E_LIFO_VAL_F'\n            lifo_rsv = 'INV_E_LIFO_RSV_VAL'\n            lifo_rsv_f = 'INV_E_LIFO_RSV_VAL_F'\n        } else if (variable == 'B') {\n            avg = 'INV_B_AVG_VAL'\n            avg_f = 'INV_B_AVG_VAL_F'\n            fifo = 'INV_B_FIFO_VAL'\n            fifo_f = 'INV_B_FIFO_VAL_F'\n            std = 'INV_B_STD_VAL'\n            std_f = 'INV_B_STD_VAL_F'\n            othnl = 'INV_B_OTHNL_VAL'\n            othnl_f = 'INV_B_OTHNL_VAL_F'\n            tot = 'INV_B_TOT_VAL'\n            tot_f = 'INV_B_TOT_VAL_F'\n            ival_tot = 'INV_B_IVAL_TOT_DVAL'\n            ival_tot_f = 'INV_B_IVAL_TOT_DVAL_F'\n            nl_tot = 'INV_B_NL_TOT_DVAL'\n            nl_tot_f = 'INV_B_NL_TOT_DVAL_F'\n            lifo = 'INV_B_LIFO_VAL'\n            lifo_f = 'INV_B_LIFO_VAL_F'\n            lifo_rsv = 'INV_B_LIFO_RSV_VAL'\n            lifo_rsv_f = 'INV_B_LIFO_RSV_VAL_F'\n        }\n        var INVVSUMx = parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl])\n\n        if (parseInt(record?.[tot]) == 0) {\n            if ((parseFloat(record?.[lifo]) + parseFloat(record?.[fifo]) + parseFloat(record?.[avg]) + parseFloat(record?.[std]) + parseFloat(record?.[othnl]) + parseFloat(record?.[ival_tot]) + parseFloat(record?.[nl_tot])) > 0 || parseInt(record?.[lifo_rsv]) != 0) {\n                record[lifo] = 0;\n                record[lifo_f] = setCharAt(record?.[lifo_f], 2, 'Z');\n                record[fifo] = 0\n                record[fifo_f] = setCharAt(record?.[fifo_f], 2, 'Z');\n                record[avg] = 0;\n                record[avg_f] = setCharAt(record?.[avg_f], 2, 'Z');\n                record[std] = 0;\n                record[std_f] = setCharAt(record?.[std_f], 2, 'Z');\n                record[othnl] = 0;\n                record[othnl_f] = setCharAt(record?.[othnl_f], 2, 'Z');\n                record[ival_tot] = 0;\n                record[ival_tot_f] = setCharAt(record?.[ival_tot_f], 2, 'Z');\n                record[nl_tot] = 0;\n                record[nl_tot_f] = setCharAt(record?.[nl_tot_f], 2, 'Z');\n                record[lifo_rsv] = 0;\n                record[lifo_rsv_f] = setCharAt(record?.[lifo_rsv_f], 2, 'Z');\n            }\n\n        } else if (parseFloat(record?.[tot]) == parseFloat(record?.[ival_tot])) {\n            if (parseFloat(record?.[ival_tot]) == parseFloat(record?.[lifo]) + parseFloat(INVVSUMx)) {\n                if (parseFloat(record?.[nl_tot]) == parseFloat(INVVSUMx)) {\n                } else {\n                    record[nl_tot] = INVVSUMx\n                    flagRules(nl_tot, [fifo_f,avg_f,std_f,othnl_f])\n                }\n            } else {\n                EvaluateNoNLIFOValuationMethodsModulePathA(variable, INVVSUMx)\n            }\n        } else {\n            record[ival_tot] = record[tot]\n            flagRules(ival_tot,[tot_f])\n            EvaluateNoNLIFOValuationMethodsModulePathA(variable, INVVSUMx)\n        }\n    }\n    function EvaluateValuationMethodsModule() {\n        msg.invvsumx = ''\n        msg.invdiffx = ''\n        msg.callDet = ''\n        let letter = msg.miv\n        EvaluateValuationMethods(letter)\n    }\n\n    EvaluateValuationMethodsModule()\n\n    return msg;\n}catch(e){\n    msg.err= 'Exit Edit'\n    msg.payload.exit = 'MIV EvaluateNoNLIFOValuationMethodsModule'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 320,
        "wires": [
            [
                "daf27efbf9f3aa0f"
            ]
        ]
    },
    {
        "id": "d7d779a3019dab22",
        "type": "switch",
        "z": "0ab9d9d713d5103c",
        "name": "",
        "property": "callDet",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "Call Details",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 910,
        "y": 180,
        "wires": [
            [
                "fe4e35d89f423462"
            ],
            []
        ]
    },
    {
        "id": "b7c456c9d73bae60",
        "type": "switch",
        "z": "0ab9d9d713d5103c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1060,
        "y": 60,
        "wires": [
            [],
            [
                "d7d779a3019dab22"
            ]
        ]
    },
    {
        "id": "4cc9bf7f08282667",
        "type": "switch",
        "z": "0ab9d9d713d5103c",
        "name": "",
        "property": "callDet",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Call Details",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 870,
        "y": 440,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "daf27efbf9f3aa0f",
        "type": "switch",
        "z": "0ab9d9d713d5103c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1020,
        "y": 320,
        "wires": [
            [],
            [
                "4cc9bf7f08282667"
            ]
        ]
    },
    {
        "id": "597772c0df7454ff",
        "type": "subflow:0ab9d9d713d5103c",
        "z": "379e12b168b021d1",
        "name": "",
        "x": 780,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "b78377ba255063ad",
        "type": "function",
        "z": "c65f463988b11e12",
        "name": "MIV: Evaluate LIFO Module",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    let cache = global.get(\"lookupCache\");\n\n    let inv_reserve_file = cache.data.find(\n        item =>\n            item.module === \"inv_reserve\" &&\n            item.param === 'inv_reserve' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"estab\"\n    )?.json_values;\n\n    function findParam() {\n        let NAICS_CODE = record.NAICS_CODE\n        NAICS_CODE = NAICS_CODE.toString()\n        for (let i in inv_reserve_file['INV_RESERVE']) {\n            let invReserve = inv_reserve_file['INV_RESERVE'][i]\n            let naics = invReserve['NAICSNEW']\n            naics = naics.toString()\n            if (NAICS_CODE.startsWith(naics)) {\n                return (invReserve);\n                break;\n            }\n        }\n    }\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n    function EvaluateLIFOModulePathB() {\n        record.ACTION = 'Return to LIFO Valuation Method'\n    }\n\n    function EvaluateLIFOModulePathC(name_lifo, name_tot, name_lifo_f, name_tot_f) {\n        if (parseFloat(record?.[name_lifo]) > parseFloat(record?.[name_tot])) {\n            record[name_lifo] = record?.[name_tot]\n            flagRules(name_lifo,[name_tot_f] )\n        }\n        EvaluateLIFOModulePathB()\n    }\n\n    function EvalLIFO(variable, invReserve) {\n        let name_tot = ''\n        let name_tot_f = ''\n        let name_lifo = ''\n        let name_lifo_rsv = ''\n        let name_lifo_f = ''\n        let name_lifo_rsv_f = ''\n        let ec_name_tot = ''\n        let ec_name_lifo = ''\n        let ec_name_lifo_rsv = ''\n        let rsv = ''\n        let beta = ''\n        if (variable == 'E') {\n            name_tot = 'INV_E_TOT_VAL'\n            name_tot_f = 'INV_E_TOT_VAL_F'\n            name_lifo = 'INV_E_LIFO_VAL'\n            name_lifo_rsv = 'INV_E_LIFO_RSV_VAL'\n            name_lifo_f = 'INV_E_LIFO_VAL_F'\n            name_lifo_rsv_f = 'INV_E_LIFO_RSV_VAL_F'\n            ec_name_tot = 'EC_INV_E_TOT_VAL'\n            ec_name_lifo = 'EC_INV_E_LIFO_VAL'\n            ec_name_lifo_rsv = 'EC_INV_E_LIFO_RSV_VAL'\n            rsv = 'RSVE_TOTE_UL'\n            beta = 'BETA_E'\n        } else if (variable == 'B') {\n            name_tot = 'INV_B_TOT_VAL'\n            name_tot_f = 'INV_B_TOT_VAL_F'\n            name_lifo = 'INV_B_LIFO_VAL'\n            name_lifo_rsv = 'INV_B_LIFO_RSV_VAL'\n            name_lifo_f = 'INV_B_LIFO_VAL_F'\n            name_lifo_rsv_f = 'INV_B_LIFO_RSV_VAL_F'\n            ec_name_tot = 'EC_INV_B_TOT_VAL'\n            ec_name_lifo = 'EC_INV_B_LIFO_VAL'\n            ec_name_lifo_rsv = 'EC_INV_B_LIFO_RSV_VAL'\n            rsv = 'RSVB_TOTB_BL'\n            beta = 'BETA_B'\n        }\n        rsv = invReserve[rsv]\n        beta = invReserve[beta]\n\n        if (parseInt(record?.[name_lifo]) == 0) {\n            if (parseInt(record?.[name_lifo_rsv]) == 0) {\n                if (parseInt(record?.[ec_name_lifo]) == 0 || parseInt(record?.[ec_name_tot]) == 0) {\n                    EvaluateLIFOModulePathB()\n                } else if ((record?.[name_lifo_f]?.charAt(0) != ' ' || record?.[name_lifo_f]?.charAt(1) != ' ')\n                    && (record?.[name_lifo_f]?.charAt(0) && record?.[name_lifo_f]?.charAt(1))) {\n                    EvaluateLIFOModulePathB()\n                } else {\n                    record[name_lifo] = Math.round((parseFloat(record?.[ec_name_lifo]) / parseFloat(record?.[ec_name_tot])) * parseFloat(record?.[name_tot]))\n                    record[name_lifo_f] = setCharAt(record?.[name_lifo_f], 2, 'H')\n                    record[name_lifo_rsv] = Math.round((parseFloat(record?.[ec_name_lifo_rsv]) / parseFloat(record?.[ec_name_tot])) * parseFloat(record?.[name_tot]))\n                    record[name_lifo_rsv_f] = setCharAt(record?.[name_lifo_rsv_f], 2, 'H')\n                    EvaluateLIFOModulePathB()\n                }\n\n            } else {\n                record[name_lifo_rsv] = 0\n                record[name_lifo_rsv_f] = setCharAt(record?.[name_lifo_rsv_f], 2, 'W')\n                EvaluateLIFOModulePathC(name_lifo, name_tot, name_lifo_f)\n            }\n        } else if (parseInt(record?.[name_lifo_rsv]) == 0) {\n            record[name_lifo_rsv] = Math.round(parseFloat(beta) * parseFloat(record?.[name_tot]))\n            record[name_lifo_rsv_f] = setCharAt(record?.[name_lifo_rsv_f], 2, 'W')\n            EvaluateLIFOModulePathC(name_lifo, name_tot, name_lifo_f)\n        } else if (parseFloat(record?.[name_lifo]) > Math.abs(parseFloat(record?.[name_lifo_rsv]))) {\n            EvaluateLIFOModulePathC(name_lifo, name_tot, name_lifo_f)\n        } else {\n            if (parseFloat(beta) > 0.70) {\n                record[name_lifo] = 4.0 * Math.abs(parseFloat(record?.[name_lifo_rsv]))\n            } else if (parseFloat(beta) <= 0.70 && parseFloat(beta) >= .50) {\n                record[name_lifo] = 5.0 * Math.abs(parseFloat(record?.[name_lifo_rsv]))\n            } else {\n                record[name_lifo] = 6.0 * Math.abs(parseFloat(record?.[name_lifo_rsv]))\n            }\n            record[name_lifo_f] = setCharAt(record?.[name_lifo_f], 2, 'W')\n            EvaluateLIFOModulePathC(name_lifo, name_tot, name_lifo_f)\n        }\n    }\n\n    function EvaluateLIFOModule() {\n        let invReserve = findParam()\n        let letter = global.get('miv')\n        EvalLIFO(letter, invReserve)\n    }\n    EvaluateLIFOModule()\n    return msg;\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MIV Evaluate LIFO'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "c8c6c13ac9fe72a7",
        "type": "function",
        "z": "c65f463988b11e12",
        "name": "MIV: Evaluate LIFO Module (Database)",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n\n    let cache = global.get(\"lookupCache\");\n\n    let inv_reserve_file = cache.data.find(\n        item =>\n            item.module === \"inv_reserve\" &&\n            item.param === 'inv_reserve' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"estab\"\n    )?.json_values;\n\n    function findParam() {\n        let NAICS_CODE = record.NAICS_CODE\n        NAICS_CODE = NAICS_CODE.toString()\n        for (let i in inv_reserve_file['INV_RESERVE']) {\n            let invReserve = inv_reserve_file['INV_RESERVE'][i]\n            let naics = invReserve['NAICSNEW']\n            naics = naics.toString()\n            if (NAICS_CODE.startsWith(naics)) {\n                return (invReserve);\n                break;\n            }\n        }\n    }\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n    function EvaluateLIFOModulePathC(name_lifo, name_tot, name_lifo_f, name_tot_f) {\n        if (parseFloat(record?.[name_lifo]) > parseFloat(record?.[name_tot])) {\n            record[name_lifo] = record?.[name_tot]\n            flagRules(name_lifo,[name_tot_f] )\n        }\n    }\n\n    function EvalLIFO(variable, invReserve) {\n        let name_tot = ''\n        let name_tot_f = ''\n        let name_lifo = ''\n        let name_lifo_rsv = ''\n        let name_lifo_f = ''\n        let name_lifo_rsv_f = ''\n        let ec_name_tot = ''\n        let ec_name_lifo = ''\n        let ec_name_lifo_rsv = ''\n        let rsv = ''\n        let beta = ''\n        if (variable == 'E') {\n            name_tot = 'INV_E_TOT_VAL'\n            name_tot_f = 'INV_E_TOT_VAL_F'\n            name_lifo = 'INV_E_LIFO_VAL'\n            name_lifo_rsv = 'INV_E_LIFO_RSV_VAL'\n            name_lifo_f = 'INV_E_LIFO_VAL_F'\n            name_lifo_rsv_f = 'INV_E_LIFO_RSV_VAL_F'\n            ec_name_tot = 'INV_E_TOT_VAL'\n            ec_name_lifo = 'INV_E_LIFO_VAL'\n            ec_name_lifo_rsv = 'INV_E_LIFO_RSV_VAL'\n            rsv = 'RSVE_TOTE_UL'\n            beta = 'BETA_E'\n        } else if (variable == 'B') {\n            name_tot = 'INV_B_TOT_VAL'\n            name_tot_f = 'INV_B_TOT_VAL_F'\n            name_lifo = 'INV_B_LIFO_VAL'\n            name_lifo_rsv = 'INV_B_LIFO_RSV_VAL'\n            name_lifo_f = 'INV_B_LIFO_VAL_F'\n            name_lifo_rsv_f = 'INV_B_LIFO_RSV_VAL_F'\n            ec_name_tot = 'INV_B_TOT_VAL'\n            ec_name_lifo = 'INV_B_LIFO_VAL'\n            ec_name_lifo_rsv = 'INV_B_LIFO_RSV_VAL'\n            rsv = 'RSVB_TOTB_BL'\n            beta = 'BETA_B'\n        }\n        rsv = invReserve[rsv]\n        beta = invReserve[beta]\n\n        if (parseInt(record?.[name_lifo]) == 0) {\n            if (parseInt(record?.[name_lifo_rsv]) == 0) {\n                if (parseInt(ec?.[ec_name_lifo]) == 0 || parseInt(ec?.[ec_name_tot]) == 0) {\n                } else if ((record?.[name_lifo_f]?.charAt(0) != ' ' || record?.[name_lifo_f]?.charAt(1) != ' ')\n                    && (record?.[name_lifo_f]?.charAt(0) && record?.[name_lifo_f]?.charAt(1))) {\n                } else {\n                    record[name_lifo] = Math.round((parseFloat(ec?.[ec_name_lifo]) / parseFloat(ec?.[ec_name_tot])) * parseFloat(record?.[name_tot]))\n                    record[name_lifo_f] = setCharAt(record?.[name_lifo_f], 2, 'H')\n                    record[name_lifo_rsv] = Math.round((parseFloat(ec?.[ec_name_lifo_rsv]) / parseFloat(ec?.[ec_name_tot])) * parseFloat(record?.[name_tot]))\n                    record[name_lifo_rsv_f] = setCharAt(record?.[name_lifo_rsv_f], 2, 'H')\n                }\n\n            } else {\n                record[name_lifo_rsv] = 0\n                record[name_lifo_rsv_f] = setCharAt(record?.[name_lifo_rsv_f], 2, 'W')\n                EvaluateLIFOModulePathC(name_lifo, name_tot, name_lifo_f)\n            }\n        } else if (parseInt(record?.[name_lifo_rsv]) == 0) {\n            record[name_lifo_rsv] = Math.round(parseFloat(beta) * parseFloat(record?.[name_tot]))\n            record[name_lifo_rsv_f] = setCharAt(record?.[name_lifo_rsv_f], 2, 'W')\n            EvaluateLIFOModulePathC(name_lifo, name_tot, name_lifo_f)\n        } else if (parseFloat(record?.[name_lifo]) > Math.abs(parseFloat(record?.[name_lifo_rsv]))) {\n            EvaluateLIFOModulePathC(name_lifo, name_tot, name_lifo_f)\n        } else {\n            if (parseFloat(beta) > 0.70) {\n                record[name_lifo] = 4.0 * Math.abs(parseFloat(record?.[name_lifo_rsv]))\n            } else if (parseFloat(beta) <= 0.70 && parseFloat(beta) >= .50) {\n                record[name_lifo] = 5.0 * Math.abs(parseFloat(record?.[name_lifo_rsv]))\n            } else {\n                record[name_lifo] = 6.0 * Math.abs(parseFloat(record?.[name_lifo_rsv]))\n            }\n            record[name_lifo_f] = setCharAt(record?.[name_lifo_f], 2, 'W')\n            EvaluateLIFOModulePathC(name_lifo, name_tot, name_lifo_f)\n        }\n    }\n\n    function EvaluateLIFOModule() {\n        let invReserve = findParam()\n        let letter = msg.miv\n        EvalLIFO(letter, invReserve)\n    }\n    EvaluateLIFOModule()\n    return msg;\n}catch(e){\n    msg.err ='Exit Edit'\n    msg.payload.exit = 'MIV Evaluate LIFO'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "2aefe1848ae82c98",
        "type": "function",
        "z": "17fe2bc799b77fa4",
        "name": "MIV: Evaluate LIFO Reverse Module",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    let cache = global.get(\"lookupCache\");\n\n    let inv_reserve_file = cache.data.find(\n        item =>\n            item.module === \"inv_reserve\" &&\n            item.param === 'inv_reserve' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"estab\"\n    )?.json_values;\n\n    function findParam() {\n        let NAICS_CODE = record.NAICS_CODE\n        NAICS_CODE = NAICS_CODE.toString()\n        for (let i in inv_reserve_file['INV_RESERVE']) {\n            let invReserve = inv_reserve_file['INV_RESERVE'][i]\n            let naics = invReserve['NAICSNEW']\n            naics = naics.toString()\n            if (NAICS_CODE.startsWith(naics)) {\n                return (invReserve);\n                break;\n            }\n        }\n    }\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function EvaluateLifoReserve(variable, invReserve) {\n        let name_tot = ''\n        let name_lifo = ''\n        let name_lifo_rsv = ''\n        let name_lifo_f = ''\n        let name_lifo_rsv_f = ''\n        let rsv = ''\n        let beta = ''\n        if (variable == 'E') {\n            name_tot = 'INV_E_TOT_VAL'\n            name_lifo = 'INV_E_LIFO_VAL'\n            name_lifo_rsv = 'INV_E_LIFO_RSV_VAL'\n            name_lifo_f = 'INV_E_LIFO_VAL_F'\n            name_lifo_rsv_f = 'INV_E_LIFO_RSV_VAL_F'\n            rsv = 'RSVE_TOTE_UL'\n            beta = 'BETA_E'\n        } else if (variable == 'B') {\n            name_tot = 'INV_B_TOT_VAL'\n            name_lifo = 'INV_B_LIFO_VAL'\n            name_lifo_rsv = 'INV_B_LIFO_RSV_VAL'\n            name_lifo_f = 'INV_B_LIFO_VAL_F'\n            name_lifo_rsv_f = 'INV_B_LIFO_RSV_VAL_F'\n            rsv = 'RSVB_TOTB_BL'\n            beta = 'BETA_B'\n        }\n        rsv = invReserve[rsv]\n        beta = invReserve[beta]\n\n        if (parseInt(record?.[name_tot]) == 0) {\n            if (parseInt(record?.[name_lifo]) != 0 || parseInt(record?.[name_lifo_rsv]) != 0) {\n                record[name_lifo] = 0\n                record[name_lifo_f] = setCharAt(record?.[name_lifo_f], 2, 'Z')\n                record[name_lifo_rsv] = 0\n                record[name_lifo_rsv_f] = setCharAt(record?.[name_lifo_rsv_f], 2, 'Z')\n            }\n        } else if (parseInt(record?.[name_lifo_rsv]) < 0 || parseInt(record?.[name_lifo_rsv]) > 0) {\n            if (Math.abs(parseFloat(record?.[name_lifo_rsv])) / parseFloat(record?.[name_tot]) >= parseFloat(rsv)) {\n                record[name_lifo_rsv] = Math.round(parseFloat(beta) * parseFloat(record?.[name_tot]))\n                record[name_lifo_rsv_f] = setCharAt(record?.[name_lifo_rsv_f], 2, 'W')\n            }\n        }\n    }\n\n    function EvaluateLifoReserveModule() {\n        let invReserve = findParam()\n        let letter = global.get('miv')\n        EvaluateLifoReserve(letter, invReserve)\n        record.ACTION = 'Return to LIFO Valuation Method'\n    }\n\n    EvaluateLifoReserveModule()\n    return msg\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MIV Evaluate LIFO Reserve'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "d6b5a6e65ee046db",
        "type": "function",
        "z": "17fe2bc799b77fa4",
        "name": "MIV: Evaluate LIFO Reverse Module",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    let cache = global.get(\"lookupCache\");\n\n    let inv_reserve_file = cache.data.find(\n        item =>\n            item.module === \"inv_reserve\" &&\n            item.param === 'inv_reserve' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"estab\"\n    )?.json_values;\n\n    function findParam() {\n        let NAICS_CODE = record.NAICS_CODE\n        NAICS_CODE = NAICS_CODE.toString()\n        for (let i in inv_reserve_file['INV_RESERVE']) {\n            let invReserve = inv_reserve_file['INV_RESERVE'][i]\n            let naics = invReserve['NAICSNEW']\n            naics = naics.toString()\n            if (NAICS_CODE.startsWith(naics)) {\n                return (invReserve);\n                break;\n            }\n        }\n    }\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function EvaluateLifoReserve(variable, invReserve) {\n        let name_tot = ''\n        let name_lifo = ''\n        let name_lifo_rsv = ''\n        let name_lifo_f = ''\n        let name_lifo_rsv_f = ''\n        let rsv = ''\n        let beta = ''\n        if (variable == 'E') {\n            name_tot = 'INV_E_TOT_VAL'\n            name_lifo = 'INV_E_LIFO_VAL'\n            name_lifo_rsv = 'INV_E_LIFO_RSV_VAL'\n            name_lifo_f = 'INV_E_LIFO_VAL_F'\n            name_lifo_rsv_f = 'INV_E_LIFO_RSV_VAL_F'\n            rsv = 'RSVE_TOTE_UL'\n            beta = 'BETA_E'\n        } else if (variable == 'B') {\n            name_tot = 'INV_B_TOT_VAL'\n            name_lifo = 'INV_B_LIFO_VAL'\n            name_lifo_rsv = 'INV_B_LIFO_RSV_VAL'\n            name_lifo_f = 'INV_B_LIFO_VAL_F'\n            name_lifo_rsv_f = 'INV_B_LIFO_RSV_VAL_F'\n            rsv = 'RSVB_TOTB_BL'\n            beta = 'BETA_B'\n        }\n        rsv = invReserve[rsv]\n        beta = invReserve[beta]\n\n        if (parseInt(record?.[name_tot]) == 0) {\n            if (parseInt(record?.[name_lifo]) != 0 || parseInt(record?.[name_lifo_rsv]) != 0) {\n                record[name_lifo] = 0\n                record[name_lifo_f] = setCharAt(record?.[name_lifo_f], 2, 'Z')\n                record[name_lifo_rsv] = 0\n                record[name_lifo_rsv_f] = setCharAt(record?.[name_lifo_rsv_f], 2, 'Z')\n            }\n        } else if (parseInt(record?.[name_lifo_rsv]) < 0 || parseInt(record?.[name_lifo_rsv]) > 0) {\n            if (Math.abs(parseFloat(record?.[name_lifo_rsv])) / parseFloat(record?.[name_tot]) >= parseFloat(rsv)) {\n                record[name_lifo_rsv] = Math.round(parseFloat(beta) * parseFloat(record?.[name_tot]))\n                record[name_lifo_rsv_f] = setCharAt(record?.[name_lifo_rsv_f], 2, 'W')\n            }\n        }\n    }\n\n    function EvaluateLifoReserveModule() {\n        let invReserve = findParam()\n        let letter = msg.miv\n        EvaluateLifoReserve(letter, invReserve)\n    }\n\n    EvaluateLifoReserveModule()\n    return msg\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'MIV Evaluate LIFO Reserve'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "891b913677e339d8",
        "type": "subflow:17fe2bc799b77fa4",
        "z": "7d33e2bb432d595f",
        "name": "",
        "x": 620,
        "y": 140,
        "wires": [
            [
                "d0b3dadd28a0d4eb"
            ]
        ]
    },
    {
        "id": "6c38654b72078fd7",
        "type": "subflow:c65f463988b11e12",
        "z": "7d33e2bb432d595f",
        "name": "",
        "x": 940,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "d0b3dadd28a0d4eb",
        "type": "switch",
        "z": "7d33e2bb432d595f",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 900,
        "y": 140,
        "wires": [
            [],
            [
                "6c38654b72078fd7"
            ]
        ]
    },
    {
        "id": "26c648f63ad22868",
        "type": "function",
        "z": "75eae7f006cc0f8a",
        "name": "MIV: Inventories Balance",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    let cache = global.get(\"lookupCache\");\n\n    let inv_reserve_file = cache.data.find(\n        item =>\n            item.module === \"inv_reserve\" &&\n            item.param === 'inv_reserve' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"estab\"\n    )?.json_values;\n\n    function findParam() {\n        let NAICS_CODE = record.NAICS_CODE\n        NAICS_CODE = NAICS_CODE.toString()\n        for (let i in inv_reserve_file['INV_RESERVE']) {\n            let invReserve = inv_reserve_file['INV_RESERVE'][i]\n            let naics = invReserve['NAICSNEW']\n            naics = naics.toString()\n            if (NAICS_CODE.startsWith(naics)) {\n                return (invReserve);\n                break;\n            }\n        }\n    }\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function MIVInventoriesBalance() {\n        if (record?.NAICS_SECTOR == '31' && record?.HISTSTAT == 'Y' && record?.INV_B_LIFO_VAL == record?.EC_INV_E_LIFO_VAL) {\n            if (record?.INV_B_LIFO_RSV_VAL == record?.EC_INV_E_LIFO_RSV_VAL) {\n            } else {\n                record.INV_B_LIFO_RSV_VAL = record?.EC_INV_E_LIFO_RSV_VAL\n                record.INV_B_LIFO_RSV_VAL_F = setCharAt(record.INV_B_LIFO_RSV_VAL_F, 2, 'H')\n            }\n        }\n        record.ACTION = 'Go To Main Routing'\n    }\n\n    MIVInventoriesBalance()\n    return msg\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MIV Inventories Balance'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "0ba7321c6aef2c00",
        "type": "function",
        "z": "75eae7f006cc0f8a",
        "name": "decide path",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NAICS_SECTOR == '31' && record?.SUBSAMP_IND_TXT != 'MC') {\n        flow.set('invBal', '')\n    } else {\n        flow.set('invBal', 'Go to Main Routing')\n        record.ACTION = 'Go to Main Routing'\n    }\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MIV Inventories Balance'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 80,
        "wires": [
            [
                "1ce2615d35152c7e"
            ]
        ]
    },
    {
        "id": "1ce2615d35152c7e",
        "type": "switch",
        "z": "75eae7f006cc0f8a",
        "name": "",
        "property": "invBal",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "Go to Main Routing",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 630,
        "y": 80,
        "wires": [
            [],
            [
                "fdc951bca47d6b65"
            ]
        ]
    },
    {
        "id": "c111167fdd9933ec",
        "type": "subflow:7d33e2bb432d595f",
        "z": "75eae7f006cc0f8a",
        "name": "",
        "x": 900,
        "y": 200,
        "wires": [
            [
                "8b0da9af9c4353e0"
            ]
        ]
    },
    {
        "id": "8bdfd34f90d77372",
        "type": "change",
        "z": "75eae7f006cc0f8a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "B",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 200,
        "wires": [
            [
                "c111167fdd9933ec"
            ]
        ]
    },
    {
        "id": "d9e3ba10f3818cec",
        "type": "subflow:7d33e2bb432d595f",
        "z": "75eae7f006cc0f8a",
        "name": "",
        "x": 900,
        "y": 280,
        "wires": [
            [
                "3e7d2bc8b39370e3"
            ]
        ]
    },
    {
        "id": "9a0715fcd68cdf02",
        "type": "change",
        "z": "75eae7f006cc0f8a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "E",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 280,
        "wires": [
            [
                "d9e3ba10f3818cec"
            ]
        ]
    },
    {
        "id": "2da3ad9dd5211ef1",
        "type": "change",
        "z": "75eae7f006cc0f8a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "B",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 340,
        "wires": [
            [
                "65ebda6db324fbed"
            ]
        ]
    },
    {
        "id": "4f08ace64dfaae1c",
        "type": "change",
        "z": "75eae7f006cc0f8a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "E",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 420,
        "wires": [
            [
                "0283c45bf9ceb4d4"
            ]
        ]
    },
    {
        "id": "65ebda6db324fbed",
        "type": "subflow:379e12b168b021d1",
        "z": "75eae7f006cc0f8a",
        "name": "",
        "x": 940,
        "y": 340,
        "wires": [
            [
                "685933e5fe069ed9"
            ]
        ]
    },
    {
        "id": "0283c45bf9ceb4d4",
        "type": "subflow:379e12b168b021d1",
        "z": "75eae7f006cc0f8a",
        "name": "",
        "x": 940,
        "y": 420,
        "wires": [
            [
                "81e7e229db0fa280"
            ]
        ]
    },
    {
        "id": "e21846d27893c031",
        "type": "function",
        "z": "75eae7f006cc0f8a",
        "name": "set nlflo",
        "func": "let NLFLO = 0\nNLFLO = parseInt(Math.floor(Math.random() * 100))\nif (NLFLO < 10) {\n    NLFLO = '0' + NLFLO\n} else {\n    NLFLO = '' + NLFLO\n}\nglobal.set('nlflo',NLFLO)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 340,
        "wires": [
            [
                "2da3ad9dd5211ef1"
            ]
        ]
    },
    {
        "id": "6b33a8a9088ae491",
        "type": "function",
        "z": "75eae7f006cc0f8a",
        "name": "MIV: Inventories Balance (Database)",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n\n    let cache = global.get(\"lookupCache\");\n\n    let inv_reserve_file = cache.data.find(\n        item =>\n            item.module === \"inv_reserve\" &&\n            item.param === 'inv_reserve' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"estab\"\n    )?.json_values;\n\n    function findParam() {\n        let NAICS_CODE = record.NAICS_CODE\n        NAICS_CODE = NAICS_CODE.toString()\n        for (let i in inv_reserve_file['INV_RESERVE']) {\n            let invReserve = inv_reserve_file['INV_RESERVE'][i]\n            let naics = invReserve['NAICSNEW']\n            naics = naics.toString()\n            if (NAICS_CODE.startsWith(naics)) {\n                return (invReserve);\n                break;\n            }\n        }\n    }\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function MIVInventoriesBalance() {\n        if (record?.NAICS_SECTOR == '31' && record?.HISTSTAT == 'Y' && record?.INV_B_LIFO_VAL == ec?.INV_E_LIFO_VAL) {\n            if (record?.INV_B_LIFO_RSV_VAL == ec?.INV_E_LIFO_RSV_VAL) {\n            } else {\n                record.INV_B_LIFO_RSV_VAL = ec?.INV_E_LIFO_RSV_VAL\n                record.INV_B_LIFO_RSV_VAL_F = setCharAt(record.INV_B_LIFO_RSV_VAL_F, 2, 'H')\n            }\n        }\n    }\n\n    MIVInventoriesBalance()\n    return msg\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'MIV Inventories Balance'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "fdc951bca47d6b65",
        "type": "switch",
        "z": "75eae7f006cc0f8a",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 660,
        "y": 140,
        "wires": [
            [],
            [
                "8bdfd34f90d77372"
            ]
        ]
    },
    {
        "id": "8b0da9af9c4353e0",
        "type": "switch",
        "z": "75eae7f006cc0f8a",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1140,
        "y": 200,
        "wires": [
            [],
            [
                "9a0715fcd68cdf02"
            ]
        ]
    },
    {
        "id": "3e7d2bc8b39370e3",
        "type": "switch",
        "z": "75eae7f006cc0f8a",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1140,
        "y": 280,
        "wires": [
            [],
            [
                "e21846d27893c031"
            ]
        ]
    },
    {
        "id": "81e7e229db0fa280",
        "type": "switch",
        "z": "75eae7f006cc0f8a",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1220,
        "y": 420,
        "wires": [
            [],
            [
                "26c648f63ad22868"
            ]
        ]
    },
    {
        "id": "685933e5fe069ed9",
        "type": "switch",
        "z": "75eae7f006cc0f8a",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1220,
        "y": 340,
        "wires": [
            [],
            [
                "4f08ace64dfaae1c"
            ]
        ]
    },
    {
        "id": "b5eb2cf5fe2f7569",
        "type": "function",
        "z": "75eae7f006cc0f8a",
        "name": "decide path",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NAICS_SECTOR == '31' && record?.SUBSAMP_IND_TXT != 'MC') {\n        msg.invBal = ''\n    } else {\n        msg.invBal = 'Go to Main Routing'\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'MIV Inventories Balance'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "f059f9abd16c0c9e",
        "type": "function",
        "z": "75eae7f006cc0f8a",
        "name": "set nlflo",
        "func": "let NLFLO = 0\nNLFLO = parseInt(Math.floor(Math.random() * 100))\nif (NLFLO < 10) {\n    NLFLO = '0' + NLFLO\n} else {\n    NLFLO = '' + NLFLO\n}\nmsg.nlflo = NLFLO\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "8a4a29f10142c232",
        "type": "function",
        "z": "3ccae806a14cca8d",
        "name": "Electric energy module impute",
        "func": "try {\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n\n    let record = msg.payload.csv[global.get('ptrModuleFacts')];\n\n    msg.cache = global.get(\"lookupCache\")\n        .data.find(\n            item =>\n                item.module === \"electric_energy\" &&\n                item.param === 'electric_energy_module' &&\n                item.program === \"aies\" &&\n                item.unit_type === \"estab\"\n        )?.json_values;\n\n    record['T_STFIPS'] = record['GEO_STATE_FIPS'];\n\n    let electricState = msg.cache['ELECTRIC_STATE'].find(state => parseInt(state.GEO_ST) == parseInt(record['T_STFIPS']));\n\n    if (!electricState) {\n    }\n\n    // Step 1: Check if EXPS_ELEC_VAL >= 10000\n    if (parseFloat(record?.EXPS_ELEC_VAL) >= 10000) {\n        if (parseFloat(record?.H_EXPS_ELEC_VAL) > 0) {\n            record['ELEC_PRCH_KWH_NUM'] = Math.round((parseFloat(record['EXPS_ELEC_VAL']) / parseFloat(record['H_EXPS_ELEC_VAL'])) * parseFloat(record['H_ELEC_PRCH_KWH_NUM']));\n            record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record['ELEC_PRCH_KWH_NUM_F'], 2, 'H')\n        }\n        else {\n            record['ELEC_PRCH_KWH_NUM'] = Math.round(parseFloat(record['EXPS_ELEC_VAL'] * electricState.AVG1))\n            record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record['ELEC_PRCH_KWH_NUM_F'], 2, 'W');\n        }\n    } else {\n        if (parseFloat(record?.EXPS_ELEC_VAL) >= parseFloat(electricState.ELEC_INTERSECT)) {\n            record['ELEC_PRCH_KWH_NUM'] = Math.round(parseFloat(record['EXPS_ELEC_VAL']) * electricState.AVG1);\n            record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record['ELEC_PRCH_KWH_NUM_F'], 2, 'W');\n        } else {\n            record['ELEC_PRCH_KWH_NUM'] = Math.round(parseFloat(record['EXPS_ELEC_VAL']) * electricState.AVG2);\n            record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record['ELEC_PRCH_KWH_NUM_F'], 2, 'W');\n        }\n    }\n    return msg;\n} catch(e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'Electric Energy Module'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "3316b71a01342d5d",
        "type": "function",
        "z": "3ccae806a14cca8d",
        "name": "Electric energy module impute database",
        "func": "try {\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n    let aies_minus = msg.aies_minus[0]\n    let useData = ''\n    if (parseFloat(record.REF_PER.substring(0, 4)) > 2023) {\n        useData = aies_minus\n    } else {\n        useData = ec\n    }\n\n    msg.cache = global.get(\"lookupCache\")\n        .data.find(\n            item =>\n                item.module === \"electric_energy\" &&\n                item.param === 'electric_energy_module' &&\n                item.program === \"aies\" &&\n                item.unit_type === \"estab\"\n        )?.json_values;\n\n    record['T_STFIPS'] = record['GEO_STATE_FIPS'];\n\n    let electricState = msg.cache['ELECTRIC_STATE'].find(state => parseInt(state.GEO_ST) == parseInt(record['T_STFIPS']));\n\n    if (!electricState) {\n    }\n\n    // Step 1: Check if EXPS_ELEC_VAL >= 10000\n    if (parseFloat(record?.EXPS_ELEC_VAL) >= 10000) {\n        if (parseFloat(useData?.EXPS_ELEC_VAL) > 0) {\n            record['ELEC_PRCH_KWH_NUM'] = Math.round((parseFloat(record['EXPS_ELEC_VAL']) / parseFloat(useData?.EXPS_ELEC_VAL)) * parseFloat(useData?.ELEC_PRCH_KWH_NUM));\n            record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record['ELEC_PRCH_KWH_NUM_F'], 2, 'H')\n        }\n        else {\n            record['ELEC_PRCH_KWH_NUM'] = Math.round(parseFloat(record['EXPS_ELEC_VAL'] * electricState.AVG1))\n            record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record['ELEC_PRCH_KWH_NUM_F'], 2, 'W');\n        }\n    } else {\n        if (parseFloat(record?.EXPS_ELEC_VAL) >= parseFloat(electricState.ELEC_INTERSECT)) {\n            record['ELEC_PRCH_KWH_NUM'] = Math.round(parseFloat(record['EXPS_ELEC_VAL']) * electricState.AVG1);\n            record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record['ELEC_PRCH_KWH_NUM_F'], 2, 'W');\n        } else {\n            record['ELEC_PRCH_KWH_NUM'] = Math.round(parseFloat(record['EXPS_ELEC_VAL']) * electricState.AVG2);\n            record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record['ELEC_PRCH_KWH_NUM_F'], 2, 'W');\n        }\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Electric Energy Module'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "e43c56eb1cdf3d1c",
        "type": "function",
        "z": "3ccae806a14cca8d",
        "name": "reset msg",
        "func": "msg.aies_minus = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 280,
        "wires": [
            [
                "3316b71a01342d5d"
            ]
        ]
    },
    {
        "id": "c4297175eb995a00",
        "type": "function",
        "z": "3ccae806a14cca8d",
        "name": "query_aies_prior_year",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.PRODUCT_REFPER_UNIT_ID\nlet ref_per = parseFloat(record.REF_PER.substring(0,4)) - 1\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_ESTAB_TABLE = env.get('DB_ESTAB_TABLE')\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_ESTAB_TABLE + \" where product_refper_unit_id = '\" + id + \"' and version = 'PO' and ref_per = '\" + ref_per + \"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 280,
        "wires": [
            [
                "ce43c535c34a06db"
            ]
        ]
    },
    {
        "id": "ce43c535c34a06db",
        "type": "subflow:8032608991ae0162",
        "z": "3ccae806a14cca8d",
        "name": "",
        "x": 380,
        "y": 280,
        "wires": [
            [
                "e43c56eb1cdf3d1c"
            ]
        ]
    },
    {
        "id": "cc3b332a2e1dd3b1",
        "type": "function",
        "z": "aadd13b9b9077fc3",
        "name": "Electric Energy module cont",
        "func": "try {\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n\n    msg.cache = global.get(\"lookupCache\")\n        .data.find(\n            item =>\n                item.module === \"electric_energy\" &&\n                item.param === 'electric_energy_module' &&\n                item.program === \"aies\" &&\n                item.unit_type === \"estab\"\n        )?.json_values;\n\n    record['T_STFIPS'] = record['GEO_STATE_FIPS'];\n\n    let electricState = msg.cache['ELECTRIC_STATE'].find(state => parseInt(state.GEO_ST) == parseInt(record['T_STFIPS']));\n\n    global.set('mfg_electric_energy', '')\n\n    if (!electricState) {\n        record['ACTION'] = 'Error: GEO_ST not found in ELECTRIC_STATE';\n        return msg;\n    }\n\n    let value = parseFloat(record?.EXPS_ELEC_VAL) / parseFloat(record?.ELEC_PRCH_KWH_NUM);\n    let value2 = (parseFloat(record?.EXPS_ELEC_VAL) * 1000) / parseFloat(record?.ELEC_PRCH_KWH_NUM);\n\n    if (parseInt(record?.EXPS_ELEC_VAL) > 0 && parseInt(record?.ELEC_PRCH_KWH_NUM) == 0) {\n        record['ACTION'] = 'Go To Electric Impute Module';\n        global.set('mfg_electric_energy', 'Go To Electric Impute Module')\n        return msg;\n    }\n\n    else if (parseFloat(electricState.LL) <= value && value <= parseFloat(electricState.UL)) {\n        record['ACTION'] = 'Go To Main Routing';\n        return msg;\n    }\n\n    else if (parseFloat(electricState.LL) <= value2 && value2 <= parseFloat(electricState.UL)) {\n        record['ELEC_PRCH_KWH_NUM'] = parseFloat(Math.round(record['ELEC_PRCH_KWH_NUM'] / 1000));\n        record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record['ELEC_PRCH_KWH_NUM_F'] , 2, 'N')\n        record['ACTION'] = 'Go To Main Routing';\n        return msg;\n    }\n\n    else {\n        record['ACTION'] = 'Go To Electric Impute Module';\n        global.set('mfg_electric_energy', 'Go To Electric Impute Module')\n        return msg;\n    }\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'Electric Energy Cont'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 60,
        "wires": [
            [
                "09e748f3e37ff59e"
            ]
        ]
    },
    {
        "id": "b8e346bc389719b0",
        "type": "subflow:3ccae806a14cca8d",
        "z": "aadd13b9b9077fc3",
        "name": "",
        "x": 1200,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "da72f5fb7dbd5250",
        "type": "switch",
        "z": "aadd13b9b9077fc3",
        "name": "",
        "property": "mfg_electric_energy",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Go To Electric Impute Module",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 930,
        "y": 180,
        "wires": [
            [
                "b8e346bc389719b0"
            ],
            []
        ]
    },
    {
        "id": "09e748f3e37ff59e",
        "type": "switch",
        "z": "aadd13b9b9077fc3",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1000,
        "y": 60,
        "wires": [
            [],
            [
                "da72f5fb7dbd5250"
            ]
        ]
    },
    {
        "id": "502f3b906b6ba89d",
        "type": "function",
        "z": "aadd13b9b9077fc3",
        "name": "Electric Energy module cont database",
        "func": "try {\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n\n    msg.cache = global.get(\"lookupCache\")\n        .data.find(\n            item =>\n                item.module === \"electric_energy\" &&\n                item.param === 'electric_energy_module' &&\n                item.program === \"aies\" &&\n                item.unit_type === \"estab\"\n        )?.json_values;\n\n    record['T_STFIPS'] = record['GEO_STATE_FIPS'];\n\n    let electricState = msg.cache['ELECTRIC_STATE'].find(state => parseInt(state.GEO_ST) == parseInt(record['T_STFIPS']));\n\n    msg.mfg_electric_energy = ''\n\n    if (!electricState) {\n    }\n\n    let value = parseFloat(record?.EXPS_ELEC_VAL) / parseFloat(record?.ELEC_PRCH_KWH_NUM);\n    let value2 = (parseFloat(record?.EXPS_ELEC_VAL) * 1000) / parseFloat(record?.ELEC_PRCH_KWH_NUM);\n\n    if (parseInt(record?.EXPS_ELEC_VAL) > 0 && parseInt(record?.ELEC_PRCH_KWH_NUM) == 0) {\n        msg.mfg_electric_energy = 'Go To Electric Impute Module'\n    }\n\n    else if (parseFloat(electricState.LL) <= value && value <= parseFloat(electricState.UL)) {\n    }\n\n    else if (parseFloat(electricState.LL) <= value2 && value2 <= parseFloat(electricState.UL)) {\n        record['ELEC_PRCH_KWH_NUM'] = parseFloat(Math.round(record['ELEC_PRCH_KWH_NUM'] / 1000));\n        record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record['ELEC_PRCH_KWH_NUM_F'] , 2, 'N')\n    }\n\n    else {\n        msg.mfg_electric_energy = 'Go To Electric Impute Module'\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Electric Energy Cont'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "9373014f1bd2d06a",
        "type": "function",
        "z": "1159e6c8f76efda3",
        "name": "ElectricEnergyModule",
        "func": "try {\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let record_indx = global.get(\"ptrModuleFacts\")\n    let record = msg.payload.csv[record_indx];\n\n    msg.cache = global.get(\"lookupCache\")\n        .data.find(\n            item =>\n                item.module === \"electric_energy\" &&\n                item.param === 'electric_energy_module' &&\n                item.program === \"aies\" &&\n                item.unit_type === \"estab\"\n        )?.json_values;\n\n    global.set('mfg_electric_energy', '')\n\n    if (record?.['NAICS_SECTOR'] === '31' && record?.['SUBSAMP_IND_TXT'] != 'MC') {\n        record['T_STFIPS'] = record?.GEO_STATE_FIPS;\n        if (record?.EXPS_ELEC_VAL == 0 && record?.ELEC_PRCH_KWH_NUM == 0) {\n            record['ACTION'] = 'Go To Main Routing'\n        } else if (record?.EXPS_ELEC_VAL == 0 && record?.ELEC_PRCH_KWH_NUM > 0) {\n            record['ELEC_PRCH_KWH_NUM'] = 0;\n            record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record?.['ELEC_PRCH_KWH_NUM_F'], 2, 'Z')\n            record['ACTION'] = 'Go To Main Routing'\n        } else {\n            let found = false;\n            for (let key in msg.cache['ELECTRIC_STATE']) {\n                if (Array.isArray(msg.cache['ELECTRIC_STATE']) && msg.cache['ELECTRIC_STATE'].some(entry => parseInt(entry[\"GEO_ST\"]) === parseInt(record['T_STFIPS']))) {\n                    found = true;\n                    break;\n                }\n            }\n            if (found) {\n                record['ACTION'] = 'Go To Electric Energy Module Cont.'\n                global.set('mfg_electric_energy', 'Go To Electric Energy Module Cont.')\n            } else {\n                record['Referral_Flag'] = 'MISSING_ST_FIPS_ELECTRIC';\n                record['ACTION'] = 'Go To Main Routing'\n\n            }\n        }\n    } else {\n        record['ACTION'] = 'Go To Main Routing'\n    }\n    msg.payload.csv[record_indx] = record;\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'Electric Energy Module'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 240,
        "wires": [
            [
                "3dd7cceafaacfd0d"
            ]
        ]
    },
    {
        "id": "19fa911974a88c47",
        "type": "subflow:aadd13b9b9077fc3",
        "z": "1159e6c8f76efda3",
        "name": "",
        "x": 1080,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "cad24aee2b94b325",
        "type": "switch",
        "z": "1159e6c8f76efda3",
        "name": "",
        "property": "mfg_electric_energy",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Go To Electric Energy Module Cont.",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 770,
        "y": 440,
        "wires": [
            [
                "19fa911974a88c47"
            ],
            []
        ]
    },
    {
        "id": "3dd7cceafaacfd0d",
        "type": "switch",
        "z": "1159e6c8f76efda3",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 780,
        "y": 340,
        "wires": [
            [],
            [
                "cad24aee2b94b325"
            ]
        ]
    },
    {
        "id": "142e24c4a36d8315",
        "type": "function",
        "z": "1159e6c8f76efda3",
        "name": "ElectricEnergyModule database",
        "func": "try {\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let record_indx = msg.ptrModuleFacts\n    let record = msg.payload.csv[record_indx];\n\n    msg.cache = global.get(\"lookupCache\")\n        .data.find(\n            item =>\n                item.module === \"electric_energy\" &&\n                item.param === 'electric_energy_module' &&\n                item.program === \"aies\" &&\n                item.unit_type === \"estab\"\n        )?.json_values;\n\n    msg.mfg_electric_energy = ''\n\n    if (record?.['NAICS_SECTOR'] === '31' && record?.['SUBSAMP_IND_TXT'] != 'MC') {\n        record['T_STFIPS'] = record?.GEO_STATE_FIPS;\n        if (record?.EXPS_ELEC_VAL == 0 && record?.ELEC_PRCH_KWH_NUM == 0) {\n        } else if (record?.EXPS_ELEC_VAL == 0 && record?.ELEC_PRCH_KWH_NUM > 0) {\n            record['ELEC_PRCH_KWH_NUM'] = 0;\n            record['ELEC_PRCH_KWH_NUM_F'] = setCharAt(record?.['ELEC_PRCH_KWH_NUM_F'], 2, 'Z')\n        } else {\n            let found = false;\n            for (let key in msg.cache['ELECTRIC_STATE']) {\n                if (Array.isArray(msg.cache['ELECTRIC_STATE']) && msg.cache['ELECTRIC_STATE'].some(entry => parseInt(entry[\"GEO_ST\"]) === parseInt(record['T_STFIPS']))) {\n                    found = true;\n                    break;\n                }\n            }\n            if (found) {\n                msg.mfg_electric_energy = 'Go To Electric Energy Module Cont.'\n            } else {\n                record['REFERRAL_FLAG'] = 'MISSING_ST_FIPS_ELECTRIC';\n            }\n        }\n    }\n    msg.payload.csv[record_indx] = record;\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Electric Energy Module'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "e1c3e5836e2b8eca",
        "type": "function",
        "z": "9f8b85fce167ad51",
        "name": "mfg_empq1",
        "func": "try{\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n\n    if (record?.EMP_MAR12_PRDWRK_NUM == 0 && record?.EMP_MAR12_NUM > 0) {\n        if (record?.PAY_ANN_PRDWRK_VAL > 0 && record?.PAY_ANN_VAL > 0) {\n            record['EMP_MAR12_PRDWRK_NUM'] = Math.round(1.1 * (record?.PAY_ANN_PRDWRK_VAL / record?.PAY_ANN_VAL) * record?.EMP_MAR12_NUM)\n            record['EMP_MAR12_NONPRDWRK_DNUM'] = Math.round(record?.EMP_MAR12_NUM - record?.EMP_MAR12_PRDWRK_NUM)\n            flagRules('EMP_MAR12_PRDWRK_NUM', ['PAY_ANN_PRDWRK_VAL_F', 'PAY_ANN_VAL_F', 'EMP_MAR12_NUM_F'])\n            flagRules('EMP_MAR12_NONPRDWRK_DNUM', ['EMP_MAR12_NUM_F', 'EMP_MAR12_PRDWRK_NUM_F'])\n        } else if (record?.PAY_QTR1_PRDWRK_VAL > 0 && record?.PAY_QTR1_VAL > 0) {\n            record['EMP_MAR12_PRDWRK_NUM'] = Math.round((record?.PAY_QTR1_PRDWRK_VAL / record?.PAY_QTR1_VAL) * record?.EMP_MAR12_NUM)\n            record['EMP_MAR12_NONPRDWRK_DNUM'] = Math.round(record?.EMP_MAR12_NUM - record?.EMP_MAR12_PRDWRK_NUM)\n            flagRules('EMP_MAR12_PRDWRK_NUM', ['PAY_QTR1_PRDWRK_VAL_F', 'PAY_QTR1_VAL_F', 'EMP_MAR12_NUM_F'])\n            flagRules('EMP_MAR12_NONPRDWRK_DNUM', ['EMP_MAR12_NUM_F', 'EMP_MAR12_PRDWRK_NUM_F']);\n        } else {\n            record['EMP_MAR12_PRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_PRDWRK_NUM_F'], 2, 'X');\n        }\n    } else if (record?.EMP_MAR12_PRDWRK_NUM > 0 && record?.EMP_MAR12_NUM > 0) {\n        if (record?.EMP_MAR12_PRDWRK_NUM != record?.EMP_MAR12_NUM) {\n            if (record?.EMP_MAR12_PRDWRK_NUM < record?.EMP_MAR12_NUM) {\n                record['EMP_MAR12_NONPRDWRK_DNUM'] = record?.EMP_MAR12_NUM - record?.EMP_MAR12_PRDWRK_NUM\n                flagRules('EMP_MAR12_NONPRDWRK_DNUM', ['EMP_MAR12_NUM_F', 'EMP_MAR12_PRDWRK_NUM_F'])\n            } else {\n                record['EMP_MAR12_PRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_PRDWRK_NUM_F'], 2, 'X');\n            }\n        }\n    }\n\n    record['ACTION'] = 'Go To: PAYQTR1'\n    // global.set('action', 'Go To: PAYQTR1')\n\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MFG EMPQ1'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "785f3ed9cce0b200",
        "type": "function",
        "z": "9f8b85fce167ad51",
        "name": "mfg_empq1 database",
        "func": "try{\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n\n    if (record?.EMP_MAR12_PRDWRK_NUM == 0 && record?.EMP_MAR12_NUM > 0) {\n        if (record?.PAY_ANN_PRDWRK_VAL > 0 && record?.PAY_ANN_VAL > 0) {\n            record['EMP_MAR12_PRDWRK_NUM'] = Math.round(1.1 * (record?.PAY_ANN_PRDWRK_VAL / record?.PAY_ANN_VAL) * record?.EMP_MAR12_NUM)\n            record['EMP_MAR12_NONPRDWRK_DNUM'] = Math.round(record?.EMP_MAR12_NUM - record?.EMP_MAR12_PRDWRK_NUM)\n            flagRules('EMP_MAR12_PRDWRK_NUM', ['PAY_ANN_PRDWRK_VAL_F', 'PAY_ANN_VAL_F', 'EMP_MAR12_NUM_F'])\n            flagRules('EMP_MAR12_NONPRDWRK_DNUM', ['EMP_MAR12_NUM_F', 'EMP_MAR12_PRDWRK_NUM_F'])\n        } else if (record?.PAY_QTR1_PRDWRK_VAL > 0 && record?.PAY_QTR1_VAL > 0) {\n            record['EMP_MAR12_PRDWRK_NUM'] = Math.round((record?.PAY_QTR1_PRDWRK_VAL / record?.PAY_QTR1_VAL) * record?.EMP_MAR12_NUM)\n            record['EMP_MAR12_NONPRDWRK_DNUM'] = Math.round(record?.EMP_MAR12_NUM - record?.EMP_MAR12_PRDWRK_NUM)\n            flagRules('EMP_MAR12_PRDWRK_NUM', ['PAY_QTR1_PRDWRK_VAL_F', 'PAY_QTR1_VAL_F', 'EMP_MAR12_NUM_F'])\n            flagRules('EMP_MAR12_NONPRDWRK_DNUM', ['EMP_MAR12_NUM_F', 'EMP_MAR12_PRDWRK_NUM_F']);\n        } else {\n            record['EMP_MAR12_PRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_PRDWRK_NUM_F'], 2, 'X');\n        }\n    } else if (record?.EMP_MAR12_PRDWRK_NUM > 0 && record?.EMP_MAR12_NUM > 0) {\n        if (record?.EMP_MAR12_PRDWRK_NUM != record?.EMP_MAR12_NUM) {\n            if (record?.EMP_MAR12_PRDWRK_NUM < record?.EMP_MAR12_NUM) {\n                record['EMP_MAR12_NONPRDWRK_DNUM'] = record?.EMP_MAR12_NUM - record?.EMP_MAR12_PRDWRK_NUM\n                flagRules('EMP_MAR12_NONPRDWRK_DNUM', ['EMP_MAR12_NUM_F', 'EMP_MAR12_PRDWRK_NUM_F'])\n            } else {\n                record['EMP_MAR12_PRDWRK_NUM_F'] = setCharAt(record['EMP_MAR12_PRDWRK_NUM_F'], 2, 'X');\n            }\n        }\n    }\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'MFG EMPQ1'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "c660fc494a2e76e6",
        "type": "function",
        "z": "05d1a91987f08f14",
        "name": "mfg_payqtr1",
        "func": "try {\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.PAY_QTR1_PRDWRK_VAL == 0 && record?.PAY_QTR1_VAL > 0) {\n        if (record?.PAY_ANN_PRDWRK_VAL > 0 && record?.PAY_ANN_VAL > 0) {\n            record['PAY_QTR1_PRDWRK_VAL'] = Math.round((record?.PAY_ANN_PRDWRK_VAL / record?.PAY_ANN_VAL) * record?.PAY_QTR1_VAL)\n            record['PAY_QTR1_NONPRDWRK_DVAL'] = Math.round(record?.PAY_QTR1_VAL - record?.PAY_QTR1_PRDWRK_VAL)\n            flagRules('PAY_QTR1_PRDWRK_VAL', ['PAY_ANN_PRDWRK_VAL_F', 'PAY_ANN_VAL_F', 'PAY_QTR1_VAL_F']);\n            flagRules('PAY_QTR1_NONPRDWRK_DVAL', ['PAY_QTR1_VAL_F', 'PAY_QTR1_PRDWRK_VAL_F']);\n        } else if (record?.EMP_MAR12_PRDWRK_NUM > 0 && record?.EMP_MAR12_NUM > 0) {\n            record['PAY_QTR1_PRDWRK_VAL'] = Math.round((record?.EMP_MAR12_PRDWRK_NUM / record?.EMP_MAR12_NUM) * record?.PAY_QTR1_VAL)\n            record['PAY_QTR1_NONPRDWRK_DVAL'] = Math.round(record?.PAY_QTR1_VAL - record?.PAY_QTR1_PRDWRK_VAL);\n            flagRules('PAY_QTR1_PRDWRK_VAL', ['EMP_MAR12_PRDWRK_NUM_F', 'EMP_MAR12_NUM_F', 'PAY_QTR1_VAL_F']);\n            flagRules('PAY_QTR1_NONPRDWRK_DVAL', ['PAY_QTR1_VAL_F', 'PAY_QTR1_PRDWRK_VAL_F']);\n        } else {\n            record['PAY_QTR1_PRDWRK_VAL_F'] = setCharAt(record['PAY_QTR1_PRDWRK_VAL_F'], 2, 'X');\n        }\n    } else if (record?.PAY_QTR1_PRDWRK_VAL > 0 && record?.PAY_QTR1_VAL > 0) {\n        if (record?.PAY_QTR1_PRDWRK_VAL != record?.PAY_QTR1_VAL) {\n            if (record?.PAY_QTR1_PRDWRK_VAL < record?.PAY_QTR1_VAL) {\n                record['PAY_QTR1_NONPRDWRK_DVAL'] = record?.PAY_QTR1_VAL - record?.PAY_QTR1_PRDWRK_VAL\n                flagRules('PAY_QTR1_NONPRDWRK_DVAL', ['PAY_QTR1_VAL_F', 'PAY_QTR1_PRDWRK_VAL_F']);\n            } else {\n                record['PAY_QTR1_PRDWRK_VAL_F'] = setCharAt(record['PAY_QTR1_PRDWRK_VAL_F'], 2, 'X');\n            }\n        }\n    }\n\n    record['ACTION'] = 'Return to Main Routing'\n    // global.set('action', 'Return to Main Routing')\n\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'MFG PAYQTR1'\n    return msg;\n}\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "3eba754375ecbb20",
        "type": "function",
        "z": "05d1a91987f08f14",
        "name": "mfg_payqtr1 database",
        "func": "try {\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    let record_idx = msg.ptrModuleFact;\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.PAY_QTR1_PRDWRK_VAL == 0 && record?.PAY_QTR1_VAL > 0) {\n        if (record?.PAY_ANN_PRDWRK_VAL > 0 && record?.PAY_ANN_VAL > 0) {\n            record['PAY_QTR1_PRDWRK_VAL'] = Math.round((record?.PAY_ANN_PRDWRK_VAL / record?.PAY_ANN_VAL) * record?.PAY_QTR1_VAL)\n            record['PAY_QTR1_NONPRDWRK_DVAL'] = Math.round(record?.PAY_QTR1_VAL - record?.PAY_QTR1_PRDWRK_VAL)\n            flagRules('PAY_QTR1_PRDWRK_VAL', ['PAY_ANN_PRDWRK_VAL_F', 'PAY_ANN_VAL_F', 'PAY_QTR1_VAL_F']);\n            flagRules('PAY_QTR1_NONPRDWRK_DVAL', ['PAY_QTR1_VAL_F', 'PAY_QTR1_PRDWRK_VAL_F']);\n        } else if (record?.EMP_MAR12_PRDWRK_NUM > 0 && record?.EMP_MAR12_NUM > 0) {\n            record['PAY_QTR1_PRDWRK_VAL'] = Math.round((record?.EMP_MAR12_PRDWRK_NUM / record?.EMP_MAR12_NUM) * record?.PAY_QTR1_VAL)\n            record['PAY_QTR1_NONPRDWRK_DVAL'] = Math.round(record?.PAY_QTR1_VAL - record?.PAY_QTR1_PRDWRK_VAL);\n            flagRules('PAY_QTR1_PRDWRK_VAL', ['EMP_MAR12_PRDWRK_NUM_F', 'EMP_MAR12_NUM_F', 'PAY_QTR1_VAL_F']);\n            flagRules('PAY_QTR1_NONPRDWRK_DVAL', ['PAY_QTR1_VAL_F', 'PAY_QTR1_PRDWRK_VAL_F']);\n        } else {\n            record['PAY_QTR1_PRDWRK_VAL_F'] = setCharAt(record['PAY_QTR1_PRDWRK_VAL_F'], 2, 'X');\n        }\n    } else if (record?.PAY_QTR1_PRDWRK_VAL > 0 && record?.PAY_QTR1_VAL > 0) {\n        if (record?.PAY_QTR1_PRDWRK_VAL != record?.PAY_QTR1_VAL) {\n            if (record?.PAY_QTR1_PRDWRK_VAL < record?.PAY_QTR1_VAL) {\n                record['PAY_QTR1_NONPRDWRK_DVAL'] = record?.PAY_QTR1_VAL - record?.PAY_QTR1_PRDWRK_VAL\n                flagRules('PAY_QTR1_NONPRDWRK_DVAL', ['PAY_QTR1_VAL_F', 'PAY_QTR1_PRDWRK_VAL_F']);\n            } else {\n                record['PAY_QTR1_PRDWRK_VAL_F'] = setCharAt(record['PAY_QTR1_PRDWRK_VAL_F'], 2, 'X');\n            }\n        }\n    }\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'MFG PAYQTR1'\n    return msg;\n}\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "b2865a1824aff9ec",
        "type": "function",
        "z": "48bdd199705157b9",
        "name": "mfg_payann",
        "func": "try {\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n    global.set('mfg_pay_emp', '')\n\n\n    if (parseInt(record?.['NAICS_SECTOR']) == 31 && record?.['SUBSAMP_IND_TXT'] != 'MC') {\n        if ((record?.PAY_ANN_PRDWRK_VAL == 0) && record?.PAY_ANN_VAL > 0) {\n            if (record?.EMP_MAR12_PRDWRK_NUM > 0 && record?.EMP_MAR12_NUM > 0) {\n                record['PAY_ANN_PRDWRK_VAL'] = Math.round(0.9 * (record?.EMP_MAR12_PRDWRK_NUM / record?.EMP_MAR12_NUM) * record?.PAY_ANN_VAL)\n                record['PAY_ANN_NONPRDWRK_DVAL'] = Math.round((record?.PAY_ANN_VAL - record?.PAY_ANN_PRDWRK_VAL))\n                flagRules('PAY_ANN_PRDWRK_VAL', ['EMP_MAR12_PRDWRK_NUM_F', 'EMP_MAR12_NUM_F', 'PAY_ANN_VAL_F'])\n                flagRules('PAY_ANN_NONPRDWRK_DVAL', ['PAY_ANN_VAL_F', 'PAY_ANN_PRDWRK_F'])\n            } else if (record?.PAY_QTR1_PRDWRK_VAL > 0 && record?.PAY_QTR1_VAL > 0) {\n                record['PAY_ANN_PRDWRK_VAL'] = Math.round((record?.PAY_QTR1_PRDWRK_VAL / record?.PAY_QTR1_VAL) * record?.PAY_ANN_VAL)\n                record['PAY_ANN_NONPRDWRK_VAL_DVAL'] = Math.round((record?.PAY_ANN_VAL - record?.PAY_ANN_PRDWRK_VAL))\n                flagRules('PAY_ANN_PRDWRK_VAL', ['PAY_QTR1_PRDWRK_VAL_F', 'PAY_QTR1_VAL_F', 'PAY_ANN_VAL_F'])\n                flagRules('PAY_ANN_NONPRDWRK_DVAL', ['PAY_ANN_VAL_F', 'PAY_ANN_PRDWRK_VAL_F'])\n            } else {\n                record['PAY_ANN_PRDWRK_VAL_F'] = setCharAt(record['PAY_ANN_PRDWRK_VAL_F'], 2, 'X');\n            }\n        } else if ((record?.PAY_ANN_PRDWRK_VAL > 0) && record?.PAY_ANN_VAL > 0) {\n            if (record?.PAY_ANN_PRDWRK_VAL != record?.PAY_ANN_VAL) {\n                if (record?.PAY_ANN_PRDWRK_DVAL < record?.PAY_ANN_VAL) {\n                    record['PAY_ANN_NON_PRDWRK_DVAL'] = Math.round(record?.PAY_ANN_VAL - record?.PAY_ANN_PRDWRK_VAL)\n                    flagRules('PAY_ANN_NON_PRDWRK_DVAL', ['PAY_ANN_VAL_F', 'PAY_ANN_PRDWRK_VAL_F'])\n                } else {\n                    record['PAY_ANN_PRDWRK_VAL_F'] = setCharAt(record['PAY_ANN_PRDWRK_VAL_F'], 2, 'X');\n                }\n            }\n        }\n        record['ACTION'] = 'Go To: EMPQ1'\n        // global.set('action', 'Go To: EMPQ1')\n    } else {\n        record['ACTION'] = 'Return to Main Routing'\n        global.set('mfg_pay_emp', 'Return to Main Routing')\n    }\n\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload = 'MFG Payann'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 180,
        "wires": [
            [
                "be2c852c16e1ae5f"
            ]
        ]
    },
    {
        "id": "be2c852c16e1ae5f",
        "type": "switch",
        "z": "48bdd199705157b9",
        "name": "",
        "property": "mfg_pay_emp",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Return to Main Routing",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 830,
        "y": 180,
        "wires": [
            [],
            [
                "2180ef194be6834d"
            ]
        ]
    },
    {
        "id": "416362dcdd1a7e66",
        "type": "subflow:05d1a91987f08f14",
        "z": "48bdd199705157b9",
        "name": "",
        "x": 1070,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "0b4f5039edc9b58f",
        "type": "subflow:9f8b85fce167ad51",
        "z": "48bdd199705157b9",
        "name": "",
        "x": 870,
        "y": 300,
        "wires": [
            [
                "50b781040e269caa"
            ]
        ]
    },
    {
        "id": "2180ef194be6834d",
        "type": "switch",
        "z": "48bdd199705157b9",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 880,
        "y": 240,
        "wires": [
            [],
            [
                "0b4f5039edc9b58f"
            ]
        ]
    },
    {
        "id": "50b781040e269caa",
        "type": "switch",
        "z": "48bdd199705157b9",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1060,
        "y": 300,
        "wires": [
            [],
            [
                "416362dcdd1a7e66"
            ]
        ]
    },
    {
        "id": "f4dcf609b2bdce56",
        "type": "function",
        "z": "48bdd199705157b9",
        "name": "mfg_payann database",
        "func": "try {\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    msg.mfg_pay_emp = ''\n\n\n    if (parseInt(record?.['NAICS_SECTOR']) == 31 && record?.['SUBSAMP_IND_TXT'] != 'MC') {\n        if ((record?.PAY_ANN_PRDWRK_VAL == 0) && record?.PAY_ANN_VAL > 0) {\n            if (record?.EMP_MAR12_PRDWRK_NUM > 0 && record?.EMP_MAR12_NUM > 0) {\n                record['PAY_ANN_PRDWRK_VAL'] = Math.round(0.9 * (record?.EMP_MAR12_PRDWRK_NUM / record?.EMP_MAR12_NUM) * record?.PAY_ANN_VAL)\n                record['PAY_ANN_NONPRDWRK_DVAL'] = Math.round((record?.PAY_ANN_VAL - record?.PAY_ANN_PRDWRK_VAL))\n                flagRules('PAY_ANN_PRDWRK_VAL', ['EMP_MAR12_PRDWRK_NUM_F', 'EMP_MAR12_NUM_F', 'PAY_ANN_VAL_F'])\n                flagRules('PAY_ANN_NONPRDWRK_DVAL', ['PAY_ANN_VAL_F', 'PAY_ANN_PRDWRK_F'])\n            } else if (record?.PAY_QTR1_PRDWRK_VAL > 0 && record?.PAY_QTR1_VAL > 0) {\n                record['PAY_ANN_PRDWRK_VAL'] = Math.round((record?.PAY_QTR1_PRDWRK_VAL / record?.PAY_QTR1_VAL) * record?.PAY_ANN_VAL)\n                record['PAY_ANN_NONPRDWRK_VAL_DVAL'] = Math.round((record?.PAY_ANN_VAL - record?.PAY_ANN_PRDWRK_VAL))\n                flagRules('PAY_ANN_PRDWRK_VAL', ['PAY_QTR1_PRDWRK_VAL_F', 'PAY_QTR1_VAL_F', 'PAY_ANN_VAL_F'])\n                flagRules('PAY_ANN_NONPRDWRK_DVAL', ['PAY_ANN_VAL_F', 'PAY_ANN_PRDWRK_VAL_F'])\n            } else {\n                record['PAY_ANN_PRDWRK_VAL_F'] = setCharAt(record['PAY_ANN_PRDWRK_VAL_F'], 2, 'X');\n            }\n        } else if ((record?.PAY_ANN_PRDWRK_VAL > 0) && record?.PAY_ANN_VAL > 0) {\n            if (record?.PAY_ANN_PRDWRK_VAL != record?.PAY_ANN_VAL) {\n                if (record?.PAY_ANN_PRDWRK_DVAL < record?.PAY_ANN_VAL) {\n                    record['PAY_ANN_NON_PRDWRK_DVAL'] = Math.round(record?.PAY_ANN_VAL - record?.PAY_ANN_PRDWRK_VAL)\n                    flagRules('PAY_ANN_NON_PRDWRK_DVAL', ['PAY_ANN_VAL_F', 'PAY_ANN_PRDWRK_VAL_F'])\n                } else {\n                    record['PAY_ANN_PRDWRK_VAL_F'] = setCharAt(record['PAY_ANN_PRDWRK_VAL_F'], 2, 'X');\n                }\n            }\n        }\n    } else {\n        msg.mfg_pay_emp = 'Return to Main Routing'\n    }\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload = 'MFG Payann'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "e4588ba92d2276e3",
        "type": "function",
        "z": "9e4e212b0811233d",
        "name": "Pre Db Write Back For Leased",
        "func": "try {\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let REFERRAL_FLAG = record['REFERRAL_FLAG'];\n\n    if (REFERRAL_FLAG === 'LEASED_ONLY') {\n        record['PAY_ANN_VAL'] = 0;\n        record['PAY_ANN_VAL_F'] = setCharAt(record?.['PAY_ANN_VAL_F'], 1, 'Z')\n    }\n\n    record['ACTION'] = 'Go to Post Edit Status Fields'\n    // global.set('action','Go to Post Edit Status Fields')\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'PreDB Write Back for Leased'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "c106fba3324f38ba",
        "type": "function",
        "z": "9e4e212b0811233d",
        "name": "Pre Db Write Back For Leased database",
        "func": "try {\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let REFERRAL_FLAG = record['REFERRAL_FLAG'];\n\n    if (REFERRAL_FLAG === 'LEASED_ONLY') {\n        record['PAY_ANN_VAL'] = 0;\n        record['PAY_ANN_VAL_F'] = setCharAt(record?.['PAY_ANN_VAL_F'], 1, 'Z')\n    }\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'PreDB Write Back for Leased'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "08eaf81ec10ed752",
        "type": "function",
        "z": "1a584bfe7f4a2458",
        "name": "load_referrals",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n    \n    function getDate() {\n        let date_1 = new Date()\n        date_1 = date_1.toLocaleDateString()\n        return date_1\n    }\n\n    function endDate() {\n        let id = record?.REPORTING_ID\n        for (let i in msg.payload.csv) {\n            let row = msg.payload.csv[i]\n            if (row?.REPORTING_ID == id && ![null, undefined].includes(row?.FLAG_NAME)) {\n                if (row?.ENDDATE) {\n                    let date1 = new Date(row.ENDDATE).toLocaleDateString()\n                    let date2 = new Date('01/01/1950').toLocaleDateString()\n                    if (date1 == date2) {\n                        row.ENDDATE = getDate()\n                    }\n                }\n            }\n        }\n    }\n\n    endDate()\n\n    function refUpdate() {\n        let found = msg.payload.csv.find(flag => flag.REPORTING_ID == record?.REPORTING_ID && flag.FLAG_NAME == record?.['REFERRAL_FLAG'] && ![null, undefined].includes(flag?.FLAG_NAME))\n        if (found) {\n            found['BGNDATE'] = getDate()\n            found['ENDDATE'] = '01/01/1950'\n        } else {\n            if ([null,undefined].includes(record?.REFERRAL_FLAG)) {\n\n            } else {\n            let obj = {}\n            obj['REPORTING_ID'] = record?.REPORTING_ID\n            obj['REF_PER'] = record?.REF_PER\n            obj['FLAG_NAME'] = record?.REFERRAL_FLAG\n            obj['RECORD_TYP'] = record?.REPORTING_ID_TYP_TXT\n            obj['BGNDATE'] = getDate()\n            // obj['ENDDATE'] = '01/01/1950'\n            if (record?.NONTABFL == 'R') {\n                obj['CRITICAL'] = 'Y'\n            }\n            msg.payload.csv.push(obj)\n            console.log(msg.payload.csv)\n            }\n        }\n    }\n\n    refUpdate()\n\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Load Referrals'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "bcb7c3ac05c2dfe5",
        "type": "function",
        "z": "1a584bfe7f4a2458",
        "name": "load_referrals database",
        "func": "try{\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n\n    function getDate() {\n        let date_1 = new Date()\n        date_1 = date_1.toLocaleDateString()\n        return date_1\n    }\n\n    function endDate() {\n        let id = record?.REPORTING_ID\n        for (let i in msg.referrals) {\n            let row = msg.referrals[i].facts\n            if (row?.REPORTING_ID == id) {\n                if (row?.ENDDATE) {\n                    let date1 = new Date(row.ENDDATE).toLocaleDateString()\n                    let date2 = new Date('01/01/1950').toLocaleDateString()\n                    if (date1 == date2) {\n                        row.ENDDATE = getDate()\n                    }\n                }\n            }\n        }\n    }\n\n    endDate()\n\n    function refUpdate() {\n        let found = msg.referrals.find(flag => flag.facts?.REPORTING_ID == record?.REPORTING_ID && flag.facts?.FLAG_NAME == record?.['REFERRAL_FLAG'])\n        if (found) {\n            found['BGNDATE'] = getDate()\n            found['ENDDATE'] = '01/01/1950'\n        } else {\n            let obj = {\"facts\":{}}\n            obj['facts']['REPORTING_ID'] = record?.REPORTING_ID\n            obj['facts']['REF_PER'] = record?.REF_PER\n            obj['facts']['FLAG_NAME'] = record?.REFERRAL_FLAG\n            obj['facts']['RECORD_TYP'] = record?.REPORTING_ID_TYP_TXT\n            obj['facts']['BGNDATE'] = getDate()\n            // obj['ENDDATE'] = '01/01/1950'\n            if (record?.NONTABFL == 'R') {\n                obj['fact']['CRITICAL'] = 'Y'\n            }\n            msg.referrals.push(obj)\n        }\n    }\n\n    refUpdate()\n\n    return msg;\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Load Referrals'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 480,
        "wires": [
            [
                "b4e2ee0c97d0f6da"
            ]
        ]
    },
    {
        "id": "7013f87054ad7457",
        "type": "function",
        "z": "1a584bfe7f4a2458",
        "name": "reset msg",
        "func": "msg.referrals = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 480,
        "wires": [
            [
                "bcb7c3ac05c2dfe5"
            ]
        ]
    },
    {
        "id": "c50190ecc02131e9",
        "type": "function",
        "z": "1a584bfe7f4a2458",
        "name": "query_referrals",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.REPORTING_ID\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where reporting_id = '\" + id + \"' and type = 'REFERRALS' and jobname = '\" + job +\"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 360,
        "wires": [
            [
                "33ff14ace95950e6"
            ]
        ]
    },
    {
        "id": "33ff14ace95950e6",
        "type": "subflow:8032608991ae0162",
        "z": "1a584bfe7f4a2458",
        "name": "",
        "x": 700,
        "y": 360,
        "wires": [
            [
                "7013f87054ad7457"
            ]
        ]
    },
    {
        "id": "b4e2ee0c97d0f6da",
        "type": "function",
        "z": "1a584bfe7f4a2458",
        "name": "placeholder API call - needs to be completed",
        "func": "\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "0306a6b0d0775ddc",
        "type": "subflow:1a584bfe7f4a2458",
        "z": "96f29b19e2260e65",
        "name": "",
        "x": 700,
        "y": 60,
        "wires": [
            [
                "b016a32cf3993765"
            ]
        ]
    },
    {
        "id": "bfd858ed62920660",
        "type": "subflow:9e4e212b0811233d",
        "z": "96f29b19e2260e65",
        "name": "",
        "x": 870,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "b016a32cf3993765",
        "type": "switch",
        "z": "96f29b19e2260e65",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 920,
        "y": 60,
        "wires": [
            [],
            [
                "bfd858ed62920660"
            ]
        ]
    },
    {
        "id": "992878fea3e496b2",
        "type": "function",
        "z": "e4fb9739caef0397",
        "name": "Unit Balance Function",
        "func": "try {\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n\n    msg.cache = global.get(\"lookupCache\").data.find(\n        item =>\n            item.module === \"balance\" &&\n            item.param === \"unit_balance\" &&\n            item.program === \"aies\" &&\n            item.unit_type === \"estab\"\n    )?.json_values;\n\n    function flagRules(variable, details) {\n        let flagName = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagName] = setCharAt(record?.[flagName], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagName] = setCharAt(record?.[flagName], 2, 'Y');\n            } else {\n                record[flagName] = setCharAt(record?.[flagName], 2, 'S');\n            }\n        }\n    }\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function arrayRemove(arr, value) {\n        return arr.filter(function (ele) {\n            return ele != value;\n        });\n    }\n    \n    function checkNaics(data, naics, rec_typ, rec_typop, rec_tax) {\n        let list = data['NAICS']\n        let unit = data['UNIT TYPE']\n        let typop = data['TYPOP']\n        let tax = data['TAXSTAT']\n        let rectyp = rec_typ\n        if (['SU', 'MU'].includes(rectyp)) {\n            rec_typ = 'ESTAB'\n        } else if (['KAU'].includes(rectyp)) {\n            rec_typ = 'KAU'\n        } else if (['ENT'].includes(rectyp)) {\n            rec_typ = 'ENT'\n        }\n        if ([null, undefined, 'null', 'undefined'].includes(typop)) {\n            rec_typop = typop\n        }\n        if ([null, undefined, 'null', 'undefined'].includes(tax)) {\n            rec_tax = tax\n        }\n\n        if (rec_typ === unit && rec_tax === tax && rec_typop === typop) {\n            if ([\"ALL\", \"All\"].includes(list)) {\n                return (true);\n            } else {\n                list = list.replace(/ /g, \"\");\n                list = list.replace(/'/g, \"\");\n                var array = list.split(',')\n\n                if (array.find(r => naics.startsWith(r))) {\n                    return (true);\n                } else {\n                    return (false)\n                }\n            }\n        }\n    }\n\n    function sumRow(data) {\n        let sum = 0;\n        var keys = [];\n        var keys_f = [];\n        for (var key in data) {\n            if (key.startsWith('DETAIL') && data[key] != null) {\n                let variable = data[key]\n                let variable_f = variable + '_F'\n                if (!Number.isNaN(parseFloat(record[variable]))) {\n                    sum = parseFloat(sum) + parseFloat(record[variable])\n                }\n                // else {\n                //     record[variable] = 0\n                // }\n                keys.push(variable)\n                keys_f.push(variable_f)\n            }\n        }\n        return [sum, keys, keys_f];\n    }\n\n    function raking(rectot, sum, keys, tol, fixedKeys) {\n        let filteredKeys = keys.filter(key => !fixedKeys || !fixedKeys.includes(key))\n\n        if ((Math.abs(rectot - sum) / rectot) <= tol) {\n            keys.sort((a, b) => record[b] - record[a]);\n\n            let updatedRectot = rectot;\n            let updatedSum = sum;\n\n            if(fixedKeys) {\n                for (let key of fixedKeys) {\n                    if (record[key] !== undefined) {\n                        updatedRectot -= record[key]\n                        updatedSum -= record[key]\n                    }\n                }\n\n            }\n\n            // if (keys.includes(excludeVar)) {\n            //     keys = arrayRemove(keys, excludeVar)\n            //     rectot = rectot - record[excludeVar]\n            //     sum = sum - record[excludeVar]\n            // }\n            let remainder = 0\n            if (updatedSum !== 0) {\n                for (let i = 0; i < filteredKeys.length; i++) {\n                        let num1 = (updatedRectot / updatedSum) * parseFloat(record[filteredKeys[i]]) + remainder\n                        let num2 = Math.round(num1)\n                        remainder = num1 - num2\n                        record[filteredKeys[i]] = num2\n                }\n            }\n        }\n    }\n\n\n    let naics = record['NAICS_CODE']\n    naics = '' + naics\n\n    const REPORTING_ID_TYP_TXT = record['REPORTING_ID_TYP_TXT']\n    let TYPOP = record['TYPOP_WHSL_OLD_NUM']\n    let TAXSTAT = record['TAXSTAT']\n\n    var unitBalances = msg.cache['UNIT_BALANCE']\n    unitBalances.sort((a, b) => (a.Priority != null ? a.Priority : Infinity) - (b.Priority != null ? b.Priority : Infinity))\n\n\n    for (let i in unitBalances) {\n        let unitBalance = unitBalances[i]\n        let priority = unitBalance.Priority\n        let fixedKeys = unitBalance['Fixed Variable']\n        if (fixedKeys !== null) {\n            fixedKeys = fixedKeys.split(\", \")\n        }\n\n\n        if (checkNaics(unitBalance, naics, REPORTING_ID_TYP_TXT, TYPOP, TAXSTAT)) {\n            let tot = unitBalance['TOTAL']\n            let rectot = 0\n            if ([100, '100'].includes(tot)) {\n                rectot = 100\n            } else {\n                if (!Number.isNaN(parseFloat(record[tot]))) {\n                    rectot = parseFloat(record[tot])\n                }\n                // else {\n                //     record[tot] = 0\n                // }\n            }\n            let name_f = tot + '_F'\n            let [sum, keys, keys_f] = sumRow(unitBalance)\n            let filteredKeys = keys.filter(key => !fixedKeys || !fixedKeys.includes(key))\n            let nonNullFiltered = filteredKeys.filter(key => ![null, undefined].includes(record[key])) \n            sum = parseFloat(sum)\n\n            const tolerance = parseFloat(unitBalance['Tolerance'])\n            const tolerance2 = parseFloat(unitBalance['Tolerance2'])\n\n            // begin fail logic\n            if (rectot == sum && sum != 0) {\n                record['ACTION'] = 'Go To: Main Routing'\n                // global.set('action', 'Go To: Main Routing')\n            } else  {\n                // not kau path\n                if (['SU', 'MU', 'ENT'].includes(REPORTING_ID_TYP_TXT) || priority == 3) {\n                    if (((sum > 0 && rectot <= 0) || (priority == 3)) && priority != 4) {\n                        record[tot] = sum\n                        flagRules(tot,keys_f)\n                    } else if (sum == 0 && rectot > 0) {\n                        for (let i = 0; i < filteredKeys.length; i++) {\n                            //let det = filteredKeys[i]\n                            let det_f = filteredKeys[i] + '_F'\n                            record[det_f] = setCharAt(record?.[det_f], 2, 'X')\n                            //record[det] = 0\n                        }\n                    } else if (sum > 0 && rectot > 0) {\n                        if ((Math.abs(rectot - sum) / rectot) <= tolerance) {\n                            let flag_check = 'Yes'\n                            for (let i = 0; i < keys.length; i++) {\n                                let det_f = keys[i] + '_F'\n                                try {\n                                    if (!['P', 'C', 'A', 'S', 'O', 'E', 'F'].includes(record[det_f].substring(1, 2))) {\n                                        flag_check = 'No'\n                                    } \n                                } catch {\n                                }\n                            }\n                            if (flag_check == 'Yes' && priority != 4) {\n                                record[tot] = sum\n                                flagRules(tot, keys_f)\n                            } else {\n                                raking(rectot, sum, keys, tolerance, fixedKeys)\n                                for (let i = 0; i < filteredKeys.length; i++) {\n                                    let det_f = filteredKeys[i] + '_F'\n                                    record[det_f] = setCharAt(record?.[det_f], 2, 'K')\n                                }\n                            }\n                        } else if ((Math.abs(rectot - sum) / rectot) <= tolerance2) {\n                            raking(rectot, sum, keys, tolerance, fixedKeys)\n                            for (let i = 0; i < filteredKeys.length; i++) {\n                                let det_f = filteredKeys[i] + '_F'\n                                record[det_f] = setCharAt(record?.[det_f], 2, 'F')\n                            }\n                        } else {\n                            for (let i = 0; i < nonNullFiltered.length; i++) {\n                                let det_f = nonNullFiltered[i] + '_F'\n                                record[det_f] = setCharAt(record?.[det_f], 2, 'X')\n                            }\n                        }\n                    } else if (sum == 0 && rectot <= 0) {\n                        for (let i = 0; i < filteredKeys.length; i++) {\n                            //let det = filteredKeys[i]\n                            record[tot] = 0\n                            let tot_f = tot + '_F'\n                            record[tot_f] = setCharAt(record?.[tot_f], 2, 'X')\n                            let det_f = filteredKeys[i] + '_F'\n                            record[det_f] = setCharAt(record?.[det_f], 2, 'X')\n                            //record[det] = 0\n                        }\n                    } else {\n                    }\n\n                // kau path\n                } else {\n                    if (priority == 3) {\n                        record[tot] = sum\n                        flagRules(tot, keys_f)\n                    } else if (sum == 0 && rectot > 0) {\n                        for (let i = 0; i < filteredKeys.length; i++) {\n                            //let det = filteredKeys[i]\n                            let det_f = filteredKeys[i] + '_F'\n                            record[det_f] = setCharAt(record?.[det_f], 2, 'X')\n                            //record[det] = 0\n                        }\n                    } else {\n                        if ((Math.abs(rectot - sum) / rectot) <= tolerance) {\n                            raking(rectot, sum, keys, tolerance, fixedKeys)\n                            for (let i = 0; i < filteredKeys.length; i++) {\n                                let det_f = filteredKeys[i] + '_F'\n                                record[det_f] = setCharAt(record?.[det_f], 2, 'K')\n                            }\n                        } else if (tolerance2 == null) {\n                        } else if ((Math.abs(rectot - sum) / rectot) <= tolerance2) {\n                            raking(rectot, sum, keys, tolerance, fixedKeys)\n                            for (let i = 0; i < filteredKeys.length; i++) {\n                                let det_f = filteredKeys[i] + '_F'\n                                record[det_f] = setCharAt(record?.[det_f], 2, 'F')\n                            }\n                        } else {\n                            for (let i = 0; i < nonNullFiltered.length; i++) {\n                                //let det = filteredKeys[i]\n                                let det_f = nonNullFiltered[i] + '_F'\n                                record[det_f] = setCharAt(record?.[det_f], 2, 'X')\n                                //record[det] = 0\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    record['ACTION'] = 'Go To: Main Routing'\n    // global.set('action', 'Go To: Main Routing')\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'Unit Balance'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "2d12fc9575798bc5",
        "type": "function",
        "z": "e4fb9739caef0397",
        "name": "Unit Balance Function (database)",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    \n    msg.cache = global.get(\"lookupCache\").data.find(\n        item =>\n            item.module === \"balance\" &&\n            item.param === \"unit_balance\" &&\n            item.program === \"aies\" &&\n            item.unit_type === \"estab\"\n    )?.json_values;\n\n    function flagRules(variable, details) {\n        let flagName = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagName] = setCharAt(record?.[flagName], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagName] = setCharAt(record?.[flagName], 2, 'Y');\n            } else {\n                record[flagName] = setCharAt(record?.[flagName], 2, 'S');\n            }\n        }\n    }\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function arrayRemove(arr, value) {\n        return arr.filter(function (ele) {\n            return ele != value;\n        });\n    }\n    \n    function checkNaics(data, naics, rec_typ, rec_typop, rec_tax) {\n        let list = data['NAICS']\n        let unit = data['UNIT TYPE']\n        let typop = data['TYPOP']\n        let tax = data['TAXSTAT']\n        let rectyp = rec_typ\n        if (['SU', 'MU'].includes(rectyp)) {\n            rec_typ = 'ESTAB'\n        } else if (['KAU'].includes(rectyp)) {\n            rec_typ = 'KAU'\n        } else if (['ENT'].includes(rectyp)) {\n            rec_typ = 'ENT'\n        }\n        if ([null, undefined, 'null', 'undefined'].includes(typop)) {\n            rec_typop = typop\n        }\n        if ([null, undefined, 'null', 'undefined'].includes(tax)) {\n            rec_tax = tax\n        }\n\n        if (rec_typ === unit && rec_tax === tax && rec_typop === typop) {\n            if ([\"ALL\", \"All\"].includes(list)) {\n                return (true);\n            } else {\n                list = list.replace(/ /g, \"\");\n                list = list.replace(/'/g, \"\");\n                var array = list.split(',')\n\n                if (array.find(r => naics.startsWith(r))) {\n                    return (true);\n                } else {\n                    return (false)\n                }\n            }\n        }\n    }\n\n    function sumRow(data) {\n        let sum = 0;\n        var keys = [];\n        var keys_f = [];\n        for (var key in data) {\n            if (key.startsWith('DETAIL') && data[key] != null) {\n                let variable = data[key]\n                let variable_f = variable + '_F'\n                if (!Number.isNaN(parseFloat(record[variable]))) {\n                    sum = parseFloat(sum) + parseFloat(record[variable])\n                }\n                // else {\n                //     record[variable] = 0\n                // }\n                keys.push(variable)\n                keys_f.push(variable_f)\n            }\n        }\n        return [sum, keys, keys_f];\n    }\n\n    function raking(rectot, sum, keys, tol, fixedKeys) {\n        let filteredKeys = keys.filter(key => !fixedKeys || !fixedKeys.includes(key))\n\n        if ((Math.abs(rectot - sum) / rectot) <= tol) {\n            keys.sort((a, b) => record[b] - record[a]);\n\n            let updatedRectot = rectot;\n            let updatedSum = sum;\n\n            if(fixedKeys) {\n                for (let key of fixedKeys) {\n                    if (record[key] !== undefined) {\n                        updatedRectot -= record[key]\n                        updatedSum -= record[key]\n                    }\n                }\n\n            }\n\n            // if (keys.includes(excludeVar)) {\n            //     keys = arrayRemove(keys, excludeVar)\n            //     rectot = rectot - record[excludeVar]\n            //     sum = sum - record[excludeVar]\n            // }\n            let remainder = 0\n            if (updatedSum !== 0) {\n                for (let i = 0; i < filteredKeys.length; i++) {\n                        let num1 = (updatedRectot / updatedSum) * parseFloat(record[filteredKeys[i]]) + remainder\n                        let num2 = Math.round(num1)\n                        remainder = num1 - num2\n                        record[filteredKeys[i]] = num2\n                }\n            }\n        }\n    }\n\n\n    let naics = record['NAICS_CODE']\n    naics = '' + naics\n\n    const REPORTING_ID_TYP_TXT = record['REPORTING_ID_TYP_TXT']\n    let TYPOP = record['TYPOP_WHSL_OLD_NUM']\n    let TAXSTAT = record['TAXSTAT']\n\n    var unitBalances = msg.cache['UNIT_BALANCE']\n    unitBalances.sort((a, b) => (a.Priority != null ? a.Priority : Infinity) - (b.Priority != null ? b.Priority : Infinity))\n\n\n    for (let i in unitBalances) {\n        let unitBalance = unitBalances[i]\n        let priority = unitBalance.Priority\n        let fixedKeys = unitBalance['Fixed Variable']\n        if (fixedKeys !== null) {\n            fixedKeys = fixedKeys.split(\", \")\n        }\n\n\n        if (checkNaics(unitBalance, naics, REPORTING_ID_TYP_TXT, TYPOP, TAXSTAT)) {\n            let tot = unitBalance['TOTAL']\n            let rectot = 0\n            if ([100, '100'].includes(tot)) {\n                rectot = 100\n            } else {\n                if (!Number.isNaN(parseFloat(record[tot]))) {\n                    rectot = parseFloat(record[tot])\n                }\n                // else {\n                //     record[tot] = 0\n                // }\n            }\n            let name_f = tot + '_F'\n            let [sum, keys, keys_f] = sumRow(unitBalance)\n            let filteredKeys = keys.filter(key => !fixedKeys || !fixedKeys.includes(key))\n            let nonNullFiltered = filteredKeys.filter(key => ![null, undefined].includes(record[key])) \n            sum = parseFloat(sum)\n\n            const tolerance = parseFloat(unitBalance['Tolerance'])\n            const tolerance2 = parseFloat(unitBalance['Tolerance2'])\n\n            // begin fail logic\n            if (rectot == sum && sum != 0) {\n            } else  {\n                // not kau path\n                if (['SU', 'MU', 'ENT'].includes(REPORTING_ID_TYP_TXT) || priority == 3) {\n                    if (((sum > 0 && rectot <= 0) || (priority == 3)) && priority != 4) {\n                        record[tot] = sum\n                        flagRules(tot,keys_f)\n                    } else if (sum == 0 && rectot > 0) {\n                        for (let i = 0; i < filteredKeys.length; i++) {\n                            //let det = filteredKeys[i]\n                            let det_f = filteredKeys[i] + '_F'\n                            record[det_f] = setCharAt(record?.[det_f], 2, 'X')\n                            //record[det] = 0\n                        }\n                    } else if (sum > 0 && rectot > 0) {\n                        if ((Math.abs(rectot - sum) / rectot) <= tolerance) {\n                            let flag_check = 'Yes'\n                            for (let i = 0; i < keys.length; i++) {\n                                let det_f = keys[i] + '_F'\n                                try {\n                                    if (!['P', 'C', 'A', 'S', 'O', 'E', 'F'].includes(record[det_f].substring(1, 2))) {\n                                        flag_check = 'No'\n                                    } \n                                } catch {\n                                }\n                            }\n                            if (flag_check == 'Yes' && priority != 4) {\n                                record[tot] = sum\n                                flagRules(tot, keys_f)\n                            } else {\n                                raking(rectot, sum, keys, tolerance, fixedKeys)\n                                for (let i = 0; i < filteredKeys.length; i++) {\n                                    let det_f = filteredKeys[i] + '_F'\n                                    record[det_f] = setCharAt(record?.[det_f], 2, 'K')\n                                }\n                            }\n                        } else if ((Math.abs(rectot - sum) / rectot) <= tolerance2) {\n                            raking(rectot, sum, keys, tolerance, fixedKeys)\n                            for (let i = 0; i < filteredKeys.length; i++) {\n                                let det_f = filteredKeys[i] + '_F'\n                                record[det_f] = setCharAt(record?.[det_f], 2, 'F')\n                            }\n                        } else {\n                            for (let i = 0; i < nonNullFiltered.length; i++) {\n                                let det_f = nonNullFiltered[i] + '_F'\n                                record[det_f] = setCharAt(record?.[det_f], 2, 'X')\n                            }\n                        }\n                    } else if (sum == 0 && rectot <= 0) {\n                        for (let i = 0; i < filteredKeys.length; i++) {\n                            //let det = filteredKeys[i]\n                            record[tot] = 0\n                            let tot_f = tot + '_F'\n                            record[tot_f] = setCharAt(record?.[tot_f], 2, 'X')\n                            let det_f = filteredKeys[i] + '_F'\n                            record[det_f] = setCharAt(record?.[det_f], 2, 'X')\n                            //record[det] = 0\n                        }\n                    } else {\n                    }\n\n                // kau path\n                } else {\n                    if (priority == 3) {\n                        record[tot] = sum\n                        flagRules(tot, keys_f)\n                    } else if (sum == 0 && rectot > 0) {\n                        for (let i = 0; i < filteredKeys.length; i++) {\n                            //let det = filteredKeys[i]\n                            let det_f = filteredKeys[i] + '_F'\n                            record[det_f] = setCharAt(record?.[det_f], 2, 'X')\n                            //record[det] = 0\n                        }\n                    } else {\n                        if ((Math.abs(rectot - sum) / rectot) <= tolerance) {\n                            raking(rectot, sum, keys, tolerance, fixedKeys)\n                            for (let i = 0; i < filteredKeys.length; i++) {\n                                let det_f = filteredKeys[i] + '_F'\n                                record[det_f] = setCharAt(record?.[det_f], 2, 'K')\n                            }\n                        } else if (tolerance2 == null) {\n                        } else if ((Math.abs(rectot - sum) / rectot) <= tolerance2) {\n                            raking(rectot, sum, keys, tolerance, fixedKeys)\n                            for (let i = 0; i < filteredKeys.length; i++) {\n                                let det_f = filteredKeys[i] + '_F'\n                                record[det_f] = setCharAt(record?.[det_f], 2, 'F')\n                            }\n                        } else {\n                            for (let i = 0; i < nonNullFiltered.length; i++) {\n                                //let det = filteredKeys[i]\n                                let det_f = nonNullFiltered[i] + '_F'\n                                record[det_f] = setCharAt(record?.[det_f], 2, 'X')\n                                //record[det] = 0\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Unit Balance'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "0c4def347547a284",
        "type": "function",
        "z": "5e2c6717be2fdd36",
        "name": "logical edits function",
        "func": "try{\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n\n    msg.cache = global.get(\"lookupCache\").data.find(\n        item =>\n            item.module === \"logical_edit\" &&\n            item.param === \"logical_edit\" &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n\n    function checkNaics(data, naics, rec_typ, rec_tax, rec_typop) {\n        let list = data['NAICS_NUM']\n        let notlist = data['NAICS_NOT']\n        let unit = data['UNIT']\n        let tax = data['TAXSTAT']\n        let typop = data['TYPOP']\n\n        let rectyp = rec_typ\n        if (['MU', 'SU'].includes(rectyp)) {\n            rec_typ = 'ESTAB'\n        } else if (['KAU', 'kau', 'Kau'].includes(rectyp)) {\n            rec_typ = 'KAU'\n        } else if (['ENT', 'Ent', 'ent'].includes(rectyp)) {\n            rec_typ = 'COMPANY'\n        }\n        if ([null, undefined, 'null', 'undefined'].includes(tax)) {\n            rec_tax = tax\n        }\n        if ([null, undefined, 'null', 'undefined'].includes(typop)) {\n            rec_typop = typop\n        } else {\n            if (![null, undefined, 'null', 'undefined'].includes(rec_typop)) {\n                rec_typop = rec_typop?.charAt(0)\n            }\n        }\n\n        if (rec_typ === unit && rec_tax === tax && rec_typop == typop) {\n            if ([\"ALL\", \"All\", \"ALL \", \"All \"].includes(list)) {\n                return (true);\n            } else {\n                list = list.replace(/ /g, \"\");\n                list = list.replace(/'/g, \"\");\n                var array = list.split(',')\n\n                if (array.find(r => naics.startsWith(r))) {\n                    if (![null, undefined].includes(notlist)) {\n                        notlist = notlist.replace(/ /g, \"\");\n                        notlist = notlist.replace(/'/g, \"\");\n                        var notarray = notlist.split(',');\n                        if (notarray.find(r => naics.startsWith(r))) {\n                            return (false);\n                        } else {\n                            return (true);\n                        }\n                    } else {\n                        return (true);\n                    }\n                } else {\n                    return (false)\n                }\n            }\n        }\n    }\n\n    function createVariables(evalobj, context) {\n        for (let i in evalobj) {\n            context[i] = evalobj[i];\n        }\n    }\n    function returnVariables(evalobj, context, array) {\n        for (let i in array) {\n            let newname = array[i]\n            evalobj[newname] = context[newname];\n            if ([null, undefined].includes(evalobj[newname])) {\n            } else {\n                evalobj[newname] = Math.round(evalobj[newname])\n            }\n        }\n    }\n\n    function evalCondition(logicalEdit, record) {\n        let truth = 'N'\n        var condition = logicalEdit['CONDITION']\n        var columns = logicalEdit['ALL_VARIABLE']\n        columns = columns.replace(/ /g, \"\");\n        var array = columns.split(',')\n        var action_col = logicalEdit['ACTION_VARIABLE']\n        action_col = action_col.replace(/ /g, \"\");\n        var action_array = action_col.split(',')\n        let evalobj = {}\n        for (let i in array) {\n            let newname = array[i]\n            if (!([null, 'null', 'NULL', undefined, 'undefined'].includes(record?.[newname]))) {\n                evalobj[newname] = parseFloat(record[newname])\n            } else {\n                evalobj[newname] = null\n            }\n        }\n        createVariables(evalobj, this);\n        if (condition == 'None') {\n            truth = 'Y'\n        } else {\n            const code = 'if (' + condition + ') {truth = \"Y\"}'\n            try {\n                eval(code)\n            } catch {\n                console.log('Condition Error on: ' + logicalEdit)\n            }\n        }\n        if (truth == 'Y') {\n            const action = logicalEdit['ACTION']\n            try {\n                eval(action)\n            } catch {\n                console.log('Action Error on: ' + logicalEdit)\n            }\n            let num = (action.split(\"=\").length - 1)\n            let string = ''\n            if ((action.split(\"=\").length - 1) >= 1) {\n                for (let i = 1; i <= num; i++) {\n                    if (i == 1) {\n                        string = action.substring(action.indexOf('=')+1)\n                    } else {\n                        string = string.substring(0, string.indexOf(';')) + string.substring(string.indexOf('=') + 1)\n                    }\n                }\n            }\n            let details = []\n            for (let i in evalobj) {\n                let name1 = i\n                if (string.indexOf(name1) != -1) {\n                    details.push(name1 + '_F')\n                }\n            }\n\n\n            returnVariables(evalobj, this, action_array)\n            for (let i in action_array) {\n                let newname = action_array[i]\n                let newname_f = newname + '_F'\n                let flag = logicalEdit['PO Flag']\n                record[newname] = evalobj[newname]\n                if (['L', 'J'].includes(flag)) {\n                    flagRules(newname, details)\n                } else {\n                    record[newname_f] = setCharAt(record?.[newname_f], 2, flag)\n                }\n            }\n        }\n    }\n\n    let naics = record['NAICS_CODE']\n    naics = '' + naics\n\n    const REPORTING_ID_TYP_TXT = record['REPORTING_ID_TYP_TXT']\n    let TAXSTAT = record['TAX_EXEMPT_STAT']\n    let TYPOP_CODE = record['TYPOP_WHSL_OLD_NUM']\n\n\n    var logicalEdits = msg.cache['LOGICAL_EDIT']\n    logicalEdits.sort((a, b) => (a.PRIORITY != null ? a.PRIORITY : Infinity) - (b.PRIORITY != null ? b.PRIORITY : Infinity))\n\n    for (let i in logicalEdits) {\n        let logicalEdit = logicalEdits[i]\n        if (checkNaics(logicalEdit, naics, REPORTING_ID_TYP_TXT, TAXSTAT, TYPOP_CODE)) {\n            evalCondition(logicalEdit, record)\n        }\n    }\n    return msg;\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'Logical Edits'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "58d9bc29ba886dc5",
        "type": "function",
        "z": "5e2c6717be2fdd36",
        "name": "logical edits function database",
        "func": "try{\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n\n    msg.cache = global.get(\"lookupCache\").data.find(\n        item =>\n            item.module === \"logical_edit\" &&\n            item.param === \"logical_edit\" &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n\n    function checkNaics(data, naics, rec_typ, rec_tax, rec_typop) {\n        let list = data['NAICS_NUM']\n        let notlist = data['NAICS_NOT']\n        let unit = data['UNIT']\n        let tax = data['TAXSTAT']\n        let typop = data['TYPOP']\n\n        let rectyp = rec_typ\n        if (['MU', 'SU'].includes(rectyp)) {\n            rec_typ = 'ESTAB'\n        } else if (['KAU', 'kau', 'Kau'].includes(rectyp)) {\n            rec_typ = 'KAU'\n        } else if (['ENT', 'Ent', 'ent'].includes(rectyp)) {\n            rec_typ = 'COMPANY'\n        }\n        if ([null, undefined, 'null', 'undefined'].includes(tax)) {\n            rec_tax = tax\n        }\n        if ([null, undefined, 'null', 'undefined'].includes(typop)) {\n            rec_typop = typop\n        } else {\n            if (![null, undefined, 'null', 'undefined'].includes(rec_typop)) {\n                rec_typop = rec_typop?.charAt(0)\n            }\n        }\n\n        if (rec_typ === unit && rec_tax === tax && rec_typop == typop) {\n            if ([\"ALL\", \"All\", \"ALL \", \"All \"].includes(list)) {\n                return (true);\n            } else {\n                list = list.replace(/ /g, \"\");\n                list = list.replace(/'/g, \"\");\n                var array = list.split(',')\n\n                if (array.find(r => naics.startsWith(r))) {\n                    if (![null, undefined].includes(notlist)) {\n                        notlist = notlist.replace(/ /g, \"\");\n                        notlist = notlist.replace(/'/g, \"\");\n                        var notarray = notlist.split(',');\n                        if (notarray.find(r => naics.startsWith(r))) {\n                            return (false);\n                        } else {\n                            return (true);\n                        }\n                    } else {\n                        return (true);\n                    }\n                } else {\n                    return (false)\n                }\n            }\n        }\n    }\n\n    function createVariables(evalobj, context) {\n        for (let i in evalobj) {\n            context[i] = evalobj[i];\n        }\n    }\n    function returnVariables(evalobj, context, array) {\n        for (let i in array) {\n            let newname = array[i]\n            evalobj[newname] = context[newname];\n            if ([null, undefined].includes(evalobj[newname])) {\n            } else {\n                evalobj[newname] = Math.round(evalobj[newname])\n            }\n        }\n    }\n\n    function evalCondition(logicalEdit, record) {\n        let truth = 'N'\n        var condition = logicalEdit['CONDITION']\n        var columns = logicalEdit['ALL_VARIABLE']\n        columns = columns.replace(/ /g, \"\");\n        var array = columns.split(',')\n        var action_col = logicalEdit['ACTION_VARIABLE']\n        action_col = action_col.replace(/ /g, \"\");\n        var action_array = action_col.split(',')\n        let evalobj = {}\n        for (let i in array) {\n            let newname = array[i]\n            if (!([null, 'null', 'NULL', undefined, 'undefined'].includes(record?.[newname]))) {\n                evalobj[newname] = parseFloat(record[newname])\n            } else {\n                evalobj[newname] = null\n            }\n        }\n        createVariables(evalobj, this);\n        if (condition == 'None') {\n            truth = 'Y'\n        } else {\n            const code = 'if (' + condition + ') {truth = \"Y\"}'\n            try {\n                eval(code)\n            } catch {\n                console.log('Condition Error on: ' + logicalEdit)\n            }\n        }\n        if (truth == 'Y') {\n            const action = logicalEdit['ACTION']\n            try {\n                eval(action)\n            } catch {\n                console.log('Action Error on: ' + logicalEdit)\n            }\n            let num = (action.split(\"=\").length - 1)\n            let string = ''\n            if ((action.split(\"=\").length - 1) >= 1) {\n                for (let i = 1; i <= num; i++) {\n                    if (i == 1) {\n                        string = action.substring(action.indexOf('=')+1)\n                    } else {\n                        string = string.substring(0, string.indexOf(';')) + string.substring(string.indexOf('=') + 1)\n                    }\n                }\n            }\n            let details = []\n            for (let i in evalobj) {\n                let name1 = i\n                if (string.indexOf(name1) != -1) {\n                    details.push(name1 + '_F')\n                }\n            }\n\n\n            returnVariables(evalobj, this, action_array)\n            for (let i in action_array) {\n                let newname = action_array[i]\n                let newname_f = newname + '_F'\n                let flag = logicalEdit['PO Flag']\n                record[newname] = evalobj[newname]\n                if (['L', 'J'].includes(flag)) {\n                    flagRules(newname, details)\n                } else {\n                    record[newname_f] = setCharAt(record?.[newname_f], 2, flag)\n                }\n            }\n        }\n    }\n\n    let naics = record['NAICS_CODE']\n    naics = '' + naics\n\n    const REPORTING_ID_TYP_TXT = record['REPORTING_ID_TYP_TXT']\n    let TAXSTAT = record['TAX_EXEMPT_STAT']\n    let TYPOP_CODE = record['TYPOP_WHSL_OLD_NUM']\n\n\n    var logicalEdits = msg.cache['LOGICAL_EDIT']\n    logicalEdits.sort((a, b) => (a.PRIORITY != null ? a.PRIORITY : Infinity) - (b.PRIORITY != null ? b.PRIORITY : Infinity))\n\n    for (let i in logicalEdits) {\n        let logicalEdit = logicalEdits[i]\n        if (checkNaics(logicalEdit, naics, REPORTING_ID_TYP_TXT, TAXSTAT, TYPOP_CODE)) {\n            evalCondition(logicalEdit, record)\n        }\n    }\n    return msg;\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Logical Edits'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "0fe0c5b4f51e33b6",
        "type": "function",
        "z": "b68b1cdb465a831c",
        "name": "Derived Items function",
        "func": "try{\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n\n    msg.cache = global.get(\"lookupCache\").data.find(\n        item =>\n            item.module === \"derived\" &&\n            item.param === \"derived\" &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    function childFlagRules(variable, details, data, id, idvar) {\n        let allData = data\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                for (let j in allData) {\n                    let row = allData[j]\n                    if (row?.[idvar] == id && row?.TABSTAT == 'Y') {\n                        if (row?.[detail]) {\n                            if (['R_', 'K_', 'T_'].includes(row?.[detail].substring(0, 2))) {\n                                found = 'Y'\n                            } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(row?.[detail]?.charAt(1))) {\n                                found = 'Y'\n                            } else {\n                                found = 'N'\n                                break\n                            }\n                            // } else {\n                            //     found = 'N'\n                            //     break\n                        }\n                    }\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    function checkNaics(data, naics, rec_typ, rec_tax) {\n        let list = data['NAICS']\n        let unit = data['UNIT']\n        let tax = data['Tax Status']\n        let rectyp = rec_typ\n        if (['MU', 'SU', 'Estab', 'ESTAB', 'estab'].includes(rectyp)) {\n            rec_typ = 'Estab'\n        } else if (['KAU', 'kau', 'Kau'].includes(rectyp)) {\n            rec_typ = 'KAU'\n        } else if (['ENT', 'COMPANY', 'Ent', 'ent', 'Company', 'company'].includes(rectyp)) {\n            rec_typ = 'COMPANY'\n        }\n        if ([null, undefined, 'null', 'undefined'].includes(tax)) {\n            rec_tax = tax\n        }\n\n        if (rec_typ === unit && rec_tax === tax) {\n            if ([\"ALL\", \"All\", \"ALL \", \"All \"].includes(list)) {\n                return (true);\n            } else {\n                list = list.replace(/ /g, \"\");\n                list = list.replace(/'/g, \"\");\n                var array = list.split(',')\n\n                if (array.find(r => naics.startsWith(r))) {\n                    return (true);\n                } else {\n                    return (false)\n                }\n            }\n        }\n    }\n\n    function findSum(derivedItem) {\n        let name = derivedItem['DERIVED ITEM']\n        let calculation = derivedItem['CALCULATION']\n        let parent = derivedItem['PARENT']\n        let child = derivedItem['CHILD']\n        var columns = derivedItem['Calc_Columns']\n        columns = columns.replace(/ /g, \"\");\n        var array = columns.split(',')\n        let array_f = []\n        for (let i in array) {\n            array_f.push(array[i] + '_F')\n        }\n        let allData = msg.payload.csv\n\n        if (['KAU', 'kau', 'Kau'].includes(parent) && ['ESTAB', 'estab', 'Estab'].includes(child)) {\n            let id = record?.['KAU_ID']\n            let sum = null\n            for (let i in allData) {\n                let row = allData[i]\n                if (row?.KAU_ID == id && ['MU', 'SU', 'ESTAB', 'Estab', 'estab'].includes(row?.REPORTING_ID_TYP_TXT) && row?.TABSTAT == 'Y') {\n                    if (sum == null) {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = 0\n                        } else {\n                            sum = parseFloat(row?.[calculation])\n                        }\n                    } else {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = parseFloat(sum) + 0\n                        } else {\n                            sum = parseFloat(sum) + parseFloat(row?.[calculation])\n                        }\n                    }\n                }\n            }\n            if (sum != null) {\n                record[name] = sum\n                childFlagRules(name, array_f, allData, id, 'KAU_ID')\n            }\n\n        } else if (['ENT', 'ent', 'Ent', 'COMPANY', 'company', 'Company'].includes(parent) && ['KAU', 'kau', 'Kau'].includes(child)) {\n            let id = record?.['LOGIN_ID']\n            let sum = null\n            for (let i in allData) {\n                let row = allData[i]\n                if (row?.LOGIN_ID == id && ['KAU', 'Kau', 'kau'].includes(row?.REPORTING_ID_TYP_TXT) && row?.TABSTAT == 'Y') {\n                    if (sum == null) {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = 0\n                        } else {\n                            sum = parseFloat(row?.[calculation])\n                        }\n                    } else {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = parseFloat(sum) + 0\n                        } else {\n                            sum = parseFloat(sum) + parseFloat(row?.[calculation])\n                        }\n                    }\n                }\n            }\n            if (sum != null) {\n                record[name] = sum\n                childFlagRules(name, array_f, allData, id, 'LOGIN_ID')\n            }\n        } else if (['ENT', 'ent', 'Ent', 'COMPANY', 'company', 'Company'].includes(parent) && ['ESTAB', 'estab', 'Estab'].includes(child)) {\n            let id = record?.['LOGIN_ID']\n            let sum = null\n            for (let i in allData) {\n                let row = allData[i]\n                if (row?.LOGIN_ID == id && ['MU', 'SU', 'ESTAB', 'Estab', 'estab'].includes(row?.REPORTING_ID_TYP_TXT) && row?.TABSTAT == 'Y') {\n                    if (sum == null) {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = 0\n                        } else {\n                            sum = parseFloat(row?.[calculation])\n                        }\n                    } else {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = parseFloat(sum) + 0\n                        } else {\n                            sum = parseFloat(sum) + parseFloat(row?.[calculation])\n                        }\n                    }\n                }\n            }\n            if (sum != null) {\n                record[name] = sum\n                childFlagRules(name, array_f, allData, id, 'LOGIN_ID')\n            }\n        }\n    }\n\n    function createVariables(evalobj, context) {\n        for (let i in evalobj) {\n            context[i] = parseFloat(evalobj[i]);\n        }\n    }\n    function evalFunction(derivedItem) {\n        let name = derivedItem['DERIVED ITEM']\n        var calculation = derivedItem['CALCULATION']\n        var columns = derivedItem['Calc_Columns']\n        columns = columns.replace(/ /g, \"\");\n        var array = columns.split(',')\n        let evalobj = {}\n        var array_f = []\n        for (let i in array) {\n            let newname = array[i]\n            let newname_f = newname + '_F'\n            array_f.push(newname_f)\n            if (record?.[newname] && !([null, undefined, 'null', 'undefined'].includes(record?.[newname]))) {\n                evalobj[newname] = record[newname]\n            } else {\n                evalobj[newname] = 0\n            }\n        }\n        createVariables(evalobj, this);\n\n        const code = 'record[name] = ' + calculation\n        eval(code)\n        flagRules(name, array_f)\n    }\n\n\n    let naics = record['NAICS_CODE']\n    naics = '' + naics\n\n    const REPORTING_ID_TYP_TXT = record['REPORTING_ID_TYP_TXT']\n    let TAXSTAT = record['TAXSTAT']\n\n    var derivedItems = msg.cache['DERIVED_ITEMS']\n    derivedItems.sort((a, b) => (a.Order != null ? a.Order : Infinity) - (b.Order != null ? b.Order : Infinity))\n\n    for (let i in derivedItems) {\n        let derivedItem = derivedItems[i]\n        if (checkNaics(derivedItem, naics, REPORTING_ID_TYP_TXT, TAXSTAT)) {\n            if (derivedItem['CALC_TYPE'] == 'Sum') {\n                findSum(derivedItem)\n            } else if (derivedItem['CALC_TYPE'] == 'Function') {\n                evalFunction(derivedItem)\n            }\n        }\n    }\n\n    return msg;\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'Derived Items'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "feeab50f0340f263",
        "type": "function",
        "z": "b68b1cdb465a831c",
        "name": "Derived Items function Database",
        "func": "try{\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n\n    msg.cache = global.get(\"lookupCache\").data.find(\n        item =>\n            item.module === \"derived\" &&\n            item.param === \"derived\" &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    function childFlagRules(variable, details, data, id, idvar) {\n        let allData = data\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                for (let j in allData) {\n                    let row = allData[j].facts\n                    if (row?.[idvar] == id && row?.TABSTAT == 'Y') {\n                        if (row?.[detail]) {\n                            if (['R_', 'K_', 'T_'].includes(row?.[detail].substring(0, 2))) {\n                                found = 'Y'\n                            } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(row?.[detail]?.charAt(1))) {\n                                found = 'Y'\n                            } else {\n                                found = 'N'\n                                break\n                            }\n                        // } else {\n                        //     found = 'N'\n                        //     break\n                        }\n                    }\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    function checkNaics(data, naics, rec_typ, rec_tax) {\n        let list = data['NAICS']\n        let unit = data['UNIT']\n        let tax = data['Tax Status']\n        let rectyp = rec_typ\n        if (['MU', 'SU', 'Estab', 'ESTAB', 'estab'].includes(rectyp)) {\n            rec_typ = 'Estab'\n        } else if (['KAU', 'kau', 'Kau'].includes(rectyp)) {\n            rec_typ = 'KAU'\n        } else if (['ENT', 'COMPANY', 'Ent', 'ent', 'Company', 'company'].includes(rectyp)) {\n            rec_typ = 'COMPANY'\n        }\n        if ([null, undefined, 'null', 'undefined'].includes(tax)) {\n            rec_tax = tax\n        }\n\n        if (rec_typ === unit && rec_tax === tax) {\n            if ([\"ALL\", \"All\", \"ALL \", \"All \"].includes(list)) {\n                return (true);\n            } else {\n                list = list.replace(/ /g, \"\");\n                list = list.replace(/'/g, \"\");\n                var array = list.split(',')\n\n                if (array.find(r => naics.startsWith(r))) {\n                    return (true);\n                } else {\n                    return (false)\n                }\n            }\n        }\n    }\n\n    function findSum(derivedItem) {\n        let name = derivedItem['DERIVED ITEM']\n        let calculation = derivedItem['CALCULATION']\n        let parent = derivedItem['PARENT']\n        let child = derivedItem['CHILD']\n        var columns = derivedItem['Calc_Columns']\n        columns = columns.replace(/ /g, \"\");\n        var array = columns.split(',')\n        let array_f = []\n        for (let i in array) {\n            array_f.push(array[i] + '_F')\n        }\n\n        if (['KAU', 'kau', 'Kau'].includes(parent) && ['ESTAB', 'estab', 'Estab'].includes(child)) {\n            let id = record?.['KAU_ID']\n            let sum = null\n            for (let i in msg.estabs) {\n                let row = msg.estabs[i].facts\n                if (row?.KAU_ID == id && ['MU', 'SU', 'ESTAB', 'Estab', 'estab'].includes(row?.REPORTING_ID_TYP_TXT) && row?.TABSTAT == 'Y') {\n                    if (sum == null) {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = 0\n                        } else {\n                            sum = parseFloat(row?.[calculation])\n                        }\n                    } else {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = parseFloat(sum) + 0\n                        } else {\n                            sum = parseFloat(sum) + parseFloat(row?.[calculation])\n                        }\n                    }\n                }\n            }\n            if (sum != null) {\n                record[name] = sum\n                childFlagRules(name, array_f, msg.estabs, id, 'KAU_ID')\n            }\n\n        } else if (['ENT', 'ent', 'Ent', 'COMPANY', 'company', 'Company'].includes(parent) && ['KAU', 'kau', 'Kau'].includes(child)) {\n            let id = record?.['LOGIN_ID']\n            let sum = null\n            for (let i in msg.kaus) {\n                let row = msg.kaus[i].facts\n                if (row?.LOGIN_ID == id && ['KAU', 'Kau', 'kau'].includes(row?.REPORTING_ID_TYP_TXT) && row?.TABSTAT == 'Y') {\n                    if (sum == null) {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = 0\n                        } else {\n                            sum = parseFloat(row?.[calculation])\n                        }\n                    } else {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = parseFloat(sum) + 0\n                        } else {\n                            sum = parseFloat(sum) + parseFloat(row?.[calculation])\n                        }\n                    }\n                }\n            }\n            if (sum != null) {\n                record[name] = sum\n                childFlagRules(name, array_f, msg.kaus, id, 'LOGIN_ID')\n            }\n        } else if (['ENT', 'ent', 'Ent', 'COMPANY', 'company', 'Company'].includes(parent) && ['ESTAB', 'estab', 'Estab'].includes(child)) {\n            let id = record?.['LOGIN_ID']\n            let sum = null\n            for (let i in msg.estabs) {\n                let row = msg.estabs[i].facts\n                if (row?.LOGIN_ID == id && ['MU', 'SU', 'ESTAB', 'Estab', 'estab'].includes(row?.REPORTING_ID_TYP_TXT) && row?.TABSTAT == 'Y') {\n                    if (sum == null) {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = 0\n                        } else {\n                            sum = parseFloat(row?.[calculation])\n                        }\n                    } else {\n                        if ([null, undefined, 'null', 'undefined'].includes(row?.[calculation])) {\n                            sum = parseFloat(sum) + 0\n                        } else {\n                            sum = parseFloat(sum) + parseFloat(row?.[calculation])\n                        }\n                    }\n                }\n            }\n            if (sum != null) {\n                record[name] = sum\n                childFlagRules(name, array_f, msg.estabs, id, 'LOGIN_ID')\n            }\n        }\n    }\n\n    function createVariables(evalobj, context) {\n        for (let i in evalobj) {\n            context[i] = parseFloat(evalobj[i]);\n        }\n    }\n    function evalFunction(derivedItem) {\n        let name = derivedItem['DERIVED ITEM']\n        var calculation = derivedItem['CALCULATION']\n        var columns = derivedItem['Calc_Columns']\n        columns = columns.replace(/ /g, \"\");\n        var array = columns.split(',')\n        let evalobj = {}\n        var array_f = []\n        for (let i in array) {\n            let newname = array[i]\n            let newname_f = newname + '_F'\n            array_f.push(newname_f)\n            if (record?.[newname] && !([null, undefined, 'null', 'undefined'].includes(record?.[newname]))) {\n                evalobj[newname] = record[newname]\n            } else {\n                evalobj[newname] = 0\n            }\n        }\n        createVariables(evalobj, this);\n\n        const code = 'record[name] = ' + calculation\n        eval(code)\n        flagRules(name, array_f)\n    }\n\n\n    let naics = record['NAICS_CODE']\n    naics = '' + naics\n\n    const REPORTING_ID_TYP_TXT = record['REPORTING_ID_TYP_TXT']\n    let TAXSTAT = record['TAXSTAT']\n\n    var derivedItems = msg.cache['DERIVED_ITEMS']\n    derivedItems.sort((a, b) => (a.Order != null ? a.Order : Infinity) - (b.Order != null ? b.Order : Infinity))\n\n    for (let i in derivedItems) {\n        let derivedItem = derivedItems[i]\n        if (checkNaics(derivedItem, naics, REPORTING_ID_TYP_TXT, TAXSTAT)) {\n            if (derivedItem['CALC_TYPE'] == 'Sum') {\n                findSum(derivedItem)\n            } else if (derivedItem['CALC_TYPE'] == 'Function') {\n                evalFunction(derivedItem)\n            }\n        }\n    }\n\n    return msg;\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Derived Items'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "5c265c3d0fb71ea5",
        "type": "function",
        "z": "b68b1cdb465a831c",
        "name": "reset msg",
        "func": "msg.kaus = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 460,
        "wires": [
            [
                "feeab50f0340f263"
            ]
        ]
    },
    {
        "id": "3eefa3fa70d38471",
        "type": "function",
        "z": "b68b1cdb465a831c",
        "name": "query_estabs",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet typ = record.REPORTING_ID_TYP_TXT\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nmsg.pathQuery = 'skip'\nif (['SU','MU'].includes(typ)) {\n    msg.pathQuery = 'skip'\n} else if ('[KAU]'.includes(typ)) {\n    msg.pathQuery = 'KAU'\n    let id = record.KAU_ID\n    msg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where kau_id = '\" + id + \"' and type = 'ESTAB' and jobname = '\" + job + \"';\"\n} else if (['ENT'].includes(typ)) {\n    msg.pathQuery = 'ENT'\n    let id = record.ENT_ID\n    msg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where ent_id = '\" + id + \"' and type = 'ESTAB' and jobname = '\" + job + \"';\"\n} else {\n    msg.pathQuery = 'skip'\n}\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 280,
        "wires": [
            [
                "83a340ff5bc4e3a1"
            ]
        ]
    },
    {
        "id": "de41ba9f1eb24608",
        "type": "subflow:8032608991ae0162",
        "z": "b68b1cdb465a831c",
        "name": "",
        "x": 260,
        "y": 340,
        "wires": [
            [
                "8c299e12681f0642"
            ]
        ]
    },
    {
        "id": "8c299e12681f0642",
        "type": "function",
        "z": "b68b1cdb465a831c",
        "name": "reset_msg",
        "func": "msg.estabs = msg.payload\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 340,
        "wires": [
            [
                "ceca18580420b90f"
            ]
        ]
    },
    {
        "id": "7779c48dbc3c852a",
        "type": "subflow:8032608991ae0162",
        "z": "b68b1cdb465a831c",
        "name": "",
        "x": 460,
        "y": 460,
        "wires": [
            [
                "5c265c3d0fb71ea5"
            ]
        ]
    },
    {
        "id": "83a340ff5bc4e3a1",
        "type": "switch",
        "z": "b68b1cdb465a831c",
        "name": "",
        "property": "pathQuery",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "skip",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 470,
        "y": 280,
        "wires": [
            [
                "feeab50f0340f263"
            ],
            [
                "de41ba9f1eb24608"
            ]
        ]
    },
    {
        "id": "ceca18580420b90f",
        "type": "switch",
        "z": "b68b1cdb465a831c",
        "name": "",
        "property": "pathQuery",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "ENT",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ENT",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 470,
        "y": 400,
        "wires": [
            [
                "feeab50f0340f263"
            ],
            [
                "4ee1a828b7982cd3"
            ]
        ]
    },
    {
        "id": "4ee1a828b7982cd3",
        "type": "function",
        "z": "b68b1cdb465a831c",
        "name": "query_ent kaus",
        "func": "let record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet typ = record.REPORTING_ID_TYP_TXT\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nlet id = record.ENT_ID\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where ent_id = '\" + id + \"' and type = 'KAU' and jobname = '\" + job + \"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 460,
        "wires": [
            [
                "7779c48dbc3c852a"
            ]
        ]
    },
    {
        "id": "8ffe802b67aef5e3",
        "type": "function",
        "z": "4781d07fda613850",
        "name": "EMP_MAR12_NUM",
        "func": "try {\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n\n    const setVariable = (variable, value) => {\n        record[variable] = value;\n    };\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let cache = global.get(\"lookupCache\");\n    let cy_py_factor = cache.data.find(\n        item =>\n            item.module === \"core_4\" &&\n            item.param === 'core_4' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function findCY() {\n        let cy_py = {}\n        for (let i in cy_py_factor['CY_PY_K_FACTORS']) {\n            let cy_py_fact = cy_py_factor['CY_PY_K_FACTORS'][i]\n            if (record.NAICS_CODE.startsWith(cy_py_fact['NAICS_CODE'])) {\n                cy_py = cy_py_fact\n                break;\n            }\n        }\n        return (cy_py);\n    }\n\n    if (record?.['REPORTING_ID_TYP_TXT'] === 'SU') {\n        if (parseFloat(record?.['IRS_EMP_MAR12_NUM']) > 0) {\n            setVariable('EMP_MAR12_NUM', record?.['IRS_EMP_MAR12_NUM']);\n            record['EMP_MAR12_NUM_F'] = setCharAt(record?.['EMP_MAR12_NUM_F'], 2, 'A');\n        }else{\n            if (parseFloat(record?.['EC_EMP_MAR12_NUM']) > 0) {\n                let cy_py = findCY()\n                setVariable('EMP_MAR12_NUM', Math.round(parseFloat(record?.['EC_EMP_MAR12_NUM']) * parseFloat(cy_py.EMPQ1)));\n                record['EMP_MAR12_NUM_F'] = setCharAt(record?.['EMP_MAR12_NUM_F'], 2, 'H');\n            }\n        }\n    } else if (record?.['REPORTING_ID_TYP_TXT'] === 'MU' && parseFloat(record?.['BR_EMP_MAR12_NUM']) > 0) {\n        setVariable('EMP_MAR12_NUM', record?.['BR_EMP_MAR12_NUM']);\n        record['EMP_MAR12_NUM_F'] = setCharAt(record?.['EMP_MAR12_NUM_F'], 2, 'O');\n    } else if (parseFloat(record?.['EC_EMP_MAR12_NUM']) > 0) {\n        let cy_py = findCY()\n        setVariable('EMP_MAR12_NUM', Math.round(parseFloat(record?.['EC_EMP_MAR12_NUM']) * parseFloat(cy_py.EMPQ1)));\n        record['EMP_MAR12_NUM_F'] = setCharAt(record?.['EMP_MAR12_NUM_F'], 2, 'H');\n    }\n\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'EMP_MAR12_NUM'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "ed41e14ea62fdff2",
        "type": "function",
        "z": "4781d07fda613850",
        "name": "EMP_MAR12_NUM_database",
        "func": "try {\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n    let irs = msg.payload.tables.irs.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n    let br = msg.payload.tables.br.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n\n    const setVariable = (variable, value) => {\n        record[variable] = value;\n    };\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let cache = global.get(\"lookupCache\");\n    let cy_py_factor = cache.data.find(\n        item =>\n            item.module === \"core_4\" &&\n            item.param === 'core_4' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function findCY() {\n        let cy_py = {}\n        for (let i in cy_py_factor['CY_PY_K_FACTORS']) {\n            let cy_py_fact = cy_py_factor['CY_PY_K_FACTORS'][i]\n            if (record.NAICS_CODE.startsWith(cy_py_fact['NAICS_CODE'])) {\n                cy_py = cy_py_fact\n                break;\n            }\n        }\n        return (cy_py);\n    }\n\n    if (record?.['REPORTING_ID_TYP_TXT'] === 'SU') {\n        if (parseFloat(irs?.['EMP_MAR12_NUM']) > 0) {\n            setVariable('EMP_MAR12_NUM', irs?.['EMP_MAR12_NUM']);\n            record['EMP_MAR12_NUM_F'] = setCharAt(record?.['EMP_MAR12_NUM_F'], 2, 'A');\n        }else{\n            if (parseFloat(ec?.['EMP_MAR12_NUM']) > 0) {\n                let cy_py = findCY()\n                setVariable('EMP_MAR12_NUM', Math.round(parseFloat(ec?.['EMP_MAR12_NUM']) * parseFloat(cy_py.EMPQ1)));\n                record['EMP_MAR12_NUM_F'] = setCharAt(record?.['EMP_MAR12_NUM_F'], 2, 'H');\n            }\n        }\n    } else if (record?.['REPORTING_ID_TYP_TXT'] === 'MU' && parseFloat(br?.['EMP_MAR12_NUM']) > 0) {\n        setVariable('EMP_MAR12_NUM', br?.['EMP_MAR12_NUM']);\n        record['EMP_MAR12_NUM_F'] = setCharAt(record?.['EMP_MAR12_NUM_F'], 2, 'O');\n    } else if (parseFloat(ec?.['EMP_MAR12_NUM']) > 0) {\n        let cy_py = findCY()\n        setVariable('EMP_MAR12_NUM', Math.round(parseFloat(ec?.['EMP_MAR12_NUM']) * parseFloat(cy_py.EMPQ1)));\n        record['EMP_MAR12_NUM_F'] = setCharAt(record?.['EMP_MAR12_NUM_F'], 2, 'H');\n    }\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'EMP_MAR12_NUM'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "8b5375b4024c9c0b",
        "type": "function",
        "z": "253763f13152858b",
        "name": "pay_qtr1_val",
        "func": "try {\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n\n    const setVariable = (variable, value) => {\n        record[variable] = value;\n    };\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let cache = global.get(\"lookupCache\");\n    let cy_py_factor = cache.data.find(\n        item =>\n            item.module === \"core_4\" &&\n            item.param === 'core_4' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function findCY() {\n        let cy_py = {}\n        for (let i in cy_py_factor['CY_PY_K_FACTORS']) {\n            let cy_py_fact = cy_py_factor['CY_PY_K_FACTORS'][i]\n            if (record.NAICS_CODE.startsWith(cy_py_fact['NAICS_CODE'])) {\n                cy_py = cy_py_fact\n                break;\n            }\n        }\n        return (cy_py);\n    }\n\n\n    if (record?.['REPORTING_ID_TYP_TXT'] === 'SU') {\n        if (parseFloat(record?.['IRS_PAY_QTR1_VAL']) > 0) {\n            setVariable('PAY_QTR1_VAL', record?.['IRS_PAY_QTR1_VAL']);\n            record['PAY_QTR1_VAL_F'] = setCharAt(record['PAY_QTR1_VAL_F'], 2, 'A');\n        } else {\n            if (parseFloat(record?.['EC_PAY_QTR1_VAL']) > 0) {\n                let cy_py = findCY()\n                setVariable('PAY_QTR1_VAL', Math.round(parseFloat(record?.['EC_PAY_QTR1_VAL']) * parseFloat(cy_py.PAYQTR1)));\n                record['PAY_QTR1_VAL_F'] = setCharAt(record?.['PAY_QTR1_VAL_F'], 2, 'H');\n            }\n        }\n    } else if (record?.['REPORTING_ID_TYP_TXT'] === 'MU' && parseFloat(record?.['BR_PAY_QTR1_VAL']) > 0) {\n        setVariable('PAY_QTR1_VAL', record?.['BR_PAY_QTR1_VAL']);\n        record['PAY_QTR1_VAL_F'] = setCharAt(record?.['PAY_QTR1_VAL_F'], 2, 'O');\n    } else if (parseFloat(record?.['EC_PAY_QTR1_VAL']) > 0) {\n        let cy_py = findCY()\n        setVariable('PAY_QTR1_VAL', Math.round(parseFloat(record?.['EC_PAY_QTR1_VAL']) * parseFloat(cy_py.PAYQTR1)));\n        record['PAY_QTR1_VAL_F'] = setCharAt(record['PAY_QTR1_VAL_F'], 2, 'H');\n    }\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'PAY_QTR1_VAL'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "37c1a5ff5ac2724a",
        "type": "function",
        "z": "253763f13152858b",
        "name": "pay_qtr1_val_database",
        "func": "try {\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n    let irs = msg.payload.tables.irs.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n    let br = msg.payload.tables.br.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    const setVariable = (variable, value) => {\n        record[variable] = value;\n    };\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let cache = global.get(\"lookupCache\");\n    let cy_py_factor = cache.data.find(\n        item =>\n            item.module === \"core_4\" &&\n            item.param === 'core_4' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function findCY() {\n        let cy_py = {}\n        for (let i in cy_py_factor['CY_PY_K_FACTORS']) {\n            let cy_py_fact = cy_py_factor['CY_PY_K_FACTORS'][i]\n            if (record.NAICS_CODE.startsWith(cy_py_fact['NAICS_CODE'])) {\n                cy_py = cy_py_fact\n                break;\n            }\n        }\n        return (cy_py);\n    }\n\n\n    if (record?.['REPORTING_ID_TYP_TXT'] === 'SU') {\n        if (parseFloat(irs?.['PAY_QTR1_VAL']) > 0) {\n            setVariable('PAY_QTR1_VAL', irs?.['PAY_QTR1_VAL']);\n            record['PAY_QTR1_VAL_F'] = setCharAt(record['PAY_QTR1_VAL_F'], 2, 'A');\n        } else {\n            if (parseFloat(ec?.['PAY_QTR1_VAL']) > 0) {\n                let cy_py = findCY()\n                setVariable('PAY_QTR1_VAL', Math.round(parseFloat(ec?.['PAY_QTR1_VAL']) * parseFloat(cy_py.PAYQTR1)));\n                record['PAY_QTR1_VAL_F'] = setCharAt(record?.['PAY_QTR1_VAL_F'], 2, 'H');\n            }\n        }\n    } else if (record?.['REPORTING_ID_TYP_TXT'] === 'MU' && parseFloat(br?.['PAY_QTR1_VAL']) > 0) {\n        setVariable('PAY_QTR1_VAL', br?.['PAY_QTR1_VAL']);\n        record['PAY_QTR1_VAL_F'] = setCharAt(record?.['PAY_QTR1_VAL_F'], 2, 'O');\n    } else if (parseFloat(ec?.['PAY_QTR1_VAL']) > 0) {\n        let cy_py = findCY()\n        setVariable('PAY_QTR1_VAL', Math.round(parseFloat(ec?.['PAY_QTR1_VAL']) * parseFloat(cy_py.PAYQTR1)));\n        record['PAY_QTR1_VAL_F'] = setCharAt(record['PAY_QTR1_VAL_F'], 2, 'H');\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'PAY_QTR1_VAL'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "9cd4f165207e607e",
        "type": "function",
        "z": "7c71f52633d8c794",
        "name": "rcpt_tot_val",
        "func": "try {\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n\n    let cache = global.get(\"lookupCache\");\n    let cy_py_factor = cache.data.find(\n        item =>\n            item.module === \"core_4\" &&\n            item.param === 'core_4' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function findCY() {\n        let cy_py = {}\n        for (let i in cy_py_factor['CY_PY_K_FACTORS']) {\n            let cy_py_fact = cy_py_factor['CY_PY_K_FACTORS'][i]\n            if (record.NAICS_CODE.startsWith(cy_py_fact['NAICS_CODE'])) {\n                cy_py = cy_py_fact\n                break;\n            }\n        }\n        return (cy_py);\n    }\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    if (record?.NAICS_SECTOR == '31' && record?.COV_CHG_CODE == '401') {\n        if (record?.RCPT_TOT_VAL == 0 || !(record?.RCPT_TOT_VAL)) {\n        }\n    } else if (record?.NAICS_SECTOR == '31' && record?.NAPCS_BLTOT > 0) {\n        record['RCPT_TOT_VAL'] = record?.NAPCS_BLTOT;\n        record['RCPT_TOT_VAL_F'] = setCharAt(record['RCPT_TOT_VAL_F'], 2, 'Y');\n    } else if (record?.REPORTING_ID_TYP_TXT === 'SU' && parseFloat(record?.RCPT_TOT_ADMN_DVAL) > 0) {\n        record['RCPT_TOT_VAL'] = record?.RCPT_TOT_ADMN_DVAL;\n        record['RCPT_TOT_VAL_F'] = setCharAt(record['RCPT_TOT_VAL_F'], 2, 'A');\n    } else if (record?.EC_RCPT_TOT_VAL > 0) {\n        let cy_py = findCY()\n        record['RCPT_TOT_VAL'] = Math.round(parseFloat(record?.EC_RCPT_TOT_VAL) * parseFloat(cy_py.RCPTOT));\n        record['RCPT_TOT_VAL_F'] = setCharAt(record['RCPT_TOT_VAL_F'], 2, 'H');\n    }\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'RCPT_TOT_VAL'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "698b158f50631fa6",
        "type": "function",
        "z": "7c71f52633d8c794",
        "name": "rcpt_tot_val_database",
        "func": "try {\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    let cache = global.get(\"lookupCache\");\n    let cy_py_factor = cache.data.find(\n        item =>\n            item.module === \"core_4\" &&\n            item.param === 'core_4' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function findCY() {\n        let cy_py = {}\n        for (let i in cy_py_factor['CY_PY_K_FACTORS']) {\n            let cy_py_fact = cy_py_factor['CY_PY_K_FACTORS'][i]\n            if (record.NAICS_CODE.startsWith(cy_py_fact['NAICS_CODE'])) {\n                cy_py = cy_py_fact\n                break;\n            }\n        }\n        return (cy_py);\n    }\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    if (record?.NAICS_SECTOR == '31' && record?.COV_CHG_CODE == '401') {\n        if (record?.RCPT_TOT_VAL == 0 || !(record?.RCPT_TOT_VAL)) {\n        }\n    } else if (record?.NAICS_SECTOR == '31' && record?.NAPCS_BLTOT > 0) {\n        record['RCPT_TOT_VAL'] = record?.NAPCS_BLTOT;\n        record['RCPT_TOT_VAL_F'] = setCharAt(record['RCPT_TOT_VAL_F'], 2, 'Y');\n    } else if (record?.REPORTING_ID_TYP_TXT === 'SU' && parseFloat(record?.RCPT_TOT_ADMN_DVAL) > 0) {\n        record['RCPT_TOT_VAL'] = record?.RCPT_TOT_ADMN_DVAL;\n        record['RCPT_TOT_VAL_F'] = setCharAt(record['RCPT_TOT_VAL_F'], 2, 'A');\n    } else if (ec.RCPT_TOT_VAL > 0) {\n        let cy_py = findCY()\n        record['RCPT_TOT_VAL'] = Math.round(parseFloat(ec.RCPT_TOT_VAL) * parseFloat(cy_py.RCPTOT));\n        record['RCPT_TOT_VAL_F'] = setCharAt(record['RCPT_TOT_VAL_F'], 2, 'H');\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'RCPT_TOT_VAL'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "32987fccfff7af52",
        "type": "function",
        "z": "27c40a87c581e266",
        "name": "pay_ann_val",
        "func": "try {\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n\n    // Set function\n    const setVariable = (variable, value) => {\n        record[variable] = value;\n    };\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n    let cache = global.get(\"lookupCache\");\n    let cy_py_factor = cache.data.find(\n        item =>\n            item.module === \"core_4\" &&\n            item.param === 'core_4' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function findCY() {\n        let cy_py = {}\n        for (let i in cy_py_factor['CY_PY_K_FACTORS']) {\n            let cy_py_fact = cy_py_factor['CY_PY_K_FACTORS'][i]\n            if (record.NAICS_CODE.startsWith(cy_py_fact['NAICS_CODE'])) {\n                cy_py = cy_py_fact\n                break;\n            }\n        }\n        return (cy_py);\n    }\n\n    const setVals = () => {\n        setVariable('PAY_QTR1_VAL', 0);\n        record['PAY_QTR1_VAL_F'] = setCharAt(record['PAY_QTR1_VAL_F'], 1, 'G');\n        setVariable('EMP_MAR12_NUM', 0);\n        record['EMP_MAR12_NUM_F'] = setCharAt(record['EMP_MAR12_NUM_F'], 1, 'G');\n        setVariable('EXIMP', 'E');\n        setVariable('Referral_Flag', 'LEASED_ONLY');\n    }\n    global.set('action','')\n\n    if (record?.REPORTING_ID_TYP_TXT == 'SU' && parseFloat(record?.IRS_PAY_ANN_VAL) > 0) {\n        setVariable('PAY_ANN_VAL', record?.IRS_PAY_ANN_VAL);\n        record['PAY_ANN_VAL_F'] = setCharAt(record['PAY_ANN_VAL_F'], 2, 'A');\n    } else if (record?.REPORTING_ID_TYP_TXT == 'MU' && parseFloat(record?.BR_PAY_ANN_VAL) > 0) {\n        setVariable('PAY_ANN_VAL', record?.BR_PAY_ANN_VAL);\n        record['PAY_ANN_VAL_F'] = setCharAt(record['PAY_ANN_VAL_F'], 2, 'O');\n    } else if (parseFloat(record?.BR_PAY_ANN_LSD_VAL) > 0) {\n        setVariable('PAY_ANN_VAL', record?.BR_PAY_ANN_LSD_VAL);\n        record['PAY_ANN_VAL_F'] = setCharAt(record['PAY_ANN_VAL_F'], 2, 'O');\n        setVals()\n    } else if (parseFloat(record?.EXPS_TEMPSTAF_VAL) > 0) {\n        setVariable('PAY_ANN_VAL', record?.EXPS_TEMPSTAF_VAL);\n        flagRules('PAY_ANN_VAL', ['EXPS_TEMPSTAF_VAL_F'])\n        setVals()\n    } else if (parseFloat(record?.EC_PAY_ANN_VAL) > 0) {\n        let cy_py = findCY()\n        setVariable('PAY_ANN_VAL', Math.round(parseFloat(record?.EC_PAY_ANN_VAL) * parseFloat(cy_py.PAYANN)));\n        record['PAY_ANN_VAL_F'] = setCharAt(record['PAY_ANN_VAL_F'], 2, 'H');\n    } else {\n        setVariable('TABSTAT', 'N')\n        setVariable('NONTABFL', 'N')\n        if (parseFloat(record?.RCPT_TOT_VAL) > 0 && record?.RCPT_TOT_VAL_F?.charAt(0) == 'R') {\n            setVariable('Referral_Flag', 'NO_PAYROLL_W_RECEIPTS')\n        }\n        setVariable('ACTION', 'EXIT EDIT')\n        global.set('action','Exit Edit')\n    }\n\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'PAY_ANN_VAL'\n    return msg;\n}\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "b76253c6ef1f5b92",
        "type": "function",
        "z": "27c40a87c581e266",
        "name": "pay_ann_val_database",
        "func": "try {\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n    let irs = msg.payload.tables.irs.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n    let br = msg.payload.tables.br.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    // Set function\n    const setVariable = (variable, value) => {\n        record[variable] = value;\n    };\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    function flagRules(variable, details) {\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n    let cache = global.get(\"lookupCache\");\n    let cy_py_factor = cache.data.find(\n        item =>\n            item.module === \"core_4\" &&\n            item.param === 'core_4' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function findCY() {\n        let cy_py = {}\n        for (let i in cy_py_factor['CY_PY_K_FACTORS']) {\n            let cy_py_fact = cy_py_factor['CY_PY_K_FACTORS'][i]\n            if (record.NAICS_CODE.startsWith(cy_py_fact['NAICS_CODE'])) {\n                cy_py = cy_py_fact\n                break;\n            }\n        }\n        return (cy_py);\n    }\n\n    const setVals = () => {\n        setVariable('PAY_QTR1_VAL', 0);\n        record['PAY_QTR1_VAL_F'] = setCharAt(record['PAY_QTR1_VAL_F'], 1, 'G');\n        setVariable('EMP_MAR12_NUM', 0);\n        record['EMP_MAR12_NUM_F'] = setCharAt(record['EMP_MAR12_NUM_F'], 1, 'G');\n        setVariable('EXIMP', 'E');\n        setVariable('Referral_Flag', 'LEASED_ONLY');\n    }\n    msg.action=''\n\n    if (record?.REPORTING_ID_TYP_TXT == 'SU' && parseFloat(irs?.PAY_ANN_VAL) > 0) {\n        setVariable('PAY_ANN_VAL', irs?.PAY_ANN_VAL);\n        record['PAY_ANN_VAL_F'] = setCharAt(record['PAY_ANN_VAL_F'], 2, 'A');\n    } else if (record?.REPORTING_ID_TYP_TXT == 'MU' && parseFloat(br?.PAY_ANN_VAL) > 0) {\n        setVariable('PAY_ANN_VAL', br?.PAY_ANN_VAL);\n        record['PAY_ANN_VAL_F'] = setCharAt(record['PAY_ANN_VAL_F'], 2, 'O');\n    } else if (parseFloat(br?.PAY_ANN_LSD_VAL) > 0) {\n        setVariable('PAY_ANN_VAL', br?.PAY_ANN_LSD_VAL);\n        record['PAY_ANN_VAL_F'] = setCharAt(record['PAY_ANN_VAL_F'], 2, 'O');\n        setVals()\n    } else if (parseFloat(record?.EXPS_TEMPSTAF_VAL) > 0) {\n        setVariable('PAY_ANN_VAL', record?.EXPS_TEMPSTAF_VAL);\n        flagRules('PAY_ANN_VAL', ['EXPS_TEMPSTAF_VAL_F'])\n        setVals()\n    } else if (parseFloat(ec?.PAY_ANN_VAL) > 0) {\n        let cy_py = findCY()\n        setVariable('PAY_ANN_VAL', Math.round(parseFloat(ec?.PAY_ANN_VAL) * parseFloat(cy_py.PAYANN)));\n        record['PAY_ANN_VAL_F'] = setCharAt(record['PAY_ANN_VAL_F'], 2, 'H');\n    } else {\n        setVariable('TABSTAT', 'N')\n        setVariable('NONTABFL', 'N')\n        if (parseFloat(record?.RCPT_TOT_VAL) > 0 && record?.RCPT_TOT_VAL_F?.charAt(0) == 'R') {\n            setVariable('Referral_Flag', 'NO_PAYROLL_W_RECEIPTS')\n        }\n        msg.action = 'Exit Edit'\n    }\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'PAY_ANN_VAL'\n    return msg;\n}\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "44cfe99b5f9e273f",
        "type": "function",
        "z": "89f071f1deb9a1b1",
        "name": "Completeness",
        "func": "try{\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n    let cache = global.get(\"lookupCache\");\n\n    let kau_totals = cache.data.find(\n        item =>\n            item.module === \"kau_total_details\" &&\n            item.param === 'kau_total_details' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    let kau_total_details = kau_totals.KAU_TOTAL_DETAILS\n    const filteredByTotal = kau_total_details.filter(obj => obj['TOTAL'] === 'X')\n    //iterate kau_total_details, check check the NAICs code and variable\n    var list = []\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    if (record?.REPORTING_ID_TYP_TXT === 'KAU') {\n        const naicsCode = record?.NAICS_CODE //set to 221112\n        const matchingEntries = filteredByTotal.filter(entry => {\n            const codesArray = entry.NAICS_CODE.split(','); //creates an array of all the however many digit NAICS_codes from parameter\n            return codesArray.some(code =>  naicsCode.startsWith(code)); //iterates the array and checks if any numbers start with 22, takes all those objects into new array\n        });\n\n        const variables = matchingEntries.map(entry => entry.Variable); //iterates matchingEntries and extracts all the variables.\n        const avoidFlags = ['G', 'Z'] //can add forbidden flag letters\n\n        for (let ele of variables) {\n            //ele = each individual variable\n            let eleValue = record?.[ele]; //access the record for given variable\n            let eleFlag = record?.[ele + \"_F\"] //access the flag for given variable\n            // Check if eleValue is 0, undefined, or null and eleFlag's second character is not \"G\" or \"Z\"\n            if ((parseFloat(eleValue) == 0 || eleValue === undefined || eleValue === null) && !avoidFlags.includes(eleFlag?.charAt(1))) {\n                eleFlag = setCharAt(eleFlag, 2, 'X')\n                record[ele + \"_F\"] = eleFlag\n            }\n        }\n    }\n\n    if (['SU','MU'].includes(record?.REPORTING_ID_TYP_TXT)) {\n        //put check in here\n\n        if (parseFloat(record?.PAY_ANN_VAL) > 0 || record?.PAY_ANN_VAL_F?.charAt(1) == 'G' || record?.PAY_ANN_VAL_F?.charAt(2) == 'Z') {\n        } else {\n            list.push('PAY_ANN_VAL')\n            // call pay_ann\n        }\n        if ((parseFloat(record?.PAY_QTR1_VAL) > 0) || (['G','Z'].includes(record?.PAY_QTR1_VAL_F?.charAt(1)))) {\n        } else {\n            list.push('PAY_QTR1_VAL')\n            // call pay_qtr1\n        }\n        if (parseFloat(record?.EMP_MAR12_NUM) > 0 || ['G', 'Z'].includes(record?.EMP_MAR_12_NUM_F?.charAt(1))) {\n        } else {\n            list.push('EMP_MAR12_NUM')\n            // call emp\n        }\n        if (parseFloat(record?.RCPT_TOT_VAL) > 0 || ['G', 'Z'].includes(record?.RCPT_TOT_VAL_F?.charAt(1)) || (parseFloat(record?.RCPT_TOT_VAL < 0) && record?.RCPT_TOT_VAL_F?.charAt(1) == 'G')) {\n        } else {\n            list.push('RCPT_TOT_VAL')\n            // call rcpt_tot\n        }\n    } \n    record.ACTION = 'Go To Main Routing'\n    global.set('completeness',list)\n    \n\n    return msg;\n}catch(e){\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'Completeness'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 240,
        "wires": [
            [
                "4714c577aefc14d1"
            ]
        ]
    },
    {
        "id": "14faa784647a76d7",
        "type": "switch",
        "z": "89f071f1deb9a1b1",
        "name": "",
        "property": "completeness",
        "propertyType": "global",
        "rules": [
            {
                "t": "cont",
                "v": "PAY_ANN_VAL",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1370,
        "y": 300,
        "wires": [
            [
                "df2c04daaf41cfe9"
            ],
            [
                "d5608bc7b22bbd86"
            ]
        ]
    },
    {
        "id": "df2c04daaf41cfe9",
        "type": "subflow:27c40a87c581e266",
        "z": "89f071f1deb9a1b1",
        "name": "",
        "x": 1560,
        "y": 280,
        "wires": [
            [
                "cb75b2a1c3d302c2"
            ]
        ]
    },
    {
        "id": "8d172b24625dc196",
        "type": "subflow:7c71f52633d8c794",
        "z": "89f071f1deb9a1b1",
        "name": "",
        "x": 1970,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "2c1c1d2268bfe5f8",
        "type": "subflow:253763f13152858b",
        "z": "89f071f1deb9a1b1",
        "name": "",
        "x": 1570,
        "y": 400,
        "wires": [
            [
                "2ff2c2898d08dd1b"
            ]
        ]
    },
    {
        "id": "e11ca2f83d0c6ec8",
        "type": "subflow:4781d07fda613850",
        "z": "89f071f1deb9a1b1",
        "name": "",
        "x": 1580,
        "y": 480,
        "wires": [
            [
                "16fe085358f3d589"
            ]
        ]
    },
    {
        "id": "d5608bc7b22bbd86",
        "type": "switch",
        "z": "89f071f1deb9a1b1",
        "name": "",
        "property": "completeness",
        "propertyType": "global",
        "rules": [
            {
                "t": "cont",
                "v": "PAY_QTR1_VAL",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1370,
        "y": 400,
        "wires": [
            [
                "2c1c1d2268bfe5f8"
            ],
            [
                "79716909567e3e73"
            ]
        ]
    },
    {
        "id": "79716909567e3e73",
        "type": "switch",
        "z": "89f071f1deb9a1b1",
        "name": "",
        "property": "completeness",
        "propertyType": "global",
        "rules": [
            {
                "t": "cont",
                "v": "EMP_MAR12_NUM",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1370,
        "y": 480,
        "wires": [
            [
                "e11ca2f83d0c6ec8"
            ],
            [
                "917c64f63bd2f19c"
            ]
        ]
    },
    {
        "id": "917c64f63bd2f19c",
        "type": "switch",
        "z": "89f071f1deb9a1b1",
        "name": "",
        "property": "completeness",
        "propertyType": "global",
        "rules": [
            {
                "t": "cont",
                "v": "RCPT_TOT_VAL",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1730,
        "y": 580,
        "wires": [
            [
                "8d172b24625dc196"
            ],
            []
        ]
    },
    {
        "id": "cb75b2a1c3d302c2",
        "type": "switch",
        "z": "89f071f1deb9a1b1",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1790,
        "y": 280,
        "wires": [
            [],
            [
                "b0dd9d17962e9f8a"
            ]
        ]
    },
    {
        "id": "4714c577aefc14d1",
        "type": "switch",
        "z": "89f071f1deb9a1b1",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1180,
        "y": 240,
        "wires": [
            [],
            [
                "14faa784647a76d7"
            ]
        ]
    },
    {
        "id": "b0dd9d17962e9f8a",
        "type": "switch",
        "z": "89f071f1deb9a1b1",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1800,
        "y": 340,
        "wires": [
            [],
            [
                "d5608bc7b22bbd86"
            ]
        ]
    },
    {
        "id": "2ff2c2898d08dd1b",
        "type": "switch",
        "z": "89f071f1deb9a1b1",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1786.3035888671875,
        "y": 404.0357360839844,
        "wires": [
            [],
            [
                "79716909567e3e73"
            ]
        ]
    },
    {
        "id": "16fe085358f3d589",
        "type": "switch",
        "z": "89f071f1deb9a1b1",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1780,
        "y": 480,
        "wires": [
            [],
            [
                "917c64f63bd2f19c"
            ]
        ]
    },
    {
        "id": "3d3c9e217d8878ca",
        "type": "function",
        "z": "89f071f1deb9a1b1",
        "name": "Completeness database",
        "func": "try{\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n    let cache = global.get(\"lookupCache\");\n\n    let kau_totals = cache.data.find(\n        item =>\n            item.module === \"kau_total_details\" &&\n            item.param === 'kau_total_details' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    let kau_total_details = kau_totals.KAU_TOTAL_DETAILS\n    const filteredByTotal = kau_total_details.filter(obj => obj['TOTAL'] === 'X')\n    //iterate kau_total_details, check check the NAICs code and variable\n    var list = []\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    if (record?.REPORTING_ID_TYP_TXT === 'KAU') {\n        const naicsCode = record?.NAICS_CODE //set to 221112\n        const matchingEntries = filteredByTotal.filter(entry => {\n            const codesArray = entry.NAICS_CODE.split(','); //creates an array of all the however many digit NAICS_codes from parameter\n            return codesArray.some(code =>  naicsCode.startsWith(code)); //iterates the array and checks if any numbers start with 22, takes all those objects into new array\n        });\n\n        const variables = matchingEntries.map(entry => entry.Variable); //iterates matchingEntries and extracts all the variables.\n        const avoidFlags = ['G', 'Z'] //can add forbidden flag letters\n\n        for (let ele of variables) {\n            //ele = each individual variable\n            let eleValue = record?.[ele]; //access the record for given variable\n            let eleFlag = record?.[ele + \"_F\"] //access the flag for given variable\n            // Check if eleValue is 0, undefined, or null and eleFlag's second character is not \"G\" or \"Z\"\n            if ((parseFloat(eleValue) == 0 || eleValue === undefined || eleValue === null) && !avoidFlags.includes(eleFlag?.charAt(1))) {\n                eleFlag = setCharAt(eleFlag, 2, 'X')\n                record[ele + \"_F\"] = eleFlag\n            }\n        }\n    }\n\n    if (['SU','MU'].includes(record?.REPORTING_ID_TYP_TXT)) {\n        //put check in here\n\n        if (parseFloat(record?.PAY_ANN_VAL) > 0 || record?.PAY_ANN_VAL_F?.charAt(1) == 'G' || record?.PAY_ANN_VAL_F?.charAt(2) == 'Z') {\n        } else {\n            list.push('PAY_ANN_VAL')\n            // call pay_ann\n        }\n        if ((parseFloat(record?.PAY_QTR1_VAL) > 0) || (['G','Z'].includes(record?.PAY_QTR1_VAL_F?.charAt(1)))) {\n        } else {\n            list.push('PAY_QTR1_VAL')\n            // call pay_qtr1\n        }\n        if (parseFloat(record?.EMP_MAR12_NUM) > 0 || ['G', 'Z'].includes(record?.EMP_MAR_12_NUM_F?.charAt(1))) {\n        } else {\n            list.push('EMP_MAR12_NUM')\n            // call emp\n        }\n        if (parseFloat(record?.RCPT_TOT_VAL) > 0 || ['G', 'Z'].includes(record?.RCPT_TOT_VAL_F?.charAt(1)) || (parseFloat(record?.RCPT_TOT_VAL < 0) && record?.RCPT_TOT_VAL_F?.charAt(1) == 'G')) {\n        } else {\n            list.push('RCPT_TOT_VAL')\n            // call rcpt_tot\n        }\n    } \n    msg.completeness=list\n    \n\n    return msg;\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Completeness'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "0a9f67e1bc33b824",
        "type": "function",
        "z": "bfe1ab19e0cbe2cf",
        "name": "classification function",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n    let cache = global.get(\"lookupCache\");\n\n    function setFlagAndExit(referralFlagValue) {\n        record.TABSTAT = \"N\";\n        record.NONTABFL = \"R\";\n        record.ACTION = \"Exit Edit\";\n        global.set('action', \"Exit Edit\")\n        record.REFERRAL_FLAG = referralFlagValue;\n    }\n\n    function checkNaicsValidation(naics) {\n        const naicsValidationData = cache.data.find(\n            item =>\n                item.module === \"classification\" &&\n                item.param === 'naics_validation' &&\n                item.program === \"aies\" &&\n                item.unit_type === \"estab\"\n        )?.json_values;\n\n        let Found = 'N'\n        if (naicsValidationData['col_0'].find(r => naics.startsWith(r))) {\n            Found = 'Y'\n        } else if (naicsValidationData['col_1'].find(r => naics.startsWith(r))) {\n            Found = 'Y'\n        } else if (naicsValidationData['col_2'].find(r => naics.startsWith(r))) {\n            Found = 'Y'\n        } else if (naicsValidationData['col_3'].find(r => naics.startsWith(r))) {\n            Found = 'Y'\n        }\n        return (Found);\n    }\n\n    function typcheck(typ) {\n        if ([\"MU\", \"SU\"].includes(typ)) {\n            setFlagAndExit(\"Invalid_NAICS_ESTAB\")\n        } else {\n            setFlagAndExit(\"Invalid_NAICS_KAU\")\n        }\n    }\n\n    if ([\"MU\", \"SU\", \"KAU\"].includes(record?.REPORTING_ID_TYP_TXT)) {\n        if (record.NAICS_CODE && record.NAICS_CODE.length == 8) {\n            if (checkNaicsValidation(record?.NAICS_CODE) == 'Y') {\n                record.ACTION = \"Go to Derive NAICS Code Module\"\n                global.set('action', \"Go to: Derive NAICS Code Module\")\n            } else {\n                typcheck(record?.REPORTING_ID_TYP_TXT)\n            }\n        } else {\n            typcheck(record?.REPORTING_ID_TYP_TXT)\n        }\n    } else {\n        record.ACTION = \"Error - Record should not have entered this module\";\n        global.set('action', \"Error - Record should not have entered this module\")\n    }\n    return msg;\n} catch (e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'Classification'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "920e8921c935b3c8",
        "type": "function",
        "z": "bfe1ab19e0cbe2cf",
        "name": "classification function database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    let cache = global.get(\"lookupCache\");\n\n    function setFlagAndExit(referralFlagValue) {\n        record.TABSTAT = \"N\";\n        record.NONTABFL = \"R\";\n        msg.action = \"Exit Edit\"\n        record.REFERRAL_FLAG = referralFlagValue;\n    }\n\n    function checkNaicsValidation(naics) {\n        const naicsValidationData = cache.data.find(\n            item =>\n                item.module === \"classification\" &&\n                item.param === 'naics_validation' &&\n                item.program === \"aies\" &&\n                item.unit_type === \"estab\"\n        )?.json_values;\n\n        let Found = 'N'\n        if (naicsValidationData['col_0'].find(r => naics.startsWith(r))) {\n            Found = 'Y'\n        } else if (naicsValidationData['col_1'].find(r => naics.startsWith(r))) {\n            Found = 'Y'\n        } else if (naicsValidationData['col_2'].find(r => naics.startsWith(r))) {\n            Found = 'Y'\n        } else if (naicsValidationData['col_3'].find(r => naics.startsWith(r))) {\n            Found = 'Y'\n        }\n        return (Found);\n    }\n\n    function typcheck(typ) {\n        if ([\"MU\", \"SU\"].includes(typ)) {\n            setFlagAndExit(\"Invalid_NAICS_ESTAB\")\n        } else {\n            setFlagAndExit(\"Invalid_NAICS_KAU\")\n        }\n    }\n\n    if ([\"MU\", \"SU\", \"KAU\"].includes(record?.REPORTING_ID_TYP_TXT)) {\n        if (record.NAICS_CODE && record.NAICS_CODE.length == 8) {\n            if (checkNaicsValidation(record?.NAICS_CODE) == 'Y') {\n                msg.action = \"Go to: Derive NAICS Code Module\"\n            } else {\n                typcheck(record?.REPORTING_ID_TYP_TXT)\n            }\n        } else {\n            typcheck(record?.REPORTING_ID_TYP_TXT)\n        }\n    } else {\n        msg.action = \"Exit Edit\"\n    }\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Classification'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "dd9091221ca2c1cf",
        "type": "function",
        "z": "c79b244779411ead",
        "name": "Valid Negative Link",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx]\n    let cache = global.get(\"lookupCache\");\n\n    let valid_negative_file = cache.data.find(\n        item =>\n            item.module === \"valid_negative\" &&\n            item.param === 'valid_negative_value' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    \n\n    function isNegative(naics, column, type, tax) {\n        if (valid_negative_file.VALID_NEGATIVE.some(element =>\n        (element.LEVEL === type &&\n            [null, undefined, tax].includes(element.TAX_EXEMPT_STAT) &&\n            element.ITEM === column &&\n            ((['ALL', 'all', 'All', '', null, undefined].includes(element.NAICS)) || \n            (naics.startsWith(element.NAICS)))))) {\n                \n            if (['ESTAB', 'KAU'].includes(type)) {\n                record['EXIMP'] = 'E'\n            }\n        } else {\n            record[column] = 0\n            if (column == 'RCPT_TOT_VAL') {\n                let column_f = column + '_F'\n                record[column_f] = setCharAt(record?.[column_f], 2, 'G')\n            } else {\n                let column_f = column + '_F'\n                record[column_f] = setCharAt(record?.[column_f], 2, 'Z')\n            }\n        }\n    }\n\n    let type = ''\n    if (['MU', 'SU'].includes(record['REPORTING_ID_TYP_TXT'])) {\n        type = 'ESTAB'\n    } else if (['KAU'].includes(record['REPORTING_ID_TYP_TXT'])) {\n        type = 'KAU'\n    } else if (['ENT'].includes(record['REPORTING_ID_TYP_TXT'])) {\n        type = 'COMPANY'\n    }\n\n    let naics = '' + record['NAICS_CODE']\n    let tax = record['TAXSTAT']\n\n    if ([null, undefined, 'null', 'undefined', ''].includes(tax)) {\n        tax = null\n    }\n\n    for (var key in record) {\n        if (parseFloat(record[key]) < 0) {\n            isNegative(naics, key, type, tax)\n        }\n    }\n\n    record['ACTION'] = 'Go to Main Routing'\n    // global.set('action','Go to Main Routing')\n    return msg;\n}catch(e){\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'Valid Negative'\n    return msg;\n}\n\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "1efda6edf1288beb",
        "type": "function",
        "z": "c79b244779411ead",
        "name": "Valid Negative Database",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx]\n    let cache = global.get(\"lookupCache\");\n\n    let valid_negative_file = cache.data.find(\n        item =>\n            item.module === \"valid_negative\" &&\n            item.param === 'valid_negative_value' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    \n\n    function isNegative(naics, column, type, tax) {\n        if (valid_negative_file.VALID_NEGATIVE.some(element =>\n        (element.LEVEL === type &&\n            [null, undefined, tax].includes(element.TAX_EXEMPT_STAT) &&\n            element.ITEM === column &&\n            ((['ALL', 'all', 'All', '', null, undefined].includes(element.NAICS)) || \n            (naics.startsWith(element.NAICS)))))) {\n                \n            if (['ESTAB', 'KAU'].includes(type)) {\n                record['EXIMP'] = 'E'\n            }\n        } else {\n            record[column] = 0\n            if (column == 'RCPT_TOT_VAL') {\n                let column_f = column + '_F'\n                record[column_f] = setCharAt(record?.[column_f], 2, 'G')\n            } else {\n                let column_f = column + '_F'\n                record[column_f] = setCharAt(record?.[column_f], 2, 'Z')\n            }\n        }\n    }\n\n    let type = ''\n    if (['MU', 'SU'].includes(record['REPORTING_ID_TYP_TXT'])) {\n        type = 'ESTAB'\n    } else if (['KAU'].includes(record['REPORTING_ID_TYP_TXT'])) {\n        type = 'KAU'\n    } else if (['ENT'].includes(record['REPORTING_ID_TYP_TXT'])) {\n        type = 'COMPANY'\n    }\n\n    let naics = '' + record['NAICS_CODE']\n    let tax = record['TAXSTAT']\n\n    if ([null, undefined, 'null', 'undefined', ''].includes(tax)) {\n        tax = null\n    }\n\n    for (var key in record) {\n        if (parseFloat(record[key]) < 0) {\n            isNegative(naics, key, type, tax)\n        }\n    }\n\n    return msg;\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Valid Negative'\n    return msg;\n}\n\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 813.3472290039062,
        "y": 107.8055648803711,
        "wires": [
            []
        ]
    },
    {
        "id": "7af8a7f283b27373",
        "type": "function",
        "z": "7e80c62ce8c753dc",
        "name": "derive_mfg_naics",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    let cache = global.get(\"lookupCache\");\n    let naics_napcs = cache.data.find(\n        item =>\n            item.module === \"mfg_napcs\" &&\n            item.param === 'mfg_napcs' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function sumRow(newobj) {\n        var naicsNapcs = naics_napcs['MN_NAPCS_BL_GROUPS']\n        var keys = [];\n        for (let i in naicsNapcs) {\n            let data = naicsNapcs[i]\n            let sum = null;\n            let naics = data['NAICS']\n            for (var key in data) {\n                if (key.startsWith('NAPCS_BL_') && data[key] != null) {\n                    let variable = data[key]\n                    if (newobj?.[variable]) {\n                        if (!Number.isNaN(parseFloat(newobj[variable]))) {\n                            if (sum == null) {\n                                sum = parseFloat(newobj[variable])\n                            } else {\n                                sum = parseFloat(sum) + parseFloat(newobj[variable])\n                            }\n                        }\n                    }\n                }\n            }\n            if (sum != null) {\n                keys.push({ naics, sum })\n            }\n        }\n        return keys;\n    }\n\n    function finalCheckMFGNAICS() {\n        if (record.NAICS_CODE == record.NAICS_DERIVED) {\n        } else {\n            record.REFERRAL_FLAG = 'NAICS_DERIVED_DIFF'\n            record.NAPCS_IND = 'N'\n        }\n    }\n\n    let id = record?.REPORTING_ID\n    let allData = msg.payload.csv;\n    let newobj = {}\n    for (let i in allData) {\n        let row = allData[i]\n        if (row.REPORTING_ID == id) {\n            if (row?.PROD_CODE) {\n                if (!['I', 'D', 'X'].includes(row?.USABLE)) {\n                    let name = row?.PROD_CODE\n                    newobj[name] = row?.PROD_CODE_VAL\n                }\n            }\n        }\n    }\n    let dataArr = sumRow(newobj)\n    const max = Math.max(...dataArr.map(o => o.sum), 0);\n    let maxArr = dataArr.filter((d) => { return d.sum == max; });\n\n    if (maxArr.length == 1) {\n        record.NAICS_DERIVED = maxArr[0].naics\n        finalCheckMFGNAICS()\n    } else if (maxArr.length > 1) {\n        let isNaics = maxArr.some(element =>\n            element.naics == record?.NAICS_CODE);\n        if (isNaics) {\n            record.NAICS_DERIVED = record.NAICS_CODE\n        } else {\n            record.NAICS_DERIVED = maxArr[0].naics\n        }\n        finalCheckMFGNAICS()\n    } else {\n        record.NAICS_DERIVED = ' '\n        record.NAPCS_IND = 'N'\n    }\n\n    record.ACTION = 'Return to Derive NAICS Code'\n    return msg;\n} catch (e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'Derive MFG NAICS'\n    return msg;\n}\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "7b9d81e30487f853",
        "type": "function",
        "z": "7e80c62ce8c753dc",
        "name": "derive_mfg_naics_database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    let cache = global.get(\"lookupCache\");\n    let naics_napcs = cache.data.find(\n        item =>\n            item.module === \"mfg_napcs\" &&\n            item.param === 'mfg_napcs' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function sumRow(newobj) {\n        var naicsNapcs = naics_napcs['MN_NAPCS_BL_GROUPS']\n        var keys = [];\n        for (let i in naicsNapcs) {\n            let data = naicsNapcs[i]\n            let sum = null;\n            let naics = data['NAICS']\n            for (var key in data) {\n                if (key.startsWith('NAPCS_BL_') && data[key] != null) {\n                    let variable = data[key]\n                    if (newobj?.[variable]) {\n                        if (!Number.isNaN(parseFloat(newobj[variable]))) {\n                            if (sum == null) {\n                                sum = parseFloat(newobj[variable])\n                            } else {\n                                sum = parseFloat(sum) + parseFloat(newobj[variable])\n                            }\n                        }\n                    }\n                }\n            }\n            if (sum != null) {\n                keys.push({ naics, sum })\n            }\n        }\n        return keys;\n    }\n\n    function finalCheckMFGNAICS() {\n        if (record.NAICS_CODE == record.NAICS_DERIVED) {\n        } else {\n            record.REFERRAL_FLAG = 'NAICS_DERIVED_DIFF'\n            record.NAPCS_IND = 'N'\n        }\n    }\n\n    let id = record?.REPORTING_ID\n    let newobj = {}\n    for (let i in msg.napcs) {\n        let row = msg.napcs[i].facts\n        if (row.REPORTING_ID == id) {\n            if (row?.PROD_CODE) {\n                if (!['I', 'D', 'X'].includes(row?.USABLE)) {\n                    let name = row?.PROD_CODE\n                    newobj[name] = row?.PROD_CODE_VAL_PI\n                }\n            }\n        }\n    }\n    let dataArr = sumRow(newobj)\n    const max = Math.max(...dataArr.map(o => o.sum), 0);\n    let maxArr = dataArr.filter((d) => { return d.sum == max; });\n\n    if (maxArr.length == 1) {\n        record.NAICS_DERIVED = maxArr[0].naics\n        finalCheckMFGNAICS()\n    } else if (maxArr.length > 1) {\n        let isNaics = maxArr.some(element =>\n            element.naics == record?.NAICS_CODE);\n        if (isNaics) {\n            record.NAICS_DERIVED = record.NAICS_CODE\n        } else {\n            record.NAICS_DERIVED = maxArr[0].naics\n        }\n        finalCheckMFGNAICS()\n    } else {\n        record.NAICS_DERIVED = ' '\n        record.NAPCS_IND = 'N'\n    }\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Derive MFG NAICS'\n    return msg;\n}\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "b160a0ca86eee401",
        "type": "function",
        "z": "f07c9ae4084738fc",
        "name": "Derived Naics ",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.REPORTING_ID_TYP_TXT === \"SU\" || record?.REPORTING_ID_TYP_TXT === \"MU\") {\n        if (record?.NAICS_SECTOR == \"31\") {\n            record.ACTION = \"Go to: Derive MFG NAICS from NAPCS\"\n            global.set('action', 'Go to: Derive MFG NAICS from NAPCS')\n        } else {\n            record.ACTION = \"Go to: Classification\"\n        }\n    } else {\n        record.ACTION = \"Go to: Classification\"\n    }\n    return msg;\n} catch (e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'Derived NAICS'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "1a8f5611db25ff83",
        "type": "function",
        "z": "f07c9ae4084738fc",
        "name": "Derived Naics Database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.REPORTING_ID_TYP_TXT === \"SU\" || record?.REPORTING_ID_TYP_TXT === \"MU\") {\n        if (record?.NAICS_SECTOR == \"31\") {\n            msg.action = 'Go to: Derive MFG NAICS from NAPCS'\n        }\n    }\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Derived NAICS'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 776.4583129882812,
        "y": 147.5833282470703,
        "wires": [
            []
        ]
    },
    {
        "id": "15222fbe79033cfa",
        "type": "function",
        "z": "998aa04bd1bb677d",
        "name": "Valid Zero",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx]\n    let cache = global.get(\"lookupCache\");\n\n    let valid_zero_file = cache.data.find(\n        item =>\n            item.module === \"valid_zero\" &&\n            item.param === 'valid_zero' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function isZero(column, type, naics) {\n        if (valid_zero_file.VALID_ZERO.some(element =>\n            (element.LEVEL) === type &&\n            (element.ITEM) === column &&\n            naics.startsWith(element.NAICS))) {\n\n            let column_f = column + '_F'\n            record[column_f] = setCharAt(record?.[column_f], 2, 'G')\n        }\n    }\n\n    let type = ''\n    if (['MU', 'SU'].includes(record['REPORTING_ID_TYP_TXT'])) {\n        type = 'ESTAB'\n    } else if (['KAU'].includes(record['REPORTING_ID_TYP_TXT'])) {\n        type = 'KAU'\n    }\n\n    for (var key in record) {\n        if (parseFloat(record[key]) == 0) {\n            isZero(key, type, record?.['NAICS_CODE'])\n        }\n    }\n\n    record['ACTION'] = 'Go to Main Routing'\n    return msg;\n}\ncatch(e){\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'Valid Zero'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "9b387fc99aeda88a",
        "type": "function",
        "z": "998aa04bd1bb677d",
        "name": "Valid Zero Database",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx]\n    let cache = global.get(\"lookupCache\");\n\n    let valid_zero_file = cache.data.find(\n        item =>\n            item.module === \"valid_zero\" &&\n            item.param === 'valid_zero' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function isZero(column, type, naics) {\n        if (valid_zero_file.VALID_ZERO.some(element =>\n            (element.LEVEL) === type &&\n            (element.ITEM) === column &&\n            naics.startsWith(element.NAICS))) {\n\n            let column_f = column + '_F'\n            record[column_f] = setCharAt(record?.[column_f], 2, 'G')\n        }\n    }\n\n    let type = ''\n    if (['MU', 'SU'].includes(record['REPORTING_ID_TYP_TXT'])) {\n        type = 'ESTAB'\n    } else if (['KAU'].includes(record['REPORTING_ID_TYP_TXT'])) {\n        type = 'KAU'\n    }\n\n    for (var key in record) {\n        if (parseFloat(record[key]) == 0) {\n            isZero(key, type, record?.['NAICS_CODE'])\n        }\n    }\n    return msg;\n}\ncatch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Valid Zero'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "71a05b6359f45791",
        "type": "function",
        "z": "aadaa91727c0d579",
        "name": "best admin function",
        "func": "try{\n    let record = msg.payload.csv[global.get(\"ptrModuleFacts\")];\n\n    // Initialize variables\n    let REPORTING_ID_TYP_TXT = record['REPORTING_ID_TYP_TXT'];\n    let NAICS_SECTOR = record['NAICS_SECTOR'];\n    let IRS_FORM_CODE_IRS = record['IRS_FORM_CODE_IRS'];\n    let IRS_RCPT_NET_VAL = parseFloat(record['IRS_RCPT_NET_VAL']);\n    let IRS_RCPT_INTEREST_VAL = parseFloat(record['IRS_RCPT_INTEREST_VAL']);\n    let IRS_RCPT_GROSSRENT_VAL = parseFloat(record['IRS_RCPT_GROSSRENT_VAL']);\n    let IRS_RCPT_OTHR_VAL = parseFloat(record['IRS_RCPT_OTHR_VAL']);\n    let IRS_INCOME_GROSS_VAL = parseFloat(record['IRS_INCOME_GROSS_VAL']);\n    let IRS_INCOME_TOT_VAL = parseFloat(record['IRS_INCOME_TOT_VAL']);\n    let IRS_RCPT_TOT_VAL = parseFloat(record['IRS_RCPT_TOT_VAL']);\n    let IRS_COST_GOODSOLD_VAL = parseFloat(record['IRS_COST_GOODSOLD_VAL']);\n    let IRS_EXPS_RENT_VAL = parseFloat(record['IRS_EXPS_RENT_VAL']);\n    let IRS_EXPS_DIRECT_VAL = parseFloat(record['IRS_EXPS_DIRECT_VAL']);\n\n    // Set function\n    const setVariable = (variable, value) => {\n        record[variable] = value;\n    };\n\n    // Logic\n    if (REPORTING_ID_TYP_TXT == 'SU') {\n        if (IRS_FORM_CODE_IRS == ' ' || IRS_FORM_CODE_IRS == 'C1') {\n            setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL);\n\n        } else if (['52', '53', '55'].includes(NAICS_SECTOR)) {\n            if (['01', '02', '03', '04', '05'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL + IRS_RCPT_INTEREST_VAL + IRS_RCPT_GROSSRENT_VAL + IRS_RCPT_OTHR_VAL);\n            } else if (['06', '07'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_GROSS_VAL + IRS_RCPT_INTEREST_VAL);\n            } else if (IRS_FORM_CODE_IRS == '08') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_TOT_VAL);\n            } else if (['09', '10', '11'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL);\n            } else if (IRS_FORM_CODE_IRS == '12') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL);\n            } else if (IRS_FORM_CODE_IRS == '13') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_TOT_VAL + IRS_RCPT_INTEREST_VAL + IRS_RCPT_GROSSRENT_VAL);\n            }\n        } else if (['06', '07'].includes(IRS_FORM_CODE_IRS)) {\n\n        } else if (['51', '54', '56', '61', '62', '71', '81'].includes(NAICS_SECTOR)) {\n            if (['01', '02', '03', '04', '05', '12'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL);\n            } else if (['08', '13'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_TOT_VAL);\n            } else if (IRS_FORM_CODE_IRS == '09') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL + IRS_COST_GOODSOLD_VAL + IRS_EXPS_RENT_VAL + IRS_EXPS_DIRECT_VAL);\n            } else if (IRS_FORM_CODE_IRS == '10') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL + IRS_COST_GOODSOLD_VAL + IRS_EXPS_DIRECT_VAL);\n            } else if (IRS_FORM_CODE_IRS == '11') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL);\n            }\n        } else if (['21', '23', '31', '42', '44', '72'].includes(NAICS_SECTOR)) {\n            if (['01', '02', '03', '04', '05', '12'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL);\n            } else if (['08', '13'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_TOT_VAL);\n            } else if (['09', '10'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL + IRS_COST_GOODSOLD_VAL);\n            } else if (IRS_FORM_CODE_IRS == '11') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL);\n            }\n        } else if (['11', '22', '48'].includes(NAICS_SECTOR)) {\n            if (['01', '02', '03', '04', '05', '12'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL);\n            } else if (['08', '13'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_TOT_VAL);\n            } else if (['09', '10', '11'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL);\n            }\n        }\n    }\n\n    setVariable('ACTION', 'Go to Main Routing')\n\n    return msg;\n}catch(e){\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'Best Admin'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "74cc98e04c95ba20",
        "type": "function",
        "z": "aadaa91727c0d579",
        "name": "best admin function db",
        "func": "try{\n    let record = msg.payload.csv[msg.ptrModuleFacts];\n\n    let irs = msg.payload.tables.irs.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    // Initialize variables\n    let REPORTING_ID_TYP_TXT = record['REPORTING_ID_TYP_TXT'];\n    let NAICS_SECTOR = record['NAICS_SECTOR'];\n    let IRS_FORM_CODE_IRS = irs?.FORM_CODE_IRS;\n    let IRS_RCPT_NET_VAL = parseFloat(irs?.RCPT_NET_VAL);\n    let IRS_RCPT_INTEREST_VAL = parseFloat(irs?.RCPT_INTEREST_VAL);\n    let IRS_RCPT_GROSSRENT_VAL = parseFloat(irs?.RCPT_GROSSRENT_VAL);\n    let IRS_RCPT_OTHR_VAL = parseFloat(irs?.RCPT_OTHR_VAL);\n    let IRS_INCOME_GROSS_VAL = parseFloat(irs?.INCOME_GROSS_VAL);\n    let IRS_INCOME_TOT_VAL = parseFloat(irs?.INCOME_TOT_VAL);\n    let IRS_RCPT_TOT_VAL = parseFloat(irs?.RCPT_TOT_VAL);\n    let IRS_COST_GOODSOLD_VAL = parseFloat(irs?.COST_GOODSOLD_VAL);\n    let IRS_EXPS_RENT_VAL = parseFloat(irs?.EXPS_RENT_VAL);\n    let IRS_EXPS_DIRECT_VAL = parseFloat(irs?.EXPS_DIRECT_VAL);\n\n    // Set function\n    const setVariable = (variable, value) => {\n        record[variable] = value;\n    };\n\n    // Logic\n    if (REPORTING_ID_TYP_TXT == 'SU') {\n        if (IRS_FORM_CODE_IRS == ' ' || IRS_FORM_CODE_IRS == 'C1') {\n            setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL);\n\n        } else if (['52', '53', '55'].includes(NAICS_SECTOR)) {\n            if (['01', '02', '03', '04', '05'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL + IRS_RCPT_INTEREST_VAL + IRS_RCPT_GROSSRENT_VAL + IRS_RCPT_OTHR_VAL);\n            } else if (['06', '07'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_GROSS_VAL + IRS_RCPT_INTEREST_VAL);\n            } else if (IRS_FORM_CODE_IRS == '08') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_TOT_VAL);\n            } else if (['09', '10', '11'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL);\n            } else if (IRS_FORM_CODE_IRS == '12') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL);\n            } else if (IRS_FORM_CODE_IRS == '13') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_TOT_VAL + IRS_RCPT_INTEREST_VAL + IRS_RCPT_GROSSRENT_VAL);\n            }\n        } else if (['06', '07'].includes(IRS_FORM_CODE_IRS)) {\n\n        } else if (['51', '54', '56', '61', '62', '71', '81'].includes(NAICS_SECTOR)) {\n            if (['01', '02', '03', '04', '05', '12'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL);\n            } else if (['08', '13'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_TOT_VAL);\n            } else if (IRS_FORM_CODE_IRS == '09') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL + IRS_COST_GOODSOLD_VAL + IRS_EXPS_RENT_VAL + IRS_EXPS_DIRECT_VAL);\n            } else if (IRS_FORM_CODE_IRS == '10') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL + IRS_COST_GOODSOLD_VAL + IRS_EXPS_DIRECT_VAL);\n            } else if (IRS_FORM_CODE_IRS == '11') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL);\n            }\n        } else if (['21', '23', '31', '42', '44', '72'].includes(NAICS_SECTOR)) {\n            if (['01', '02', '03', '04', '05', '12'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL);\n            } else if (['08', '13'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_TOT_VAL);\n            } else if (['09', '10'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL + IRS_COST_GOODSOLD_VAL);\n            } else if (IRS_FORM_CODE_IRS == '11') {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL);\n            }\n        } else if (['11', '22', '48'].includes(NAICS_SECTOR)) {\n            if (['01', '02', '03', '04', '05', '12'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_NET_VAL);\n            } else if (['08', '13'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_INCOME_TOT_VAL);\n            } else if (['09', '10', '11'].includes(IRS_FORM_CODE_IRS)) {\n                setVariable('RCPT_TOT_ADMN_DVAL', IRS_RCPT_TOT_VAL);\n            }\n        }\n    }\n\n    msg.payload.csv[msg.ptrModuleFacts] = record;\n\n    return msg;\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Best Admin'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "310c654aa32dd481",
        "type": "function",
        "z": "b22812dba408ab8f",
        "name": "geography function",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    const record = msg.payload.csv[record_idx];\n    const cache = global.get(\"lookupCache\");\n    const validationChartData = cache.data.find(\n        item =>\n            item.module === \"geography\" &&\n            item.param === \"geography\" &&\n            item.program === \"aies\" &&\n            item.unit_type === \"estab\"\n    )?.json_values;\n\n    let validation = validationChartData.GEO.some(element =>\n    (parseInt(element.STFIPS) === parseInt(record?.GEO_STATE_FIPS) &&\n        parseInt(element.GEOREG) === parseInt(record?.GEO_REGION))\n    );\n\n    if (validation) {\n        record['ACTION'] = \"Go to Main Routing\";\n        global.set('action', 'Go to Main Routing')\n    } else if (record?.GEO_STATE_FIPS === \"97\") {\n        if (record?.NAICS_SECTOR === \"21\" && [\"PC\", \"NG\", \"AT\"].includes(record?.PHYSLOC_ADDR_ST_TXT)) {\n            record['ACTION'] = \"Go to Main Routing\";\n            global.set('action', 'Go to Main Routing')\n        } else {\n            record['TABSTAT'] = \"N\";\n            record['NONTABFL'] = \"Y\";\n            record['ACTION'] = \"Exit Edit\";\n            global.set('action', 'Exit Edit')\n        }\n    } else {\n        record['TABSTAT'] = \"N\";\n        record['NONTABFL'] = \"Y\";\n        record['ACTION'] = \"Exit Edit\";\n        // record['FLAG'] = \"GEO_Invalid\";\n        global.set('action', 'Exit Edit')\n    }\n\n    // record.module = \"Geography\";\n    return msg;\n} catch (e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'Geography'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "872f9f5e7753309f",
        "type": "function",
        "z": "b22812dba408ab8f",
        "name": "geography function database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    const record = msg.payload.csv[record_idx];\n    const cache = global.get(\"lookupCache\");\n    const validationChartData = cache.data.find(\n        item =>\n            item.module === \"geography\" &&\n            item.param === \"geography\" &&\n            item.program === \"aies\" &&\n            item.unit_type === \"estab\"\n    )?.json_values;\n\n    let validation = validationChartData.GEO.some(element =>\n    (parseInt(element.STFIPS) === parseInt(record?.GEO_STATE_FIPS) &&\n        parseInt(element.GEOREG) === parseInt(record?.GEO_REGION))\n    );\n\n    if (validation) {\n        msg.action = 'Go to Main Routing'\n    } else if (record?.GEO_STATE_FIPS === \"97\") {\n        if (record?.NAICS_SECTOR === \"21\" && [\"PC\", \"NG\", \"AT\"].includes(record?.PHYSLOC_ADDR_ST_TXT)) {\n            msg.action = 'Go to Main Routing'\n        } else {\n            record['TABSTAT'] = \"N\";\n            record['NONTABFL'] = \"Y\";\n            msg.action = 'Exit Edit'\n        }\n    } else {\n        record['TABSTAT'] = \"N\";\n        record['NONTABFL'] = \"Y\";\n        msg.action = 'Exit Edit'\n    }\n\n    // record.module = \"Geography\";\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Geography'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "f2eeed6f42b8a31c",
        "type": "function",
        "z": "42be4655fd3a8c84",
        "name": "critical error",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setResult() {\n        record['TABSTAT'] = \"N\";\n        record['NONTABFL'] = \"D\";\n        record['ACTION'] = \"Exit Edit\";\n        global.set('action', 'Exit Edit')\n    }\n\n    // function parseToNum(val) {\n    //     return isNaN(val) ? 0 : parseInt(val, 10);\n    // }\n    function naicsSectorCheck() {\n        let result =\n            parseFloat(record['PAY_ANN_VAL']) +\n            parseFloat(record['EMP_MAR12_NUM']) +\n            parseFloat(record['PAY_QTR1_VAL']) +\n            parseFloat(record['RCPT_TOT_VAL']) +\n            parseFloat(record['IRS_PAY_ANN_VAL']) +\n            parseFloat(record['IRS_EMP_MAR12_NUM']) +\n            parseFloat(record['IRS_PAY_QTR1_VAL']);\n\n        if (parseFloat(record['NAICS_SECTOR']) === 31) {\n            result = parseFloat(result) + parseFloat(record['EXPS_TEMPSTAF_VAL']);\n        }\n        return result\n    }\n    let data = naicsSectorCheck();\n    // record['DATA'] = data\n\n    if (record?.COV_CHG_CODE &&\n        [\"111\", \"131\", \"791\"].includes(record['COV_CHG_CODE']?.toString()) &&\n        new Date(record['COV_CHG_DATE']) <=\n        new Date(\"01-01-\" + record.REF_PER.substring(0, 4)) &&\n        data == 0\n    ) {\n        setResult();\n\n    } else if (record?.COV_CHG_CODE && [\"181\", \"201\", \"801\", \"091\", \"121\", \"171\"].includes(record['COV_CHG_CODE']?.toString())) {\n        setResult();\n    } else {\n        record['ACTION'] = \"Go To Main Routing\";\n        global.set('action', 'Go To Main Routing')\n    }\n    return msg;\n} catch (e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'Critical Error'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "b877a5a4d1e56930",
        "type": "function",
        "z": "42be4655fd3a8c84",
        "name": "critical error database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    let irs = msg.payload.tables.irs.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    function setResult() {\n        record['TABSTAT'] = \"N\";\n        record['NONTABFL'] = \"D\";\n        msg.action = 'Exit Edit'\n    }\n\n    // function parseToNum(val) {\n    //     return isNaN(val) ? 0 : parseInt(val, 10);\n    // }\n    function naicsSectorCheck() {\n        let result =\n            parseFloat(record['PAY_ANN_VAL']) +\n            parseFloat(record['EMP_MAR12_NUM']) +\n            parseFloat(record['PAY_QTR1_VAL']) +\n            parseFloat(record['RCPT_TOT_VAL']) +\n            parseFloat(irs['PAY_ANN_VAL']) +\n            parseFloat(irs['EMP_MAR12_NUM']) +\n            parseFloat(irs['PAY_QTR1_VAL']);\n\n        if (parseFloat(record['NAICS_SECTOR']) === 31) {\n            result = parseFloat(result) + parseFloat(record['EXPS_TEMPSTAF_VAL']);\n        }\n        return result\n    }\n    let data = naicsSectorCheck();\n    // record['DATA'] = data\n\n    if (record?.COV_CHG_CODE &&\n        [\"111\", \"131\", \"791\"].includes(record['COV_CHG_CODE']?.toString()) &&\n        new Date(record['COV_CHG_DATE']) <=\n        new Date(\"01-01-\" + record.REF_PER.substring(0, 4)) &&\n        data == 0\n    ) {\n        setResult();\n\n    } else if (record?.COV_CHG_CODE && [\"181\", \"201\", \"801\", \"091\", \"121\", \"171\"].includes(record['COV_CHG_CODE']?.toString())) {\n        setResult();\n    } else {\n        msg.action = 'Go To Main Routing'\n    }\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Critical Error'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "31739108a9b57e14",
        "type": "function",
        "z": "20d530cc0b193752",
        "name": "BR Stat ",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function A() {\n        record.TABSTAT = \"N\";\n        record.NONTABFL = \"D\";\n        record.ACTION = \"Exit Edit\";\n        global.set('action', 'Exit Edit')\n    }\n\n    if ([\"SU\", \"MU\", \"KAU\", \"ENT\"].includes(String(record?.REPORTING_ID_TYP_TXT))) {\n        record.TABSTAT = \"Y\";\n        record.NONTABFL = ' ';\n        if ([\"MU\", \"SU\", \"ENT\"].includes(String(record?.REPORTING_ID_TYP_TXT))) {\n            if (record?.BR_STAT === \"N\") {\n                A();\n            } else {\n                record.ACTION = \"Go to main Routing\";\n            }\n\n        } else {\n            if (record?.KAU_STAT === \"N\") {\n                A();\n            } else {\n                record.ACTION = \"Go to main Routing\";\n            }\n        }\n    } else {\n        record.ACTION = \"ERROR\";\n        global.set('action', 'ERROR')\n    }\n\n    return msg;\n} catch (e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'BR STAT'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "6c4fa7250eba792a",
        "type": "function",
        "z": "20d530cc0b193752",
        "name": "BR Stat ",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    function A() {\n        record.TABSTAT = \"N\";\n        record.NONTABFL = \"D\";\n        msg.action = 'Exit Edit'\n    }\n\n    if ([\"SU\", \"MU\", \"KAU\", \"ENT\"].includes(String(record?.REPORTING_ID_TYP_TXT))) {\n        record.TABSTAT = \"Y\";\n        record.NONTABFL = ' ';\n        if ([\"MU\", \"SU\", \"ENT\"].includes(String(record?.REPORTING_ID_TYP_TXT))) {\n            if (record?.BR_STAT === \"N\") {\n                A();\n            }\n        } else {\n            if (record?.KAU_STAT === \"N\") {\n                A();\n            }\n        }\n    } else {\n        msg.action = 'Exit Edit'\n    }\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'BR STAT'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "508bfe2ad7cfeddd",
        "type": "subflow:1159e6c8f76efda3",
        "z": "e09a92672a809eab",
        "name": "",
        "x": 540,
        "y": 360,
        "wires": [
            [
                "29636a3b9b9bf654"
            ]
        ]
    },
    {
        "id": "29636a3b9b9bf654",
        "type": "switch",
        "z": "e09a92672a809eab",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 780,
        "y": 360,
        "wires": [
            [],
            [
                "8587ec4502170e69"
            ]
        ]
    },
    {
        "id": "8587ec4502170e69",
        "type": "subflow:75eae7f006cc0f8a",
        "z": "e09a92672a809eab",
        "name": "",
        "x": 550,
        "y": 440,
        "wires": [
            [
                "a6ecbb0f804243ba"
            ]
        ]
    },
    {
        "id": "a6ecbb0f804243ba",
        "type": "switch",
        "z": "e09a92672a809eab",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 780,
        "y": 440,
        "wires": [
            [],
            [
                "a5431844c324306b"
            ]
        ]
    },
    {
        "id": "a5431844c324306b",
        "type": "subflow:b68b1cdb465a831c",
        "z": "e09a92672a809eab",
        "name": "",
        "x": 520,
        "y": 500,
        "wires": [
            [
                "ebd10c9f307211a6"
            ]
        ]
    },
    {
        "id": "ebd10c9f307211a6",
        "type": "switch",
        "z": "e09a92672a809eab",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 780,
        "y": 500,
        "wires": [
            [],
            [
                "da1041380073a9cd"
            ]
        ]
    },
    {
        "id": "da1041380073a9cd",
        "type": "subflow:96f29b19e2260e65",
        "z": "e09a92672a809eab",
        "name": "",
        "x": 570,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "46b3677a66484905",
        "type": "subflow:7c74ea1220a33f32",
        "z": "e09a92672a809eab",
        "name": "",
        "x": 490,
        "y": 240,
        "wires": [
            [
                "a241a27d91c97bd0"
            ]
        ]
    },
    {
        "id": "a241a27d91c97bd0",
        "type": "switch",
        "z": "e09a92672a809eab",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 740,
        "y": 240,
        "wires": [
            [],
            [
                "ece6d6ed5ddcee4b"
            ]
        ]
    },
    {
        "id": "ece6d6ed5ddcee4b",
        "type": "switch",
        "z": "e09a92672a809eab",
        "name": "sector check",
        "property": "naicsSector",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 270,
        "y": 300,
        "wires": [
            [
                "508bfe2ad7cfeddd"
            ],
            [
                "da1041380073a9cd"
            ]
        ]
    },
    {
        "id": "4d56f52e9266104e",
        "type": "subflow:b68b1cdb465a831c",
        "z": "848cf3fa24ade3ee",
        "name": "",
        "x": 1200,
        "y": 380,
        "wires": [
            [
                "19086e3898d97bcf"
            ]
        ]
    },
    {
        "id": "19086e3898d97bcf",
        "type": "switch",
        "z": "848cf3fa24ade3ee",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1400,
        "y": 380,
        "wires": [
            [],
            [
                "a7635805269c06d8"
            ]
        ]
    },
    {
        "id": "a7635805269c06d8",
        "type": "subflow:96f29b19e2260e65",
        "z": "848cf3fa24ade3ee",
        "name": "",
        "x": 1210,
        "y": 440,
        "wires": [
            [
                "ddcfb9ab334353de"
            ]
        ]
    },
    {
        "id": "464674c4029c73d2",
        "type": "subflow:7c74ea1220a33f32",
        "z": "848cf3fa24ade3ee",
        "name": "",
        "x": 560,
        "y": 300,
        "wires": [
            [
                "4504eca1eab0f0d6"
            ]
        ]
    },
    {
        "id": "4504eca1eab0f0d6",
        "type": "switch",
        "z": "848cf3fa24ade3ee",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 740,
        "y": 300,
        "wires": [
            [],
            [
                "0ac0ff658a0a1649"
            ]
        ]
    },
    {
        "id": "0ac0ff658a0a1649",
        "type": "switch",
        "z": "848cf3fa24ade3ee",
        "name": "sector check",
        "property": "naicsSector",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 610,
        "y": 360,
        "wires": [
            [],
            [
                "bb5df2efe11ea168"
            ]
        ]
    },
    {
        "id": "a87b0bc5e57096a7",
        "type": "subflow:0179503501c47e39",
        "z": "848cf3fa24ade3ee",
        "name": "",
        "x": 1430,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "c52d373db0383ce9",
        "type": "subflow:6ace7023ea973ebe",
        "z": "848cf3fa24ade3ee",
        "name": "",
        "x": 1190,
        "y": 520,
        "wires": [
            [
                "37fd0022f9cf94d8"
            ]
        ]
    },
    {
        "id": "ddcfb9ab334353de",
        "type": "switch",
        "z": "848cf3fa24ade3ee",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1420,
        "y": 440,
        "wires": [
            [],
            [
                "c52d373db0383ce9"
            ]
        ]
    },
    {
        "id": "37fd0022f9cf94d8",
        "type": "switch",
        "z": "848cf3fa24ade3ee",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1420,
        "y": 520,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "bb5df2efe11ea168",
        "type": "switch",
        "z": "848cf3fa24ade3ee",
        "name": "tabstat",
        "property": "tabstat",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "N",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "N",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 730,
        "y": 440,
        "wires": [
            [
                "1ebfc483e36c32ee"
            ],
            [
                "a7635805269c06d8"
            ]
        ]
    },
    {
        "id": "1ebfc483e36c32ee",
        "type": "switch",
        "z": "848cf3fa24ade3ee",
        "name": "action check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 910,
        "y": 380,
        "wires": [
            [
                "4d56f52e9266104e"
            ],
            [
                "a7635805269c06d8"
            ]
        ]
    },
    {
        "id": "54eb107c0332181c",
        "type": "subflow:20d530cc0b193752",
        "z": "2cc271394c47d59b",
        "name": "",
        "x": 360,
        "y": 120,
        "wires": [
            [
                "92fdd684beea9454"
            ]
        ]
    },
    {
        "id": "215fc0dfced8954c",
        "type": "switch",
        "z": "2cc271394c47d59b",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 610,
        "y": 180,
        "wires": [
            [],
            [
                "ab401fe410548892"
            ]
        ]
    },
    {
        "id": "92fdd684beea9454",
        "type": "switch",
        "z": "2cc271394c47d59b",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 120,
        "wires": [
            [],
            [
                "215fc0dfced8954c"
            ]
        ]
    },
    {
        "id": "ab401fe410548892",
        "type": "subflow:b68b1cdb465a831c",
        "z": "2cc271394c47d59b",
        "name": "",
        "x": 360,
        "y": 240,
        "wires": [
            [
                "37794b0f554a07e3"
            ]
        ]
    },
    {
        "id": "d01ff40d7ba003ae",
        "type": "subflow:5e2c6717be2fdd36",
        "z": "2cc271394c47d59b",
        "name": "",
        "x": 350,
        "y": 300,
        "wires": [
            [
                "e81f3652bc8e327b"
            ]
        ]
    },
    {
        "id": "37794b0f554a07e3",
        "type": "switch",
        "z": "2cc271394c47d59b",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 240,
        "wires": [
            [],
            [
                "d01ff40d7ba003ae"
            ]
        ]
    },
    {
        "id": "d647d659668b1b7b",
        "type": "subflow:e4fb9739caef0397",
        "z": "2cc271394c47d59b",
        "name": "",
        "x": 390,
        "y": 360,
        "wires": [
            [
                "372b45912e271aab"
            ]
        ]
    },
    {
        "id": "e81f3652bc8e327b",
        "type": "switch",
        "z": "2cc271394c47d59b",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 300,
        "wires": [
            [],
            [
                "d647d659668b1b7b"
            ]
        ]
    },
    {
        "id": "372b45912e271aab",
        "type": "switch",
        "z": "2cc271394c47d59b",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 360,
        "wires": [
            [],
            [
                "8858108c0e9c355c"
            ]
        ]
    },
    {
        "id": "8858108c0e9c355c",
        "type": "subflow:b68b1cdb465a831c",
        "z": "2cc271394c47d59b",
        "name": "",
        "x": 360,
        "y": 420,
        "wires": [
            [
                "62488e09ea38855f"
            ]
        ]
    },
    {
        "id": "62488e09ea38855f",
        "type": "switch",
        "z": "2cc271394c47d59b",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 420,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "562ff9816c105930",
        "type": "subflow:96f29b19e2260e65",
        "z": "2cc271394c47d59b",
        "name": "",
        "x": 370,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "6a6c20afbe8a3a43",
        "type": "function",
        "z": "50ae5f8d28de46c8",
        "name": "upfront raking",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\")\n    let record = msg.payload.csv[record_idx];\n    let estabs = msg.payload.csv\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    function findRows(variable) {\n        let keys = [];\n        let j = 0;\n        for (let i in estabs) {\n            let row = estabs[i];\n            if (!Number.isNaN(parseFloat(row[variable])) &&\n                parseFloat(row[variable]) !== null &&\n                parseFloat(row[variable]) !== undefined &&\n                row.KAU_ID == record.KAU_ID &&\n                row?.TABSTAT != 'N' &&\n                ['MU', 'SU'].includes(row?.REPORTING_ID_TYP_TXT)) {\n                keys[j] = row\n                j = j + 1\n            }\n        }\n        return [keys];\n    }\n\n    function raking(Y, temptot, variable) {\n        let [key] = findRows(variable)\n        let keys = key.sort((a, b) => b[variable] - a[variable])\n        let remainder = 0\n\n        for (let i = 0; i < keys.length; i++) {\n            let num1 = (parseFloat(Y) / parseFloat(temptot)) * parseFloat(keys[i][variable]) + remainder\n            let num2 = Math.round(num1)\n            remainder = num1 - num2\n            keys[i][variable] = num2\n            keys[i][variable + '_F'] = setCharAt(keys[i][variable + '_F'], 2, 'K')\n        }\n    }\n\n    let list = ['RCPT_TOT_VAL', 'EMP_MAR12_NUM', 'PAY_ANN_VAL', 'PAY_QTR1_VAL', 'CAPEX_NEW_TOT_DVAL']\n\n    for (let i in list) {\n        let name = list[i]\n        let name_f = name + '_F'\n        if (['P', 'C', 'A', 'S', 'O', 'E', 'F'].includes(record?.[name_f]?.charAt(1)) || (parseFloat(record?.RCPT_TOT_VAL_RP) > 0 && record?.NAICS_SECTOR != 31)) {\n            let temptot = 0\n            let id = record?.KAU_ID\n            for (let i in estabs) {\n                let row = estabs[i]\n                if (row?.KAU_ID == id && row?.TABSTAT != 'N' && ['MU', 'SU'].includes(row?.REPORTING_ID_TYP_TXT)) {\n                    temptot = temptot + parseFloat(row?.[name])\n                }\n            }\n            if (parseFloat(record?.[name])==parseFloat(temptot)) {\n            } else if (0.8 <= parseFloat(record?.[name]) / parseFloat(temptot) && parseFloat(record?.[name]) / parseFloat(temptot) <= 1.2) {\n                raking(record?.[name], temptot, name)\n                if (record?.[name_f]?.charAt(1) == 'G') {\n                    for (let i in estabs) {\n                        let row = estabs[i]\n                        if (row?.KAU_ID == id && row?.TABSTAT != 'N' && ['MU', 'SU'].includes(row?.REPORTING_ID_TYP_TXT)) {\n                            row[name_f] = setCharAt(row?.[name_f], 1, 'G')\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    return msg;\n} catch (e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'Estab to KAU raking'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "b0156654c33056d6",
        "type": "function",
        "z": "50ae5f8d28de46c8",
        "name": "reset msg",
        "func": "msg.aies_rp = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 420,
        "wires": [
            [
                "4fb29d09c84d6ae3"
            ]
        ]
    },
    {
        "id": "54f040eaf9d8a5ad",
        "type": "function",
        "z": "50ae5f8d28de46c8",
        "name": "query_estabs",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.KAU_ID\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where kau_id = '\" + id + \"' and type = 'ESTAB' and jobname = '\" + job +\"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 300,
        "wires": [
            [
                "71bf5398ef017457"
            ]
        ]
    },
    {
        "id": "71bf5398ef017457",
        "type": "subflow:8032608991ae0162",
        "z": "50ae5f8d28de46c8",
        "name": "",
        "x": 560,
        "y": 300,
        "wires": [
            [
                "bd6bc19b18972a8f"
            ]
        ]
    },
    {
        "id": "c7fd5dbe3a8260c8",
        "type": "subflow:8032608991ae0162",
        "z": "50ae5f8d28de46c8",
        "name": "",
        "x": 1120,
        "y": 420,
        "wires": [
            [
                "30dae06389848fab"
            ]
        ]
    },
    {
        "id": "30dae06389848fab",
        "type": "function",
        "z": "50ae5f8d28de46c8",
        "name": "reset msg",
        "func": "msg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1300,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "63fd2ee773d7934c",
        "type": "switch",
        "z": "50ae5f8d28de46c8",
        "name": "",
        "property": "query",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "The query is invalid",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "No query",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 930,
        "y": 420,
        "wires": [
            [],
            [],
            [
                "c7fd5dbe3a8260c8"
            ]
        ]
    },
    {
        "id": "4fb29d09c84d6ae3",
        "type": "function",
        "z": "50ae5f8d28de46c8",
        "name": "upfront raking database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts\n    let record = msg.payload.csv[record_idx];\n    let estabs = msg.estabs\n    let aies_rp = msg.aies_rp[0]\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    function findRows(variable) {\n        let keys = [];\n        let j = 0;\n        for (let i in estabs) {\n            let row = estabs[i].facts;\n            if (!Number.isNaN(parseFloat(row[variable])) &&\n                parseFloat(row[variable]) !== null &&\n                parseFloat(row[variable]) !== undefined &&\n                row.KAU_ID == record.KAU_ID && \n                row?.TABSTAT != 'N' && \n                ['MU', 'SU'].includes(row?.REPORTING_ID_TYP_TXT)) {\n                keys[j] = row\n                j = j + 1\n            }\n        }\n        return [keys];\n    }\n\n    function raking(Y, temptot, variable) {\n        let [key] = findRows(variable)\n        let keys = key.sort((a, b) => b[variable] - a[variable])\n        let remainder = 0\n\n        for (let i = 0; i < keys.length; i++) {\n            let num1 = (parseFloat(Y) / parseFloat(temptot)) * parseFloat(keys[i][variable]) + remainder\n            let num2 = Math.round(num1)\n            remainder = num1 - num2\n            keys[i][variable] = num2\n            keys[i][variable + '_F'] = setCharAt(keys[i][variable + '_F'], 2, 'K')\n\n        }\n    }\n\n    let list = ['RCPT_TOT_VAL', 'EMP_MAR12_NUM', 'PAY_ANN_VAL', 'PAY_QTR1_VAL', 'CAPEX_NEW_TOT_DVAL']\n    let raked = ''\n    for (let i in list) {\n        let name = list[i]\n        let name_f = name + '_F'\n        if (['P','C','A','S','O','E','F'].includes(record?.[name_f]?.charAt(1)) || (parseFloat(aies_rp?.RCPT_TOT_VAL) > 0 && record?.NAICS_SECTOR != 31)) {\n            let temptot = 0\n            let id = record?.KAU_ID\n            for (let i in estabs) {\n                let row = estabs[i].facts\n                if (row?.KAU_ID == id && row?.TABSTAT != 'N' && ['MU', 'SU'].includes(row?.REPORTING_ID_TYP_TXT)) {\n                    temptot = temptot + parseFloat(row?.[name])\n                }\n            }\n            if (parseFloat(record?.[name])==parseFloat(temptot)) {\n            } else if (0.8 <= parseFloat(record?.[name]) / parseFloat(temptot) && parseFloat(record?.[name]) / parseFloat(temptot) <= 1.2) {\n                raking(record?.[name], temptot, name)\n                raked = 'Y'\n                if (record?.[name_f]?.charAt(1) == 'G') {\n                    for (let i in estabs) {\n                        let row = estabs[i].facts\n                        if (row?.KAU_ID == id && row?.TABSTAT != 'N' && ['MU', 'SU'].includes(row?.REPORTING_ID_TYP_TXT)) {\n                            row[name_f] = setCharAt(row?.[name_f],1,'G')\n                        }\n                    }\n                }\n            }\n        }\n    }\n    \n    if (raked == 'Y') {\n        let CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\n        let DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\n\n        let arr = msg.estabs;\n        let query = \"UPDATE \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" SET facts = CASE id \";\n        let string = ''\n        // Add CASE conditions for each ID\n        arr.forEach(item => {\n            query += `WHEN ${item.id} THEN '${JSON.stringify(item.facts).replace(/'/g, \"''\") }'::jsonb `;\n        });\n        // // Close the CASE statement and specify which IDs should be updated\n        let ids = arr.map(item => item.id);\n        query += `END WHERE id IN (${ids.join(', ')})`;\n\n        let jobName = msg.payload.job.jobName.replace(/'/g, \"''\"); // Escape single quotes\n        query += ` AND jobname = '${jobName}'`;\n\n        if (query.includes(\"();\")) {\n            msg.query = \"The query is invalid\"\n        } else {\n            msg.query = query\n        }\n        msg.records = msg.payload\n    } else {\n        msg.query = \"No query\"\n    }\n\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Estab to KAU upfront raking'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 420,
        "wires": [
            [
                "63fd2ee773d7934c"
            ]
        ]
    },
    {
        "id": "bd6bc19b18972a8f",
        "type": "function",
        "z": "50ae5f8d28de46c8",
        "name": "reset_msg and query_aies rp",
        "func": "msg.estabs = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.PRODUCT_REFPER_UNIT_ID\nlet ref_per = record.REF_PER\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_KAU_TABLE = env.get('DB_KAU_TABLE')\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_KAU_TABLE + \" where product_refper_unit_id = '\" + id + \"' and version = 'RP' and ref_per = '\" + ref_per + \"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 360,
        "wires": [
            [
                "4e33ad5ade83b70d"
            ]
        ]
    },
    {
        "id": "4e33ad5ade83b70d",
        "type": "subflow:8032608991ae0162",
        "z": "50ae5f8d28de46c8",
        "name": "",
        "x": 640,
        "y": 360,
        "wires": [
            [
                "b0156654c33056d6"
            ]
        ]
    },
    {
        "id": "2e5501e16398d095",
        "type": "function",
        "z": "f9a2a2262f95bae3",
        "name": "Init Set ACTVMIO & OPSTATS",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    const checkOPSTAT_STAT_F = (record) => {\n        const char = record?.OPSTAT_STAT_F ? record?.OPSTAT_STAT_F?.charAt(0) : ' ';\n        return ['R', 'T', 'K'].includes(char);\n    };\n\n    function processACTV_MIO_NUM(record) {\n        let mioNum = parseInt(record?.ACTV_MIO_NUM) || 0;\n        if (mioNum == 0 || mioNum > 12) {\n            record.ACTV_MIO_NUM = '12';\n            record.ACTV_MIO_NUM_F = setCharAt(record['ACTV_MIO_NUM_F'], 2, 'Y');\n        }\n    }\n\n    function determineFlow(record) {\n        if ((['111', '131'].includes(record?.COV_CHG_CODE) ||\n            (['791'].includes(record?.COV_CHG_CODE) && parseInt(record?.ACTV_MIO_NUM) < 12)) &&\n            new Date(record?.COV_CHG_DATE) < new Date('2024-01-01')) {\n            record.OPSTATS = 'N';\n        } else if (checkOPSTAT_STAT_F(record)) {\n            if (parseInt(record?.OPSTAT_STAT) === 3) {\n                record.OPSTATS = 'N';\n            } else if (parseInt(record?.OPSTAT_STAT) == 4) {\n                if (parseInt(record?.RP_ACTV_MIO_NUM) == 12) {\n                    record.OPSTATS = 'Y'\n                } else {\n                    record.OPSTATS = 'N';\n                }\n            } else {\n                record.OPSTATS = 'Y';\n            }\n        } else {\n            record.OPSTATS = 'Y'\n        }\n        if (checkOPSTAT_STAT_F(record)) {\n            record.OPSTATS_F = setCharAt(record['OPSTATS_F'], 2, 'R');\n        } else {\n            record.OPSTATS_F = setCharAt(record['OPSTATS_F'], 2, 'S');\n        }\n        record.ACTION = 'Go to NONNORM Router';\n\n    }\n\n    function processRecord(record) {\n        processACTV_MIO_NUM(record);\n        if (record?.OPSTATS == null) {\n            determineFlow(record);\n        } else {\n            if (record?.OPSTATS_F?.charAt(2) != 'R' && record?.OPSTATS_F?.charAt(1) === '_') {\n                determineFlow(record);\n            } else {\n                record.ACTION = 'Go to NONNORM Router';\n            }\n        }\n        msg.payload.csv[record_idx] = record\n    }\n\n    processRecord(record);\n    return msg;\n}catch(e){\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'NONNORM Init Set ACTVMIO'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "1dbc0304b4f0add2",
        "type": "function",
        "z": "f9a2a2262f95bae3",
        "name": "Init Set ACTVMIO & OPSTATS database",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    let aies_rp = msg.aies_rp[0]\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    const checkOPSTAT_STAT_F = (record) => {\n        const char = record?.OPSTAT_STAT_F ? record?.OPSTAT_STAT_F?.charAt(0) : ' ';\n        return ['R', 'T', 'K'].includes(char);\n    };\n\n    function processACTV_MIO_NUM(record) {\n        let mioNum = parseInt(record?.ACTV_MIO_NUM) || 0;\n        if (mioNum === 0 || mioNum > 12) {\n            record.ACTV_MIO_NUM = '12';\n            record.ACTV_MIO_NUM_F = setCharAt(record['ACTV_MIO_NUM_F'], 2, 'Y');\n        }\n    }\n\n    function determineFlow(record) {\n        if ((['111', '131'].includes(record?.COV_CHG_CODE) ||\n            (['791'].includes(record?.COV_CHG_CODE) && parseInt(aies_rp?.ACTV_MIO_NUM) < 12)) &&\n            new Date(record?.COV_CHG_DATE) < new Date('2024-01-01')) {\n            record.OPSTATS = 'N';\n        } else if (checkOPSTAT_STAT_F(record)) {\n            if (parseInt(record?.OPSTAT_STAT) === 3) {\n                record.OPSTATS = 'N';\n            } else if (parseInt(record?.OPSTAT_STAT) == 4) {\n                if (parseInt(aies_rp?.ACTV_MIO_NUM) == 12) {\n                    record.OPSTATS = 'Y'\n                } else {\n                    record.OPSTATS = 'N';\n                }\n            } else {\n                record.OPSTATS = 'Y';\n            }\n        } else {\n            record.OPSTATS = 'Y'\n        }\n        if (checkOPSTAT_STAT_F(record)) {\n            record.OPSTATS_F = setCharAt(record['OPSTATS_F'], 2, 'R');\n        } else {\n            record.OPSTATS_F = setCharAt(record['OPSTATS_F'], 2, 'S');\n        }\n    }\n\n    function processRecord(record) {\n        processACTV_MIO_NUM(record);\n        if (record?.OPSTATS == null) {\n            determineFlow(record);\n        } else {\n            if (record?.OPSTATS_F?.charAt(2) != 'R' && record?.OPSTATS_F?.charAt(1) === '_') {\n                determineFlow(record);\n            }\n        }\n        msg.payload.csv[record_idx] = record\n    }\n\n    processRecord(record);\n    return msg;\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NONNORM Init Set ACTVMIO'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "0fdd138dc5aa4e79",
        "type": "function",
        "z": "f9a2a2262f95bae3",
        "name": "reset msg",
        "func": "msg.aies_rp = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 80,
        "wires": [
            [
                "1dbc0304b4f0add2"
            ]
        ]
    },
    {
        "id": "5892e25ef4304793",
        "type": "function",
        "z": "f9a2a2262f95bae3",
        "name": "query_aies_rp",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.PRODUCT_REFPER_UNIT_ID\nlet ref_per = record.REF_PER\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_ESTAB_TABLE = env.get('DB_ESTAB_TABLE')\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_ESTAB_TABLE + \" where product_refper_unit_id = '\" + id + \"' and version = 'RP' and ref_per = '\" + ref_per + \"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 80,
        "wires": [
            [
                "19d7f05f29d760af"
            ]
        ]
    },
    {
        "id": "19d7f05f29d760af",
        "type": "subflow:8032608991ae0162",
        "z": "f9a2a2262f95bae3",
        "name": "",
        "x": 380,
        "y": 80,
        "wires": [
            [
                "0fdd138dc5aa4e79"
            ]
        ]
    },
    {
        "id": "e2f7739eee5de74c",
        "type": "function",
        "z": "e1f601e2c56dfda4",
        "name": "Special Season final",
        "func": "try { \n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    function setVal() {\n        record.EMP_MAR12_NUM_F = setCharAt(record['EMP_MAR12_NUM_F'], 2, 'Z');\n        record.PAY_QTR1_VAL_F = setCharAt(record['PAY_QTR1_VAL_F'], 2, 'Z');\n    }\n    function goToNonNORMRouter() {\n        record.ACTION = 'Return To NonNORM Router'\n    }\n\n    function pathSuccessSpecialSeasonFinal() {\n        if (record?.EMP_MAR12_NUM_F\n            && !(['R', 'T', 'K'].includes(record?.EMP_MAR12_NUM_F?.charAt(0)))\n            && record?.EMP_MAR12_NUM_F?.charAt(1) == '_'\n            && !(['L', 'N', 'Z'].includes(record?.EMP_MAR12_NUM_F?.charAt(2)))) {\n            if (record?.REPORTING_ID_TYP_TXT == 'SU') {\n                if (parseFloat(record?.IRS_EMP_MAR12_NUM) == 0) {\n                    setVal()\n                    goToNonNORMRouter()\n                } else {\n                    goToNonNORMRouter()\n                }\n            } else {\n                if (parseFloat(record?.BR_EMP_MAR12_NUM) == 0) {\n                    setVal()\n                    goToNonNORMRouter()\n                } else {\n                    goToNonNORMRouter()\n                }\n            }\n        } else {\n            goToNonNORMRouter()\n        }\n    }\n\n    if (record?.PAY_QTR1_VAL_F\n        && !(['R', 'T', 'K'].includes(record?.PAY_QTR1_VAL_F?.charAt(0)))\n        && record?.PAY_QTR1_VAL_F?.charAt(1) == '_'\n        && !(['L', 'N', 'Z'].includes(record?.PAY_QTR1_VAL_F?.charAt(2)))\n    ) {\n        if (record?.REPORTING_ID_TYP_TXT == 'SU') {\n            if (parseFloat(record?.IRS_PAY_QTR1_VAL) == 0) {\n                pathSuccessSpecialSeasonFinal()\n            } else {\n                goToNonNORMRouter()\n            }\n        } else {\n            if (parseFloat(record?.BR_PAY_QTR1_VAL) == 0) {\n                pathSuccessSpecialSeasonFinal()\n            } else {\n                goToNonNORMRouter()\n            }\n        }\n    } else {\n        goToNonNORMRouter()\n    }\n\n    return msg;\n} catch(e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'NONNORM Special Season'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "674845d63a9b326d",
        "type": "function",
        "z": "e1f601e2c56dfda4",
        "name": "Special Season final (database)",
        "func": "try { \n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    \n    let irs = msg.payload.tables.irs.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n    let br = msg.payload.tables.br.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    function setVal() {\n        record.EMP_MAR12_NUM_F = setCharAt(record['EMP_MAR12_NUM_F'], 2, 'Z');\n        record.PAY_QTR1_VAL_F = setCharAt(record['PAY_QTR1_VAL_F'], 2, 'Z');\n    }\n\n    function pathSuccessSpecialSeasonFinal() {\n        if (record?.EMP_MAR12_NUM_F\n            && !(['R', 'T', 'K'].includes(record?.EMP_MAR12_NUM_F?.charAt(0)))\n            && record?.EMP_MAR12_NUM_F?.charAt(1) == '_'\n            && !(['L', 'N', 'Z'].includes(record?.EMP_MAR12_NUM_F?.charAt(2)))) {\n            if (record?.REPORTING_ID_TYP_TXT == 'SU') {\n                if (parseFloat(irs?.EMP_MAR12_NUM) == 0) {\n                    setVal()\n                }\n            } else {\n                if (parseFloat(br?.EMP_MAR12_NUM) == 0) {\n                    setVal()\n                }\n            }\n        }\n    }\n\n    if (record?.PAY_QTR1_VAL_F\n        && !(['R', 'T', 'K'].includes(record?.PAY_QTR1_VAL_F?.charAt(0)))\n        && record?.PAY_QTR1_VAL_F?.charAt(1) == '_'\n        && !(['L', 'N', 'Z'].includes(record?.PAY_QTR1_VAL_F?.charAt(2)))\n    ) {\n        if (record?.REPORTING_ID_TYP_TXT == 'SU') {\n            if (parseFloat(irs?.PAY_QTR1_VAL) == 0) {\n                pathSuccessSpecialSeasonFinal()\n            }\n        } else {\n            if (parseFloat(br?.PAY_QTR1_VAL) == 0) {\n                pathSuccessSpecialSeasonFinal()\n            }\n        }\n    }\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NONNORM Special Season'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "46531482d43b4cae",
        "type": "function",
        "z": "b8154c600987e319",
        "name": "Set Basic to 0",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    function setVal(val) {\n        record[val] = 0;\n        let name = val + '_F'\n        record[name] = setCharAt(record[name], 2, 'Z');\n    }\n\n    if (parseInt(record?.ACTV_MIO_NUM) < 10) {\n        if (!(record?.PAY_QTR1_VAL_F.charAt(1) === 'G' || record?.PAY_QTR1_VAL_F.charAt(2) === 'G')) {\n            setVal('PAY_QTR1_VAL')\n        }\n        if (!(record?.EMP_MAR12_NUM_F.charAt(1) === 'G' || record?.EMP_MAR12_NUM_F?.charAt(2) === 'G')) {\n            setVal('EMP_MAR12_NUM')\n        }\n    } else {\n        if (record?.RP_PAY_QTR1_VAL == 0 && record?.PAY_QTR1_VAL_F && ['R', 'T', 'K'].includes(record?.PAY_QTR1_VAL_F?.charAt(0)) && record?.PAY_QTR1_VAL_F?.charAt(1) == '_') {\n            setVal('EMP_MAR12_NUM')\n            setVal('PAY_QTR1_VAL')\n        }\n    }\n    record.ACTION = 'Return To NonNORM Router';\n\n    return msg;\n\n} catch(e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'NONNORM Set Basic'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "aba6ffeb03f86245",
        "type": "function",
        "z": "b8154c600987e319",
        "name": "Set Basic to 0 (database)",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    let aies_rp = msg.aies_rp[0]\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    function setVal(val) {\n        record[val] = 0;\n        let name = val + '_F'\n        record[name] = setCharAt(record[name], 2, 'Z');\n    }\n\n    if (parseInt(record?.ACTV_MIO_NUM) < 10) {\n        if (!(record?.PAY_QTR1_VAL_F.charAt(1) === 'G' || record?.PAY_QTR1_VAL_F.charAt(2) === 'G')) {\n            setVal('PAY_QTR1_VAL')\n        }\n        if (!(record?.EMP_MAR12_NUM_F.charAt(1) === 'G' || record?.EMP_MAR12_NUM_F?.charAt(2) === 'G')) {\n            setVal('EMP_MAR12_NUM')\n        }\n    } else {\n        if (aies_rp?.PAY_QTR1_VAL == 0 && record?.PAY_QTR1_VAL_F && ['R', 'T', 'K'].includes(record?.PAY_QTR1_VAL_F?.charAt(0)) && record?.PAY_QTR1_VAL_F?.charAt(1) == '_') {\n            setVal('EMP_MAR12_NUM')\n            setVal('PAY_QTR1_VAL')\n        }\n    }\n\n    return msg;\n\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NONNORM Set Basic'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "1bb9ec440766bd2c",
        "type": "function",
        "z": "5251d9acce14d156",
        "name": "Set NONORM",
        "func": "try{ \n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    record.NONNORM = '_'\n    if (record?.OPSTATS == 'Y') {\n        let year = parseInt(record?.REF_PER.substring(0, 4))\n        if (year > 2023) {\n            let year = parseInt(record?.REF_PER.substring(0, 4))\n            if (record?.REPORTING_ID_TYP_TXT == 'MU' && record?.ACTV_MIO_NUM < 12 &&\n                // for system integration prior_refper_pay_ann_val will need to be a db reference for the value of pay_ann_val of the prior years data in db\n                (record?.ACTV_MIO_NUM_F?.charAt(2) == 'Y' || parseFloat(record?.PRIOR_REFPER_PAY_ANN_VAL) == 0)) {\n                record.NONNORM = 'B'\n                record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n            } else {\n                if (record.ACTV_MIO_NUM < 12) {\n                    record.NONNORM = 'S'\n                    record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n                }\n            }\n            record.ACTION = 'Return to NonNORM Router';\n        } else {\n            if (record.REPORTING_ID_TYP_TXT == 'MU' && record.ACTV_MIO_NUM < 12 &&\n                // for system integration EC_PAY_ANN_VAL for this module will need to be tied to EC.PAY_ANN_VAL where ref_per = 2022U1\n                (record?.ACTV_MIO_NUM_F?.charAt(2) == 'L' || parseFloat(record?.REFPER_2022U1_EC_PAY_ANN_VAL) == 0)) {\n                record.NONNORM = 'B'\n                record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n                record.ACTION = 'Return to NonNORM Router';\n            } else {\n                if (record.ACTV_MIO_NUM < 12) {\n                    record.NONNORM = 'S'\n                    record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n                }\n            }\n            record.ACTION = 'Return to NonNORM Router';\n        }\n    } else {\n        record.NONNORM = 'D'\n        record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'J');\n        record.ACTION = 'Return to NonNORM Router';\n    }\n    return msg;\n} catch(e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'set NONNORM'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "213085be48a9be47",
        "type": "function",
        "z": "5251d9acce14d156",
        "name": "Set NONORM (database)",
        "func": "try{ \n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    let aies_minus = msg.aies_minus[0]\n    \n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    record.NONNORM = '_'\n    if (record?.OPSTATS == 'Y') {\n        let year = parseInt(record?.REF_PER.substring(0, 4))\n        if (year > 2023) {\n            let year = parseInt(record?.REF_PER.substring(0, 4))\n            if (record?.REPORTING_ID_TYP_TXT == 'MU' && record?.ACTV_MIO_NUM < 12 &&\n                // for system integration prior_refper_pay_ann_val will need to be a db reference for the value of pay_ann_val of the prior years data in db\n                (record?.ACTV_MIO_NUM_F?.charAt(2) == 'Y' || parseFloat(aies_minus?.PAY_ANN_VAL) == 0)) {\n                record.NONNORM = 'B'\n                record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n            } else {\n                if (record.ACTV_MIO_NUM < 12) {\n                    record.NONNORM = 'S'\n                    record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n                }\n            }\n        } else {\n            if (record.REPORTING_ID_TYP_TXT == 'MU' && record.ACTV_MIO_NUM < 12 &&\n                (record?.ACTV_MIO_NUM_F?.charAt(2) == 'L' || parseFloat(ec?.PAY_ANN_VAL) == 0)) {\n                record.NONNORM = 'B'\n                record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n            } else {\n                if (record.ACTV_MIO_NUM < 12) {\n                    record.NONNORM = 'S'\n                    record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n                }\n            }\n        }\n    } else {\n        record.NONNORM = 'D'\n        record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'J');\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Set NONNORM'\n    return msg;\n};",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "2d63887727bfd997",
        "type": "function",
        "z": "5251d9acce14d156",
        "name": "reset msg",
        "func": "msg.aies_minus = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 500,
        "wires": [
            [
                "213085be48a9be47"
            ]
        ]
    },
    {
        "id": "855017b9a531c25b",
        "type": "function",
        "z": "5251d9acce14d156",
        "name": "query_aies_prior_year",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.PRODUCT_REFPER_UNIT_ID\nlet ref_per = parseFloat(record.REF_PER.substring(0,4)) - 1\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_ESTAB_TABLE = env.get('DB_ESTAB_TABLE')\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_ESTAB_TABLE + \" where product_refper_unit_id = '\" + id + \"' and version = 'PO' and ref_per = '\" + ref_per + \"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 500,
        "wires": [
            [
                "d396310697ea6cf6"
            ]
        ]
    },
    {
        "id": "d396310697ea6cf6",
        "type": "subflow:8032608991ae0162",
        "z": "5251d9acce14d156",
        "name": "",
        "x": 420,
        "y": 500,
        "wires": [
            [
                "2d63887727bfd997"
            ]
        ]
    },
    {
        "id": "9511bc37f025a9ac",
        "type": "function",
        "z": "a661e33a6e4be4fe",
        "name": "Set OPSTATS & ACTVMIO",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function setOpstatsActvmioPathC(TEMPMIO) {\n        record.OPSTATS = 'N'\n        record.OPSTATS_F = setCharAt(record['OPSTATS_F'], 2, 'Y')\n        setOpstatsActvmioPathB(TEMPMIO)\n    }\n    function setOpstatsActvmioPathB(TEMPMIO) {\n        record.ACTV_MIO_NUM = TEMPMIO\n        record.ACTV_MIO_NUM_F = setCharAt(record['ACTV_MIO_NUM_F'], 2, 'Y')\n        setOpstatsActvmioPathA()\n    }\n    function setOpstatsActvmioPathA() {\n        record.ACTION = 'Return to NonNORM Router'\n    }\n\n    //double check this\n    if (record.REPORTING_ID_TYP_TXT == 'SU') {\n        let TEMPMIO = 0\n        if (parseFloat(record?.PAY_QTR1_VAL) + parseFloat(record?.IRS_PAY_QTR1_VAL) > 0) {\n            TEMPMIO = TEMPMIO + 3\n        } else if (record?.REF_PER != '2022A1' || parseFloat(record?.IRS_PAY_ANN_VAL) <= 0) {\n            record.NONNORM = 'B'\n            record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y')\n        }\n        if (parseFloat(record?.IRS_PAY_QTR2_VAL) > 0) {\n            TEMPMIO = TEMPMIO + 3\n        }\n        if (parseFloat(record?.IRS_PAY_QTR3_VAL) > 0) {\n            TEMPMIO = TEMPMIO + 3\n        }\n        if (parseFloat(record?.IRS_PAY_QTR4_VAL) > 0 || record?.IRS_PAY_QTR4_VAL_F == \"_\") {\n            TEMPMIO = TEMPMIO + 3\n            const formattedBMF_FR941 = String(record?.BMF_FR941).padStart(2, '0');\n            if (['03', '51', '00'].includes(formattedBMF_FR941)) {\n                setOpstatsActvmioPathC(TEMPMIO)\n            } else {\n                setOpstatsActvmioPathB(TEMPMIO)\n            }\n        } else {\n            if (record?.OPSTATS_F?.charAt(2) == 'R') {\n                setOpstatsActvmioPathB(TEMPMIO)\n            } else {\n                setOpstatsActvmioPathC(TEMPMIO)\n            }\n        }\n\n    } else if (record?.OPSTATS_F?.charAt(2) == 'R' && ['R', 'T', 'K'].includes(record?.ACTV_MIO_NUM_F?.charAt(0))) {\n        setOpstatsActvmioPathA()\n    } else if (['211', '221', '241', '311', '321', '341', '401', '511', '741'].includes(record?.COV_CHG_CODE)) {\n        if (record?.COV_CHG_DATE) {\n            const formattedDate = record.COV_CHG_DATE.split(\"-\").reverse().join(\"-\");\n            const date = new Date(formattedDate);\n            if (date > new Date('2023-01-31') && date < new Date('2024-01-01')) {\n                record.ACTV_MIO_NUM = 13 - (date.getMonth() + 1);\n                record.ACTV_MIO_NUM_F = setCharAt(record['ACTV_MIO_NUM_F'], 2, '_')\n            }\n        }\n        setOpstatsActvmioPathA()\n    } else if (['111', '131', '791'].includes(record?.COV_CHG_CODE)) {\n        if (record?.COV_CHG_DATE) {\n            const formattedDate = record.COV_CHG_DATE.split(\"-\").reverse().join(\"-\");\n            const date = new Date(formattedDate);\n            if (date < new Date('01/01/2024')) {\n                record.ACTV_MIO_NUM = (date.getMonth() + 1)\n                record.ACTV_MIO_NUM_F = setCharAt(record['ACTV_MIO_NUM_F'], 2, 'Y')\n                record.OPSTATS = 'N'\n                record.OPSTATS_F = setCharAt(record['OPSTATS_F'], 2, 'Y')\n            }\n        }\n        setOpstatsActvmioPathA()\n    } else {\n        setOpstatsActvmioPathA()\n    }\n\n    return msg;\n} catch(e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'NONNORM Set Opstats'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "0bf82731e7668fda",
        "type": "function",
        "z": "a661e33a6e4be4fe",
        "name": "Set OPSTATS & ACTVMIO (database)",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    let irs = msg.payload.tables.irs.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function setOpstatsActvmioPathC(TEMPMIO) {\n        record.OPSTATS = 'N'\n        record.OPSTATS_F = setCharAt(record['OPSTATS_F'], 2, 'Y')\n        setOpstatsActvmioPathB(TEMPMIO)\n    }\n    function setOpstatsActvmioPathB(TEMPMIO) {\n        record.ACTV_MIO_NUM = TEMPMIO\n        record.ACTV_MIO_NUM_F = setCharAt(record['ACTV_MIO_NUM_F'], 2, 'Y')\n    }\n\n    //double check this\n    if (record.REPORTING_ID_TYP_TXT == 'SU') {\n        let TEMPMIO = 0\n        if (parseFloat(record?.PAY_QTR1_VAL) + parseFloat(irs?.PAY_QTR1_VAL) > 0) {\n            TEMPMIO = TEMPMIO + 3\n        } else if (record?.REF_PER != '2022A1' || parseFloat(irs?.PAY_ANN_VAL) <= 0) {\n            record.NONNORM = 'B'\n            record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y')\n        }\n        if (parseFloat(irs?.PAY_QTR2_VAL) > 0) {\n            TEMPMIO = TEMPMIO + 3\n        }\n        if (parseFloat(irs?.PAY_QTR3_VAL) > 0) {\n            TEMPMIO = TEMPMIO + 3\n        }\n        if (parseFloat(irs?.PAY_QTR4_VAL) > 0 || irs?.PAY_QTR4_VAL_F == \"_\") {\n            TEMPMIO = TEMPMIO + 3\n            const formattedBMF_FR941 = String(record?.BMF_FR941).padStart(2, '0');\n            if (['03', '51', '00'].includes(formattedBMF_FR941)) {\n                setOpstatsActvmioPathC(TEMPMIO)\n            } else {\n                setOpstatsActvmioPathB(TEMPMIO)\n            }\n        } else {\n            if (record?.OPSTATS_F?.charAt(2) == 'R') {\n                setOpstatsActvmioPathB(TEMPMIO)\n            } else {\n                setOpstatsActvmioPathC(TEMPMIO)\n            }\n        }\n\n    } else if (record?.OPSTATS_F?.charAt(2) == 'R' && ['R', 'T', 'K'].includes(record?.ACTV_MIO_NUM_F?.charAt(0))) {\n    } else if (['211', '221', '241', '311', '321', '341', '401', '511', '741'].includes(record?.COV_CHG_CODE)) {\n        if (record?.COV_CHG_DATE) {\n            const formattedDate = record.COV_CHG_DATE.split(\"-\").reverse().join(\"-\");\n            const date = new Date(formattedDate);\n            if (date > new Date('2023-01-31') && date < new Date('2024-01-01')) {\n                record.ACTV_MIO_NUM = 13 - (date.getMonth() + 1);\n                record.ACTV_MIO_NUM_F = setCharAt(record['ACTV_MIO_NUM_F'], 2, '_')\n            }\n        }\n    } else if (['111', '131', '791'].includes(record?.COV_CHG_CODE)) {\n        if (record?.COV_CHG_DATE) {\n            const formattedDate = record.COV_CHG_DATE.split(\"-\").reverse().join(\"-\");\n            const date = new Date(formattedDate);\n            if (date < new Date('01/01/2024')) {\n                record.ACTV_MIO_NUM = (date.getMonth() + 1)\n                record.ACTV_MIO_NUM_F = setCharAt(record['ACTV_MIO_NUM_F'], 2, 'Y')\n                record.OPSTATS = 'N'\n                record.OPSTATS_F = setCharAt(record['OPSTATS_F'], 2, 'Y')\n            }\n        }\n    }\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NONNORM Set Opstats'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "b0e28808b91c6ec3",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "NONNORM: Router database",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n    let irs = msg.payload.tables.irs.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    flow.set('nonnorm','')\n\n    function processRecord(record) {\n        if (['R', 'T', 'K'].includes(record?.ACTV_MIO_NUM_F?.charAt(0)) && record?.REPORTING_ID_TYP_TXT == 'SU') {\n            if (record?.ACTV_MIO_NUM < 12 && record?.REF_PER == '2022A1' && parseFloat(irs?.PAY_ANN_VAL) == 0) {\n                record.NONNORM = 'B';\n                record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n            }\n        } else {\n            if (['97', '98', '99'].includes(record?.BMF_FR941)) {\n            } else {\n                if (record?.ACTV_MIO_NUM_F?.charAt(1) == \"_\" && record?.OPSTATS_F?.charAt(1) == \"_\") {\n                    flow.set('nonnorm','setOpstat')\n                }\n            }\n        }\n    }\n\n    processRecord(record);\n    return msg;\n}catch(e){\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1590,
        "y": 520,
        "wires": [
            [
                "5ee638cd6c031f5b"
            ]
        ]
    },
    {
        "id": "531a95e4141f6041",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "",
        "property": "nonnorm",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "setOpstat",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1550,
        "y": 600,
        "wires": [
            [
                "25bc35687f98cb6f"
            ],
            [
                "1a3bdeb5b7661c2c"
            ]
        ]
    },
    {
        "id": "25bc35687f98cb6f",
        "type": "subflow:a661e33a6e4be4fe",
        "z": "b93bf22bc3258992",
        "name": "",
        "x": 1820,
        "y": 600,
        "wires": [
            [
                "1b333e1a8be816d4"
            ]
        ]
    },
    {
        "id": "1a3bdeb5b7661c2c",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "nonnorm_check",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NONNORM_F?.charAt(0) == '_' && record?.NONNORM_F?.charAt(1) == '_' && record?.NONNORM_F?.charAt(2) == '_') {\n        flow.set('nonnorm','Nonnorm')\n    } else if (record?.NONNORM_F?.charAt(0) == '_' && record?.NONNORM_F?.charAt(1) == '_' && record?.NONNORM_F?.charAt(2) == 'J') {\n        flow.set('nonnorm','Nonnorm')\n    }\n    return msg;\n} catch(e) {\n    global.set('err','ExitEdit')\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 700,
        "wires": [
            [
                "76be572a39be4bdf"
            ]
        ]
    },
    {
        "id": "513bf4fe19ee0d89",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "",
        "property": "nonnorm",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "Nonnorm",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1550,
        "y": 800,
        "wires": [
            [
                "ea1f82b99437cadd"
            ],
            [
                "786aaf43a58ee387"
            ]
        ]
    },
    {
        "id": "ea1f82b99437cadd",
        "type": "subflow:5251d9acce14d156",
        "z": "b93bf22bc3258992",
        "name": "",
        "x": 1800,
        "y": 780,
        "wires": [
            [
                "8f9b068c506c4b81"
            ]
        ]
    },
    {
        "id": "786aaf43a58ee387",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "check_Basic",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NONNORM == 'B') {\n        flow.set('nonnorm','setBasic')\n    }\n    return msg;\n} catch(e) {\n    global.set('err','ExitEdit')\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1570,
        "y": 920,
        "wires": [
            [
                "74acf36415f02509"
            ]
        ]
    },
    {
        "id": "63d49be91d8cc04b",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "",
        "property": "nonnorm",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "setBasic",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1550,
        "y": 1040,
        "wires": [
            [
                "2791eeab210f684d"
            ],
            [
                "a4bb6bc2fb1bedf3"
            ]
        ]
    },
    {
        "id": "2791eeab210f684d",
        "type": "subflow:b8154c600987e319",
        "z": "b93bf22bc3258992",
        "name": "",
        "x": 1880,
        "y": 1020,
        "wires": [
            [
                "14c8a1c0321785e4"
            ]
        ]
    },
    {
        "id": "a4bb6bc2fb1bedf3",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "check_Season",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NONNORM == 'S' && parseFloat(record?.ACTV_MIO_NUM) < 10 && parseFloat(record?.PAY_QTR1_VAL) == 0 && parseFloat(record?.EMP_MAR12_NUM) == 0) {\n        flow.set('nonnorm', 'Seasonal')\n    }\n    return msg;\n} catch (e) {\n    global.set('err', 'ExitEdit')\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1580,
        "y": 1140,
        "wires": [
            [
                "e29aea0b1729c026"
            ]
        ]
    },
    {
        "id": "4ee290960a71f086",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "",
        "property": "nonnorm",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "Seasonal",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2010,
        "y": 1280,
        "wires": [
            [
                "6a1ccd3660b252ad"
            ],
            []
        ]
    },
    {
        "id": "6a1ccd3660b252ad",
        "type": "subflow:e1f601e2c56dfda4",
        "z": "b93bf22bc3258992",
        "name": "",
        "x": 2160,
        "y": 1180,
        "wires": [
            []
        ]
    },
    {
        "id": "67d7853d425a88ed",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "NONNORM: Router",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    flow.set('nonnorm','')\n\n    \n    // function nonNORMRouterPathA() {\n    //     if ((record?.NONNORM_F == \"   \") || (record?.NONNORM_F == \"  J\")) {\n    //         setNONNORM()\n    //     }\n    //     if (record?.NONNORM == 'B') {\n    //         setBASIC()\n    //     }\n    //     if (record?.NONNORM == 'S' && record?.ACTV_MIO_NUM < 10 && record?.PAY_QTR1_VAL == 0 && record?.EMP_MAR12_NUM == 0) {\n    //         specialSeasonal()\n    //     }\n    //     record.ACTION = \"Exit to AIES Main Routing\";\n    // }\n    function processRecord(record) {\n        if (['R', 'T', 'K'].includes(record?.ACTV_MIO_NUM_F?.charAt(0)) && record?.REPORTING_ID_TYP_TXT == 'SU') {\n            if (record?.ACTV_MIO_NUM < 12 && record?.REF_PER == '2022A1' && parseFloat(record?.IRS_PAY_ANN_VAL) == 0) {\n                record.NONNORM = 'B';\n                record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n            }\n        } else {\n            if (['97', '98', '99'].includes(record?.BMF_FR941)) {\n            } else {\n                if (record?.ACTV_MIO_NUM_F?.charAt(1) == \"_\" && record?.OPSTATS_F?.charAt(1) == \"_\") {\n                    flow.set('nonnorm','setOpstat')\n                }\n            }\n        }\n    }\n    \n    processRecord(record);\n    return msg;\n}catch(e){\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 540,
        "wires": [
            [
                "5aa9633017e8d63e"
            ]
        ]
    },
    {
        "id": "91c8045841b3afc1",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "",
        "property": "nonnorm",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "setOpstat",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 250,
        "y": 600,
        "wires": [
            [
                "012d7cd5a43b7380"
            ],
            [
                "511df3f091066649"
            ]
        ]
    },
    {
        "id": "012d7cd5a43b7380",
        "type": "subflow:a661e33a6e4be4fe",
        "z": "b93bf22bc3258992",
        "name": "",
        "x": 520,
        "y": 600,
        "wires": [
            [
                "7a35a2a22d05ef32"
            ]
        ]
    },
    {
        "id": "511df3f091066649",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "nonnorm_check",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NONNORM_F?.charAt(0) == '_' && record?.NONNORM_F?.charAt(1) == '_' && record?.NONNORM_F?.charAt(2) == '_') {\n        flow.set('nonnorm','Nonnorm')\n    } else if (record?.NONNORM_F?.charAt(0) == '_' && record?.NONNORM_F?.charAt(1) == '_' && record?.NONNORM_F?.charAt(2) == 'J') {\n        flow.set('nonnorm','Nonnorm')\n    }\n    return msg;\n} catch(e) {\n    global.set('err','ExitEdit')\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 700,
        "wires": [
            [
                "2b2ac02cd102febb"
            ]
        ]
    },
    {
        "id": "033d6e13c3ff9d2d",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "",
        "property": "nonnorm",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "Nonnorm",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 250,
        "y": 780,
        "wires": [
            [
                "febe29fbd707ad07"
            ],
            [
                "752530fb1d3a6fc2"
            ]
        ]
    },
    {
        "id": "febe29fbd707ad07",
        "type": "subflow:5251d9acce14d156",
        "z": "b93bf22bc3258992",
        "name": "",
        "x": 520,
        "y": 780,
        "wires": [
            [
                "10dd3dc15f8c51f7"
            ]
        ]
    },
    {
        "id": "752530fb1d3a6fc2",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "check_Basic",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n    if (record?.NONNORM == 'B') {\n        flow.set('nonnorm','setBasic')\n    }\n    return msg;\n} catch(e) {\n    global.set('err','ExitEdit')\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 860,
        "wires": [
            [
                "0c24ccfcfab4286e"
            ]
        ]
    },
    {
        "id": "b740246053ff9e5e",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "",
        "property": "nonnorm",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "setBasic",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 250,
        "y": 960,
        "wires": [
            [
                "9d204258305d6a87"
            ],
            [
                "62d869473113339f"
            ]
        ]
    },
    {
        "id": "9d204258305d6a87",
        "type": "subflow:b8154c600987e319",
        "z": "b93bf22bc3258992",
        "name": "",
        "x": 520,
        "y": 940,
        "wires": [
            [
                "7421111e8e6f6628"
            ]
        ]
    },
    {
        "id": "62d869473113339f",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "check_Season",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n    if (record?.NONNORM == 'S' && parseFloat(record?.ACTV_MIO_NUM) < 10 && parseFloat(record?.PAY_QTR1_VAL) == 0 && parseFloat(record?.EMP_MAR12_NUM) == 0) {\n        flow.set('nonnorm', 'Seasonal')\n    }\n    return msg;\n} catch (e) {\n    global.set('err', 'ExitEdit')\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 1060,
        "wires": [
            [
                "5fc9a4338bfcf05c"
            ]
        ]
    },
    {
        "id": "523d7db5c28b97c6",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "",
        "property": "nonnorm",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "Seasonal",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 690,
        "y": 1160,
        "wires": [
            [
                "8236aa72a4466f04"
            ],
            []
        ]
    },
    {
        "id": "8236aa72a4466f04",
        "type": "subflow:e1f601e2c56dfda4",
        "z": "b93bf22bc3258992",
        "name": "",
        "x": 800,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "5ee638cd6c031f5b",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1900,
        "y": 520,
        "wires": [
            [],
            [
                "531a95e4141f6041"
            ]
        ]
    },
    {
        "id": "76be572a39be4bdf",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1880,
        "y": 680,
        "wires": [
            [],
            [
                "513bf4fe19ee0d89"
            ]
        ]
    },
    {
        "id": "1b333e1a8be816d4",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2080,
        "y": 600,
        "wires": [
            [],
            [
                "1a3bdeb5b7661c2c"
            ]
        ]
    },
    {
        "id": "8f9b068c506c4b81",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2060,
        "y": 780,
        "wires": [
            [],
            [
                "786aaf43a58ee387"
            ]
        ]
    },
    {
        "id": "74acf36415f02509",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1840,
        "y": 920,
        "wires": [
            [],
            [
                "63d49be91d8cc04b"
            ]
        ]
    },
    {
        "id": "14c8a1c0321785e4",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2160,
        "y": 1020,
        "wires": [
            [],
            [
                "a4bb6bc2fb1bedf3"
            ]
        ]
    },
    {
        "id": "e29aea0b1729c026",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1840,
        "y": 1140,
        "wires": [
            [],
            [
                "4ee290960a71f086"
            ]
        ]
    },
    {
        "id": "5aa9633017e8d63e",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 780,
        "y": 540,
        "wires": [
            [],
            [
                "91c8045841b3afc1"
            ]
        ]
    },
    {
        "id": "7a35a2a22d05ef32",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 780,
        "y": 600,
        "wires": [
            [],
            [
                "511df3f091066649"
            ]
        ]
    },
    {
        "id": "2b2ac02cd102febb",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 760,
        "y": 700,
        "wires": [
            [],
            [
                "033d6e13c3ff9d2d"
            ]
        ]
    },
    {
        "id": "10dd3dc15f8c51f7",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 760,
        "y": 780,
        "wires": [
            [],
            [
                "752530fb1d3a6fc2"
            ]
        ]
    },
    {
        "id": "0c24ccfcfab4286e",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 540,
        "y": 860,
        "wires": [
            [],
            [
                "b740246053ff9e5e"
            ]
        ]
    },
    {
        "id": "5fc9a4338bfcf05c",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 500,
        "y": 1060,
        "wires": [
            [],
            [
                "523d7db5c28b97c6"
            ]
        ]
    },
    {
        "id": "7421111e8e6f6628",
        "type": "switch",
        "z": "b93bf22bc3258992",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 780,
        "y": 940,
        "wires": [
            [],
            [
                "62d869473113339f"
            ]
        ]
    },
    {
        "id": "134a4f1619c6a8a3",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "NONNORM: Router database",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    msg.nonnorm = ''\n\n    function processRecord(record) {\n        if (['R', 'T', 'K'].includes(record?.ACTV_MIO_NUM_F?.charAt(0)) && record?.REPORTING_ID_TYP_TXT == 'SU') {\n            if (record?.ACTV_MIO_NUM < 12 && record?.REF_PER == '2022A1' && parseFloat(record?.IRS_PAY_ANN_VAL) == 0) {\n                record.NONNORM = 'B';\n                record.NONNORM_F = setCharAt(record['NONNORM_F'], 2, 'Y');\n            }\n        } else {\n            if (['97', '98', '99'].includes(record?.BMF_FR941)) {\n            } else {\n                if (record?.ACTV_MIO_NUM_F?.charAt(1) == \"_\" && record?.OPSTATS_F?.charAt(1) == \"_\") {\n                    msg.nonnorm = 'setOpstat'\n                }\n            }\n        }\n    }\n    \n    processRecord(record);\n    return msg;\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "ec579f432219aaf9",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "nonnorm_check database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NONNORM_F?.charAt(0) == '_' && record?.NONNORM_F?.charAt(1) == '_' && record?.NONNORM_F?.charAt(2) == '_') {\n        msg.nonnorm = 'Nonnorm'\n    } else if (record?.NONNORM_F?.charAt(0) == '_' && record?.NONNORM_F?.charAt(1) == '_' && record?.NONNORM_F?.charAt(2) == 'J') {\n        msg.nonnorm = 'Nonnorm'\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'ExitEdit'\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "33345180deba9457",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "check_Basic_database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    if (record?.NONNORM == 'B') {\n        msg.nonnorm = 'setBasic'\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'ExitEdit'\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "bc53bd6edb4c6f3f",
        "type": "function",
        "z": "b93bf22bc3258992",
        "name": "check_Season database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    if (record?.NONNORM == 'S' && parseFloat(record?.ACTV_MIO_NUM) < 10 && parseFloat(record?.PAY_QTR1_VAL) == 0 && parseFloat(record?.EMP_MAR12_NUM) == 0) {\n        msg.nonnorm = 'Seasonal'\n    }\n    return msg;\n} catch (e) {\n    msg.err = 'ExitEdit'\n    msg.payload.exit = 'NONNORM Router'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "d831e0513adcc48e",
        "type": "function",
        "z": "e7b7501b29427db9",
        "name": "napcs_prep function",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    let cache = global.get(\"lookupCache\");\n    let naics_napcs = cache.data.find(\n        item =>\n            item.module === \"napcs\" &&\n            item.param === 'napcs_prep' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function resetNAPCS(row) {\n        if (row?.PROD_CODE) {\n            if (parseFloat(row?.PROD_CODE_VAL_PO) == 0) {\n                row.USABLE = 'D'\n            } else if (parseFloat(row?.PROD_CODE_VAL_PO) < 0) {\n                row.USABLE = 'I'\n            } else {\n                record.NAPCS_IND = 'U'\n                if (parseFloat(row?.PROD_CODE_VAL_PO) > 0) {\n                    if (row?.PROD_CODE.substring(0, 7) == '9000000') {\n                        row.USABLE = 'J'\n                    } else {\n                        row.USABLE = 'U'\n                    }\n                }\n            }\n        } else {\n            record.NAPCS_IND = '_'\n        }\n    }\n\n    function imputeHist() {\n        let id = record?.REPORTING_ID\n        if (record?.NAPCS_IMP == 'Y') {\n            for (let i in allData) {\n                let row = allData[i]\n                if (row?.REPORTING_ID == id) {\n                    if (row?.PROD_CODE_VAL_PI_F && row?.PROD_CODE_VAL_PI_F?.charAt(1) != '_') {\n                        record.NAPCS_IMP = '_'\n                    } else if (row?.PROD_CODE && (!(row?.PROD_CODE_VAL_PI_F))) {\n                        record.NAPCS_IMP = '_'\n                    }\n                }\n            }\n        } else if (record?.NAPCS_IND == '_') {\n            if (record?.HISTSTAT == 'Y' && record?.EC_NAPCS_IND == 'U' && parseFloat(record?.EC_NAPCS_BLTOT) > 0 && parseFloat(record?.EC_RCPT_TOT_VAL) > 0) {\n                for (let i in allData) {\n                    let row = allData[i]\n                    if (row?.EC_REPORTING_ID == id) {\n                        if (parseFloat(row?.EC_NAPCS_PROD_CODE_VAL_PO) > 0) {\n                            if (['I', 'D', 'X'].includes(row?.EC_NAPCS_USABLE)) {\n                            } else {\n                                record.NAPCS_IMP = 'Y'\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    let id = record['REPORTING_ID']\n    //prod code po from here\n    let allData = msg.payload.csv;\n    let NAPCS_BLTOT = 0\n    let NAPCS_PRM = 0\n    let NAPCS_OTH = 0\n    let ProdFound = 'N'\n\n    if (record?.NAICS_SECTOR == '31' && record?.SUBSAMP_IND_TXT != 'MC') {\n        for (let i in allData) {\n            let row = allData[i]\n            if (row.REPORTING_ID == id) {\n                row.PROD_CODE_VAL_PO = row.PROD_CODE_VAL_PI\n                row.PROD_CODE_VAL_PO_F = row.PROD_CODE_VAL_PI_F\n                resetNAPCS(row)\n                if (row?.PROD_CODE) {\n                    ProdFound = 'Y'\n                }\n            }\n        }\n        if (ProdFound == 'N') {\n            record['NAPCS_IND'] = '_'\n        }\n\n        imputeHist()\n\n        let val_9000 = ''\n        for (let i in allData) {\n            let row = allData[i]\n            if (row.REPORTING_ID == id) {\n                if (row?.PROD_CODE) {\n                    if (['I', 'D', 'X'].includes(row?.USABLE)) {\n                    } else {\n                        if (row?.PROD_CODE.substring(7, 10) == '000') {\n                            NAPCS_BLTOT = NAPCS_BLTOT + parseFloat(row?.PROD_CODE_VAL_PO)\n                        }\n                        if (row?.PROD_CODE.substring(0, 1) == '2') {\n                            NAPCS_PRM = NAPCS_PRM + parseFloat(row?.PROD_CODE_VAL_PO)\n                        }\n                        if (row?.PROD_CODE.substring(0, 1) != '2') {\n                            if (row.PROD_CODE.substring(0, 7) == '9000000') {\n                            } else {\n                                NAPCS_OTH = NAPCS_OTH + parseFloat(row?.PROD_CODE_VAL_PO)\n                            }\n                        }\n                        let napcs = naics_napcs.NAPCS_PREP.some(element => (parseInt(element.NAPCS) === parseInt(row?.PROD_CODE)));\n                        if (napcs) {\n                        } else {\n                            row.USABLE = 'I'\n                        }\n                    }\n                    if (row?.PROD_CODE == '9000000000') {\n                        val_9000 = row?.PROD_CODE_VAL_PO\n                    }\n                }\n            }\n        }\n\n        record['NAPCS_BLTOT'] = NAPCS_BLTOT\n        record['NAPCS_BAL'] = parseFloat(record?.RCPT_TOT_VAL) - NAPCS_BLTOT\n        record['NAPCS_PRM'] = NAPCS_PRM\n        record['NAPCS_OTH'] = NAPCS_OTH\n\n        // if (val_9000 != '') {\n        //     if (parseFloat(val_9000) > (parseFloat(NAPCS_BLTOT) - parseFloat(val_9000))) {\n        //         record['FLAG'] = 'WRITEIN_IND_DETER'\n        //     }\n        // }\n\n        record.ACTION = 'END'\n    } else {\n        record.ACTION = 'Go to Main Routing'\n    }\n\n    return msg;\n} catch (e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'NAPCS Prep'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "7107f40b085e1575",
        "type": "function",
        "z": "e7b7501b29427db9",
        "name": "napcs_prep function_db",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    let ec_napcs = msg.payload.tables.ec_napcs;\n\n    let cache = global.get(\"lookupCache\");\n    let naics_napcs = cache.data.find(\n        item =>\n            item.module === \"napcs\" &&\n            item.param === 'napcs_prep' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    function resetNAPCS(row) {\n        if (row?.PROD_CODE) {\n            if (parseFloat(row?.PROD_CODE_VAL_PO) == 0) {\n                row.USABLE = 'D'\n            } else if (parseFloat(row?.PROD_CODE_VAL_PO) < 0) {\n                row.USABLE = 'I'\n            } else {\n                record.NAPCS_IND = 'U'\n                if (parseFloat(row?.PROD_CODE_VAL_PO) > 0) {\n                    if (row?.PROD_CODE.substring(0, 7) == '9000000') {\n                        row.USABLE = 'J'\n                    } else {\n                        row.USABLE = 'U'\n                    }\n                }\n            }\n        }\n    }\n\n    function imputeHist() {\n        let id = record?.REPORTING_ID\n        if (record?.NAPCS_IMP == 'Y') {\n            for (let i in allData) {\n                let row = allData[i].facts\n                if (row.REPORTING_ID == id) {\n                    if (row?.PROD_CODE_VAL_PI_F && row?.PROD_CODE_VAL_PI_F.charAt(1) != '_') {\n                        record.NAPCS_IMP = '_'\n                    } else if (row?.PROD_CODE && (!(row?.PROD_CODE_VAL_PI_F))) {\n                        record.NAPCS_IMP = '_'\n                    }\n                }\n            }\n        } else if (record?.NAPCS_IND == '_') {\n            if (record?.HISTSTAT == 'Y' && ec.NAPCS_IND == 'U' && ec.NAPCS_BLTOT > 0 && ec.RCPT_TOT_VAL > 0) {\n                for (let i in ec_napcs) {\n                    let row = ec_napcs[i].fact\n                    if (row.REPORTING_ID == id) {\n                        if (parseFloat(row?.PROD_CODE_VAL_PO) > 0) {\n                            if (['I', 'D', 'X'].includes(row?.USABLE)) {\n                            } else {\n                                record.NAPCS_IMP = 'Y'\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    let allData = msg.napcs;\n\n    let NAPCS_BLTOT = 0\n    let NAPCS_PRM = 0\n    let NAPCS_OTH = 0\n    let ProdFound = 'N'\n\n    if (record?.NAICS_SECTOR == '31' && record?.SUBSAMP_IND_TXT != 'MC') {\n        let id = record?.REPORTING_ID\n        for (let i in allData) {\n            let row = allData[i]\n            if (row.REPORTING_ID == id) {\n                row.PROD_CODE_VAL_PO = row?.PROD_CODE_VAL_PI\n                row.PROD_CODE_VAL_PO_F = row?.PROD_CODE_VAL_PI_F\n                resetNAPCS(row)\n                if (row?.PROD_CODE) {\n                    ProdFound = 'Y'\n                }\n            }\n        }\n        if (ProdFound == 'N') {\n            record['NAPCS_IND'] = '_'\n        }\n\n        imputeHist()\n\n        let val_9000 = ''\n        for (let i in allData) {\n            let row = allData[i].facts\n            if (row.REPORTING_ID == id) {\n                if (row?.PROD_CODE) {\n                    if (['I', 'D', 'X'].includes(row?.USABLE)) {\n                    } else {\n                        if (row?.PROD_CODE.substring(7, 10) == '000') {\n                            NAPCS_BLTOT = NAPCS_BLTOT + parseFloat(row?.PROD_CODE_VAL_PO)\n                        }\n                        if (row?.PROD_CODE.substring(0, 1) == '2') {\n                            NAPCS_PRM = NAPCS_PRM + parseFloat(row?.PROD_CODE_VAL_PO)\n                        }\n                        if (row?.PROD_CODE.substring(0, 1) != '2') {\n                            if (row.PROD_CODE.substring(0, 7) == '9000000') {\n                            } else {\n                                NAPCS_OTH = NAPCS_OTH + parseFloat(row?.PROD_CODE_VAL_PO)\n                            }\n                        }\n                        let napcs = naics_napcs.NAPCS_PREP.some(element => (parseInt(element.NAPCS) === parseInt(row?.PROD_CODE)));\n                        if (napcs) {\n                        } else {\n                            row.USABLE = 'I'\n                        }\n                    }\n                    if (row?.PROD_CODE == '9000000000') {\n                        val_9000 = row?.PROD_CODE_VAL_PO\n                    }\n                }\n            }\n        }\n        record['NAPCS_BLTOT'] = NAPCS_BLTOT\n        record['NAPCS_BAL'] = parseFloat(record?.RCPT_TOT_VAL) - NAPCS_BLTOT\n        record['NAPCS_PRM'] = NAPCS_PRM\n        record['NAPCS_OTH'] = NAPCS_OTH\n\n        // if (val_9000 != '') {\n        //     if (parseFloat(val_9000) > (parseFloat(NAPCS_BLTOT) - parseFloat(val_9000))) {\n        //         record['FLAG'] = 'WRITEIN_IND_DETER'\n        //     }\n        // }\n    }\n        \n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS Prep'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 280,
        "wires": [
            [
                "47abda326034b5ad"
            ]
        ]
    },
    {
        "id": "7afc95955b988a72",
        "type": "function",
        "z": "e7b7501b29427db9",
        "name": "reset msg",
        "func": "msg.napcs = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 280,
        "wires": [
            [
                "7107f40b085e1575"
            ]
        ]
    },
    {
        "id": "6796f4ce3af71d7b",
        "type": "function",
        "z": "e7b7501b29427db9",
        "name": "query_napcs",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.REPORTING_ID\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where reporting_id = '\" + id + \"' and type = 'NAPCS' and jobname = '\" + job +\"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 160,
        "wires": [
            [
                "1ec625f6573706e3"
            ]
        ]
    },
    {
        "id": "1ec625f6573706e3",
        "type": "subflow:8032608991ae0162",
        "z": "e7b7501b29427db9",
        "name": "",
        "x": 460,
        "y": 160,
        "wires": [
            [
                "7afc95955b988a72"
            ]
        ]
    },
    {
        "id": "47abda326034b5ad",
        "type": "function",
        "z": "e7b7501b29427db9",
        "name": "NOT CODED CALL NAPCS UPDATE API",
        "func": "\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "83e6537885e334ae",
        "type": "function",
        "z": "0179503501c47e39",
        "name": "mfg mu su to kau",
        "func": "try {\n    let record_idx = global.get('ptrModuleFacts')\n    let record = msg.payload.csv[record_idx]\n\n    let suMu = msg.payload.csv\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function childFlagRules(variable, details, data, idvar) {\n        let allData = data\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i of details) {\n                // find instance of no\n                let findFlg1 = allData.find(mu => mu?.[idvar] == record?.[idvar] && mu?.RECORD_TYP_TXT == '20' && mu?.TABSTAT == 'Y' &&\n                    (!['R_', 'K_', 'T_'].includes(mu?.[i]?.substring(0, 2))) && (!['R', 'C', 'A', 'S', 'O', 'G'].includes(mu?.[i]?.charAt(1))))\n\n                // find instance of yes\n                let findFlg2 = allData.find(mu => mu?.[idvar] == record?.[idvar] && mu?.RECORD_TYP_TXT == '20' && mu?.TABSTAT == 'Y' &&\n                    ((['R_', 'K_', 'T_'].includes(mu?.[i]?.substring(0, 2))) || (['R', 'C', 'A', 'S', 'O', 'G'].includes(mu?.[i]?.charAt(1)))))\n\n                if (findFlg2) {\n                    found = 'Y'\n                }\n\n                if (findFlg1) {\n                    found = 'N'\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n\n    if (record?.REPORTING_ID_TYP_TXT == 'KAU' && record?.NAICS_SECTOR == '31' && record?.ENT_TYP_TXT == 'SU') {\n\n        let suData = suMu.find(su => su.KAU_ID == record.KAU_ID && su.RECORD_TYP_TXT == '20')\n\n        let mfgSUListFlags = [\n            'CAPEX_BUILD_NEW_VAL_F', 'CAPEX_BUILD_TOT_DVAL_F', 'CAPEX_BUILD_USED_VAL_F', 'CAPEX_MACH_NEW_VAL_F', \n            'CAPEX_MACH_TOT_DVAL_F', 'CAPEX_MACH_USED_VAL_F', 'CAPEX_NEW_TOT_DVAL_F', 'CAPEX_TOT_DVAL_F',\n            'CAPEX_USED_TOT_DVAL_F', 'ELEC_GEN_KWH_NUM_F', 'ELEC_PRCH_KWH_NUM_F', 'ELEC_SOLD_KWH_NUM_F', \n            'EMP_MAR12_NONPRDWRK_DNUM_F', 'EMP_MAR12_NUM_F', 'EMP_MAR12_PRDWRK_NUM_F', 'EXPS_ADVERT_VAL_F', \n            'EXPS_BUILD_REP_VAL_F', 'EXPS_COMMSVC_VAL_F', 'EXPS_COMPTR_OTHEQ_VAL_F', 'EXPS_CONTRACT_VAL_F', \n            'EXPS_DATAPROC_VAL_F', 'EXPS_ELEC_VAL_F', 'EXPS_EXSOFT_VAL_F', 'EXPS_FRNG_BENEFIT_VAL_F', \n            'EXPS_FUEL_VAL_F', 'EXPS_MAT_V1_VAL_F', 'EXPS_OTHER_VAL_F', 'EXPS_PROFTECH_VAL_F', \n            'EXPS_REFUSE_VAL_F', 'EXPS_RENT_BUILD_VAL_F', 'EXPS_RENT_MACH_VAL_F', 'EXPS_RESALE_VAL_F', \n            'EXPS_TAX_VAL_F', 'EXPS_TEMPSTAF_VAL_F', 'EXPS_TOT_DVAL_F', 'EXPS_TOT_VAL_F', \n            'HOURS_PRDWRK_NUM_F', 'INV_B_AVG_VAL_F', 'INV_B_FIFO_VAL_F', \n            'INV_B_FIN_VAL_F', 'INV_B_IVAL_TOT_DVAL_F', 'INV_B_LIFO_RSV_VAL_F', 'INV_B_LIFO_VAL_F', \n            'INV_B_MAT_VAL_F', 'INV_B_NL_TOT_DVAL_F', 'INV_B_OTHNL_VAL_F', 'INV_B_STD_VAL_F', \n            'INV_B_TOT_DVAL_F', 'INV_B_WIP_VAL_F', 'INV_E_AVG_VAL_F', 'INV_E_FIFO_VAL_F', \n            'INV_E_FIN_VAL_F', 'INV_E_IVAL_TOT_DVAL_F', 'INV_E_LIFO_RSV_VAL_F', 'INV_E_LIFO_VAL_F', \n            'INV_E_MAT_VAL_F', 'INV_E_NL_TOT_DVAL_F', 'INV_E_OTHNL_VAL_F', 'INV_E_STD_VAL_F', \n            'INV_E_TOT_DVAL_F', 'INV_E_WIP_VAL_F', 'PAY_ANN_NONPRDWRK_VAL_F', 'PAY_ANN_PRDWRK_VAL_F', \n            'PAY_ANN_VAL_F', 'PAY_QTR1_NONPRDWRK_DVAL_F', 'PAY_QTR1_PRDWRK_VAL_F', 'PAY_QTR1_VAL_F', \n            'RCPT_ECOMM_VAL_F', 'RCPT_TOT_VAL_F', 'ROBOT_INDST_INOP_NUM_F', 'ROBOT_INDST_PRCH_NUM_F', \n            'ROBOT_INDST_VAL_F'\n            // 73\n        ];\n\n        let mfgSUList = [\n            'CAPEX_BUILD_NEW_VAL', 'CAPEX_BUILD_TOT_DVAL', 'CAPEX_BUILD_USED_VAL', 'CAPEX_MACH_NEW_VAL', \n            'CAPEX_MACH_TOT_DVAL', 'CAPEX_MACH_USED_VAL', 'CAPEX_NEW_TOT_DVAL', 'CAPEX_TOT_DVAL', \n            'CAPEX_USED_TOT_DVAL', 'ELEC_GEN_KWH_NUM', 'ELEC_PRCH_KWH_NUM', 'ELEC_SOLD_KWH_NUM', \n            'EMP_EMP_MAR12_NONPRDWRK_DNUM', 'EMP_MAR12_NUM', 'EMP_MAR12_PRDWRK_NUM', 'EXPS_ADVERT_VAL', \n            'EXPS_BUILD_REP_VAL', 'EXPS_COMMSVC_VAL', 'EXPS_COMPTR_OTHEQ_VAL', 'EXPS_CONTRACT_VAL', \n            'EXPS_CSTMTOT_DVAL', 'EXPS_DATAPROC_VAL', 'EXPS_ELEC_VAL', 'EXPS_EXSOFT_VAL', \n            'EXPS_FRNG_BENEFIT_VAL', 'EXPS_FUEL_VAL', 'EXPS_MACH_REP_VAL', 'EXPS_MAT_V1_VAL', \n            'EXPS_OTHER_VAL', 'EXPS_PCHTT_DVAL', 'EXPS_PROFTECH_VAL', 'EXPS_REFUSE_VAL', \n            'EXPS_RENT_BUILD_VAL', 'EXPS_RENT_MACH_VAL', 'EXPS_RESALE_VAL', 'EXPS_RPTOT_DVAL', \n            'EXPS_TAX_VAL', 'EXPS_TEMPSTAF_VAL', 'EXPS_TOT_DVAL', 'EXPS_TOT_VAL', \n            'HOURS_PRDWRK_NUM', 'INV_B_AVG_VAL', 'INV_B_FIFO_VAL', \n            'INV_B_FIN_VAL', 'INV_B_IVAL_TOT_DVAL', 'INV_B_LIFO_RSV_VAL', 'INV_B_LIFO_VAL', \n            'INV_B_MAT_VAL', 'INV_B_NL_TOT_DVAL', 'INV_B_OTHNL_VAL', 'INV_B_STD_VAL', \n            'INV_B_TOT_DVAL', 'INV_B_WIP_VAL', 'INV_E_AVG_VAL', 'INV_E_FIFO_VAL', \n            'INV_E_FIN_VAL', 'INV_E_IVAL_TOT_DVAL', 'INV_E_LIFO_RSV_VAL', 'INV_E_LIFO_VAL', \n            'INV_E_MAT_VAL', 'INV_E_NL_TOT_DVAL', 'INV_E_OTHNL_VAL', 'INV_E_STD_VAL', \n            'INV_E_TOT_DVAL', 'INV_E_WIP_VAL', 'INV_STAT', 'NONTABFL', \n            'PAY_ANN_NONPRDWRK_VAL', 'PAY_ANN_PRDWRK_VAL', 'PAY_ANN_VAL', 'PAY_QTR1_NONPRDWRK_DVAL', \n            'PAY_QTR1_PRDWRK_VAL', 'PAY_QTR1_VAL', 'RCPT_ECOMM_VAL', 'RCPT_TOT_VAL', \n            'ROBOT_INDST_INOP_NUM', 'ROBOT_INDST_PRCH_NUM', 'ROBOT_INDST_VAL', 'TABSTAT', \n            'VALUE_ADDED_DVAL'\n            // 81\n        ];\n\n        for (let name of mfgSUList) {\n            record[name] = suData[name];\n        }\n        for (let flag of mfgSUListFlags) {\n            let flagValue = suData[flag]\n            let flagLetter = flagValue?.charAt(2)\n            if ([null, undefined].includes(flagLetter)) {\n                flagLetter = '_'\n            }\n            record[flag] = setCharAt(record[flag], 2, flagLetter)\n        }\n    } else if (record?.REPORTING_ID_TYP_TXT == 'KAU' && record?.NAICS_SECTOR == '31' && record?.ENT_TYP_TXT == 'MU') {\n\n        let muData = suMu.filter(mu => mu.KAU_ID == record.KAU_ID && mu.RECORD_TYP_TXT == '20' && mu.TABSTAT == 'Y')\n        if ((muData.length >= 1)) {\n\n            let mfgMUListFlags = [\n                'CAPEX_BUILD_NEW_VAL_F', 'CAPEX_BUILD_TOT_DVAL_F', 'CAPEX_BUILD_USED_VAL_F', 'CAPEX_MACH_NEW_VAL_F', \n                'CAPEX_MACH_TOT_DVAL_F', 'CAPEX_MACH_USED_VAL_F', 'CAPEX_NEW_TOT_DVAL_F', 'CAPEX_TOT_DVAL_F', \n                'CAPEX_USED_TOT_DVAL_F', 'ELEC_GEN_KWH_NUM_F', 'ELEC_PRCH_KWH_NUM_F', 'ELEC_SOLD_KWH_NUM_F', \n                'EMP_MAR12_NONPRDWRK_DNUM_F', 'EMP_MAR12_NUM_F', 'EMP_MAR12_PRDWRK_NUM_F', 'EXPS_ADVERT_VAL_F', \n                'EXPS_BUILD_REP_VAL_F', 'EXPS_COMMSVC_VAL_F', 'EXPS_COMPTR_OTHEQ_VAL_F', 'EXPS_CONTRACT_VAL_F', \n                'EXPS_DATAPROC_VAL_F', 'EXPS_ELEC_VAL_F', 'EXPS_EXSOFT_VAL_F', 'EXPS_FRNG_BENEFIT_VAL_F', \n                'EXPS_FUEL_VAL_F', 'EXPS_MAT_V1_VAL_F', 'EXPS_OTHER_VAL_F', 'EXPS_PROFTECH_VAL_F', \n                'EXPS_REFUSE_VAL_F', 'EXPS_RENT_BUILD_VAL_F', 'EXPS_RENT_MACH_VAL_F', 'EXPS_RESALE_VAL_F', \n                'EXPS_TAX_VAL_F', 'EXPS_TEMPSTAF_VAL_F', 'EXPS_TOT_DVAL_F', 'EXPS_TOT_VAL_F', \n                'HOURS_PRDWRK_NUM_F', 'INV_B_AVG_VAL_F', 'INV_B_FIFO_VAL_F', \n                'INV_B_FIN_VAL_F', 'INV_B_IVAL_TOT_DVAL_F', 'INV_B_LIFO_RSV_VAL_F', 'INV_B_LIFO_VAL_F', \n                'INV_B_MAT_VAL_F', 'INV_B_NL_TOT_DVAL_F', 'INV_B_OTHNL_VAL_F', 'INV_B_STD_VAL_F', \n                'INV_B_TOT_DVAL_F', 'INV_B_WIP_VAL_F', 'INV_E_AVG_VAL_F', 'INV_E_FIFO_VAL_F', \n                'INV_E_FIN_VAL_F', 'INV_E_IVAL_TOT_DVAL_F', 'INV_E_LIFO_RSV_VAL_F', 'INV_E_LIFO_VAL_F', \n                'INV_E_MAT_VAL_F', 'INV_E_NL_TOT_DVAL_F', 'INV_E_OTHNL_VAL_F', 'INV_E_STD_VAL_F', \n                'INV_E_TOT_DVAL_F', 'INV_E_WIP_VAL_F', 'PAY_ANN_NONPRDWRK_VAL_F', 'PAY_ANN_PRDWRK_VAL_F', \n                'PAY_ANN_VAL_F', 'PAY_QTR1_NONPRDWRK_DVAL_F', 'PAY_QTR1_PRDWRK_VAL_F', 'PAY_QTR1_VAL_F', \n                'RCPT_ECOMM_VAL_F', 'RCPT_TOT_VAL_F', 'RCPT_UFO_STAT_F', 'RCPT_UFO_VAL_F', \n                'ROBOT_INDST_INOP_NUM_F', 'ROBOT_INDST_PRCH_NUM_F', 'ROBOT_INDST_VAL_F'\n                // 75\n            ];\n\n            let mfgMUList = [\n                'CAPEX_BUILD_NEW_VAL', 'CAPEX_BUILD_TOT_DVAL', 'CAPEX_BUILD_USED_VAL', 'CAPEX_MACH_NEW_VAL', \n                'CAPEX_MACH_TOT_DVAL', 'CAPEX_MACH_USED_VAL', 'CAPEX_NEW_TOT_DVAL', 'CAPEX_TOT_DVAL', \n                'CAPEX_USED_TOT_DVAL', 'ELEC_GEN_KWH_NUM', 'ELEC_PRCH_KWH_NUM', 'ELEC_SOLD_KWH_NUM', \n                'EMP_EMP_MAR12_NONPRDWRK_DNUM', 'EMP_MAR12_NUM', 'EMP_MAR12_PRDWRK_NUM', 'EXPS_ADVERT_VAL', \n                'EXPS_BUILD_REP_VAL', 'EXPS_COMMSVC_VAL', 'EXPS_COMPTR_OTHEQ_VAL', 'EXPS_CONTRACT_VAL', \n                'EXPS_CSTMTOT_DVAL', 'EXPS_DATAPROC_VAL', 'EXPS_ELEC_VAL', 'EXPS_EXSOFT_VAL', \n                'EXPS_FRNG_BENEFIT_VAL', 'EXPS_FUEL_VAL', 'EXPS_MACH_REP_VAL', 'EXPS_MAT_V1_VAL', \n                'EXPS_OTHER_VAL', 'EXPS_PCHTT_DVAL', 'EXPS_PROFTECH_VAL', 'EXPS_REFUSE_VAL', \n                'EXPS_RENT_BUILD_VAL', 'EXPS_RENT_MACH_VAL', 'EXPS_RESALE_VAL', 'EXPS_RPTOT_DVAL', \n                'EXPS_TAX_VAL', 'EXPS_TEMPSTAF_VAL', 'EXPS_TOT_DVAL', 'EXPS_TOT_VAL', \n                'HOURS_PRDWRK_NUM', 'INV_B_AVG_VAL', 'INV_B_FIFO_VAL', \n                'INV_B_FIN_VAL', 'INV_B_IVAL_TOT_DVAL', 'INV_B_LIFO_RSV_VAL', 'INV_B_LIFO_VAL', \n                'INV_B_MAT_VAL', 'INV_B_NL_TOT_DVAL', 'INV_B_OTHNL_VAL', 'INV_B_STD_VAL', \n                'INV_B_TOT_DVAL', 'INV_B_WIP_VAL', 'INV_E_AVG_VAL', 'INV_E_FIFO_VAL', \n                'INV_E_FIN_VAL', 'INV_E_IVAL_TOT_DVAL', 'INV_E_LIFO_RSV_VAL', 'INV_E_LIFO_VAL', \n                'INV_E_MAT_VAL', 'INV_E_NL_TOT_DVAL', 'INV_E_OTHNL_VAL', 'INV_E_STD_VAL', \n                'INV_E_TOT_DVAL', 'INV_E_WIP_VAL', 'INV_STAT', 'PAY_ANN_NONPRDWRK_VAL', \n                'PAY_ANN_PRDWRK_VAL', 'PAY_ANN_VAL', 'PAY_QTR1_NONPRDWRK_DVAL', 'PAY_QTR1_PRDWRK_VAL', \n                'PAY_QTR1_VAL', 'RCPT_ECOMM_VAL', 'RCPT_TOT_VAL', 'RCPT_UFO_STAT', \n                'RCPT_UFO_VAL', 'ROBOT_INDST_INOP_NUM', 'ROBOT_INDST_PRCH_NUM', 'ROBOT_INDST_VAL', \n                'VALUE_ADDED_DVAL'\n                // 81 \n            ];\n            for (let name of mfgMUList) {\n                let value = muData.map(mu => mu?.[name]).reduce((a, b) => parseFloat(a) + parseFloat(b));\n                record[name] = value;\n\n            }\n            for (let flag of mfgMUListFlags) {\n                let idvar = 'KAU_ID'\n                let len = flag.length - 2\n                let name = flag.substring(0,len)\n                childFlagRules(name, [flag], muData, idvar)\n            }\n        } else {\n            record['TABSTAT'] = 'N'\n        }\n    } \n    return msg;\n\n} catch (e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'NONMFG SU to KAU'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "b24bac40f275b02c",
        "type": "function",
        "z": "0179503501c47e39",
        "name": "mfg mu su to kau database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts\n    let record = msg.payload.csv[record_idx]\n\n    let suMu = msg.estabs\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function childFlagRules(variable, details, data, idvar) {\n        let allData = data\n        let flagname = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[flagname] = setCharAt(record?.[flagname], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i of details) {\n                // find instance of no\n                let findFlg1 = allData.find(mu => mu.facts?.[idvar] == record?.[idvar] && mu.facts?.TABSTAT == 'Y' &&\n                    (!['R_', 'K_', 'T_'].includes(mu.facts?.[i]?.substring(0, 2))) && (!['R', 'C', 'A', 'S', 'O', 'G'].includes(mu.fact?.[i]?.charAt(1))))\n\n                // find instance of yes\n                let findFlg2 = allData.find(mu => mu.facts?.[idvar] == record?.[idvar] && mu.facts?.TABSTAT == 'Y' &&\n                    ((['R_', 'K_', 'T_'].includes(mu.facts?.[i]?.substring(0, 2))) || (['R', 'C', 'A', 'S', 'O', 'G'].includes(mu.fact?.[i]?.charAt(1)))))\n\n                if (findFlg2) {\n                    found = 'Y'\n                }\n\n                if (findFlg1) {\n                    found = 'N'\n                }\n            }\n            if (found == 'Y') {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'Y');\n            } else {\n                record[flagname] = setCharAt(record?.[flagname], 2, 'S');\n            }\n        }\n    }\n\n\n    if (record?.REPORTING_ID_TYP_TXT == 'KAU' && record?.NAICS_SECTOR == '31' && record?.ENT_TYP_TXT == 'SU') {\n\n        let suData = suMu.find(su => su.facts.KAU_ID == record.KAU_ID)\n\n        let mfgSUListFlags = [\n            'CAPEX_BUILD_NEW_VAL_F', 'CAPEX_BUILD_TOT_DVAL_F', 'CAPEX_BUILD_USED_VAL_F', 'CAPEX_MACH_NEW_VAL_F', \n            'CAPEX_MACH_TOT_DVAL_F', 'CAPEX_MACH_USED_VAL_F', 'CAPEX_NEW_TOT_DVAL_F', 'CAPEX_TOT_DVAL_F',\n            'CAPEX_USED_TOT_DVAL_F', 'ELEC_GEN_KWH_NUM_F', 'ELEC_PRCH_KWH_NUM_F', 'ELEC_SOLD_KWH_NUM_F', \n            'EMP_MAR12_NONPRDWRK_DNUM_F', 'EMP_MAR12_NUM_F', 'EMP_MAR12_PRDWRK_NUM_F', 'EXPS_ADVERT_VAL_F', \n            'EXPS_BUILD_REP_VAL_F', 'EXPS_COMMSVC_VAL_F', 'EXPS_COMPTR_OTHEQ_VAL_F', 'EXPS_CONTRACT_VAL_F', \n            'EXPS_DATAPROC_VAL_F', 'EXPS_ELEC_VAL_F', 'EXPS_EXSOFT_VAL_F', 'EXPS_FRNG_BENEFIT_VAL_F', \n            'EXPS_FUEL_VAL_F', 'EXPS_MAT_V1_VAL_F', 'EXPS_OTHER_VAL_F', 'EXPS_PROFTECH_VAL_F', \n            'EXPS_REFUSE_VAL_F', 'EXPS_RENT_BUILD_VAL_F', 'EXPS_RENT_MACH_VAL_F', 'EXPS_RESALE_VAL_F', \n            'EXPS_TAX_VAL_F', 'EXPS_TEMPSTAF_VAL_F', 'EXPS_TOT_DVAL_F', 'EXPS_TOT_VAL_F', \n            'HOURS_PRDWRK_NUM_F', 'INV_B_AVG_VAL_F', 'INV_B_FIFO_VAL_F', \n            'INV_B_FIN_VAL_F', 'INV_B_IVAL_TOT_DVAL_F', 'INV_B_LIFO_RSV_VAL_F', 'INV_B_LIFO_VAL_F', \n            'INV_B_MAT_VAL_F', 'INV_B_NL_TOT_DVAL_F', 'INV_B_OTHNL_VAL_F', 'INV_B_STD_VAL_F', \n            'INV_B_TOT_DVAL_F', 'INV_B_WIP_VAL_F', 'INV_E_AVG_VAL_F', 'INV_E_FIFO_VAL_F', \n            'INV_E_FIN_VAL_F', 'INV_E_IVAL_TOT_DVAL_F', 'INV_E_LIFO_RSV_VAL_F', 'INV_E_LIFO_VAL_F', \n            'INV_E_MAT_VAL_F', 'INV_E_NL_TOT_DVAL_F', 'INV_E_OTHNL_VAL_F', 'INV_E_STD_VAL_F', \n            'INV_E_TOT_DVAL_F', 'INV_E_WIP_VAL_F', 'PAY_ANN_NONPRDWRK_VAL_F', 'PAY_ANN_PRDWRK_VAL_F', \n            'PAY_ANN_VAL_F', 'PAY_QTR1_NONPRDWRK_DVAL_F', 'PAY_QTR1_PRDWRK_VAL_F', 'PAY_QTR1_VAL_F', \n            'RCPT_ECOMM_VAL_F', 'RCPT_TOT_VAL_F', 'ROBOT_INDST_INOP_NUM_F', 'ROBOT_INDST_PRCH_NUM_F', \n            'ROBOT_INDST_VAL_F'\n            // 73\n        ];\n\n        let mfgSUList = [\n            'CAPEX_BUILD_NEW_VAL', 'CAPEX_BUILD_TOT_DVAL', 'CAPEX_BUILD_USED_VAL', 'CAPEX_MACH_NEW_VAL', \n            'CAPEX_MACH_TOT_DVAL', 'CAPEX_MACH_USED_VAL', 'CAPEX_NEW_TOT_DVAL', 'CAPEX_TOT_DVAL', \n            'CAPEX_USED_TOT_DVAL', 'ELEC_GEN_KWH_NUM', 'ELEC_PRCH_KWH_NUM', 'ELEC_SOLD_KWH_NUM', \n            'EMP_EMP_MAR12_NONPRDWRK_DNUM', 'EMP_MAR12_NUM', 'EMP_MAR12_PRDWRK_NUM', 'EXPS_ADVERT_VAL', \n            'EXPS_BUILD_REP_VAL', 'EXPS_COMMSVC_VAL', 'EXPS_COMPTR_OTHEQ_VAL', 'EXPS_CONTRACT_VAL', \n            'EXPS_CSTMTOT_DVAL', 'EXPS_DATAPROC_VAL', 'EXPS_ELEC_VAL', 'EXPS_EXSOFT_VAL', \n            'EXPS_FRNG_BENEFIT_VAL', 'EXPS_FUEL_VAL', 'EXPS_MACH_REP_VAL', 'EXPS_MAT_V1_VAL', \n            'EXPS_OTHER_VAL', 'EXPS_PCHTT_DVAL', 'EXPS_PROFTECH_VAL', 'EXPS_REFUSE_VAL', \n            'EXPS_RENT_BUILD_VAL', 'EXPS_RENT_MACH_VAL', 'EXPS_RESALE_VAL', 'EXPS_RPTOT_DVAL', \n            'EXPS_TAX_VAL', 'EXPS_TEMPSTAF_VAL', 'EXPS_TOT_DVAL', 'EXPS_TOT_VAL', \n            'HOURS_PRDWRK_NUM', 'INV_B_AVG_VAL', 'INV_B_FIFO_VAL', \n            'INV_B_FIN_VAL', 'INV_B_IVAL_TOT_DVAL', 'INV_B_LIFO_RSV_VAL', 'INV_B_LIFO_VAL', \n            'INV_B_MAT_VAL', 'INV_B_NL_TOT_DVAL', 'INV_B_OTHNL_VAL', 'INV_B_STD_VAL', \n            'INV_B_TOT_DVAL', 'INV_B_WIP_VAL', 'INV_E_AVG_VAL', 'INV_E_FIFO_VAL', \n            'INV_E_FIN_VAL', 'INV_E_IVAL_TOT_DVAL', 'INV_E_LIFO_RSV_VAL', 'INV_E_LIFO_VAL', \n            'INV_E_MAT_VAL', 'INV_E_NL_TOT_DVAL', 'INV_E_OTHNL_VAL', 'INV_E_STD_VAL', \n            'INV_E_TOT_DVAL', 'INV_E_WIP_VAL', 'INV_STAT', 'NONTABFL', \n            'PAY_ANN_NONPRDWRK_VAL', 'PAY_ANN_PRDWRK_VAL', 'PAY_ANN_VAL', 'PAY_QTR1_NONPRDWRK_DVAL', \n            'PAY_QTR1_PRDWRK_VAL', 'PAY_QTR1_VAL', 'RCPT_ECOMM_VAL', 'RCPT_TOT_VAL', \n            'ROBOT_INDST_INOP_NUM', 'ROBOT_INDST_PRCH_NUM', 'ROBOT_INDST_VAL', 'TABSTAT', \n            'VALUE_ADDED_DVAL'\n            // 81\n        ];\n\n        for (let name of mfgSUList) {\n            record[name] = suData[name];\n        }\n        for (let flag of mfgSUListFlags) {\n            let flagValue = suData[flag]\n            let flagLetter = flagValue?.charAt(2)\n            if ([null, undefined].includes(flagLetter)) {\n                flagLetter = '_'\n            }\n            record[flag] = setCharAt(record[flag], 2, flagLetter)\n        }\n    } else if (record?.REPORTING_ID_TYP_TXT == 'KAU' && record?.NAICS_SECTOR == '31' && record?.ENT_TYP_TXT == 'MU') {\n\n        let muData = suMu.filter(mu => mu.facts.KAU_ID == record.KAU_ID && mu.facts.TABSTAT == 'Y')\n\n        if ((muData.length >= 1)) {\n\n            let mfgMUListFlags = [\n                'CAPEX_BUILD_NEW_VAL_F', 'CAPEX_BUILD_TOT_DVAL_F', 'CAPEX_BUILD_USED_VAL_F', 'CAPEX_MACH_NEW_VAL_F', \n                'CAPEX_MACH_TOT_DVAL_F', 'CAPEX_MACH_USED_VAL_F', 'CAPEX_NEW_TOT_DVAL_F', 'CAPEX_TOT_DVAL_F', \n                'CAPEX_USED_TOT_DVAL_F', 'ELEC_GEN_KWH_NUM_F', 'ELEC_PRCH_KWH_NUM_F', 'ELEC_SOLD_KWH_NUM_F', \n                'EMP_MAR12_NONPRDWRK_DNUM_F', 'EMP_MAR12_NUM_F', 'EMP_MAR12_PRDWRK_NUM_F', 'EXPS_ADVERT_VAL_F', \n                'EXPS_BUILD_REP_VAL_F', 'EXPS_COMMSVC_VAL_F', 'EXPS_COMPTR_OTHEQ_VAL_F', 'EXPS_CONTRACT_VAL_F', \n                'EXPS_DATAPROC_VAL_F', 'EXPS_ELEC_VAL_F', 'EXPS_EXSOFT_VAL_F', 'EXPS_FRNG_BENEFIT_VAL_F', \n                'EXPS_FUEL_VAL_F', 'EXPS_MAT_V1_VAL_F', 'EXPS_OTHER_VAL_F', 'EXPS_PROFTECH_VAL_F', \n                'EXPS_REFUSE_VAL_F', 'EXPS_RENT_BUILD_VAL_F', 'EXPS_RENT_MACH_VAL_F', 'EXPS_RESALE_VAL_F', \n                'EXPS_TAX_VAL_F', 'EXPS_TEMPSTAF_VAL_F', 'EXPS_TOT_DVAL_F', 'EXPS_TOT_VAL_F', \n                'HOURS_PRDWRK_NUM_F', 'INV_B_AVG_VAL_F', 'INV_B_FIFO_VAL_F', \n                'INV_B_FIN_VAL_F', 'INV_B_IVAL_TOT_DVAL_F', 'INV_B_LIFO_RSV_VAL_F', 'INV_B_LIFO_VAL_F', \n                'INV_B_MAT_VAL_F', 'INV_B_NL_TOT_DVAL_F', 'INV_B_OTHNL_VAL_F', 'INV_B_STD_VAL_F', \n                'INV_B_TOT_DVAL_F', 'INV_B_WIP_VAL_F', 'INV_E_AVG_VAL_F', 'INV_E_FIFO_VAL_F', \n                'INV_E_FIN_VAL_F', 'INV_E_IVAL_TOT_DVAL_F', 'INV_E_LIFO_RSV_VAL_F', 'INV_E_LIFO_VAL_F', \n                'INV_E_MAT_VAL_F', 'INV_E_NL_TOT_DVAL_F', 'INV_E_OTHNL_VAL_F', 'INV_E_STD_VAL_F', \n                'INV_E_TOT_DVAL_F', 'INV_E_WIP_VAL_F', 'PAY_ANN_NONPRDWRK_VAL_F', 'PAY_ANN_PRDWRK_VAL_F', \n                'PAY_ANN_VAL_F', 'PAY_QTR1_NONPRDWRK_DVAL_F', 'PAY_QTR1_PRDWRK_VAL_F', 'PAY_QTR1_VAL_F', \n                'RCPT_ECOMM_VAL_F', 'RCPT_TOT_VAL_F', 'RCPT_UFO_STAT_F', 'RCPT_UFO_VAL_F', \n                'ROBOT_INDST_INOP_NUM_F', 'ROBOT_INDST_PRCH_NUM_F', 'ROBOT_INDST_VAL_F'\n                // 75\n            ];\n\n            let mfgMUList = [\n                'CAPEX_BUILD_NEW_VAL', 'CAPEX_BUILD_TOT_DVAL', 'CAPEX_BUILD_USED_VAL', 'CAPEX_MACH_NEW_VAL', \n                'CAPEX_MACH_TOT_DVAL', 'CAPEX_MACH_USED_VAL', 'CAPEX_NEW_TOT_DVAL', 'CAPEX_TOT_DVAL', \n                'CAPEX_USED_TOT_DVAL', 'ELEC_GEN_KWH_NUM', 'ELEC_PRCH_KWH_NUM', 'ELEC_SOLD_KWH_NUM', \n                'EMP_EMP_MAR12_NONPRDWRK_DNUM', 'EMP_MAR12_NUM', 'EMP_MAR12_PRDWRK_NUM', 'EXPS_ADVERT_VAL', \n                'EXPS_BUILD_REP_VAL', 'EXPS_COMMSVC_VAL', 'EXPS_COMPTR_OTHEQ_VAL', 'EXPS_CONTRACT_VAL', \n                'EXPS_CSTMTOT_DVAL', 'EXPS_DATAPROC_VAL', 'EXPS_ELEC_VAL', 'EXPS_EXSOFT_VAL', \n                'EXPS_FRNG_BENEFIT_VAL', 'EXPS_FUEL_VAL', 'EXPS_MACH_REP_VAL', 'EXPS_MAT_V1_VAL', \n                'EXPS_OTHER_VAL', 'EXPS_PCHTT_DVAL', 'EXPS_PROFTECH_VAL', 'EXPS_REFUSE_VAL', \n                'EXPS_RENT_BUILD_VAL', 'EXPS_RENT_MACH_VAL', 'EXPS_RESALE_VAL', 'EXPS_RPTOT_DVAL', \n                'EXPS_TAX_VAL', 'EXPS_TEMPSTAF_VAL', 'EXPS_TOT_DVAL', 'EXPS_TOT_VAL', \n                'HOURS_PRDWRK_NUM', 'INV_B_AVG_VAL', 'INV_B_FIFO_VAL', \n                'INV_B_FIN_VAL', 'INV_B_IVAL_TOT_DVAL', 'INV_B_LIFO_RSV_VAL', 'INV_B_LIFO_VAL', \n                'INV_B_MAT_VAL', 'INV_B_NL_TOT_DVAL', 'INV_B_OTHNL_VAL', 'INV_B_STD_VAL', \n                'INV_B_TOT_DVAL', 'INV_B_WIP_VAL', 'INV_E_AVG_VAL', 'INV_E_FIFO_VAL', \n                'INV_E_FIN_VAL', 'INV_E_IVAL_TOT_DVAL', 'INV_E_LIFO_RSV_VAL', 'INV_E_LIFO_VAL', \n                'INV_E_MAT_VAL', 'INV_E_NL_TOT_DVAL', 'INV_E_OTHNL_VAL', 'INV_E_STD_VAL', \n                'INV_E_TOT_DVAL', 'INV_E_WIP_VAL', 'INV_STAT', 'PAY_ANN_NONPRDWRK_VAL', \n                'PAY_ANN_PRDWRK_VAL', 'PAY_ANN_VAL', 'PAY_QTR1_NONPRDWRK_DVAL', 'PAY_QTR1_PRDWRK_VAL', \n                'PAY_QTR1_VAL', 'RCPT_ECOMM_VAL', 'RCPT_TOT_VAL', 'RCPT_UFO_STAT', \n                'RCPT_UFO_VAL', 'ROBOT_INDST_INOP_NUM', 'ROBOT_INDST_PRCH_NUM', 'ROBOT_INDST_VAL', \n                'VALUE_ADDED_DVAL'\n                // 81 \n            ];\n            for (let name of mfgMUList) {\n                let value = muData.map(mu => mu.facts?.[name]).reduce((a, b) => parseFloat(a) + parseFloat(b));\n                record[name] = value;\n\n            }\n            for (let flag of mfgMUListFlags) {\n                let idvar = 'KAU_ID'\n                let len = flag.length - 2\n                let name = flag.substring(0,len)\n                childFlagRules(name, [flag], muData, idvar)\n            }\n        } else {\n            record['TABSTAT'] = 'N'\n        }\n    } \n    return msg;\n\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NONMFG SU to KAU'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "cacb1688b9fbbb51",
        "type": "function",
        "z": "0179503501c47e39",
        "name": "reset msg",
        "func": "msg.estabs = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 380,
        "wires": [
            [
                "b24bac40f275b02c"
            ]
        ]
    },
    {
        "id": "b4b65b10e70c9fdc",
        "type": "function",
        "z": "0179503501c47e39",
        "name": "query_estabs",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.KAU_ID\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where kau_id = '\" + id + \"' and type = 'ESTAB' and jobname = '\" + job +\"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 260,
        "wires": [
            [
                "5837ec71d32113d4"
            ]
        ]
    },
    {
        "id": "5837ec71d32113d4",
        "type": "subflow:8032608991ae0162",
        "z": "0179503501c47e39",
        "name": "",
        "x": 480,
        "y": 260,
        "wires": [
            [
                "cacb1688b9fbbb51"
            ]
        ]
    },
    {
        "id": "c44aad574a2c2638",
        "type": "function",
        "z": "f9cd233b8803b29d",
        "name": "nonmfg su to kau",
        "func": "try {\n    let record_idx = global.get('ptrModuleFacts')\n    let record = msg.payload.csv[record_idx]\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    if (record?.REPORTING_ID_TYP_TXT == 'SU' && record?.NAICS_SECTOR != 31) {\n        let kauData = msg.payload.csv.find(kau => kau?.KAU_ID == record?.KAU_ID && kau?.RECORD_TYP_TXT == '30' && kau?.ENT_TYP_TXT == 'SU')\n        let list = ['TABSTAT', 'NONTABFL', 'EMP_MAR12_NUM', 'PAY_ANN_VAL', 'PAY_QTR1_VAL', 'RCPT_TOT_VAL']\n        let listFlags = ['EMP_MAR12_NUM_F', 'PAY_ANN_VAL_F', 'PAY_QTR1_VAL_F', 'RCPT_TOT_VAL_F']\n        \n        //entData = entData[0] \n        for (let i in list) {\n            let name = list[i]\n            kauData[name] = record[name]\n        }\n        for (let j in listFlags) {\n            let nameFlag = listFlags[j]\n            let flagValue = record?.[nameFlag]\n            let flagLetter = flagValue?.charAt(2)\n            if ([null, undefined].includes(flagLetter)) {\n                flagLetter = '_'\n            }\n            kauData[nameFlag] = setCharAt(kauData?.[nameFlag], 2, flagLetter)\n        }\n        console.log(kauData)\n    }\n\n    return msg;\n\n} catch (e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'NONMFG SU to KAU'\n    return msg;\n}\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "ebb88c0fe63216f1",
        "type": "function",
        "z": "f9cd233b8803b29d",
        "name": "nonmfg su to kau (database)",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx]; \n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let kauFound = ''\n    if (record?.REPORTING_ID_TYP_TXT == 'SU' && record?.NAICS_SECTOR != 31) {\n        let kauData = msg.kau.find(kau => kau.facts.KAU_ID == record.KAU_ID && kau.facts.ENT_TYP_TXT == 'SU')\n        if (kauData) {\n            kauFound = 'Y'\n            let list = ['TABSTAT', 'NONTABFL', 'EMP_MAR12_NUM', 'PAY_ANN_VAL', 'PAY_QTR1_VAL', 'RCPT_TOT_VAL' ]\n            let listFlags = ['EMP_MAR12_NUM_F', 'PAY_ANN_VAL_F', 'PAY_QTR1_VAL_F', 'RCPT_TOT_VAL_F' ]\n            //entData = entData[0] \n            for (let i in list) {\n                let name = list[i]\n                kauData[name] = record[name]\n            }\n            for (let j in listFlags) {\n                let nameFlag = listFlags[j]\n                let flagValue = record[nameFlag]\n                let flagLetter = flagValue.charAt(2)\n                if ([null, undefined].includes(flagLetter)) {\n                    flagLetter = '_'\n                }\n                kauData[nameFlag] = setCharAt(kauData[nameFlag], 2, flagLetter)\n            }       \n        }\n    }\n\n    if (kauFound == 'Y') {\n        let CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\n        let DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\n\n        let arr = msg.kau;\n        let query = \"UPDATE \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" SET facts = CASE id \";\n        let string = ''\n        // Add CASE conditions for each ID\n        arr.forEach(item => {\n            query += `WHEN ${item.id} THEN '${JSON.stringify(item.facts).replace(/'/g, \"''\")}'::jsonb `;\n        });\n        // // Close the CASE statement and specify which IDs should be updated\n        let ids = arr.map(item => item.id);\n        query += `END WHERE id IN (${ids.join(', ')})`;\n\n        let jobName = msg.payload.job.jobName.replace(/'/g, \"''\"); // Escape single quotes\n        query += ` AND jobname = '${jobName}'`;\n\n        if (query.includes(\"();\")) {\n            msg.query = \"The query is invalid\"\n        } else {\n            msg.query = query\n        }\n        msg.records = msg.payload\n    } else {\n        msg.query = \"No query\"\n    }\n\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NONMFG SU to KAU'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 260,
        "wires": [
            [
                "2b23dc729e994b06"
            ]
        ]
    },
    {
        "id": "e75254fb2b379810",
        "type": "function",
        "z": "f9cd233b8803b29d",
        "name": "reset msg",
        "func": "msg.kau = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 260,
        "wires": [
            [
                "ebb88c0fe63216f1"
            ]
        ]
    },
    {
        "id": "ac712e10584e9395",
        "type": "function",
        "z": "f9cd233b8803b29d",
        "name": "query_kau",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.KAU_ID\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where kau_id = '\" + id + \"' and type = 'KAU' and jobname = '\" + job +\"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 260,
        "wires": [
            [
                "2d8d58a06d1b0206"
            ]
        ]
    },
    {
        "id": "2d8d58a06d1b0206",
        "type": "subflow:8032608991ae0162",
        "z": "f9cd233b8803b29d",
        "name": "",
        "x": 400,
        "y": 260,
        "wires": [
            [
                "e75254fb2b379810"
            ]
        ]
    },
    {
        "id": "5b6539fa7f632af4",
        "type": "subflow:8032608991ae0162",
        "z": "f9cd233b8803b29d",
        "name": "",
        "x": 920,
        "y": 380,
        "wires": [
            [
                "1f3af66da3636820"
            ]
        ]
    },
    {
        "id": "1f3af66da3636820",
        "type": "function",
        "z": "f9cd233b8803b29d",
        "name": "reset msg",
        "func": "msg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "2b23dc729e994b06",
        "type": "switch",
        "z": "f9cd233b8803b29d",
        "name": "",
        "property": "query",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "The query is invalid",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "No query",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 730,
        "y": 380,
        "wires": [
            [],
            [],
            [
                "5b6539fa7f632af4"
            ]
        ]
    },
    {
        "id": "dbd2be51e81b1072",
        "type": "function",
        "z": "1ff4019fd0378d4a",
        "name": "su to ent mfg and nonmfg",
        "func": "try {\n    let record_idx = global.get('ptrModuleFacts')\n    let record = msg.payload.csv[record_idx]\n\n    if (record?.REPORTING_ID_TYP_TXT == 'ENT' && record?.ENT_TYP_TXT == 'SU') {\n        let suData = msg.payload.csv.find(su => su?.ENT_ID == record?.ENT_ID && su?.RECORD_TYP_TXT == '20')\n        let list = ['TABSTAT', 'NONTABFL']\n        //entData = entData[0] \n        for (let i in list) { \n            let name = list[i]\n\n            record[name] = suData[name]\n        }    \n    }\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'SU to ENT'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "6d7ce0460b97de12",
        "type": "function",
        "z": "1ff4019fd0378d4a",
        "name": "su to ent mfg and nonmfg (database)",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx]; \n\n    if (record?.REPORTING_ID_TYP_TXT == 'ENT' && record?.ENT_TYP_TXT == 'SU') {\n        let suData = msg.estabs.find(su => su.facts?.ENT_ID == record?.ENT_ID)\n        if (suData) {\n            let list = ['TABSTAT', 'NONTABFL']\n            //entData = entData[0] \n            for (let i in list) { \n                let name = list[i]\n                record[name] = suData[name]\n            }    \n        }\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'SU to ENT'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "599d6807d26fcc2c",
        "type": "function",
        "z": "1ff4019fd0378d4a",
        "name": "reset msg",
        "func": "msg.estabs = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 340,
        "wires": [
            [
                "6d7ce0460b97de12"
            ]
        ]
    },
    {
        "id": "50f6ffbda87758af",
        "type": "function",
        "z": "1ff4019fd0378d4a",
        "name": "query_estabs",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.ENT_ID\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nmsg.pathQuery = ''\nif (record?.ENT_TYP_TXT == 'SU') {\n    msg.pathQuery = 'Y'\n    msg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where ent_id = '\" + id + \"' and type = 'ESTAB' and jobname = '\" + job + \"';\"\n} else {\n    msg.pathQuery = ''\n}\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 280,
        "wires": [
            [
                "db152a9402f6725a"
            ]
        ]
    },
    {
        "id": "2f97c9cbe68ec9b9",
        "type": "subflow:8032608991ae0162",
        "z": "1ff4019fd0378d4a",
        "name": "",
        "x": 320,
        "y": 340,
        "wires": [
            [
                "599d6807d26fcc2c"
            ]
        ]
    },
    {
        "id": "db152a9402f6725a",
        "type": "switch",
        "z": "1ff4019fd0378d4a",
        "name": "",
        "property": "pathQuery",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 420,
        "y": 280,
        "wires": [
            [],
            [
                "2f97c9cbe68ec9b9"
            ]
        ]
    },
    {
        "id": "eb7d69628314219e",
        "type": "function",
        "z": "6ace7023ea973ebe",
        "name": "kau to su",
        "func": "try {\n    let record_idx = global.get('ptrModuleFacts')\n    let record = msg.payload.csv[record_idx]\n    \n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    if (record?.REPORTING_ID_TYP_TXT == 'KAU' && record?.ENT_TYP_TXT == 'SU' && !(['31', '32', '33'].includes(record?.GROUP_KEY_TXT.substring(0, 2)))) {\n        let suData = msg.payload.csv.find(su => su.KAU_ID == record.KAU_ID && su.RECORD_TYP_TXT == '20')\n        const kauFlags = [\n            'CAPEX_BUILD_NEW_VAL_F', 'CAPEX_BUILD_TOT_DVAL_F', 'CAPEX_BUILD_USED_VAL_F', 'CAPEX_MACH_NEW_VAL_F',\n            'CAPEX_MACH_TOT_DVAL_F', 'CAPEX_MACH_USED_VAL_F', 'CAPEX_NEW_TOT_DVAL_F', 'CAPEX_TOT_DVAL_F',\n            'CAPEX_USED_TOT_DVAL_F', 'ECOMM_DPCT_F', 'EMP_MAR12_NUM_F', 'EXP_DPCT_F', 'EXPS_ACCESS_VAL_F',\n            'EXPS_ADVERT_VAL_F', 'EXPS_BENPAY_HLTH_VAL_F', 'EXPS_BENPAY_LIFE_VAL_F', 'EXPS_BROADCAST_VAL_F',\n            'EXPS_BUILD_REP_VAL_F', 'EXPS_COMMSVC_VAL_F', 'EXPS_COMPTR_OTHEQ_VAL_F', 'EXPS_DATAPROC_VAL_F',\n            'EXPS_DEPR_VAL_F', 'EXPS_EHR_STAT_F', 'EXPS_EHR_VAL_F', 'EXPS_ELEC_VAL_F', 'EXPS_EXSOFT_VAL_F',\n            'EXPS_FRNG_BENEFIT_VAL_F', 'EXPS_FUEL_TRANSP_VAL_F', 'EXPS_FUEL_VAL_F', 'EXPS_GRANTS_VAL_F',\n            'EXPS_INS_PREM_VAL_F', 'EXPS_INTEREST_VAL_F', 'EXPS_LOSS_NONMED_VAL_F', 'EXPS_LOSS_VAL_F',\n            'EXPS_MACH_REP_VAL_F', 'EXPS_MAT_V1_VAL_F', 'EXPS_MAT_V2_VAL_F', 'EXPS_NETFEE_VAL_F',\n            'EXPS_OTHER_VAL_F', 'EXPS_PRCH_RESALE_VAL_F', 'EXPS_PRINT_VAL_F', 'EXPS_PROFLIAB_VAL_F',\n            'EXPS_PROFTECH_VAL_F', 'EXPS_PROGPROD_VAL_F', 'EXPS_REFUSE_VAL_F', 'EXPS_RENT_BUILD_VAL_F',\n            'EXPS_RENT_MACH_VAL_F', 'EXPS_SOFTREPR_VAL_F', 'EXPS_SUPPLY_MED_VAL_F', 'EXPS_TAX_VAL_F',\n            'EXPS_TEMPSTAF_VAL_F', 'EXPS_TOT_DVAL_F', 'EXPS_TOT_HOTEL_OWN3RD_DVAL_F',\n            'EXPS_TOT_HOTEL_OWN3RD_VAL_F', 'EXPS_TOT_VAL_F', 'EXPS_TRANSP_REP_VAL_F', 'EXPS_TRANSP_VAL_F',\n            'EXPS_USC_VAL_F', 'HOTEL_MNG_EIN_NUM_F', 'HOTEL_MNG_NAME_TXT_F', 'HOTEL_OWN3RD_NUM_F',\n            'HOTEL_OWN3RD_STAT_F', 'HOTEL_OWNMNG_NUM_F', 'HOTEL_OWNNOTMNG_NUM_F', 'INV_B_LIFO_NET_DVAL_F',\n            'INV_B_TOT_DVAL_F', 'INV_DOM_DVAL_F', 'INV_E_FIN_VAL_F', 'INV_E_LIFO_RSV_VAL_F',\n            'INV_E_LIFO_VAL_F', 'INV_E_MAT_VAL_F', 'INV_E_TOT_DVAL_F', 'INV_E_WIP_VAL_F',\n            'INV_FOREIGN_DPCT_F', 'INV_FOREIGN_VAL_F', 'INV_RPT_DATE_F', 'INV_STAT_F',\n            'INVENTORY_DPCT_F', 'MRCH_ECOMMERCE_DVAL_F', 'MRCH_NONMERCH_EC_DVAL_F',\n            'MRCH_NONMERCH_SALES_DVAL_F', 'MRCH_SALES_DVAL_F', 'PAT_IN_DAYS_NUM_F', 'PAT_OUT_VISIT_NUM_F',\n            'PAT_VISITS_NUM_F', 'PAY_ANN_VAL_F', 'PAY_QTR1_VAL_F', 'PROFIT_LOSS_DVAL_F', 'PURCHASES_DPCT_F',\n            'RCPT_ADV_CLASS_DVAL_F', 'RCPT_ADV_CLASS_PCT_F', 'RCPT_ADV_OTH_DVAL_F', 'RCPT_ADV_OTH_PCT_F',\n            'RCPT_ADV_SPACE_VAL_F', 'RCPT_ADVERT_VAL_F', 'RCPT_AGBR_REV_DVAL_F', 'RCPT_APSOFT_ENTR_DVAL_F',\n            'RCPT_APSOFT_ENTR_PCT_F', 'RCPT_APSOFT_MAIN_DVAL_F', 'RCPT_APSOFT_MAIN_PCT_F',\n            'RCPT_APSOFT_OTH_DVAL_F', 'RCPT_APSOFT_OTH_PCT_F', 'RCPT_APSOFT_PERS_DVAL_F',\n            'RCPT_APSOFT_PERS_PCT_F', 'RCPT_APSOFT_PUB_VAL_F', 'RCPT_AUDVID_VAL_F', 'RCPT_BILL_OTHOP_DVAL_F',\n            'RCPT_BILL_OTHOP_PCT_F', 'RCPT_BILL_PAY_DVAL_F', 'RCPT_BILL_PAY_PCT_F', 'RCPT_BOOK_ONLINE_DVAL_F',\n            'RCPT_BOOK_ONLINE_PCT_F', 'RCPT_BOOK_OTH_DVAL_F', 'RCPT_BOOK_OTH_PCT_F', 'RCPT_BOOK_PRNT_DVAL_F',\n            'RCPT_BOOK_PRNT_PCT_F', 'RCPT_BOOK_PUB_VAL_F', 'RCPT_BOOK_VAL_F', 'RCPT_BUS_DVAL_F',\n            'RCPT_BUS_PCT_F', 'RCPT_CLOTH_VAL_F', 'RCPT_COMP_VAL_F', 'RCPT_COMSN_AVG_RATE_PCT_F',\n            'RCPT_COMSN_AVG_RATE_RAT_F', 'RCPT_COMSN_EARN_VAL_F', 'RCPT_COMSN_GSV_VAL_F',\n            'RCPT_CUST_BUS_DVAL_F', 'RCPT_CUST_BUS_PCT_F', 'RCPT_CUST_IND_DVAL_F', 'RCPT_CUST_IND_PCT_F',\n            'RCPT_CUST_LNGTEL_BUS_DVAL_F', 'RCPT_CUST_LNGTEL_BUS_PCT_F', 'RCPT_CUST_LNGTEL_IND_DVAL_F',\n            'RCPT_CUST_LNGTEL_IND_PCT_F', 'RCPT_CUST_LOCTEL_BUS_DVAL_F', 'RCPT_CUST_LOCTEL_BUS_PCT_F',\n            'RCPT_CUST_LOCTEL_IND_DVAL_F', 'RCPT_CUST_LOCTEL_IND_PCT_F', 'RCPT_CUST_NORES_DVAL_F',\n            'RCPT_CUST_NORES_PCT_F', 'RCPT_CUST_RES_DVAL_F', 'RCPT_CUST_RES_PCT_F', 'RCPT_CUST_SUBLIN_BUS_DVAL_F',\n            'RCPT_CUST_SUBLIN_BUS_PCT_F', 'RCPT_CUST_SUBLIN_IND_DVAL_F', 'RCPT_CUST_SUBLIN_IND_PCT_F',\n            'RCPT_DIR_ONLINE_DVAL_F', 'RCPT_DIR_ONLINE_PCT_F', 'RCPT_DIR_OTH_DVAL_F', 'RCPT_DIR_OTH_PCT_F',\n            'RCPT_DIR_PRNT_DVAL_F', 'RCPT_DIR_PRNT_PCT_F', 'RCPT_DIR_PUB_VAL_F', 'RCPT_DRUGS_VAL_F',\n            'RCPT_ECOMM_ADVERT_VAL_F', 'RCPT_ECOMM_AUDVID_VAL_F', 'RCPT_ECOMM_BOOK_VAL_F',\n            'RCPT_ECOMM_CLOTH_VAL_F', 'RCPT_ECOMM_COMP_VAL_F', 'RCPT_ECOMM_DRUGS_VAL_F',\n            'RCPT_ECOMM_ELAPPL_VAL_F', 'RCPT_ECOMM_FDBRWN_VAL_F', 'RCPT_ECOMM_FURNTR_VAL_F',\n            'RCPT_ECOMM_HOTEL_OWN3RD_VAL_F', 'RCPT_ECOMM_JWLRY_VAL_F', 'RCPT_ECOMM_NONMRCH_VAL_F',\n            'RCPT_ECOMM_OFCEQ_VAL_F', 'RCPT_ECOMM_OTHMRCH_VAL_F', 'RCPT_ECOMM_SHPHDL_VAL_F',\n            'RCPT_ECOMM_SOFTWARE_VAL_F', 'RCPT_ECOMM_SPTGD_VAL_F', 'RCPT_ECOMM_TOYS_VAL_F', 'RCPT_ECOMM_VAL_F',\n            'RCPT_ELAPPL_VAL_F', 'RCPT_FDBRWN_VAL_F', 'RCPT_FURNTR_VAL_F', 'RCPT_GROSSBILL_VAL_F',\n            'RCPT_HLTHCARE_PRVDRS_VAL_F', 'RCPT_JWLRY_VAL_F', 'RCPT_LEISURE_DVAL_F', 'RCPT_LEISURE_PCT_F',\n            'RCPT_LNGTEL_VAL_F', 'RCPT_LOCTEL_VAL_F', 'RCPT_MEDICAID_VAL_F', 'RCPT_MEDICARE_VAL_F',\n            'RCPT_MOTR_AGR_DVAL_F', 'RCPT_MOTR_AGR_PCT_F', 'RCPT_MOTR_ELECT_DVAL_F', 'RCPT_MOTR_ELECT_PCT_F',\n            'RCPT_MOTR_FUEL_DVAL_F', 'RCPT_MOTR_FUEL_PCT_F', 'RCPT_MOTR_GRAIN_DVAL_F', 'RCPT_MOTR_GRAIN_PCT_F',\n            'RCPT_MOTR_HAZRD_DVAL_F', 'RCPT_MOTR_HAZRD_PCT_F', 'RCPT_MOTR_HAZRD_STAT_F', 'RCPT_MOTR_METAL_DVAL_F',\n            'RCPT_MOTR_METAL_PCT_F', 'RCPT_MOTR_NEWFRN_DVAL_F', 'RCPT_MOTR_NEWFRN_PCT_F', 'RCPT_MOTR_OTH_DVAL_F',\n            'RCPT_MOTR_OTH_PCT_F', 'RCPT_MOTR_PHARM_DVAL_F', 'RCPT_MOTR_PHARM_PCT_F', 'RCPT_MOTR_STONE_DVAL_F',\n            'RCPT_MOTR_STONE_PCT_F', 'RCPT_MOTR_USEDGD_DVAL_F', 'RCPT_MOTR_USEDGD_PCT_F', 'RCPT_MOTR_VAL_F',\n            'RCPT_MOTR_WOOD_DVAL_F', 'RCPT_MOTR_WOOD_PCT_F', 'RCPT_NEWPT_SSBNFTS_VAL_F', 'RCPT_NEWS_ONLINE_DVAL_F',\n            'RCPT_NEWS_ONLINE_PCT_F', 'RCPT_NEWS_OTH_DVAL_F', 'RCPT_NEWS_OTH_PCT_F', 'RCPT_NEWS_PRNT_DVAL_F',\n            'RCPT_NEWS_PRNT_PCT_F', 'RCPT_NEWS_PUB_VAL_F', 'RCPT_NONMRCH_VAL_F', 'RCPT_NONOP_DVAL_F',\n            'RCPT_NONOP_GIFT_INVST_DVAL_F', 'RCPT_NONOP_GIFTS_VAL_F', 'RCPT_NONOP_INVST_VAL_F',\n            'RCPT_NONOP_OTH_VAL_F', 'RCPT_NONOP_PROGSRVC_VAL_F', 'RCPT_NONPT_HCARE_PRVDRS_VAL_F',\n            'RCPT_NONPT_OTH_VAL_F', 'RCPT_NONTELEMED_DVAL_F', 'RCPT_OFCEQ_VAL_F', 'RCPT_OTH_GOVPROG_VAL_F',\n            'RCPT_OTHMRCH_TXT_F', 'RCPT_OTHMRCH_VAL_F', 'RCPT_OWN_VAL_F', 'RCPT_PAT_IN_DVAL_F',\n            'RCPT_PAT_IN_PCT_F', 'RCPT_PAT_OUT_DVAL_F', 'RCPT_PAT_OUT_PCT_F', 'RCPT_PAT_OUTPCKT_VAL_F',\n            'RCPT_PATCARE_OTH_VAL_F', 'RCPT_PER_ONLINE_DVAL_F', 'RCPT_PER_ONLINE_PCT_F', 'RCPT_PER_OTH_DVAL_F',\n            'RCPT_PER_OTH_PCT_F', 'RCPT_PER_PRNT_DVAL_F', 'RCPT_PER_PRNT_PCT_F', 'RCPT_PER_PUB_VAL_F',\n            'RCPT_PROPCSLTY_INS_VAL_F', 'RCPT_PVTHLTH_INS_VAL_F', 'RCPT_SHPHDL_VAL_F', 'RCPT_SOFTWARE_VAL_F',\n            'RCPT_SPTGD_VAL_F', 'RCPT_STOR_DVAL_F', 'RCPT_SUBLIN_VAL_F', 'RCPT_SYSOFT_ENTR_DVAL_F',\n            'RCPT_SYSOFT_ENTR_PCT_F', 'RCPT_SYSOFT_MAIN_DVAL_F', 'RCPT_SYSOFT_MAIN_PCT_F', 'RCPT_SYSOFT_OTH_DVAL_F',\n            'RCPT_SYSOFT_OTH_PCT_F', 'RCPT_SYSOFT_PERS_DVAL_F', 'RCPT_SYSOFT_PERS_PCT_F',\n            'RCPT_SYSOFT_PUB_VAL_F', 'RCPT_TELEMED_VAL_F', 'RCPT_TOT_HOTEL_OWN_VAL_F',\n            'RCPT_TOT_HOTEL_OWN3RD_DVAL_F', 'RCPT_TOT_HOTEL_OWN3RD_VAL_F', 'RCPT_TOT_PY_VAL_F',\n            'RCPT_TOT_VAL_F', 'RCPT_TOYS_VAL_F', 'RCPT_UFO_STAT_F', 'RCPT_UFO_VAL_F', 'RCPT_WORKCOMP_VAL_F',\n            'ROBOT_VAL_F', 'TRAILER_NUM_TOT_DVAL_F', 'TRAILER_WD_NUM_F', 'TRAILER_WOD_NUM_F',\n            'TRUCK_NUM_TOT_DVAL_F', 'TRUCK_WD_NUM_F', 'TRUCK_WOD_NUM_F', 'TRUCKTRAC_NUM_TOT_DVAL_F',\n            'TRUCKTRAC_WD_NUM_F', 'TRUCKTRAC_WOD_NUM_F', 'YEAR_END_DATE_F', 'YEAR_START_DATE_F'\n        ]\n\n\n        const kauVariable = [\n            'CAPEX_BUILD_NEW_VAL', 'CAPEX_BUILD_TOT_DVAL', 'CAPEX_BUILD_USED_VAL', 'CAPEX_MACH_NEW_VAL',\n            'CAPEX_MACH_TOT_DVAL', 'CAPEX_MACH_USED_VAL', 'CAPEX_NEW_TOT_DVAL', 'CAPEX_TOT_DVAL',\n            'CAPEX_USED_TOT_DVAL', 'ECOMM_DPCT', 'EMP_MAR12_NUM', 'EXP_DPCT', 'EXPS_ACCESS_VAL',\n            'EXPS_ADVERT_VAL', 'EXPS_BENPAY_HLTH_VAL', 'EXPS_BENPAY_LIFE_VAL', 'EXPS_BROADCAST_VAL',\n            'EXPS_BUILD_REP_VAL', 'EXPS_COMMSVC_VAL', 'EXPS_COMPTR_OTHEQ_VAL', 'EXPS_DATAPROC_VAL',\n            'EXPS_DEPR_VAL', 'EXPS_EHR_STAT', 'EXPS_EHR_VAL', 'EXPS_ELEC_VAL', 'EXPS_EXSOFT_VAL',\n            'EXPS_FRNG_BENEFIT_VAL', 'EXPS_FUEL_TRANSP_VAL', 'EXPS_FUEL_VAL', 'EXPS_GRANTS_VAL',\n            'EXPS_INS_PREM_VAL', 'EXPS_INTEREST_VAL', 'EXPS_LOSS_NONMED_VAL', 'EXPS_LOSS_VAL',\n            'EXPS_MACH_REP_VAL', 'EXPS_MAT_V1_VAL', 'EXPS_MAT_V2_VAL', 'EXPS_NETFEE_VAL', 'EXPS_OTHER_VAL',\n            'EXPS_PRCH_RESALE_VAL', 'EXPS_PRINT_VAL', 'EXPS_PROFLIAB_VAL', 'EXPS_PROFTECH_VAL',\n            'EXPS_PROGPROD_VAL', 'EXPS_REFUSE_VAL', 'EXPS_RENT_BUILD_VAL', 'EXPS_RENT_MACH_VAL',\n            'EXPS_SOFTREPR_VAL', 'EXPS_SUPPLY_MED_VAL', 'EXPS_TAX_VAL', 'EXPS_TEMPSTAF_VAL', 'EXPS_TOT_DVAL',\n            'EXPS_TOT_HOTEL_OWN3RD_DVAL', 'EXPS_TOT_HOTEL_OWN3RD_VAL', 'EXPS_TOT_VAL', 'EXPS_TRANSP_REP_VAL',\n            'EXPS_TRANSP_VAL', 'EXPS_USC_VAL', 'HOTEL_MNG_EIN_NUM', 'HOTEL_MNG_NAME_TXT', 'HOTEL_OWN3RD_NUM',\n            'HOTEL_OWN3RD_STAT', 'HOTEL_OWNMNG_NUM', 'HOTEL_OWNNOTMNG_NUM', 'INV_B_LIFO_NET_DVAL',\n            'INV_B_TOT_DVAL', 'INV_DOM_DVAL', 'INV_E_FIN_VAL', 'INV_E_LIFO_RSV_VAL', 'INV_E_LIFO_VAL',\n            'INV_E_MAT_VAL', 'INV_E_TOT_DVAL', 'INV_E_WIP_VAL', 'INV_FOREIGN_DPCT', 'INV_FOREIGN_VAL',\n            'INV_RPT_DATE', 'INV_STAT', 'INVENTORY_DPCT', 'MRCH_ECOMMERCE_DVAL', 'MRCH_NONMERCH_EC_DVAL',\n            'MRCH_NONMERCH_SALES_DVAL', 'MRCH_SALES_DVAL', 'NONTABFL', 'PAT_IN_DAYS_NUM', 'PAT_OUT_VISIT_NUM',\n            'PAT_VISITS_NUM', 'PAY_ANN_VAL', 'PAY_QTR1_VAL', 'PROFIT_LOSS_DVAL', 'PURCHASES_DPCT',\n            'RCPT_ADV_CLASS_DVAL', 'RCPT_ADV_CLASS_PCT', 'RCPT_ADV_OTH_DVAL', 'RCPT_ADV_OTH_PCT',\n            'RCPT_ADV_SPACE_VAL', 'RCPT_ADVERT_VAL', 'RCPT_AGBR_REV_DVAL', 'RCPT_APSOFT_ENTR_DVAL',\n            'RCPT_APSOFT_ENTR_PCT', 'RCPT_APSOFT_MAIN_DVAL', 'RCPT_APSOFT_MAIN_PCT', 'RCPT_APSOFT_OTH_DVAL',\n            'RCPT_APSOFT_OTH_PCT', 'RCPT_APSOFT_PERS_DVAL', 'RCPT_APSOFT_PERS_PCT', 'RCPT_APSOFT_PUB_VAL',\n            'RCPT_AUDVID_VAL', 'RCPT_BILL_OTHOP_DVAL', 'RCPT_BILL_OTHOP_PCT', 'RCPT_BILL_PAY_DVAL',\n            'RCPT_BILL_PAY_PCT', 'RCPT_BOOK_ONLINE_DVAL', 'RCPT_BOOK_ONLINE_PCT', 'RCPT_BOOK_OTH_DVAL',\n            'RCPT_BOOK_OTH_PCT', 'RCPT_BOOK_PRNT_DVAL', 'RCPT_BOOK_PRNT_PCT', 'RCPT_BOOK_PUB_VAL',\n            'RCPT_BOOK_VAL', 'RCPT_BUS_DVAL', 'RCPT_BUS_PCT', 'RCPT_CLOTH_VAL', 'RCPT_COMP_VAL',\n            'RCPT_COMSN_AVG_RATE_PCT', 'RCPT_COMSN_AVG_RATE_RAT', 'RCPT_COMSN_EARN_VAL', 'RCPT_COMSN_GSV_VAL',\n            'RCPT_CUST_BUS_DVAL', 'RCPT_CUST_BUS_PCT', 'RCPT_CUST_IND_DVAL', 'RCPT_CUST_IND_PCT',\n            'RCPT_CUST_LNGTEL_BUS_DVAL', 'RCPT_CUST_LNGTEL_BUS_PCT', 'RCPT_CUST_LNGTEL_IND_DVAL',\n            'RCPT_CUST_LNGTEL_IND_PCT', 'RCPT_CUST_LOCTEL_BUS_DVAL', 'RCPT_CUST_LOCTEL_BUS_PCT',\n            'RCPT_CUST_LOCTEL_IND_DVAL', 'RCPT_CUST_LOCTEL_IND_PCT', 'RCPT_CUST_NORES_DVAL',\n            'RCPT_CUST_NORES_PCT', 'RCPT_CUST_RES_DVAL', 'RCPT_CUST_RES_PCT', 'RCPT_CUST_SUBLIN_BUS_DVAL',\n            'RCPT_CUST_SUBLIN_BUS_PCT', 'RCPT_CUST_SUBLIN_IND_DVAL', 'RCPT_CUST_SUBLIN_IND_PCT',\n            'RCPT_DIR_ONLINE_DVAL', 'RCPT_DIR_ONLINE_PCT', 'RCPT_DIR_OTH_DVAL', 'RCPT_DIR_OTH_PCT',\n            'RCPT_DIR_PRNT_DVAL', 'RCPT_DIR_PRNT_PCT', 'RCPT_DIR_PUB_VAL', 'RCPT_DRUGS_VAL',\n            'RCPT_ECOMM_ADVERT_VAL', 'RCPT_ECOMM_AUDVID_VAL', 'RCPT_ECOMM_BOOK_VAL', 'RCPT_ECOMM_CLOTH_VAL',\n            'RCPT_ECOMM_COMP_VAL', 'RCPT_ECOMM_DRUGS_VAL', 'RCPT_ECOMM_ELAPPL_VAL', 'RCPT_ECOMM_FDBRWN_VAL',\n            'RCPT_ECOMM_FURNTR_VAL', 'RCPT_ECOMM_HOTEL_OWN3RD_VAL', 'RCPT_ECOMM_JWLRY_VAL',\n            'RCPT_ECOMM_NONMRCH_VAL', 'RCPT_ECOMM_OFCEQ_VAL', 'RCPT_ECOMM_OTHMRCH_VAL',\n            'RCPT_ECOMM_SHPHDL_VAL', 'RCPT_ECOMM_SOFTWARE_VAL', 'RCPT_ECOMM_SPTGD_VAL', 'RCPT_ECOMM_TOYS_VAL',\n            'RCPT_ECOMM_VAL', 'RCPT_ELAPPL_VAL', 'RCPT_FDBRWN_VAL', 'RCPT_FURNTR_VAL', 'RCPT_GROSSBILL_VAL',\n            'RCPT_HLTHCARE_PRVDRS_VAL', 'RCPT_JWLRY_VAL', 'RCPT_LEISURE_DVAL', 'RCPT_LEISURE_PCT',\n            'RCPT_LNGTEL_VAL', 'RCPT_LOCTEL_VAL', 'RCPT_MEDICAID_VAL', 'RCPT_MEDICARE_VAL',\n            'RCPT_MOTR_AGR_DVAL', 'RCPT_MOTR_AGR_PCT', 'RCPT_MOTR_ELECT_DVAL', 'RCPT_MOTR_ELECT_PCT',\n            'RCPT_MOTR_FUEL_DVAL', 'RCPT_MOTR_FUEL_PCT', 'RCPT_MOTR_GRAIN_DVAL', 'RCPT_MOTR_GRAIN_PCT',\n            'RCPT_MOTR_HAZRD_DVAL', 'RCPT_MOTR_HAZRD_PCT', 'RCPT_MOTR_HAZRD_STAT', 'RCPT_MOTR_METAL_DVAL',\n            'RCPT_MOTR_METAL_PCT', 'RCPT_MOTR_NEWFRN_DVAL', 'RCPT_MOTR_NEWFRN_PCT', 'RCPT_MOTR_OTH_DVAL',\n            'RCPT_MOTR_OTH_PCT', 'RCPT_MOTR_PHARM_DVAL', 'RCPT_MOTR_PHARM_PCT', 'RCPT_MOTR_STONE_DVAL',\n            'RCPT_MOTR_STONE_PCT', 'RCPT_MOTR_USEDGD_DVAL', 'RCPT_MOTR_USEDGD_PCT', 'RCPT_MOTR_VAL',\n            'RCPT_MOTR_WOOD_DVAL', 'RCPT_MOTR_WOOD_PCT', 'RCPT_NEWPT_SSBNFTS_VAL', 'RCPT_NEWS_ONLINE_DVAL',\n            'RCPT_NEWS_ONLINE_PCT', 'RCPT_NEWS_OTH_DVAL', 'RCPT_NEWS_OTH_PCT', 'RCPT_NEWS_PRNT_DVAL',\n            'RCPT_NEWS_PRNT_PCT', 'RCPT_NEWS_PUB_VAL', 'RCPT_NONMRCH_VAL', 'RCPT_NONOP_DVAL',\n            'RCPT_NONOP_GIFT_INVST_DVAL', 'RCPT_NONOP_GIFTS_VAL', 'RCPT_NONOP_INVST_VAL',\n            'RCPT_NONOP_OTH_VAL', 'RCPT_NONOP_PROGSRVC_VAL', 'RCPT_NONPT_HCARE_PRVDRS_VAL',\n            'RCPT_NONPT_OTH_VAL', 'RCPT_NONTELEMED_DVAL', 'RCPT_OFCEQ_VAL', 'RCPT_OTH_GOVPROG_VAL',\n            'RCPT_OTHMRCH_VAL', 'RCPT_OWN_VAL', 'RCPT_PAT_IN_DVAL', 'RCPT_PAT_IN_PCT', 'RCPT_PAT_NET_DVAL',\n            'RCPT_PAT_NET_DVAL', 'RCPT_PAT_OUT_DVAL', 'RCPT_PAT_OUT_PCT', 'RCPT_PAT_OUTPCKT_VAL',\n            'RCPT_PATCARE_OTH_VAL', 'RCPT_PER_ONLINE_DVAL', 'RCPT_PER_ONLINE_PCT', 'RCPT_PER_OTH_DVAL',\n            'RCPT_PER_OTH_PCT', 'RCPT_PER_PRNT_DVAL', 'RCPT_PER_PRNT_PCT', 'RCPT_PER_PUB_VAL',\n            'RCPT_PROPCSLTY_INS_VAL', 'RCPT_PVTHLTH_INS_VAL', 'RCPT_SHPHDL_VAL', 'RCPT_SOFTWARE_VAL',\n            'RCPT_SPTGD_VAL', 'RCPT_STOR_DVAL', 'RCPT_SUBLIN_VAL', 'RCPT_SYSOFT_ENTR_DVAL',\n            'RCPT_SYSOFT_ENTR_PCT', 'RCPT_SYSOFT_MAIN_DVAL', 'RCPT_SYSOFT_MAIN_PCT', 'RCPT_SYSOFT_OTH_DVAL',\n            'RCPT_SYSOFT_OTH_PCT', 'RCPT_SYSOFT_PERS_DVAL', 'RCPT_SYSOFT_PERS_PCT', 'RCPT_SYSOFT_PUB_VAL',\n            'RCPT_TELEMED_VAL', 'RCPT_TOT_HOTEL_OWN_VAL', 'RCPT_TOT_HOTEL_OWN3RD_DVAL',\n            'RCPT_TOT_HOTEL_OWN3RD_VAL', 'RCPT_TOT_PY_VAL', 'RCPT_TOT_VAL', 'RCPT_TOYS_VAL',\n            'RCPT_UFO_STAT', 'RCPT_UFO_VAL', 'RCPT_WORKCOMP_VAL', 'ROBOT_VAL', 'TABSTAT',\n            'TRAILER_NUM_TOT_DVAL', 'TRAILER_WD_NUM', 'TRAILER_WOD_NUM', 'TRUCK_NUM_TOT_DVAL',\n            'TRUCK_WD_NUM', 'TRUCK_WOD_NUM', 'TRUCKTRAC_NUM_TOT_DVAL', 'TRUCKTRAC_WD_NUM',\n            'TRUCKTRAC_WOD_NUM', 'YEAR_END_DATE', 'YEAR_START_DATE'\n        ]\n        for (let name of kauVariable) {\n            suData[name] = record?.[name]\n        }\n        for (let flag of kauFlags) {\n            let flagValue = record?.[flag]\n            let flagLetter = flagValue?.charAt(2)\n            if ([null, undefined].includes(flagLetter)) {\n                flagLetter = '_'\n            }\n            suData[flag] = setCharAt(suData[flag], 2, flagLetter)\n        }\n        console.log(suData)\n    }\n    \n    return msg;\n\n} catch (e) {\n    global.set('err', 'Exit Edit')\n    msg.payload.exit = 'KAU to SU'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "c22edf7e2e86893f",
        "type": "function",
        "z": "6ace7023ea973ebe",
        "name": "kau to su (database)",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx]; \n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    let updated = ''\n    if (record?.REPORTING_ID_TYP_TXT == 'KAU' && record?.ENT_TYP_TXT == 'SU' && !(['31', '32', '33'].includes(record?.GROUP_KEY_TXT.substring(0, 2)))) {\n        let suData = msg.estabs.find(su => su.facts.KAU_ID == record.KAU_ID)\n        if (suData) {\n            updated = 'Y'\n        }\n        const kauFlags = [\n            'CAPEX_BUILD_NEW_VAL_F', 'CAPEX_BUILD_TOT_DVAL_F', 'CAPEX_BUILD_USED_VAL_F', 'CAPEX_MACH_NEW_VAL_F',\n            'CAPEX_MACH_TOT_DVAL_F', 'CAPEX_MACH_USED_VAL_F', 'CAPEX_NEW_TOT_DVAL_F', 'CAPEX_TOT_DVAL_F',\n            'CAPEX_USED_TOT_DVAL_F', 'ECOMM_DPCT_F', 'EMP_MAR12_NUM_F', 'EXP_DPCT_F', 'EXPS_ACCESS_VAL_F',\n            'EXPS_ADVERT_VAL_F', 'EXPS_BENPAY_HLTH_VAL_F', 'EXPS_BENPAY_LIFE_VAL_F', 'EXPS_BROADCAST_VAL_F',\n            'EXPS_BUILD_REP_VAL_F', 'EXPS_COMMSVC_VAL_F', 'EXPS_COMPTR_OTHEQ_VAL_F', 'EXPS_DATAPROC_VAL_F',\n            'EXPS_DEPR_VAL_F', 'EXPS_EHR_STAT_F', 'EXPS_EHR_VAL_F', 'EXPS_ELEC_VAL_F', 'EXPS_EXSOFT_VAL_F',\n            'EXPS_FRNG_BENEFIT_VAL_F', 'EXPS_FUEL_TRANSP_VAL_F', 'EXPS_FUEL_VAL_F', 'EXPS_GRANTS_VAL_F',\n            'EXPS_INS_PREM_VAL_F', 'EXPS_INTEREST_VAL_F', 'EXPS_LOSS_NONMED_VAL_F', 'EXPS_LOSS_VAL_F',\n            'EXPS_MACH_REP_VAL_F', 'EXPS_MAT_V1_VAL_F', 'EXPS_MAT_V2_VAL_F', 'EXPS_NETFEE_VAL_F',\n            'EXPS_OTHER_VAL_F', 'EXPS_PRCH_RESALE_VAL_F', 'EXPS_PRINT_VAL_F', 'EXPS_PROFLIAB_VAL_F',\n            'EXPS_PROFTECH_VAL_F', 'EXPS_PROGPROD_VAL_F', 'EXPS_REFUSE_VAL_F', 'EXPS_RENT_BUILD_VAL_F',\n            'EXPS_RENT_MACH_VAL_F', 'EXPS_SOFTREPR_VAL_F', 'EXPS_SUPPLY_MED_VAL_F', 'EXPS_TAX_VAL_F',\n            'EXPS_TEMPSTAF_VAL_F', 'EXPS_TOT_DVAL_F', 'EXPS_TOT_HOTEL_OWN3RD_DVAL_F',\n            'EXPS_TOT_HOTEL_OWN3RD_VAL_F', 'EXPS_TOT_VAL_F', 'EXPS_TRANSP_REP_VAL_F', 'EXPS_TRANSP_VAL_F',\n            'EXPS_USC_VAL_F', 'HOTEL_MNG_EIN_NUM_F', 'HOTEL_MNG_NAME_TXT_F', 'HOTEL_OWN3RD_NUM_F',\n            'HOTEL_OWN3RD_STAT_F', 'HOTEL_OWNMNG_NUM_F', 'HOTEL_OWNNOTMNG_NUM_F', 'INV_B_LIFO_NET_DVAL_F',\n            'INV_B_TOT_DVAL_F', 'INV_DOM_DVAL_F', 'INV_E_FIN_VAL_F', 'INV_E_LIFO_RSV_VAL_F',\n            'INV_E_LIFO_VAL_F', 'INV_E_MAT_VAL_F', 'INV_E_TOT_DVAL_F', 'INV_E_WIP_VAL_F',\n            'INV_FOREIGN_DPCT_F', 'INV_FOREIGN_VAL_F', 'INV_RPT_DATE_F', 'INV_STAT_F',\n            'INVENTORY_DPCT_F', 'MRCH_ECOMMERCE_DVAL_F', 'MRCH_NONMERCH_EC_DVAL_F',\n            'MRCH_NONMERCH_SALES_DVAL_F', 'MRCH_SALES_DVAL_F', 'PAT_IN_DAYS_NUM_F', 'PAT_OUT_VISIT_NUM_F',\n            'PAT_VISITS_NUM_F', 'PAY_ANN_VAL_F', 'PAY_QTR1_VAL_F', 'PROFIT_LOSS_DVAL_F', 'PURCHASES_DPCT_F',\n            'RCPT_ADV_CLASS_DVAL_F', 'RCPT_ADV_CLASS_PCT_F', 'RCPT_ADV_OTH_DVAL_F', 'RCPT_ADV_OTH_PCT_F',\n            'RCPT_ADV_SPACE_VAL_F', 'RCPT_ADVERT_VAL_F', 'RCPT_AGBR_REV_DVAL_F', 'RCPT_APSOFT_ENTR_DVAL_F',\n            'RCPT_APSOFT_ENTR_PCT_F', 'RCPT_APSOFT_MAIN_DVAL_F', 'RCPT_APSOFT_MAIN_PCT_F',\n            'RCPT_APSOFT_OTH_DVAL_F', 'RCPT_APSOFT_OTH_PCT_F', 'RCPT_APSOFT_PERS_DVAL_F',\n            'RCPT_APSOFT_PERS_PCT_F', 'RCPT_APSOFT_PUB_VAL_F', 'RCPT_AUDVID_VAL_F', 'RCPT_BILL_OTHOP_DVAL_F',\n            'RCPT_BILL_OTHOP_PCT_F', 'RCPT_BILL_PAY_DVAL_F', 'RCPT_BILL_PAY_PCT_F', 'RCPT_BOOK_ONLINE_DVAL_F',\n            'RCPT_BOOK_ONLINE_PCT_F', 'RCPT_BOOK_OTH_DVAL_F', 'RCPT_BOOK_OTH_PCT_F', 'RCPT_BOOK_PRNT_DVAL_F',\n            'RCPT_BOOK_PRNT_PCT_F', 'RCPT_BOOK_PUB_VAL_F', 'RCPT_BOOK_VAL_F', 'RCPT_BUS_DVAL_F',\n            'RCPT_BUS_PCT_F', 'RCPT_CLOTH_VAL_F', 'RCPT_COMP_VAL_F', 'RCPT_COMSN_AVG_RATE_PCT_F',\n            'RCPT_COMSN_AVG_RATE_RAT_F', 'RCPT_COMSN_EARN_VAL_F', 'RCPT_COMSN_GSV_VAL_F',\n            'RCPT_CUST_BUS_DVAL_F', 'RCPT_CUST_BUS_PCT_F', 'RCPT_CUST_IND_DVAL_F', 'RCPT_CUST_IND_PCT_F',\n            'RCPT_CUST_LNGTEL_BUS_DVAL_F', 'RCPT_CUST_LNGTEL_BUS_PCT_F', 'RCPT_CUST_LNGTEL_IND_DVAL_F',\n            'RCPT_CUST_LNGTEL_IND_PCT_F', 'RCPT_CUST_LOCTEL_BUS_DVAL_F', 'RCPT_CUST_LOCTEL_BUS_PCT_F',\n            'RCPT_CUST_LOCTEL_IND_DVAL_F', 'RCPT_CUST_LOCTEL_IND_PCT_F', 'RCPT_CUST_NORES_DVAL_F',\n            'RCPT_CUST_NORES_PCT_F', 'RCPT_CUST_RES_DVAL_F', 'RCPT_CUST_RES_PCT_F', 'RCPT_CUST_SUBLIN_BUS_DVAL_F',\n            'RCPT_CUST_SUBLIN_BUS_PCT_F', 'RCPT_CUST_SUBLIN_IND_DVAL_F', 'RCPT_CUST_SUBLIN_IND_PCT_F',\n            'RCPT_DIR_ONLINE_DVAL_F', 'RCPT_DIR_ONLINE_PCT_F', 'RCPT_DIR_OTH_DVAL_F', 'RCPT_DIR_OTH_PCT_F',\n            'RCPT_DIR_PRNT_DVAL_F', 'RCPT_DIR_PRNT_PCT_F', 'RCPT_DIR_PUB_VAL_F', 'RCPT_DRUGS_VAL_F',\n            'RCPT_ECOMM_ADVERT_VAL_F', 'RCPT_ECOMM_AUDVID_VAL_F', 'RCPT_ECOMM_BOOK_VAL_F',\n            'RCPT_ECOMM_CLOTH_VAL_F', 'RCPT_ECOMM_COMP_VAL_F', 'RCPT_ECOMM_DRUGS_VAL_F',\n            'RCPT_ECOMM_ELAPPL_VAL_F', 'RCPT_ECOMM_FDBRWN_VAL_F', 'RCPT_ECOMM_FURNTR_VAL_F',\n            'RCPT_ECOMM_HOTEL_OWN3RD_VAL_F', 'RCPT_ECOMM_JWLRY_VAL_F', 'RCPT_ECOMM_NONMRCH_VAL_F',\n            'RCPT_ECOMM_OFCEQ_VAL_F', 'RCPT_ECOMM_OTHMRCH_VAL_F', 'RCPT_ECOMM_SHPHDL_VAL_F',\n            'RCPT_ECOMM_SOFTWARE_VAL_F', 'RCPT_ECOMM_SPTGD_VAL_F', 'RCPT_ECOMM_TOYS_VAL_F', 'RCPT_ECOMM_VAL_F',\n            'RCPT_ELAPPL_VAL_F', 'RCPT_FDBRWN_VAL_F', 'RCPT_FURNTR_VAL_F', 'RCPT_GROSSBILL_VAL_F',\n            'RCPT_HLTHCARE_PRVDRS_VAL_F', 'RCPT_JWLRY_VAL_F', 'RCPT_LEISURE_DVAL_F', 'RCPT_LEISURE_PCT_F',\n            'RCPT_LNGTEL_VAL_F', 'RCPT_LOCTEL_VAL_F', 'RCPT_MEDICAID_VAL_F', 'RCPT_MEDICARE_VAL_F',\n            'RCPT_MOTR_AGR_DVAL_F', 'RCPT_MOTR_AGR_PCT_F', 'RCPT_MOTR_ELECT_DVAL_F', 'RCPT_MOTR_ELECT_PCT_F',\n            'RCPT_MOTR_FUEL_DVAL_F', 'RCPT_MOTR_FUEL_PCT_F', 'RCPT_MOTR_GRAIN_DVAL_F', 'RCPT_MOTR_GRAIN_PCT_F',\n            'RCPT_MOTR_HAZRD_DVAL_F', 'RCPT_MOTR_HAZRD_PCT_F', 'RCPT_MOTR_HAZRD_STAT_F', 'RCPT_MOTR_METAL_DVAL_F',\n            'RCPT_MOTR_METAL_PCT_F', 'RCPT_MOTR_NEWFRN_DVAL_F', 'RCPT_MOTR_NEWFRN_PCT_F', 'RCPT_MOTR_OTH_DVAL_F',\n            'RCPT_MOTR_OTH_PCT_F', 'RCPT_MOTR_PHARM_DVAL_F', 'RCPT_MOTR_PHARM_PCT_F', 'RCPT_MOTR_STONE_DVAL_F',\n            'RCPT_MOTR_STONE_PCT_F', 'RCPT_MOTR_USEDGD_DVAL_F', 'RCPT_MOTR_USEDGD_PCT_F', 'RCPT_MOTR_VAL_F',\n            'RCPT_MOTR_WOOD_DVAL_F', 'RCPT_MOTR_WOOD_PCT_F', 'RCPT_NEWPT_SSBNFTS_VAL_F', 'RCPT_NEWS_ONLINE_DVAL_F',\n            'RCPT_NEWS_ONLINE_PCT_F', 'RCPT_NEWS_OTH_DVAL_F', 'RCPT_NEWS_OTH_PCT_F', 'RCPT_NEWS_PRNT_DVAL_F',\n            'RCPT_NEWS_PRNT_PCT_F', 'RCPT_NEWS_PUB_VAL_F', 'RCPT_NONMRCH_VAL_F', 'RCPT_NONOP_DVAL_F',\n            'RCPT_NONOP_GIFT_INVST_DVAL_F', 'RCPT_NONOP_GIFTS_VAL_F', 'RCPT_NONOP_INVST_VAL_F',\n            'RCPT_NONOP_OTH_VAL_F', 'RCPT_NONOP_PROGSRVC_VAL_F', 'RCPT_NONPT_HCARE_PRVDRS_VAL_F',\n            'RCPT_NONPT_OTH_VAL_F', 'RCPT_NONTELEMED_DVAL_F', 'RCPT_OFCEQ_VAL_F', 'RCPT_OTH_GOVPROG_VAL_F',\n            'RCPT_OTHMRCH_TXT_F', 'RCPT_OTHMRCH_VAL_F', 'RCPT_OWN_VAL_F', 'RCPT_PAT_IN_DVAL_F',\n            'RCPT_PAT_IN_PCT_F', 'RCPT_PAT_OUT_DVAL_F', 'RCPT_PAT_OUT_PCT_F', 'RCPT_PAT_OUTPCKT_VAL_F',\n            'RCPT_PATCARE_OTH_VAL_F', 'RCPT_PER_ONLINE_DVAL_F', 'RCPT_PER_ONLINE_PCT_F', 'RCPT_PER_OTH_DVAL_F',\n            'RCPT_PER_OTH_PCT_F', 'RCPT_PER_PRNT_DVAL_F', 'RCPT_PER_PRNT_PCT_F', 'RCPT_PER_PUB_VAL_F',\n            'RCPT_PROPCSLTY_INS_VAL_F', 'RCPT_PVTHLTH_INS_VAL_F', 'RCPT_SHPHDL_VAL_F', 'RCPT_SOFTWARE_VAL_F',\n            'RCPT_SPTGD_VAL_F', 'RCPT_STOR_DVAL_F', 'RCPT_SUBLIN_VAL_F', 'RCPT_SYSOFT_ENTR_DVAL_F',\n            'RCPT_SYSOFT_ENTR_PCT_F', 'RCPT_SYSOFT_MAIN_DVAL_F', 'RCPT_SYSOFT_MAIN_PCT_F', 'RCPT_SYSOFT_OTH_DVAL_F',\n            'RCPT_SYSOFT_OTH_PCT_F', 'RCPT_SYSOFT_PERS_DVAL_F', 'RCPT_SYSOFT_PERS_PCT_F',\n            'RCPT_SYSOFT_PUB_VAL_F', 'RCPT_TELEMED_VAL_F', 'RCPT_TOT_HOTEL_OWN_VAL_F',\n            'RCPT_TOT_HOTEL_OWN3RD_DVAL_F', 'RCPT_TOT_HOTEL_OWN3RD_VAL_F', 'RCPT_TOT_PY_VAL_F',\n            'RCPT_TOT_VAL_F', 'RCPT_TOYS_VAL_F', 'RCPT_UFO_STAT_F', 'RCPT_UFO_VAL_F', 'RCPT_WORKCOMP_VAL_F',\n            'ROBOT_VAL_F', 'TRAILER_NUM_TOT_DVAL_F', 'TRAILER_WD_NUM_F', 'TRAILER_WOD_NUM_F',\n            'TRUCK_NUM_TOT_DVAL_F', 'TRUCK_WD_NUM_F', 'TRUCK_WOD_NUM_F', 'TRUCKTRAC_NUM_TOT_DVAL_F',\n            'TRUCKTRAC_WD_NUM_F', 'TRUCKTRAC_WOD_NUM_F', 'YEAR_END_DATE_F', 'YEAR_START_DATE_F'\n        ]\n\n\n        const kauVariable = [\n            'CAPEX_BUILD_NEW_VAL', 'CAPEX_BUILD_TOT_DVAL', 'CAPEX_BUILD_USED_VAL', 'CAPEX_MACH_NEW_VAL',\n            'CAPEX_MACH_TOT_DVAL', 'CAPEX_MACH_USED_VAL', 'CAPEX_NEW_TOT_DVAL', 'CAPEX_TOT_DVAL',\n            'CAPEX_USED_TOT_DVAL', 'ECOMM_DPCT', 'EMP_MAR12_NUM', 'EXP_DPCT', 'EXPS_ACCESS_VAL',\n            'EXPS_ADVERT_VAL', 'EXPS_BENPAY_HLTH_VAL', 'EXPS_BENPAY_LIFE_VAL', 'EXPS_BROADCAST_VAL',\n            'EXPS_BUILD_REP_VAL', 'EXPS_COMMSVC_VAL', 'EXPS_COMPTR_OTHEQ_VAL', 'EXPS_DATAPROC_VAL',\n            'EXPS_DEPR_VAL', 'EXPS_EHR_STAT', 'EXPS_EHR_VAL', 'EXPS_ELEC_VAL', 'EXPS_EXSOFT_VAL',\n            'EXPS_FRNG_BENEFIT_VAL', 'EXPS_FUEL_TRANSP_VAL', 'EXPS_FUEL_VAL', 'EXPS_GRANTS_VAL',\n            'EXPS_INS_PREM_VAL', 'EXPS_INTEREST_VAL', 'EXPS_LOSS_NONMED_VAL', 'EXPS_LOSS_VAL',\n            'EXPS_MACH_REP_VAL', 'EXPS_MAT_V1_VAL', 'EXPS_MAT_V2_VAL', 'EXPS_NETFEE_VAL', 'EXPS_OTHER_VAL',\n            'EXPS_PRCH_RESALE_VAL', 'EXPS_PRINT_VAL', 'EXPS_PROFLIAB_VAL', 'EXPS_PROFTECH_VAL',\n            'EXPS_PROGPROD_VAL', 'EXPS_REFUSE_VAL', 'EXPS_RENT_BUILD_VAL', 'EXPS_RENT_MACH_VAL',\n            'EXPS_SOFTREPR_VAL', 'EXPS_SUPPLY_MED_VAL', 'EXPS_TAX_VAL', 'EXPS_TEMPSTAF_VAL', 'EXPS_TOT_DVAL',\n            'EXPS_TOT_HOTEL_OWN3RD_DVAL', 'EXPS_TOT_HOTEL_OWN3RD_VAL', 'EXPS_TOT_VAL', 'EXPS_TRANSP_REP_VAL',\n            'EXPS_TRANSP_VAL', 'EXPS_USC_VAL', 'HOTEL_MNG_EIN_NUM', 'HOTEL_MNG_NAME_TXT', 'HOTEL_OWN3RD_NUM',\n            'HOTEL_OWN3RD_STAT', 'HOTEL_OWNMNG_NUM', 'HOTEL_OWNNOTMNG_NUM', 'INV_B_LIFO_NET_DVAL',\n            'INV_B_TOT_DVAL', 'INV_DOM_DVAL', 'INV_E_FIN_VAL', 'INV_E_LIFO_RSV_VAL', 'INV_E_LIFO_VAL',\n            'INV_E_MAT_VAL', 'INV_E_TOT_DVAL', 'INV_E_WIP_VAL', 'INV_FOREIGN_DPCT', 'INV_FOREIGN_VAL',\n            'INV_RPT_DATE', 'INV_STAT', 'INVENTORY_DPCT', 'MRCH_ECOMMERCE_DVAL', 'MRCH_NONMERCH_EC_DVAL',\n            'MRCH_NONMERCH_SALES_DVAL', 'MRCH_SALES_DVAL', 'NONTABFL', 'PAT_IN_DAYS_NUM', 'PAT_OUT_VISIT_NUM',\n            'PAT_VISITS_NUM', 'PAY_ANN_VAL', 'PAY_QTR1_VAL', 'PROFIT_LOSS_DVAL', 'PURCHASES_DPCT',\n            'RCPT_ADV_CLASS_DVAL', 'RCPT_ADV_CLASS_PCT', 'RCPT_ADV_OTH_DVAL', 'RCPT_ADV_OTH_PCT',\n            'RCPT_ADV_SPACE_VAL', 'RCPT_ADVERT_VAL', 'RCPT_AGBR_REV_DVAL', 'RCPT_APSOFT_ENTR_DVAL',\n            'RCPT_APSOFT_ENTR_PCT', 'RCPT_APSOFT_MAIN_DVAL', 'RCPT_APSOFT_MAIN_PCT', 'RCPT_APSOFT_OTH_DVAL',\n            'RCPT_APSOFT_OTH_PCT', 'RCPT_APSOFT_PERS_DVAL', 'RCPT_APSOFT_PERS_PCT', 'RCPT_APSOFT_PUB_VAL',\n            'RCPT_AUDVID_VAL', 'RCPT_BILL_OTHOP_DVAL', 'RCPT_BILL_OTHOP_PCT', 'RCPT_BILL_PAY_DVAL',\n            'RCPT_BILL_PAY_PCT', 'RCPT_BOOK_ONLINE_DVAL', 'RCPT_BOOK_ONLINE_PCT', 'RCPT_BOOK_OTH_DVAL',\n            'RCPT_BOOK_OTH_PCT', 'RCPT_BOOK_PRNT_DVAL', 'RCPT_BOOK_PRNT_PCT', 'RCPT_BOOK_PUB_VAL',\n            'RCPT_BOOK_VAL', 'RCPT_BUS_DVAL', 'RCPT_BUS_PCT', 'RCPT_CLOTH_VAL', 'RCPT_COMP_VAL',\n            'RCPT_COMSN_AVG_RATE_PCT', 'RCPT_COMSN_AVG_RATE_RAT', 'RCPT_COMSN_EARN_VAL', 'RCPT_COMSN_GSV_VAL',\n            'RCPT_CUST_BUS_DVAL', 'RCPT_CUST_BUS_PCT', 'RCPT_CUST_IND_DVAL', 'RCPT_CUST_IND_PCT',\n            'RCPT_CUST_LNGTEL_BUS_DVAL', 'RCPT_CUST_LNGTEL_BUS_PCT', 'RCPT_CUST_LNGTEL_IND_DVAL',\n            'RCPT_CUST_LNGTEL_IND_PCT', 'RCPT_CUST_LOCTEL_BUS_DVAL', 'RCPT_CUST_LOCTEL_BUS_PCT',\n            'RCPT_CUST_LOCTEL_IND_DVAL', 'RCPT_CUST_LOCTEL_IND_PCT', 'RCPT_CUST_NORES_DVAL',\n            'RCPT_CUST_NORES_PCT', 'RCPT_CUST_RES_DVAL', 'RCPT_CUST_RES_PCT', 'RCPT_CUST_SUBLIN_BUS_DVAL',\n            'RCPT_CUST_SUBLIN_BUS_PCT', 'RCPT_CUST_SUBLIN_IND_DVAL', 'RCPT_CUST_SUBLIN_IND_PCT',\n            'RCPT_DIR_ONLINE_DVAL', 'RCPT_DIR_ONLINE_PCT', 'RCPT_DIR_OTH_DVAL', 'RCPT_DIR_OTH_PCT',\n            'RCPT_DIR_PRNT_DVAL', 'RCPT_DIR_PRNT_PCT', 'RCPT_DIR_PUB_VAL', 'RCPT_DRUGS_VAL',\n            'RCPT_ECOMM_ADVERT_VAL', 'RCPT_ECOMM_AUDVID_VAL', 'RCPT_ECOMM_BOOK_VAL', 'RCPT_ECOMM_CLOTH_VAL',\n            'RCPT_ECOMM_COMP_VAL', 'RCPT_ECOMM_DRUGS_VAL', 'RCPT_ECOMM_ELAPPL_VAL', 'RCPT_ECOMM_FDBRWN_VAL',\n            'RCPT_ECOMM_FURNTR_VAL', 'RCPT_ECOMM_HOTEL_OWN3RD_VAL', 'RCPT_ECOMM_JWLRY_VAL',\n            'RCPT_ECOMM_NONMRCH_VAL', 'RCPT_ECOMM_OFCEQ_VAL', 'RCPT_ECOMM_OTHMRCH_VAL',\n            'RCPT_ECOMM_SHPHDL_VAL', 'RCPT_ECOMM_SOFTWARE_VAL', 'RCPT_ECOMM_SPTGD_VAL', 'RCPT_ECOMM_TOYS_VAL',\n            'RCPT_ECOMM_VAL', 'RCPT_ELAPPL_VAL', 'RCPT_FDBRWN_VAL', 'RCPT_FURNTR_VAL', 'RCPT_GROSSBILL_VAL',\n            'RCPT_HLTHCARE_PRVDRS_VAL', 'RCPT_JWLRY_VAL', 'RCPT_LEISURE_DVAL', 'RCPT_LEISURE_PCT',\n            'RCPT_LNGTEL_VAL', 'RCPT_LOCTEL_VAL', 'RCPT_MEDICAID_VAL', 'RCPT_MEDICARE_VAL',\n            'RCPT_MOTR_AGR_DVAL', 'RCPT_MOTR_AGR_PCT', 'RCPT_MOTR_ELECT_DVAL', 'RCPT_MOTR_ELECT_PCT',\n            'RCPT_MOTR_FUEL_DVAL', 'RCPT_MOTR_FUEL_PCT', 'RCPT_MOTR_GRAIN_DVAL', 'RCPT_MOTR_GRAIN_PCT',\n            'RCPT_MOTR_HAZRD_DVAL', 'RCPT_MOTR_HAZRD_PCT', 'RCPT_MOTR_HAZRD_STAT', 'RCPT_MOTR_METAL_DVAL',\n            'RCPT_MOTR_METAL_PCT', 'RCPT_MOTR_NEWFRN_DVAL', 'RCPT_MOTR_NEWFRN_PCT', 'RCPT_MOTR_OTH_DVAL',\n            'RCPT_MOTR_OTH_PCT', 'RCPT_MOTR_PHARM_DVAL', 'RCPT_MOTR_PHARM_PCT', 'RCPT_MOTR_STONE_DVAL',\n            'RCPT_MOTR_STONE_PCT', 'RCPT_MOTR_USEDGD_DVAL', 'RCPT_MOTR_USEDGD_PCT', 'RCPT_MOTR_VAL',\n            'RCPT_MOTR_WOOD_DVAL', 'RCPT_MOTR_WOOD_PCT', 'RCPT_NEWPT_SSBNFTS_VAL', 'RCPT_NEWS_ONLINE_DVAL',\n            'RCPT_NEWS_ONLINE_PCT', 'RCPT_NEWS_OTH_DVAL', 'RCPT_NEWS_OTH_PCT', 'RCPT_NEWS_PRNT_DVAL',\n            'RCPT_NEWS_PRNT_PCT', 'RCPT_NEWS_PUB_VAL', 'RCPT_NONMRCH_VAL', 'RCPT_NONOP_DVAL',\n            'RCPT_NONOP_GIFT_INVST_DVAL', 'RCPT_NONOP_GIFTS_VAL', 'RCPT_NONOP_INVST_VAL',\n            'RCPT_NONOP_OTH_VAL', 'RCPT_NONOP_PROGSRVC_VAL', 'RCPT_NONPT_HCARE_PRVDRS_VAL',\n            'RCPT_NONPT_OTH_VAL', 'RCPT_NONTELEMED_DVAL', 'RCPT_OFCEQ_VAL', 'RCPT_OTH_GOVPROG_VAL',\n            'RCPT_OTHMRCH_VAL', 'RCPT_OWN_VAL', 'RCPT_PAT_IN_DVAL', 'RCPT_PAT_IN_PCT', 'RCPT_PAT_NET_DVAL',\n            'RCPT_PAT_NET_DVAL', 'RCPT_PAT_OUT_DVAL', 'RCPT_PAT_OUT_PCT', 'RCPT_PAT_OUTPCKT_VAL',\n            'RCPT_PATCARE_OTH_VAL', 'RCPT_PER_ONLINE_DVAL', 'RCPT_PER_ONLINE_PCT', 'RCPT_PER_OTH_DVAL',\n            'RCPT_PER_OTH_PCT', 'RCPT_PER_PRNT_DVAL', 'RCPT_PER_PRNT_PCT', 'RCPT_PER_PUB_VAL',\n            'RCPT_PROPCSLTY_INS_VAL', 'RCPT_PVTHLTH_INS_VAL', 'RCPT_SHPHDL_VAL', 'RCPT_SOFTWARE_VAL',\n            'RCPT_SPTGD_VAL', 'RCPT_STOR_DVAL', 'RCPT_SUBLIN_VAL', 'RCPT_SYSOFT_ENTR_DVAL',\n            'RCPT_SYSOFT_ENTR_PCT', 'RCPT_SYSOFT_MAIN_DVAL', 'RCPT_SYSOFT_MAIN_PCT', 'RCPT_SYSOFT_OTH_DVAL',\n            'RCPT_SYSOFT_OTH_PCT', 'RCPT_SYSOFT_PERS_DVAL', 'RCPT_SYSOFT_PERS_PCT', 'RCPT_SYSOFT_PUB_VAL',\n            'RCPT_TELEMED_VAL', 'RCPT_TOT_HOTEL_OWN_VAL', 'RCPT_TOT_HOTEL_OWN3RD_DVAL',\n            'RCPT_TOT_HOTEL_OWN3RD_VAL', 'RCPT_TOT_PY_VAL', 'RCPT_TOT_VAL', 'RCPT_TOYS_VAL',\n            'RCPT_UFO_STAT', 'RCPT_UFO_VAL', 'RCPT_WORKCOMP_VAL', 'ROBOT_VAL', 'TABSTAT',\n            'TRAILER_NUM_TOT_DVAL', 'TRAILER_WD_NUM', 'TRAILER_WOD_NUM', 'TRUCK_NUM_TOT_DVAL',\n            'TRUCK_WD_NUM', 'TRUCK_WOD_NUM', 'TRUCKTRAC_NUM_TOT_DVAL', 'TRUCKTRAC_WD_NUM',\n            'TRUCKTRAC_WOD_NUM', 'YEAR_END_DATE', 'YEAR_START_DATE'\n        ]\n\n        for (let name of kauVariable) {\n            suData[name] = record[name]\n        }\n        for (let flag of kauFlags) {\n            let flagValue = record[flag]\n            let flagLetter = flagValue.charAt(2)\n            if ([null, undefined].includes(flagLetter)) {\n                flagLetter = '_'\n            }\n            suData[flag] = setCharAt(suData[flag], 2, flagLetter)\n        }\n    }\n\n    if (updated == 'Y') {\n        let CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\n        let DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\n\n        let arr = msg.estabs;\n        let query = \"UPDATE \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" SET facts = CASE id \";\n        let string = ''\n        // Add CASE conditions for each ID\n        arr.forEach(item => {\n            query += `WHEN ${item.id} THEN '${JSON.stringify(item.facts).replace(/'/g, \"''\")}'::jsonb `;\n        });\n        // // Close the CASE statement and specify which IDs should be updated\n        let ids = arr.map(item => item.id);\n        query += `END WHERE id IN (${ids.join(', ')})`;\n\n        let jobName = msg.payload.job.jobName.replace(/'/g, \"''\"); // Escape single quotes\n        query += ` AND jobname = '${jobName}'`;\n\n        if (query.includes(\"();\")) {\n            msg.query = \"The query is invalid\"\n        } else {\n            msg.query = query\n        }\n        msg.records = msg.payload\n    } else {\n        msg.query = \"No query\"\n    }\n\n    return msg;\n\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'KAU to SU'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 380,
        "wires": [
            [
                "4ec7abca77ff5c61"
            ]
        ]
    },
    {
        "id": "8fbc05957c7403bb",
        "type": "function",
        "z": "6ace7023ea973ebe",
        "name": "reset msg",
        "func": "msg.estabs = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 380,
        "wires": [
            [
                "c22edf7e2e86893f"
            ]
        ]
    },
    {
        "id": "aad7779af50a0d87",
        "type": "function",
        "z": "6ace7023ea973ebe",
        "name": "query_estabs",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.KAU_ID\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where kau_id = '\" + id + \"' and type = 'ESTAB' and jobname = '\" + job +\"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 260,
        "wires": [
            [
                "0e8ee961a3261df9"
            ]
        ]
    },
    {
        "id": "0e8ee961a3261df9",
        "type": "subflow:8032608991ae0162",
        "z": "6ace7023ea973ebe",
        "name": "",
        "x": 440,
        "y": 260,
        "wires": [
            [
                "8fbc05957c7403bb"
            ]
        ]
    },
    {
        "id": "53852e511b8bf62c",
        "type": "function",
        "z": "6ace7023ea973ebe",
        "name": "reset msg",
        "func": "msg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "e71f368dae707e48",
        "type": "subflow:8032608991ae0162",
        "z": "6ace7023ea973ebe",
        "name": "",
        "x": 1000,
        "y": 380,
        "wires": [
            [
                "53852e511b8bf62c"
            ]
        ]
    },
    {
        "id": "4ec7abca77ff5c61",
        "type": "switch",
        "z": "6ace7023ea973ebe",
        "name": "",
        "property": "query",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "The query is invalid",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "No query",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 810,
        "y": 380,
        "wires": [
            [],
            [],
            [
                "e71f368dae707e48"
            ]
        ]
    },
    {
        "id": "513fe743c07a7cac",
        "type": "function",
        "z": "1a2581dce20863e3",
        "name": "check scope",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\")\n    let record = msg.payload.csv[record_idx];\n\n    if (['SU','MU'].includes(record?.REPORTING_ID_TYP_TXT)) {\n        if (record?.SCOPE == 'Y') {\n            flow.set('scope','Y')\n        } else {\n            flow.set('scope', 'N')\n        }\n    } else if (['KAU'].includes(record?.REPORTING_ID_TYP_TXT)) {\n        if (record?.GROUP_KEY_TXT.substring(10,11) == 'Y') {\n            flow.set('scope', 'Y')\n        } else {\n            flow.set('scope', 'N')\n        }\n    } else if (['ENT'].includes(record?.REPORTING_ID_TYP_TXT)) {\n        flow.set('scope', 'Y')\n    }\n\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'Scope Check'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "af6b654eb7fd90cf",
        "type": "function",
        "z": "7c74ea1220a33f32",
        "name": "sector 31",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\")\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NAICS_SECTOR == '31') {\n        global.set('naicsSector','Y')\n    } else {\n        global.set('naicsSector','N')\n    }\n\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'Sector 31'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "622a3718b9ba0fb5",
        "type": "function",
        "z": "7c74ea1220a33f32",
        "name": "sector 31 database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NAICS_SECTOR == '31') {\n        msg.naicsSector = 'Y'\n    } else {\n        msg.naicsSector = 'N'\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'Sector 31'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "264c6fe27b557bb8",
        "type": "function",
        "z": "a307acf02307bc62",
        "name": "check estab nontabfl",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\")\n    let record = msg.payload.csv[record_idx];\n\n    if (['MU','SU'].includes(record?.REPORTING_ID_TYP_TXT) && record?.NONTABFL == 'M') {\n        global.set('action','Exit Edit')\n    }\n    return msg;\n} catch(e) {\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "3a5a4e7bbbaed5e8",
        "type": "function",
        "z": "a307acf02307bc62",
        "name": "check estab nontabfl database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts\n    let record = msg.payload.csv[record_idx];\n\n    if (['MU','SU'].includes(record?.REPORTING_ID_TYP_TXT) && record?.NONTABFL == 'M') {\n        msg.action = 'Exit Edit'\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'check estab nontabfl'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "f6885c586821c8cd",
        "type": "function",
        "z": "b3b1701e035827dc",
        "name": "NAPCS HDICAT",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    function NAPCSHDICAT() {\n    if(record?.TABSTAT == 'Y' && parseFloat(record?.RCPT_TOT_VAL) > 0 && ['SU','MU'].includes(record?.REPORTING_ID_TYP_TXT)){\n            if(record?.NAPCS_IND == 'U'){\n                if(['T','E'].includes(record?.NAPCS_NODONOR)){\n                    // setCharAt(record.NAPCS_HDICAT, 1, 'NC')\n                    record.NAPCS_HDICAT = 'NC'\n                }else{\n                    // setCharAt(record.NAPCS_HDICAT, 1, 'C')\n                    record.NAPCS_HDICAT = '_C'\n                }\n            }else{\n                // setCharAt(record.NAPCS_HDICAT, 1, 'F')\n                record.NAPCS_HDICAT = '_F'\n            }\n    }else{\n        record.NAPCS_HDICAT = null\n    }\n        record.ACTION = 'END'\n    }\n    NAPCSHDICAT()\n    return msg\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'NAPCS HDICAT'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "ed81efb441d78c39",
        "type": "function",
        "z": "b3b1701e035827dc",
        "name": "NAPCS HDICAT (database)",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n    function NAPCSHDICAT() {\n    if(record?.TABSTAT == 'Y' && parseFloat(record?.RCPT_TOT_VAL) > 0 && ['SU','MU'].includes(record?.REPORTING_ID_TYP_TXT)){\n            if(record?.NAPCS_IND == 'U'){\n                if(['T','E'].includes(record?.NAPCS_NODONOR)){\n                    // setCharAt(record.NAPCS_HDICAT, 1, 'NC')\n                    record.NAPCS_HDICAT = 'NC'\n                }else{\n                    // setCharAt(record.NAPCS_HDICAT, 1, 'C')\n                    record.NAPCS_HDICAT = '_C'\n                }\n            }else{\n                // setCharAt(record.NAPCS_HDICAT, 1, 'F')\n                record.NAPCS_HDICAT = '_F'\n            }\n    }else{\n        record.NAPCS_HDICAT = null\n    }\n        record.ACTION = 'END'\n    }\n    NAPCSHDICAT()\n    return msg\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS HDICAT'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "d1b1713300484045",
        "type": "function",
        "z": "b576348e42469acf",
        "name": "NAPCS: M_GOCO",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let variable_f = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[variable_f] = setCharAt(record?.[variable_f], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[variable_f] = setCharAt(record?.[variable_f], 2, 'Y');\n            } else {\n                record[variable_f] = setCharAt(record?.[variable_f], 2, 'S');\n            }\n        }\n    }\n\n    let cache = global.get(\"lookupCache\");\n    let naics_napcs = cache.data.find(\n        item =>\n            item.module === \"napcs\" &&\n            item.param === 'naics_to_napcs_m_goco' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    var napcs = naics_napcs['NAICS_TO_NAPCS_M_GOCO']\n    function isNaicsCodeFound() {\n        for (let i in napcs) {\n            let row = napcs[i]\n            if (record?.NAICS_CODE.substr(0, 3) == row['NAICS-3']) {\n                return (row.NAPCS)\n            }\n        }\n    }\n\n    let isNaicsFound = naics_napcs?.NAICS_TO_NAPCS_M_GOCO.some(n => n['NAICS-3'] == record?.NAICS_CODE.substr(0, 3));\n\n    function NAPCSMGOCO() {\n        if (record?.NAPCS_IND == 'U') {\n            record.PROD_CODE_VAL_PO = 0\n            record.USABLE = 'D'\n            record.PROD_CODE_VAL_PO_F = setCharAt(record?.PROD_CODE_VAL_PO_F, 1, 'Z')\n        }\n\n        if (isNaicsFound) {\n            record.NAPCS_IND = 'U'\n            record.PROD_CODE = isNaicsCodeFound()\n            record.PROD_CODE_VAL_PO = record?.RCPT_TOT_VAL\n            record.REF_PER = record?.REF_PER\n            flagRules('PROD_CODE_VAL_PO', ['RCPT_TOT_VAL_F'])\n\n            const fields = [\n                \"CAPEX_BUILD_NEW_VAL\", \"CAPEX_BUILD_USED_VAL\", \"CAPEX_BUILD_TOT_DVAL\",\n                \"CAPEX_MACH_NEW_VAL\", \"CAPEX_MACH_USED_VAL\", \"CAPEX_MACH_TOT_DVAL\",\n                \"CAPEX_AUTO_VAL\", \"CAPEX_COMPTR_VAL\", \"CAPEX_OTHMACH_VAL\",\n                \"CAPEX_OTH_NEW_VAL\", \"CAPEX_OTH_NEW_WRTIN_TXT\", \"CAPEX_OTH_USED_VAL\",\n                \"CAPEX_OTH_USED_WRTIN_TXT\", \"CAPEX_OTH_TOT_DVAL\", \"CAPEX_NEW_TOT_DVAL\",\n                \"CAPEX_USED_TOT_DVAL\", \"CAPEX_TOT_DVAL\",\n\n                \"CAPEX_BUILD_NEW_VAL_F\", \"CAPEX_BUILD_USED_VAL_F\", \"CAPEX_BUILD_TOT_DVAL_F\",\n                \"CAPEX_MACH_NEW_VAL_F\", \"CAPEX_MACH_USED_VAL_F\", \"CAPEX_MACH_TOT_DVAL_F\",\n                \"CAPEX_AUTO_VAL_F\", \"CAPEX_COMPTR_VAL_F\", \"CAPEX_OTHMACH_VAL_F\",\n                \"CAPEX_OTH_NEW_VAL_F\", \"CAPEX_OTH_NEW_WRTIN_TXT_F\", \"CAPEX_OTH_USED_VAL_F\",\n                \"CAPEX_OTH_USED_WRTIN_TXT_F\", \"CAPEX_OTH_TOT_DVAL_F\", \"CAPEX_NEW_TOT_DVAL_F\",\n                \"CAPEX_USED_TOT_DVAL_F\", \"CAPEX_TOT_DVAL_F\",\n\n                \"INV_E_FIN_VAL\", \"INV_E_WIP_VAL\", \"INV_E_MAT_VAL\",\n                \"INV_E_TOT_VAL\", \"INV_B_FIN_VAL\", \"INV_B_WIP_VAL\",\n                \"INV_B_MAT_VAL\", \"INV_B_TOT_VAL\", \"INV_E_FIFO_VAL\",\n                \"INV_E_AVG_VAL\", \"INV_E_STD_VAL\", \"INV_E_OTHNL_VAL\",\n                \"INV_E_NL_TOT_DVAL\", \"INV_B_FIFO_VAL\", \"INV_B_AVG_VAL\",\n                \"INV_B_STD_VAL\", \"INV_B_OTHNL_VAL\", \"INV_B_NL_TOT_DVAL\", \"INV_E_LIFO_VAL\", \"INV_B_LIFO_VAL\",\n                \"INV_E_IVAL_TOT_DVAL\", \"INV_B_IVAL_TOT_DVAL\", \"INV_E_LIFO_RSV_VAL\",\n                \"INV_B_LIFO_RSV_VAL\",\n\n                \"INV_E_FIN_VAL_F\", \"INV_E_WIP_VAL_F\",\n                \"INV_E_MAT_VAL_F\", \"INV_E_TOT_VAL_F\", \"INV_B_FIN_VAL_F\",\n                \"INV_B_WIP_VAL_F\", \"INV_B_MAT_VAL_F\", \"INV_B_TOT_VAL_F\",\n                \"INV_E_FIFO_VAL_F\", \"INV_E_AVG_VAL_F\", \"INV_E_STD_VAL_F\",\n                \"INV_E_OTHNL_VAL_F\", \"INV_E_NL_TOT_DVAL_F\", \"INV_B_FIFO_VAL_F\",\n                \"INV_B_AVG_VAL_F\", \"INV_B_STD_VAL_F\", \"INV_B_OTHNL_VAL_F\",\n                \"INV_B_NL_TOT_DVAL_F\", \"INV_E_LIFO_VAL_F\", \"INV_B_LIFO_VAL_F\",\n                \"INV_E_IVAL_TOT_DVAL_F\", \"INV_B_IVAL_TOT_DVAL_F\", \"INV_E_LIFO_RSV_VAL_F\",\n                \"INV_B_LIFO_RSV_VAL_F\"\n            ];\n\n            fields.forEach(field => {\n                if (field.endsWith(\"_F\")) {\n                    record[field] = setCharAt(record[field] || '__', 2, 'Z')\n                } else {\n                    record[field] = 0;\n                }\n            });\n            record.EXPS_MAT_V1_VAL = 0;\n            flagRules('EXPS_CSTMTOT_DVAL', ['EXPS_ELEC_VAL_F', 'EXPS_FUEL_VAL_F', 'EXPS_CONTRACT_F', 'EXPS_RESALE_F'])\n            record.EXPS_CSTMTOT_DVAL =\n                (parseFloat(record?.EXPS_ELEC_VAL) || 0)\n                + (parseFloat(record?.EXPS_FUEL_VAL) || 0)\n                + (parseFloat(record?.EXPS_CONTRACT_VAL) || 0)\n                + (parseFloat(record?.EXPS_RESALE_VAL) || 0);\n\n        } else {\n            record.TABSTAT = 'N'\n            record.NONTABFL = 'R'\n            record.STOP = 'T'\n            record.REFERRAL_FLAG = 'GOCO_NAICS_NO_MATCH'\n            global.set('action','Exit Edit')\n        }\n        record.ACTION = 'END'\n    }\n\n    NAPCSMGOCO()\n    msg.payload.csv[record_idx] = record\n\n    return msg\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'NAPCS M_GOCO'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "9a1dafbf122468ba",
        "type": "function",
        "z": "b576348e42469acf",
        "name": "NAPCS: M_GOCO database",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function flagRules(variable, details) {\n        let variable_f = variable + '_F'\n        if (record?.[variable] == 0) {\n            record[variable_f] = setCharAt(record?.[variable_f], 2, 'Z');\n        } else {\n            let found = 'N'\n            for (let i in details) {\n                let detail = details[i]\n                if (record?.[detail]) {\n                    if (['R_', 'K_', 'T_'].includes(record?.[detail].substring(0, 2))) {\n                        found = 'Y'\n                    } else if (['R', 'C', 'A', 'S', 'O', 'G'].includes(record?.[detail]?.charAt(1))) {\n                        found = 'Y'\n                    } else {\n                        found = 'N'\n                        break\n                    }\n                    // } else {\n                    //     found = 'N'\n                    //     break\n                }\n            }\n            if (found == 'Y') {\n                record[variable_f] = setCharAt(record?.[variable_f], 2, 'Y');\n            } else {\n                record[variable_f] = setCharAt(record?.[variable_f], 2, 'S');\n            }\n        }\n    }\n\n    let cache = global.get(\"lookupCache\");\n    let naics_napcs = cache.data.find(\n        item =>\n            item.module === \"napcs\" &&\n            item.param === 'naics_to_napcs_m_goco' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    var napcs = naics_napcs['NAICS_TO_NAPCS_M_GOCO']\n    function isNaicsCodeFound() {\n        for (let i in napcs) {\n            let row = napcs[i]\n            if (record?.NAICS_CODE.substr(0, 3) == row['NAICS-3']) {\n                return (row.NAPCS)\n            }\n        }\n    }\n\n    let isNaicsFound = naics_napcs?.NAICS_TO_NAPCS_M_GOCO.some(n => n['NAICS-3'] == record?.NAICS_CODE.substr(0, 3));\n\n    function NAPCSMGOCO() {\n        if (record?.NAPCS_IND == 'U') {\n            let id = record?.REPORTING_ID\n            for (let i in msg.napcs) {\n                let row = msg.napcs[i].facts\n                if (row.REPORTING_ID == id) {\n                    record.PROD_CODE_VAL_PO = 0\n                    record.USABLE = 'D'\n                    record.PROD_CODE_VAL_PO_F = setCharAt(record?.PROD_CODE_VAL_PO_F, 1, 'Z')\n                }\n            }\n        }\n\n        if (isNaicsFound) {\n            let id = record?.REPORTING_ID\n            record.NAPCS_IND = 'U'\n\n            let Found = 'N'\n            for (let i in msg.napcs) {\n                let row = msg.napcs[i].facts\n                if (row.REPORTING_ID == id) {\n                    row.PROD_CODE = isNaicsCodeFound()\n                    row.PROD_CODE_VAL_PO = record?.RCPT_TOT_VAL\n                    row.REF_PER = record?.REF_PER\n                    flagRules('PROD_CODE_VAL_PO', ['RCPT_TOT_VAL_F'])\n                    Found = 'Y'\n                    break\n                }\n            }\n            if (Found == 'N') {\n                let row = {\"facts\":{}}\n                row['facts'].REPORTING_ID = id\n                row['facts'].PROD_CODE = isNaicsCodeFound()\n                row['facts'].PROD_CODE_VAL_PO = record?.RCPT_TOT_VAL\n                row['facts'].REF_PER = record?.REF_PER\n                flagRules('PROD_CODE_VAL_PO', ['RCPT_TOT_VAL_F'])\n                msg.napcs.push(row)\n            }\n\n            const fields = [\n                \"CAPEX_BUILD_NEW_VAL\", \"CAPEX_BUILD_USED_VAL\", \"CAPEX_BUILD_TOT_DVAL\",\n                \"CAPEX_MACH_NEW_VAL\", \"CAPEX_MACH_USED_VAL\", \"CAPEX_MACH_TOT_DVAL\",\n                \"CAPEX_AUTO_VAL\", \"CAPEX_COMPTR_VAL\", \"CAPEX_OTHMACH_VAL\",\n                \"CAPEX_OTH_NEW_VAL\", \"CAPEX_OTH_NEW_WRTIN_TXT\", \"CAPEX_OTH_USED_VAL\",\n                \"CAPEX_OTH_USED_WRTIN_TXT\", \"CAPEX_OTH_TOT_DVAL\", \"CAPEX_NEW_TOT_DVAL\",\n                \"CAPEX_USED_TOT_DVAL\", \"CAPEX_TOT_DVAL\",\n\n                \"CAPEX_BUILD_NEW_VAL_F\", \"CAPEX_BUILD_USED_VAL_F\", \"CAPEX_BUILD_TOT_DVAL_F\",\n                \"CAPEX_MACH_NEW_VAL_F\", \"CAPEX_MACH_USED_VAL_F\", \"CAPEX_MACH_TOT_DVAL_F\",\n                \"CAPEX_AUTO_VAL_F\", \"CAPEX_COMPTR_VAL_F\", \"CAPEX_OTHMACH_VAL_F\",\n                \"CAPEX_OTH_NEW_VAL_F\", \"CAPEX_OTH_NEW_WRTIN_TXT_F\", \"CAPEX_OTH_USED_VAL_F\",\n                \"CAPEX_OTH_USED_WRTIN_TXT_F\", \"CAPEX_OTH_TOT_DVAL_F\", \"CAPEX_NEW_TOT_DVAL_F\",\n                \"CAPEX_USED_TOT_DVAL_F\", \"CAPEX_TOT_DVAL_F\",\n\n                \"INV_E_FIN_VAL\", \"INV_E_WIP_VAL\", \"INV_E_MAT_VAL\",\n                \"INV_E_TOT_VAL\", \"INV_B_FIN_VAL\", \"INV_B_WIP_VAL\",\n                \"INV_B_MAT_VAL\", \"INV_B_TOT_VAL\", \"INV_E_FIFO_VAL\",\n                \"INV_E_AVG_VAL\", \"INV_E_STD_VAL\", \"INV_E_OTHNL_VAL\",\n                \"INV_E_NL_TOT_DVAL\", \"INV_B_FIFO_VAL\", \"INV_B_AVG_VAL\",\n                \"INV_B_STD_VAL\", \"INV_B_OTHNL_VAL\", \"INV_B_NL_TOT_DVAL\", \"INV_E_LIFO_VAL\", \"INV_B_LIFO_VAL\",\n                \"INV_E_IVAL_TOT_DVAL\", \"INV_B_IVAL_TOT_DVAL\", \"INV_E_LIFO_RSV_VAL\",\n                \"INV_B_LIFO_RSV_VAL\",\n\n                \"INV_E_FIN_VAL_F\", \"INV_E_WIP_VAL_F\",\n                \"INV_E_MAT_VAL_F\", \"INV_E_TOT_VAL_F\", \"INV_B_FIN_VAL_F\",\n                \"INV_B_WIP_VAL_F\", \"INV_B_MAT_VAL_F\", \"INV_B_TOT_VAL_F\",\n                \"INV_E_FIFO_VAL_F\", \"INV_E_AVG_VAL_F\", \"INV_E_STD_VAL_F\",\n                \"INV_E_OTHNL_VAL_F\", \"INV_E_NL_TOT_DVAL_F\", \"INV_B_FIFO_VAL_F\",\n                \"INV_B_AVG_VAL_F\", \"INV_B_STD_VAL_F\", \"INV_B_OTHNL_VAL_F\",\n                \"INV_B_NL_TOT_DVAL_F\", \"INV_E_LIFO_VAL_F\", \"INV_B_LIFO_VAL_F\",\n                \"INV_E_IVAL_TOT_DVAL_F\", \"INV_B_IVAL_TOT_DVAL_F\", \"INV_E_LIFO_RSV_VAL_F\",\n                \"INV_B_LIFO_RSV_VAL_F\"\n            ];\n\n            fields.forEach(field => {\n                if (field.endsWith(\"_F\")) {\n                    record[field] = setCharAt(record[field] || '  ', 2, 'Z')\n                } else {\n                    record[field] = 0;\n                }\n            });\n            record.EXPS_MAT_V1_VAL = 0;\n            flagRules('EXPS_CSTMTOT_DVAL', ['EXPS_ELEC_VAL_F', 'EXPS_FUEL_VAL_F', 'EXPS_CONTRACT_F', 'EXPS_RESALE_F'])\n\n            record.EXPS_CSTMTOT_DVAL =\n                (parseFloat(record?.EXPS_ELEC_VAL) || 0)\n                + (parseFloat(record?.EXPS_FUEL_VAL) || 0)\n                + (parseFloat(record?.EXPS_CONTRACT_VAL) || 0)\n                + (parseFloat(record?.EXPS_RESALE_VAL) || 0);\n\n        } else {\n            record.TABSTAT = 'N'\n            record.NONTABFL = 'R'\n            record.STOP = 'T'\n            record.REFERRAL_FLAG = 'GOCO_NAICS_NO_MATCH'\n            msg.action = 'Exit Edit'\n        }\n        record.ACTION = 'END'\n    }\n\n    NAPCSMGOCO()\n\n    return msg\n}catch(e){\n    msg.err ='Exit Edit'\n    msg.payload.exit = 'NAPCS M_GOCO'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "3f577bb0f73d0ae2",
        "type": "change",
        "z": "4b2a066dec42e6f4",
        "name": "Set NODONOR",
        "rules": [
            {
                "t": "set",
                "p": "nodonor",
                "pt": "global",
                "to": "\"\"",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 500,
        "wires": [
            [
                "4b8c2d9a659b2ad5"
            ]
        ]
    },
    {
        "id": "4b8c2d9a659b2ad5",
        "type": "function",
        "z": "4b2a066dec42e6f4",
        "name": "NODONOR Check GOCO",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    let cache = global.get(\"lookupCache\");\n    let m_goco = cache.data.find(\n        item =>\n            item.module === \"napcs\" &&\n            item.param === 'napcs_m_goco' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    let isIdFound = m_goco?.NAPCS_M_GOCO.some(n => n['SURVUID'] == record?.REPORTING_ID);\n\n    function callMGOCO() {\n        if (isIdFound) {\n            global.set('nodonor', 'go to m_goco');\n            record.NAPCS_NODONOR = 'E'\n        }\n    }\n\n    callMGOCO()\n\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'NAPCS NODONOR'\n    return msg\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 500,
        "wires": [
            [
                "bd6cd891b972f30a"
            ]
        ]
    },
    {
        "id": "1c7ef6807114346f",
        "type": "switch",
        "z": "4b2a066dec42e6f4",
        "name": "",
        "property": "nodonor",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "go to m_goco",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "go to m_goco",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1210,
        "y": 540,
        "wires": [
            [
                "6f8e4805c41cb820"
            ],
            [
                "99aa6097013685ea"
            ]
        ]
    },
    {
        "id": "6f8e4805c41cb820",
        "type": "subflow:b576348e42469acf",
        "z": "4b2a066dec42e6f4",
        "name": "",
        "x": 1440,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "99aa6097013685ea",
        "type": "function",
        "z": "4b2a066dec42e6f4",
        "name": "NAPCS: NODONOR",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let cache = global.get(\"lookupCache\");\n    let naics_napcs = cache.data.find(\n        item =>\n            item.module === \"napcs\" &&\n            item.param === 'napcs_nodonor_cutoff' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    var napcs = naics_napcs['NAPCS_NODONOR_CUTOFF']\n    function isNaicsCodeFound() {\n        for (let i in napcs) {\n            let row = napcs[i]\n            if (record?.NAICS_CODE == row['NAIC']) {\n                return (row.CUTOFF)\n            }\n        }\n    }\n\n    function find9000() {\n        let id = record['REPORTING_ID']\n        let allData = msg.payload.csv;\n        for (let i in allData) {\n            let row = allData[i]\n            if (row.REPORTING_ID == id) {\n                if (row?.PROD_CODE_VAL_PO && row?.PROD_CODE == '9000000000') {\n                    return (row?.PROD_CODE_VAL_PO)\n                }\n            }\n        }\n    }\n\n    function NAPCSNODONOR() {\n        if (['T', 'B'].includes(record?.NAPCS_NODONOR) || !(['SU', 'MU'].includes(record?.REPORTING_ID_TYP_TXT))) {\n        } else {\n            record.NAPCS_NODONOR = '_';\n            if (record?.NAPCS_IND === 'U' && parseFloat(record?.RCPT_TOT_VAL) > 0) {\n                let isNaicsFound = naics_napcs?.NAPCS_NODONOR_CUTOFF.some(n => n['NAIC'] == record?.NAICS_CODE);\n                if (isNaicsFound) {\n                    let cutoff = isNaicsCodeFound()\n                    let val_9000 = find9000()\n                    if ((parseFloat(record?.NAPCS_OTH) / parseFloat(record?.RCPT_TOT_VAL)) >= parseFloat(cutoff)) {\n                        record.NAPCS_NODONOR = 'E'\n                    } else if ((parseFloat(val_9000) / parseFloat(record?.RCPT_TOT_VAL)) >= 0.5) {\n                        record.NAPCS_NODONOR = 'E'\n                    } else if (((parseFloat(val_9000) + parseFloat(record?.NAPCS_OTH)) / parseFloat(record?.RCPT_TOT_VAL)) >= 0.5) {\n                        record.NAPCS_NODONOR = 'E'\n                    } else if (record?.NAPCS_IMP === 'Y') {\n                        record.NAPCS_NODONOR = 'E'\n                    }\n                } else {\n                    record.REFERRAL_FLAG = 'MISSING_NAICOLD_NODONOR'\n                    record.TABSTAT = 'N';\n                    record.NONTABFL = 'R';\n                    global.set('action','Exit Edit')\n                }\n            }\n        }\n        record.ACTION = 'END'\n    }\n\n    NAPCSNODONOR();\n    return msg;\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'NAPCS NODONOR'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1460,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "cca993facc85d773",
        "type": "function",
        "z": "4b2a066dec42e6f4",
        "name": "NODONOR Check GOCO Database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    let cache = global.get(\"lookupCache\");\n    let m_goco = cache.data.find(\n        item =>\n            item.module === \"napcs\" &&\n            item.param === 'napcs_m_goco' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    msg.nodonor = ''\n\n    let isIdFound = m_goco?.NAPCS_M_GOCO.some(n => n['SURVUID'] == record?.REPORTING_ID);\n\n    function callMGOCO() {\n        if (isIdFound) {\n            msg.nodonor = 'go to m_goco';\n            record.NAPCS_NODONOR = 'E'\n        }\n    }\n\n    callMGOCO()\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS NODONOR'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 780,
        "wires": [
            [
                "0278ed9cc02fedcd"
            ]
        ]
    },
    {
        "id": "8366b39611863d9e",
        "type": "switch",
        "z": "4b2a066dec42e6f4",
        "name": "",
        "property": "nodonor",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "go to m_goco",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "go to m_goco",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1050,
        "y": 900,
        "wires": [
            [
                "dd3e98aa265935e1"
            ],
            [
                "1e5fb0fcbcb8cdb5"
            ]
        ]
    },
    {
        "id": "dd3e98aa265935e1",
        "type": "subflow:b576348e42469acf",
        "z": "4b2a066dec42e6f4",
        "name": "",
        "x": 1240,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "1e5fb0fcbcb8cdb5",
        "type": "function",
        "z": "4b2a066dec42e6f4",
        "name": "NAPCS: NODONOR Database",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    let cache = global.get(\"lookupCache\");\n    let naics_napcs = cache.data.find(\n        item =>\n            item.module === \"napcs\" &&\n            item.param === 'napcs_nodonor_cutoff' &&\n            item.program === \"aies\" &&\n            item.unit_type === \"all\"\n    )?.json_values;\n\n    var napcs = naics_napcs['NAPCS_NODONOR_CUTOFF']\n    function isNaicsCodeFound() {\n        for (let i in napcs) {\n            let row = napcs[i]\n            if (record?.NAICS_CODE == row['NAIC']) {\n                return (row.CUTOFF)\n            }\n        }\n    }\n\n    function find9000() {\n        let id = record['REPORTING_ID']\n        let allData = msg.napcs;\n        for (let i in allData) {\n            let row = allData[i].facts\n            if (row.REPORTING_ID == id) {\n                if (row?.PROD_CODE_VAL_PO && row?.PROD_CODE == '9000000000') {\n                    return (row?.PROD_CODE_VAL_PO)\n                }\n            }\n        }\n    }\n\n    function NAPCSNODONOR() {\n        if (['T', 'B'].includes(record?.NAPCS_NODONOR) || !(['SU', 'MU'].includes(record?.REPORTING_ID_TYP_TXT))) {\n        } else {\n            record.NAPCS_NODONOR = '_';\n            if (record?.NAPCS_IND === 'U' && parseFloat(record?.RCPT_TOT_VAL) > 0) {\n                let isNaicsFound = naics_napcs?.NAPCS_NODONOR_CUTOFF.some(n => n['NAIC'] == record?.NAICS_CODE);\n                if (isNaicsFound) {\n                    let cutoff = isNaicsCodeFound()\n                    let val_9000 = find9000()\n                    if ((parseFloat(record?.NAPCS_OTH) / parseFloat(record?.RCPT_TOT_VAL)) >= parseFloat(cutoff)) {\n                        record.NAPCS_NODONOR = 'E'\n                    } else if ((parseFloat(val_9000) / parseFloat(record?.RCPT_TOT_VAL)) >= 0.5) {\n                        record.NAPCS_NODONOR = 'E'\n                    } else if (((parseFloat(val_9000) + parseFloat(record?.NAPCS_OTH)) / parseFloat(record?.RCPT_TOT_VAL)) >= 0.5) {\n                        record.NAPCS_NODONOR = 'E'\n                    } else if (record?.NAPCS_IMP === 'Y') {\n                        record.NAPCS_NODONOR = 'E'\n                    }\n                } else {\n                    record.REFERRAL_FLAG = 'MISSING_NAICOLD_NODONOR'\n                    record.TABSTAT = 'N';\n                    record.NONTABFL = 'R';\n                    msg.action = 'Exit Edit'\n                }\n            }\n        }\n    }\n\n    NAPCSNODONOR();\n    return msg;\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS NODONOR'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "0278ed9cc02fedcd",
        "type": "switch",
        "z": "4b2a066dec42e6f4",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1120,
        "y": 780,
        "wires": [
            [],
            [
                "8366b39611863d9e"
            ]
        ]
    },
    {
        "id": "bd6cd891b972f30a",
        "type": "switch",
        "z": "4b2a066dec42e6f4",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1040,
        "y": 500,
        "wires": [
            [],
            [
                "1c7ef6807114346f"
            ]
        ]
    },
    {
        "id": "e07677c8e679affd",
        "type": "function",
        "z": "e77217f4bfc52a38",
        "name": "napcs_recalculate_napcs_fields",
        "func": "try{\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    let allData= msg.payload.csv\n    let id = record?.REPORTING_ID\n\n    let NAPCS_BLTOT = 0\n    let NAPCS_PRM = 0\n    let NAPCS_OTH = 0\n\n    for (let i in allData) {\n        let row = allData[i]\n        if (row.REPORTING_ID == id) {\n            if (row?.PROD_CODE) {\n                if (['I', 'D', 'X'].includes(row?.USABLE)) {\n                } else {\n                    if (row?.PROD_CODE.substring(7, 10) == '000') {\n                        NAPCS_BLTOT = NAPCS_BLTOT + parseFloat(row?.PROD_CODE_VAL_PO)\n                    }\n                    if (row?.PROD_CODE.substring(0, 1) == '2') {\n                        NAPCS_PRM = NAPCS_PRM + parseFloat(row?.PROD_CODE_VAL_PO)\n                    }\n                    if (row?.PROD_CODE.substring(0, 1) != '2') {\n                        if (row.PROD_CODE.substring(0, 7) == '9000000') {\n                        } else {\n                            NAPCS_OTH = NAPCS_OTH + parseFloat(row?.PROD_CODE_VAL_PO)\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    record['NAPCS_BAL'] = record['RCPT_TOT_VAL'] - NAPCS_BLTOT\n    record['NAPCS_BLTOT'] = NAPCS_BLTOT\n    record['NAPCS_PRM'] = NAPCS_PRM\n    record['NAPCS_OTH'] = NAPCS_OTH\n    \n    return msg\n\n}catch(e){\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'NAPCS Recalculate'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "f3045340c8deb4c8",
        "type": "function",
        "z": "e77217f4bfc52a38",
        "name": "napcs_recalculate_napcs_fields database",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    let allData= msg.napcs\n    let id = record?.REPORTING_ID\n\n    let NAPCS_BLTOT = 0\n    let NAPCS_PRM = 0\n    let NAPCS_OTH = 0\n\n    for (let i in allData) {\n        let row = allData[i].facts\n        if (row.REPORTING_ID == id) {\n            if (row?.PROD_CODE) {\n                if (['I', 'D', 'X'].includes(row?.USABLE)) {\n                } else {\n                    if (row?.PROD_CODE.substring(7, 10) == '000') {\n                        NAPCS_BLTOT = NAPCS_BLTOT + parseFloat(row?.PROD_CODE_VAL_PO)\n                    }\n                    if (row?.PROD_CODE.substring(0, 1) == '2') {\n                        NAPCS_PRM = NAPCS_PRM + parseFloat(row?.PROD_CODE_VAL_PO)\n                    }\n                    if (row?.PROD_CODE.substring(0, 1) != '2') {\n                        if (row.PROD_CODE.substring(0, 7) == '9000000') {\n                        } else {\n                            NAPCS_OTH = NAPCS_OTH + parseFloat(row?.PROD_CODE_VAL_PO)\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    record['NAPCS_BAL'] = record['RCPT_TOT_VAL'] - NAPCS_BLTOT\n    record['NAPCS_BLTOT'] = NAPCS_BLTOT\n    record['NAPCS_PRM'] = NAPCS_PRM\n    record['NAPCS_OTH'] = NAPCS_OTH\n    \n    return msg\n\n}catch(e){\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS Recalculate'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "b2afff84193f1485",
        "type": "function",
        "z": "fbb1e70dfe5fe82f",
        "name": "NAPCS BL ROUNDING",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    let id = record.REPORTING_ID\n    let allData = msg.payload.csv;\n    let newarr = []\n    let newarr2 = []\n    let j = 0\n    let k = 0\n    for (let i in allData) {\n        let row = allData[i]\n        if (row.REPORTING_ID == id) {\n            if (row.PROD_CODE) {\n                if (row.NAPCSCODE_MF == 'Y') {\n                    newarr[j] = row\n                    j = j + 1\n                } else {\n                    newarr2[k] = row\n                    k = k + 1\n                }\n            }\n        }\n    }\n    newarr.sort((a, b) => a.PROD_CODE_VAL_PO - b.PROD_CODE_VAL_PO);\n    newarr2.sort((a, b) => b.PROD_CODE_VAL_PO - a.PROD_CODE_VAL_PO);\n    newarr = newarr.concat(newarr2)\n\n    let remainder = 0\n    for (let i in newarr) {\n        let row = newarr[i]\n        let adjusted = parseFloat(row?.PROD_CODE_VAL_PO) + remainder\n        let rounded = Math.round(adjusted)\n        if (row?.NAPCSCODE_MF == 'Y' && rounded == 0) {\n            rounded = 1\n        } else if (rounded < 0) {\n            rounded = 0\n        }\n        remainder = adjusted - rounded\n        // row.EXACT, row.ADJUSTED, row.ROUNDED, row.FRACTIONAL are for testing purposes only\n        // row.EXACT = row?.PROD_CODE_VAL\n        // row.ADJUSTED = adjusted\n        // row.ROUNDED = rounded\n        // row.FRACTIONAL = remainder\n        row.PROD_CODE_VAL_PO = rounded\n        newarr[i] = row\n    }\n\n    return msg\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'NAPCS BL Rounding'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "615ae6b803178326",
        "type": "function",
        "z": "fbb1e70dfe5fe82f",
        "name": "NAPCS BL ROUNDING Database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    let id = record.REPORTING_ID\n    let allData = msg.napcs;\n    let newarr = []\n    let newarr2 = []\n    let j = 0\n    let k = 0\n    for (let i in allData) {\n        let row = allData[i].facts\n        if (row.REPORTING_ID == id) {\n            if (row.PROD_CODE) {\n                if (row.NAPCSCODE_MF == 'Y') {\n                    newarr[j] = row\n                    j = j + 1\n                } else {\n                    newarr2[k] = row\n                    k = k + 1\n                }\n            }\n        }\n    }\n    newarr.sort((a, b) => a.PROD_CODE_VAL_PO - b.PROD_CODE_VAL_PO);\n    newarr2.sort((a, b) => b.PROD_CODE_VAL_PO - a.PROD_CODE_VAL_PO);\n    newarr = newarr.concat(newarr2)\n\n    let remainder = 0\n    for (let i in newarr) {\n        let row = newarr[i]\n        let adjusted = parseFloat(row?.PROD_CODE_VAL_PO) + remainder\n        let rounded = Math.round(adjusted)\n        if (row?.NAPCSCODE_MF == 'Y' && rounded == 0) {\n            rounded = 1\n        } else if (rounded < 0) {\n            rounded = 0\n        }\n        remainder = adjusted - rounded\n        // row.EXACT, row.ADJUSTED, row.ROUNDED, row.FRACTIONAL are for testing purposes only\n        // row.EXACT = row?.PROD_CODE_VAL_PO\n        // row.ADJUSTED = adjusted\n        // row.ROUNDED = rounded\n        // row.FRACTIONAL = remainder\n        row.PROD_CODE_VAL_PO = rounded\n    }\n\n    return msg\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS BL Rounding'\n    return msg\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "61569829f3b93a82",
        "type": "function",
        "z": "c706d1ca2706f3bf",
        "name": "Balancing Database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    let allData = msg.napcs;\n\n\n    let id = record?.REPORTING_ID\n\n    msg.cache = global.get(\"lookupCache\")\n        .data.find(\n            item =>\n                item.module === 'naics' &&\n                item.param === 'naics_tolerance' &&\n                item.program === 'aies' &&\n                item.unit_type === 'all'\n        )?.json_values;\n\n    var jsonData = msg.cache['NAICS_TOLERANCE']\n    msg.action = ''\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function findTol() {\n        let naics = record?.NAICS_CODE\n        for (let i in jsonData) {\n            let row = jsonData[i]\n            if (row.NAICS.startsWith(naics)) {\n                let LL = row.LL\n                let UL = row.UL;\n                return { LL, UL };\n            }\n        }\n    }\n\n    function evalBalancing() {\n        if (record?.RCPT_TOT_VAL > 0) {\n            let naics = jsonData.some(element => (element.NAICS.startsWith(record?.NAICS_CODE)));\n            if (naics) {\n                let { LL, UL } = findTol()\n\n                if (record?.NAPCS_BLTOT == record?.RCPT_TOT_VAL) {\n\n                } else if ((parseFloat(LL) <= (parseFloat(record?.NAPCS_BLTOT) / parseFloat(record?.RCPT_TOT_VAL))) &&\n                    ((parseFloat(record?.NAPCS_BLTOT) / parseFloat(record?.RCPT_TOT_VAL)) <= parseFloat(UL))) {\n                    for (let i in allData) {\n                        let row = allData[i].facts\n                        if (row?.REPORTING_ID == id && row?.PROD_CODE_VAL_PO) {\n                            row.PROD_CODE_VAL_PO = (parseFloat(row?.PROD_CODE_VAL_PO) / parseFloat(record?.NAPCS_BLTOT)) * parseFloat(record?.RCPT_TOT_VAL)\n                            row.PROD_CODE_VAL_PO_F = setCharAt(row?.PROD_CODE_VAL_PO_F, 2, 'K')\n                        }\n                    }\n                } else if ((parseFloat(record?.RCPT_TOT_VAL) == parseFloat(record?.RCPT_TOT_VAL_PI)) || (parseFloat(record?.RCPT_TOT_VAL_PI) == 0)) {\n                    record.NAPCS_IND = 'N'\n\n                } else if ((parseFloat(LL) <= (parseFloat(record?.NAPCS_BLTOT) / parseFloat(record?.RCPT_TOT_VAL_PI))) &&\n                    ((parseFloat(record?.NAPCS_BLTOT) / parseFloat(record?.RCPT_TOT_VAL_PI)) <= parseFloat(UL))) {\n                    for (let i in allData) {\n                        let row = allData[i].facts\n                        if (row?.REPORTING_ID == id && row?.PROD_CODE_VAL_PO) {\n                            row.PROD_CODE_VAL_PO = (parseFloat(row?.PROD_CODE_VAL_PO) / parseFloat(record?.NAPCS_BLTOT)) * parseFloat(record?.RCPT_TOT_VAL)\n                            row.PROD_CODE_VAL_PO_F = setCharAt(row?.PROD_CODE_VAL_PO_F, 2, 'K')\n                        }\n                    }\n                } else {\n                    record.NAPCS_IND = 'N'\n                }\n            } else {\n                record.TABSTAT = 'N'\n                record.NONTABFL = 'R'\n                record.STOP = 'T'\n                record.REFERRAL_FLAG = 'MIS_NAICSOLD_NAICSTOLERANCE' // checked with Census\n                msg.action = 'Exit Edit'\n            }\n        } else {\n            record.NAPCS_IND = 'N'\n        }\n        record.ACTION = 'End'\n    }\n\n    evalBalancing()\n    return msg\n\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS Balancing'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "1fe10b7b2609c70b",
        "type": "function",
        "z": "c706d1ca2706f3bf",
        "name": "Balancing",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    let allData = msg.payload.csv;\n    let id = record?.REPORTING_ID\n\n    msg.cache = global.get(\"lookupCache\")\n        .data.find(\n            item =>\n                item.module === 'naics' &&\n                item.param === 'naics_tolerance' &&\n                item.program === 'aies' &&\n                item.unit_type === 'all'\n        )?.json_values;\n\n    var jsonData = msg.cache['NAICS_TOLERANCE']\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    function findTol() {\n        let naics = record?.NAICS_CODE\n        for (let i in jsonData) {\n            let row = jsonData[i]\n            if (row.NAICS.startsWith(naics)) {\n                let LL = row.LL\n                let UL = row.UL;\n                return { LL, UL };\n            }\n        }\n    }\n\n    function evalBalancing() {\n        if (record?.RCPT_TOT_VAL > 0) {\n            let naics = jsonData.some(element => (element.NAICS.startsWith(record?.NAICS_CODE)));\n            if (naics) {\n                let { LL, UL } = findTol()\n\n                if (record?.NAPCS_BLTOT == record?.RCPT_TOT_VAL) {\n\n                } else if ((parseFloat(LL) <= (parseFloat(record?.NAPCS_BLTOT) / parseFloat(record?.RCPT_TOT_VAL))) &&\n                    ((parseFloat(record?.NAPCS_BLTOT) / parseFloat(record?.RCPT_TOT_VAL)) <= parseFloat(UL))) {\n                    for (let i in allData) {\n                        let row = allData[i]\n                        if (row?.REPORTING_ID == id && row?.PROD_CODE_VAL_PO) {\n                            row.PROD_CODE_VAL_PO = (parseFloat(row?.PROD_CODE_VAL_PO) / parseFloat(record?.NAPCS_BLTOT)) * parseFloat(record?.RCPT_TOT_VAL)\n                            row.PROD_CODE_VAL_PO_F = setCharAt(row?.PROD_CODE_VAL_PO_F, 2, 'K')\n                            allData[i] = row\n                        }\n                    }\n                } else if ((parseFloat(record?.RCPT_TOT_VAL) == parseFloat(record?.RCPT_TOT_VAL_PI)) || (parseFloat(record?.RCPT_TOT_VAL_PI) == 0)) {\n                    record.NAPCS_IND = 'N'\n\n                } else if ((parseFloat(LL) <= (parseFloat(record?.NAPCS_BLTOT) / parseFloat(record?.RCPT_TOT_VAL_PI))) &&\n                    ((parseFloat(record?.NAPCS_BLTOT) / parseFloat(record?.RCPT_TOT_VAL_PI)) <= parseFloat(UL))) {\n                    for (let i in allData) {\n                        let row = allData[i]\n                        if (row?.REPORTING_ID == id && row?.PROD_CODE_VAL_PO) {\n                            row.PROD_CODE_VAL_PO = (parseFloat(row?.PROD_CODE_VAL_PO) / parseFloat(record?.NAPCS_BLTOT)) * parseFloat(record?.RCPT_TOT_VAL)\n                            row.PROD_CODE_VAL_PO_F = setCharAt(row?.PROD_CODE_VAL_PO_F, 2, 'K')\n                            allData[i] = row\n                        }\n                    }\n                } else {\n                    record.NAPCS_IND = 'N'\n                }\n            } else {\n                record.TABSTAT = 'N'\n                record.NONTABFL = 'R'\n                record.STOP = 'T'\n                record.REFERRAL_FLAG = 'MIS_NAICSOLD_NAICSTOLERANCE' // checked with Census\n                global.set('action','Exit Edit')\n            }\n        } else {\n            record.NAPCS_IND = 'N'\n        }\n        record.ACTION = 'End'\n    }\n\n    evalBalancing()\n    return msg\n\n} catch (e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'NAPCS Balancing'\n    return msg;\n}",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "401fdae063b57aa5",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "NAPCS Balance",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n    let id = record['REPORTING_ID']\n\n    let allData = msg.payload.csv;\n    let NAPCS_BLTOT = 0\n    let NAPCS_PRM = 0\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    global.set('napcsBal','')\n    global.set('action','')\n\n    if (record?.NAICS_SECTOR === '31' && record?.SUBSAMP_IND_TXT !== 'MC') {\n        if (record?.NAPCS_IND == '_') {\n            if (record?.HISTSTAT === 'Y' &&\n                record?.EC_NAPCS_IND === 'U' &&\n                (parseInt(record?.EC_NAPCS_BLTOT) > 0) &&\n                (parseInt(record?.EC_RCPT_TOT_VAL) > 0) &&\n                (parseInt(record?.RCPT_TOT_VAL) > 0) &&\n                record?.NAPCS_IMP === 'Y') {\n                for (let index in allData) {\n                    let row = allData[index]\n                    if (row.EC_REPORTING_ID === id &&\n                        row.EC_REF_PER === '2022U1' &&\n                        (row.EC_NAPCS_USABLE !== 'I' || row.EC_NAPCS_USABLE !== 'D' || row.EC_NAPCS_USABLE !== 'X') &&\n                        (parseInt(row.EC_NAPCS_PROD_CODE_VAL) > 0) &&\n                        row.EC_NAPCS_PROD_CODE.substring(0, 7) !== '9000000') {\n                        row.NAPCS_IND = 'U'\n                        row.NAPCS_IMP = 'Y'\n                        row.PROD_CODE = record.EC_NAPCS_PROD_CODE\n                        row.USABLE = 'U'\n                        record.PROD_CODE_VAL_PO = (parseFloat(record.EC_NAPCS_PROD_CODE_VAL_PO) * (\n                            parseFloat(record.RCPT_TOT_VAL)) /\n                            parseFloat(record.EC_RCPT_TOT_VAL))\n                        record.REPORTING_ID = record.REPORTING_ID\n                        record.REF_PER = record.REF_PER\n                        record.PROD_CODE_VAL_PO_F = setCharAt(record.PROD_CODE_VAL_PO_F.toString(), 2, 'H');\n                    }\n                    if ((parseInt(row.EC_NAPCS_PROD_CODE_VAL) > 0) &&\n                        row.EC_NAPCS_PROD_CODE.substring(0, 7) === '9000000') {\n                        row.NAPCS_IND = 'U'\n                        row.NAPCS_IMP = 'Y'\n                        row.PROD_CODE = record.EC_NAPCS_PROD_CODE\n                        row.USABLE = 'J'\n                        record.PROD_CODE_VAL_PO = (parseFloat(record.EC_NAPCS_PROD_CODE_VAL_PO) *\n                            (parseFloat(record.RCPT_TOT_VAL)) / parseFloat(record.EC_RCPT_TOT_VAL))\n                        record.REPORTING_ID = record.REPORTING_ID\n                        record.REF_PER = record.REF_PER\n                        record.PROD_CODE_VAL_PO_F = setCharAt(record.PROD_CODE_VAL_PO_F.toString(), 2, 'H');\n                    }\n                    if (row.PROD_CODE.substr(7, 3) === '000') {\n                        record.NAPCS_BLTOT = parseInt(record.NAPCS_BLTOT) + parseInt(record.PROD_CODE_VAL)\n                    }\n\n                }\n                global.set('napcsBal', 'Route A')\n            } else {\n                global.set('napcsBal', 'Route B')\n            }\n        } else {\n            global.set('napcsBal', 'Route A')\n        }\n    } else {\n        global.set('napcsBal', 'Main Route')\n    }\n\n    msg.payload.csv[record_idx] = record\n    return msg;\n} catch (e) {\n    global.set('err','Exit Edit')\n    return msg;\n}\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 140,
        "wires": [
            [
                "03b8fb7bd5b0caa5"
            ]
        ]
    },
    {
        "id": "03b8fb7bd5b0caa5",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "",
        "property": "napcsBal",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Main Route",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Route A",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Route B",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 950,
        "y": 140,
        "wires": [
            [],
            [
                "f3c9ed8ece9824e7"
            ],
            [
                "7e243549edd2f857"
            ]
        ]
    },
    {
        "id": "fa743c474c8459ee",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "",
        "property": "napcsBal",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "BL Rounding",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1170,
        "y": 340,
        "wires": [
            [
                "2d5bd626ccbe866c"
            ],
            [
                "66953372c8123589"
            ]
        ]
    },
    {
        "id": "f3c9ed8ece9824e7",
        "type": "subflow:c706d1ca2706f3bf",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 1200,
        "y": 180,
        "wires": [
            [
                "75879436990d7deb"
            ]
        ]
    },
    {
        "id": "c359203e32ea9253",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "NAPCS Balance 2",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NAPCS_IND == 'U') {\n        global.set('napcsBal','BL Rounding')\n    }\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 260,
        "wires": [
            [
                "fa743c474c8459ee"
            ]
        ]
    },
    {
        "id": "2d5bd626ccbe866c",
        "type": "subflow:fbb1e70dfe5fe82f",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 1400,
        "y": 340,
        "wires": [
            [
                "66953372c8123589"
            ]
        ]
    },
    {
        "id": "66953372c8123589",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "NAPCS Balance 3",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n    let id = record['REPORTING_ID']\n\n    let allData = msg.payload.csv;\n\n    for (let i in allData) {\n        let row = allData[i]\n        if (row.REPORTING_ID == id && row.PROD_CODE_VAL_PO == 0) {\n            row.USABLE = 'D'\n            allData[i] = row\n        } \n    }\n\n    msg.payload.csv = allData\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 420,
        "wires": [
            [
                "eeedbeab13ecf5f0"
            ]
        ]
    },
    {
        "id": "eeedbeab13ecf5f0",
        "type": "subflow:e77217f4bfc52a38",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 1240,
        "y": 480,
        "wires": [
            [
                "f3c44589923692eb"
            ]
        ]
    },
    {
        "id": "f3c44589923692eb",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "NAPCS Balance 4",
        "func": "try {\n    let record_idx = global.get(\"ptrModuleFacts\");\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NAPCS_BAL != 0 && record?.NAPCS_IND == 'U') {\n        record.NAPCS_IND = 'N'\n    }\n\n    msg.payload.csv[record_idx] = record\n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 540,
        "wires": [
            [
                "7e243549edd2f857"
            ]
        ]
    },
    {
        "id": "7e243549edd2f857",
        "type": "subflow:4b2a066dec42e6f4",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 1200,
        "y": 600,
        "wires": [
            [
                "72b2653deb32a23b"
            ]
        ]
    },
    {
        "id": "0265195f902cf9bb",
        "type": "subflow:b3b1701e035827dc",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 1620,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "75879436990d7deb",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1430,
        "y": 180,
        "wires": [
            [],
            [
                "c359203e32ea9253"
            ]
        ]
    },
    {
        "id": "72b2653deb32a23b",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1410,
        "y": 600,
        "wires": [
            [],
            [
                "0265195f902cf9bb"
            ]
        ]
    },
    {
        "id": "08a8e672a5c57c22",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "NAPCS Balance Database",
        "func": "try {\n    let record = msg.payload.csv[msg.ptrModuleFacts]; \n    let id = record['REPORTING_ID']\n\n    let ec = msg.payload.tables.ec.find(obj => obj.fact.REPORTING_ID == record.REPORTING_ID)\n\n    function setCharAt(str, index, chr) {\n        if ([null, undefined].includes(str)) {\n            let newstr = ''\n            for (let i = 0; i < index; i++) {\n                newstr = newstr + '_';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            if (index > str.length - 1) {\n                let addstr = index - str.length\n                let newstr = str\n                for (let i = 0; i < addstr; i++) {\n                    newstr = newstr + '_';\n                }\n                newstr = newstr + chr\n                return newstr;\n            } else {\n                return str.substring(0, index) + chr + str.substring(index + 1);\n            }\n        }\n    }\n\n    msg.napcsBal = ''\n    msg.action = ''\n\n    if (record?.NAICS_SECTOR === '31' && record?.SUBSAMP_IND_TXT !== 'MC') {\n        if (record?.NAPCS_IND == '_') {\n            if (record?.HISTSTAT === 'Y' &&\n                ec?.NAPCS_IND === 'U' &&\n                (parseInt(ec?.NAPCS_BLTOT) > 0) &&\n                (parseInt(ec?.RCPT_TOT_VAL) > 0) &&\n                (parseInt(record?.RCPT_TOT_VAL) > 0) &&\n                record?.NAPCS_IMP === 'Y') {\n                let ec_napcs = msg.payload.tables.ec_napcs // doesn't always need this\n                let obj = {\"facts\": {}}\n                let sum = 0\n                for (let index in ec_napcs) {\n                    let row = ec_napcs[index].fact\n                    if (row.REPORTING_ID === id &&\n                        row.REF_PER === '2022' &&\n                        (row.USABLE !== 'I' || row.USABLE !== 'D' || row.USABLE !== 'X') &&\n                        (parseInt(row.PROD_CODE_VAL_PO) > 0)) {\n                        record.NAPCS_IND = 'U'\n                        record.NAPCS_IMP = 'Y'\n                        obj['facts']['PROD_CODE'] = row?.PROD_CODE\n                        obj['facts']['PROD_CODE_VAL_PO'] = (parseFloat(row?.PROD_CODE_VAL_PO) * (\n                            parseFloat(record.RCPT_TOT_VAL)) /\n                            parseFloat(ec.RCPT_TOT_VAL))\n                        obj['facts'].REPORTING_ID = record.REPORTING_ID\n                        obj['facts'].REF_PER = record.REF_PER\n                        obj['facts']['PROD_CODE_VAL_PO_F'] = setCharAt(obj['fact']?.['PROD_CODE_VAL_PO_F'], 2, 'H');\n                        if (row.PROD_CODE.substring(0, 7) != '9000000') {\n                            obj['facts']['USABLE'] = 'U'\n                        } else if (row.PROD_CODE.substring(0,7) == '9000000') {\n                            obj['facts']['USABLE'] = 'J'                            \n                        }\n                        if (row?.PROD_CODE.substring(7,10) == '000') {\n                            sum = sum + row?.PROD_CODE_VAL_PO\n                        }\n                        msg.payload.tables.napcs.push(obj)\n                    }\n                }\n                record.NAPCS_BLTOT = sum\n                msg.napcsBal = 'Route A'\n            } else {\n                msg.napcsBal = 'Route B'\n            }\n        } else {\n            msg.napcsBal = 'Route A'\n        }\n    } else {\n        msg.napcsBal = 'Main Route'\n    }\n\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS Balance'\n    return msg;\n}\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 760,
        "wires": [
            [
                "db2dd457387005ca"
            ]
        ]
    },
    {
        "id": "f7540a0b5b934716",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "",
        "property": "napcsBal",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Main Route",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Route A",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Route B",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1610,
        "y": 800,
        "wires": [
            [],
            [
                "f6729de3af9f930b"
            ],
            [
                "661fef400c6a9e5e"
            ]
        ]
    },
    {
        "id": "34fb7348bf3d8d7d",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "",
        "property": "napcsBal",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "BL Rounding",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1830,
        "y": 1020,
        "wires": [
            [
                "fc615dcceef87d2b"
            ],
            [
                "9c2462fecc162c71"
            ]
        ]
    },
    {
        "id": "f6729de3af9f930b",
        "type": "subflow:c706d1ca2706f3bf",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 1860,
        "y": 840,
        "wires": [
            [
                "91a1d77989dab7fe"
            ]
        ]
    },
    {
        "id": "7da488982da41e8e",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "NAPCS Balance 2",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NAPCS_IND == 'U') {\n        msg.napcsBal = 'BL Rounding'\n    }\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS Balance'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 940,
        "wires": [
            [
                "2de242bf9107e456"
            ]
        ]
    },
    {
        "id": "fc615dcceef87d2b",
        "type": "subflow:fbb1e70dfe5fe82f",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 2060,
        "y": 1020,
        "wires": [
            [
                "54eed307dad14fc6"
            ]
        ]
    },
    {
        "id": "9c2462fecc162c71",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "NAPCS Balance 3",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n    let id = record['REPORTING_ID']\n\n    for (let i in msg.napcs) {\n        let row = msg.napcs[i].facts\n        if (row.REPORTING_ID == id && row.PROD_CODE_VAL_PO == 0) {\n            row.USABLE = 'D'\n        } \n    }\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS Balance'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 1100,
        "wires": [
            [
                "a1c8ca75b50ff5d1"
            ]
        ]
    },
    {
        "id": "a47e01a7b282b984",
        "type": "subflow:e77217f4bfc52a38",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 1900,
        "y": 1160,
        "wires": [
            [
                "fb5b28e591e48d2b"
            ]
        ]
    },
    {
        "id": "511269f9382db3d5",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "NAPCS Balance 4",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts;\n    let record = msg.payload.csv[record_idx];\n\n    if (record?.NAPCS_BAL != 0 && record?.NAPCS_IND == 'U') {\n        record.NAPCS_IND = 'N'\n    }\n\n    return msg;\n} catch(e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'NAPCS Balance'\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1850,
        "y": 1220,
        "wires": [
            [
                "b4ce6d20568897f1"
            ]
        ]
    },
    {
        "id": "661fef400c6a9e5e",
        "type": "subflow:4b2a066dec42e6f4",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 1860,
        "y": 1280,
        "wires": [
            [
                "04c86e21998d2f68"
            ]
        ]
    },
    {
        "id": "b48caa53536a345c",
        "type": "subflow:b3b1701e035827dc",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 2100,
        "y": 1400,
        "wires": [
            [
                "515994aae1c4ef52"
            ]
        ]
    },
    {
        "id": "272398fb73d0c920",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "",
        "property": "action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2290,
        "y": 880,
        "wires": [
            [],
            [
                "7da488982da41e8e"
            ]
        ]
    },
    {
        "id": "50b57e919c645cc1",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "",
        "property": "action",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2110,
        "y": 1340,
        "wires": [
            [
                "515994aae1c4ef52"
            ],
            [
                "b48caa53536a345c"
            ]
        ]
    },
    {
        "id": "db2dd457387005ca",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1440,
        "y": 760,
        "wires": [
            [],
            [
                "f7540a0b5b934716"
            ]
        ]
    },
    {
        "id": "91a1d77989dab7fe",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2120,
        "y": 840,
        "wires": [
            [],
            [
                "272398fb73d0c920"
            ]
        ]
    },
    {
        "id": "2de242bf9107e456",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2120,
        "y": 940,
        "wires": [
            [],
            [
                "34fb7348bf3d8d7d"
            ]
        ]
    },
    {
        "id": "54eed307dad14fc6",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2300,
        "y": 1020,
        "wires": [
            [],
            [
                "9c2462fecc162c71"
            ]
        ]
    },
    {
        "id": "a1c8ca75b50ff5d1",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2120,
        "y": 1100,
        "wires": [
            [],
            [
                "a47e01a7b282b984"
            ]
        ]
    },
    {
        "id": "fb5b28e591e48d2b",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2185.16064453125,
        "y": 1163.1785888671875,
        "wires": [
            [],
            [
                "511269f9382db3d5"
            ]
        ]
    },
    {
        "id": "b4ce6d20568897f1",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2100,
        "y": 1220,
        "wires": [
            [],
            [
                "661fef400c6a9e5e"
            ]
        ]
    },
    {
        "id": "04c86e21998d2f68",
        "type": "switch",
        "z": "d32a58c0544f501c",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2100,
        "y": 1280,
        "wires": [
            [],
            [
                "50b57e919c645cc1"
            ]
        ]
    },
    {
        "id": "cc692248725e2247",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "reset msg",
        "func": "msg.napcs = msg.payload\nmsg.payload = msg.records\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 820,
        "wires": [
            [
                "08a8e672a5c57c22"
            ]
        ]
    },
    {
        "id": "326cfe866efb4daf",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "query_napcs",
        "func": "msg.records = msg.payload\n\nlet record_idx = msg.ptrModuleFacts;\nlet record = msg.records.csv[record_idx];\nlet id = record.REPORTING_ID\n\nlet CLIENT_DB_SCHEMA = env.get('CLIENT_DB_SCHEMA')\nlet DB_SPAD_TABLE = env.get('DB_SPAD_TABLE')\nlet job = msg.payload.job.jobName\n\nmsg.query = \"  SELECT * FROM \" + CLIENT_DB_SCHEMA + \".\" + DB_SPAD_TABLE + \" where reporting_id = '\" + id + \"' and type = 'NAPCS' and jobname = '\" + job +\"';\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 760,
        "wires": [
            [
                "f54b8a1f3cb92c7a"
            ]
        ]
    },
    {
        "id": "f54b8a1f3cb92c7a",
        "type": "subflow:8032608991ae0162",
        "z": "d32a58c0544f501c",
        "name": "",
        "x": 880,
        "y": 760,
        "wires": [
            [
                "cc692248725e2247"
            ]
        ]
    },
    {
        "id": "515994aae1c4ef52",
        "type": "function",
        "z": "d32a58c0544f501c",
        "name": "NOT CODED CALL NAPCS UPDATE API",
        "func": "\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2640,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "8484fa1c86e06482",
        "type": "function",
        "z": "1088c7f7eed8781b",
        "name": "histstat",
        "func": "try{\n    let record_idx = global.get('ptrModuleFacts')\n    let record = msg.payload.csv[record_idx]\n    \n    let hist = msg.payload.csv\n    let findEc = hist.find(ec => ec?.REPORTING_ID == record?.REPORTING_ID && ec?.EC_TABLE == 'Yes')\n\n    const ecUsed = [\n        \"ELEC_PRCH_KWH_NUM\", \"EMP_MAR12_NUM\", \"EXPS_ELEC_VAL\", \"INV_B_AVG_VAL\",\n        \"INV_B_IVAL_TOT_DVAL\", \"INV_B_LIFO_RSV_VAL\", \"INV_B_LIFO_VAL\", \"INV_B_STD_VAL\",\n        \"INV_B_TOT_VAL\", \"INV_E_AVG_VAL\", \"INV_E_IVAL_TOT_DVAL\", \"INV_E_LIFO_RSV_VAL\",\n        \"INV_E_LIFO_VAL\", \"INV_E_STD_VAL\", \"INV_E_TOT_VAL\", \"PAY_ANN_VAL\", \"PAY_QTR1_VAL\",\n        \"RCPT_TOT_VAL\", \"INV_E_FIFO_VAL\", \"INV_B_FIFO_VAL\", \"NAPCS_BLTOT\"\n    ]; \n\n    // const ecMaybe = [ \n    //     \"ASSET_BGN_VAL\", \"ASSET_END_TOT_DVAL\", \"ASSET_SOLD_VAL\", \"CAPEX_AUTO_VAL\", \n    //     \"CAPEX_BUILD_TOT_DVAL\", \"CAPEX_COMPTR_VAL\", \"CAPEX_MACH_TOT_DVAL\", \"CAPEX_OTHMACH_VAL\", \n    //     \"CAPEX_TOT_DVAL\", \"DEPR_VAL\", \"ELEC_GEN_KWH_NUM\", \"ELEC_SOLD_KWH_NUM\", \n    //     \"EMP_MAR12_NONPRDWRK_NUM\", \"EMP_MAR12_PRDWRK_NUM\", \"EXPS_ADVERT_VAL\", \"EXPS_BENPAY_HLTH_VAL\", \n    //     \"EXPS_COMMSVC_VAL\", \"EXPS_COMPTR_OTHEQ_VAL\", \"EXPS_CONTRACT_VAL\", \"EXPS_DATAPROC_VAL\", \n    //     \"EXPS_EXSOFT_VAL\", \"EXPS_MACH_REP_VAL\", \"EXPS_MAT_V1_VAL\", \"EXPS_OTHER_VAL\", \n    //     \"EXPS_PCHTT_DVAL\", \"EXPS_PRCH_RESALE_VAL\", \"EXPS_PROFTECH_VAL\", \"EXPS_REFUSE_VAL\", \n    //     \"EXPS_RENT_BUILD_VAL\", \"EXPS_RENT_MACH_VAL\", \"EXPS_RESALE_VAL\", \"EXPS_TAX_VAL\", \n    //     \"EXPS_TEMPSTAF_VAL\", \"EXPS_TOT_VAL\", \"HOURS_PRDWRK_NUM\", \"INV_B_MAT_VAL\", \n    //     \"INV_B_NL_TOT_DVAL\", \"INV_B_OTHNL_VAL\", \"INV_B_WIP_VAL\", \"INV_E_MAT_VAL\", \n    //     \"INV_E_NL_TOT_DVAL\", \"INV_E_OTHNL_VAL\", \"INV_E_WIP_VAL\", \"PAY_ANN_NONPRDWRK_VAL\", \n    //     \"PAY_ANN_PRDWRK_VAL\", \"PAY_QTR1_NONPRDWRK_VAL\", \"PAY_QTR1_PRDWRK_VAL\", \"RCPT_COMSN_EARN_VAL\", \n    //     \"RCPT_COMSN_GSV_VAL\", \"RCPT_ECOMM_VAL\", \"RCPT_ESHIP_PCT\", \"ROBOT_INDST_INOP_NUM\", \n    //     \"ROBOT_INDST_PRCH_NUM\", \"ROBOT_INDST_VAL\", \"VALUE_ADDED_DVAL\" \n    // ]; \n\n    if (findEc) {\n        record['HISTSTAT'] = 'Y'\n    } else {\n        let obj = {}\n        for (let i of ecUsed) {\n            obj[i] = 0\n        }\n        hist.push(obj)\n        console.log(hist)\n    }\n    \n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'histstat'\n    return msg;\n}\n''",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "70eb1c5abaaa5b4b",
        "type": "function",
        "z": "1088c7f7eed8781b",
        "name": "histstat database",
        "func": "try{\n    let record_idx = msg.ptrModuleFacts\n    let record = msg.payload.csv[record_idx]\n    \n    let hist = msg.payload.tables.ec\n    let findEc = hist.find(ec => ec.fact?.REPORTING_ID == record?.REPORTING_ID)\n\n    const ecUsed = [\n        \"ELEC_PRCH_KWH_NUM\", \"EMP_MAR12_NUM\", \"EXPS_ELEC_VAL\", \"INV_B_AVG_VAL\",\n        \"INV_B_IVAL_TOT_DVAL\", \"INV_B_LIFO_RSV_VAL\", \"INV_B_LIFO_VAL\", \"INV_B_STD_VAL\",\n        \"INV_B_TOT_VAL\", \"INV_E_AVG_VAL\", \"INV_E_IVAL_TOT_DVAL\", \"INV_E_LIFO_RSV_VAL\",\n        \"INV_E_LIFO_VAL\", \"INV_E_STD_VAL\", \"INV_E_TOT_VAL\", \"PAY_ANN_VAL\", \"PAY_QTR1_VAL\",\n        \"RCPT_TOT_VAL\", \"INV_E_FIFO_VAL\", \"INV_B_FIFO_VAL\", \"NAPCS_BLTOT\"\n    ]; \n\n    // const ecMaybe = [ \n    //     \"ASSET_BGN_VAL\", \"ASSET_END_TOT_DVAL\", \"ASSET_SOLD_VAL\", \"CAPEX_AUTO_VAL\", \n    //     \"CAPEX_BUILD_TOT_DVAL\", \"CAPEX_COMPTR_VAL\", \"CAPEX_MACH_TOT_DVAL\", \"CAPEX_OTHMACH_VAL\", \n    //     \"CAPEX_TOT_DVAL\", \"DEPR_VAL\", \"ELEC_GEN_KWH_NUM\", \"ELEC_SOLD_KWH_NUM\", \n    //     \"EMP_MAR12_NONPRDWRK_NUM\", \"EMP_MAR12_PRDWRK_NUM\", \"EXPS_ADVERT_VAL\", \"EXPS_BENPAY_HLTH_VAL\", \n    //     \"EXPS_COMMSVC_VAL\", \"EXPS_COMPTR_OTHEQ_VAL\", \"EXPS_CONTRACT_VAL\", \"EXPS_DATAPROC_VAL\", \n    //     \"EXPS_EXSOFT_VAL\", \"EXPS_MACH_REP_VAL\", \"EXPS_MAT_V1_VAL\", \"EXPS_OTHER_VAL\", \n    //     \"EXPS_PCHTT_DVAL\", \"EXPS_PRCH_RESALE_VAL\", \"EXPS_PROFTECH_VAL\", \"EXPS_REFUSE_VAL\", \n    //     \"EXPS_RENT_BUILD_VAL\", \"EXPS_RENT_MACH_VAL\", \"EXPS_RESALE_VAL\", \"EXPS_TAX_VAL\", \n    //     \"EXPS_TEMPSTAF_VAL\", \"EXPS_TOT_VAL\", \"HOURS_PRDWRK_NUM\", \"INV_B_MAT_VAL\", \n    //     \"INV_B_NL_TOT_DVAL\", \"INV_B_OTHNL_VAL\", \"INV_B_WIP_VAL\", \"INV_E_MAT_VAL\", \n    //     \"INV_E_NL_TOT_DVAL\", \"INV_E_OTHNL_VAL\", \"INV_E_WIP_VAL\", \"PAY_ANN_NONPRDWRK_VAL\", \n    //     \"PAY_ANN_PRDWRK_VAL\", \"PAY_QTR1_NONPRDWRK_VAL\", \"PAY_QTR1_PRDWRK_VAL\", \"RCPT_COMSN_EARN_VAL\", \n    //     \"RCPT_COMSN_GSV_VAL\", \"RCPT_ECOMM_VAL\", \"RCPT_ESHIP_PCT\", \"ROBOT_INDST_INOP_NUM\", \n    //     \"ROBOT_INDST_PRCH_NUM\", \"ROBOT_INDST_VAL\", \"VALUE_ADDED_DVAL\" \n    // ]; \n\n    if (findEc) {\n        record['HISTSTAT'] = 'Y'\n    } else {\n        let obj = {\"fact\":{}}\n        for (let i of ecUsed) {\n            obj[\"fact\"][i] = 0\n        }\n        msg.payload.tables.ec.push(obj)\n    }\n    \n    return msg;\n} catch(e) {\n    msg.err='Exit Edit'\n    msg.payload.exit = 'histstat'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "b853872c4456ce78",
        "type": "function",
        "z": "e50e4180ad305262",
        "name": "histstat after pv",
        "func": "try{\n    let record_idx = global.get('ptrModuleFacts')\n    let record = msg.payload.csv[record_idx]\n    \n    const ecUsed = [\n        \"ELEC_PRCH_KWH_NUM\", \"EMP_MAR12_NUM\", \"EXPS_ELEC_VAL\", \"INV_B_AVG_VAL\",\n        \"INV_B_IVAL_TOT_DVAL\", \"INV_B_LIFO_RSV_VAL\", \"INV_B_LIFO_VAL\", \"INV_B_STD_VAL\",\n        \"INV_B_TOT_VAL\", \"INV_E_AVG_VAL\", \"INV_E_IVAL_TOT_DVAL\", \"INV_E_LIFO_RSV_VAL\",\n        \"INV_E_LIFO_VAL\", \"INV_E_STD_VAL\", \"INV_E_TOT_VAL\", \"PAY_ANN_VAL\", \"PAY_QTR1_VAL\",\n        \"RCPT_TOT_VAL\", \"INV_E_FIFO_VAL\", \"INV_B_FIFO_VAL\", \"NAPCS_BLTOT\"\n    ]; \n\n    // const ecMaybe = [ \n    //     \"ASSET_BGN_VAL\", \"ASSET_END_TOT_DVAL\", \"ASSET_SOLD_VAL\", \"CAPEX_AUTO_VAL\", \n    //     \"CAPEX_BUILD_TOT_DVAL\", \"CAPEX_COMPTR_VAL\", \"CAPEX_MACH_TOT_DVAL\", \"CAPEX_OTHMACH_VAL\", \n    //     \"CAPEX_TOT_DVAL\", \"DEPR_VAL\", \"ELEC_GEN_KWH_NUM\", \"ELEC_SOLD_KWH_NUM\", \n    //     \"EMP_MAR12_NONPRDWRK_NUM\", \"EMP_MAR12_PRDWRK_NUM\", \"EXPS_ADVERT_VAL\", \"EXPS_BENPAY_HLTH_VAL\", \n    //     \"EXPS_COMMSVC_VAL\", \"EXPS_COMPTR_OTHEQ_VAL\", \"EXPS_CONTRACT_VAL\", \"EXPS_DATAPROC_VAL\", \n    //     \"EXPS_EXSOFT_VAL\", \"EXPS_MACH_REP_VAL\", \"EXPS_MAT_V1_VAL\", \"EXPS_OTHER_VAL\", \n    //     \"EXPS_PCHTT_DVAL\", \"EXPS_PRCH_RESALE_VAL\", \"EXPS_PROFTECH_VAL\", \"EXPS_REFUSE_VAL\", \n    //     \"EXPS_RENT_BUILD_VAL\", \"EXPS_RENT_MACH_VAL\", \"EXPS_RESALE_VAL\", \"EXPS_TAX_VAL\", \n    //     \"EXPS_TEMPSTAF_VAL\", \"EXPS_TOT_VAL\", \"HOURS_PRDWRK_NUM\", \"INV_B_MAT_VAL\", \n    //     \"INV_B_NL_TOT_DVAL\", \"INV_B_OTHNL_VAL\", \"INV_B_WIP_VAL\", \"INV_E_MAT_VAL\", \n    //     \"INV_E_NL_TOT_DVAL\", \"INV_E_OTHNL_VAL\", \"INV_E_WIP_VAL\", \"PAY_ANN_NONPRDWRK_VAL\", \n    //     \"PAY_ANN_PRDWRK_VAL\", \"PAY_QTR1_NONPRDWRK_VAL\", \"PAY_QTR1_PRDWRK_VAL\", \"RCPT_COMSN_EARN_VAL\", \n    //     \"RCPT_COMSN_GSV_VAL\", \"RCPT_ECOMM_VAL\", \"RCPT_ESHIP_PCT\", \"ROBOT_INDST_INOP_NUM\", \n    //     \"ROBOT_INDST_PRCH_NUM\", \"ROBOT_INDST_VAL\", \"VALUE_ADDED_DVAL\" \n    // ]; \n\n    if (record?.HISTSTAT == 'Y') {\n    } else {\n        let obj = {}\n        for (let i of ecUsed) {\n            obj[i] = 0\n        }\n        msg.payload.csv.push(obj)\n        // console.log(msg.payoad.csv)\n    }\n    \n    return msg;\n} catch(e) {\n    global.set('err','Exit Edit')\n    msg.payload.exit = 'histstat after pv'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "caa8121172334814",
        "type": "function",
        "z": "e50e4180ad305262",
        "name": "histstat after pv database",
        "func": "try {\n    let record_idx = msg.ptrModuleFacts\n    let record = msg.payload.csv[record_idx]\n\n    const ecUsed = [\n        \"ELEC_PRCH_KWH_NUM\", \"EMP_MAR12_NUM\", \"EXPS_ELEC_VAL\", \"INV_B_AVG_VAL\",\n        \"INV_B_IVAL_TOT_DVAL\", \"INV_B_LIFO_RSV_VAL\", \"INV_B_LIFO_VAL\", \"INV_B_STD_VAL\",\n        \"INV_B_TOT_VAL\", \"INV_E_AVG_VAL\", \"INV_E_IVAL_TOT_DVAL\", \"INV_E_LIFO_RSV_VAL\",\n        \"INV_E_LIFO_VAL\", \"INV_E_STD_VAL\", \"INV_E_TOT_VAL\", \"PAY_ANN_VAL\", \"PAY_QTR1_VAL\",\n        \"RCPT_TOT_VAL\", \"INV_E_FIFO_VAL\", \"INV_B_FIFO_VAL\", \"NAPCS_BLTOT\"\n    ];\n\n    // const ecMaybe = [ \n    //     \"ASSET_BGN_VAL\", \"ASSET_END_TOT_DVAL\", \"ASSET_SOLD_VAL\", \"CAPEX_AUTO_VAL\", \n    //     \"CAPEX_BUILD_TOT_DVAL\", \"CAPEX_COMPTR_VAL\", \"CAPEX_MACH_TOT_DVAL\", \"CAPEX_OTHMACH_VAL\", \n    //     \"CAPEX_TOT_DVAL\", \"DEPR_VAL\", \"ELEC_GEN_KWH_NUM\", \"ELEC_SOLD_KWH_NUM\", \n    //     \"EMP_MAR12_NONPRDWRK_NUM\", \"EMP_MAR12_PRDWRK_NUM\", \"EXPS_ADVERT_VAL\", \"EXPS_BENPAY_HLTH_VAL\", \n    //     \"EXPS_COMMSVC_VAL\", \"EXPS_COMPTR_OTHEQ_VAL\", \"EXPS_CONTRACT_VAL\", \"EXPS_DATAPROC_VAL\", \n    //     \"EXPS_EXSOFT_VAL\", \"EXPS_MACH_REP_VAL\", \"EXPS_MAT_V1_VAL\", \"EXPS_OTHER_VAL\", \n    //     \"EXPS_PCHTT_DVAL\", \"EXPS_PRCH_RESALE_VAL\", \"EXPS_PROFTECH_VAL\", \"EXPS_REFUSE_VAL\", \n    //     \"EXPS_RENT_BUILD_VAL\", \"EXPS_RENT_MACH_VAL\", \"EXPS_RESALE_VAL\", \"EXPS_TAX_VAL\", \n    //     \"EXPS_TEMPSTAF_VAL\", \"EXPS_TOT_VAL\", \"HOURS_PRDWRK_NUM\", \"INV_B_MAT_VAL\", \n    //     \"INV_B_NL_TOT_DVAL\", \"INV_B_OTHNL_VAL\", \"INV_B_WIP_VAL\", \"INV_E_MAT_VAL\", \n    //     \"INV_E_NL_TOT_DVAL\", \"INV_E_OTHNL_VAL\", \"INV_E_WIP_VAL\", \"PAY_ANN_NONPRDWRK_VAL\", \n    //     \"PAY_ANN_PRDWRK_VAL\", \"PAY_QTR1_NONPRDWRK_VAL\", \"PAY_QTR1_PRDWRK_VAL\", \"RCPT_COMSN_EARN_VAL\", \n    //     \"RCPT_COMSN_GSV_VAL\", \"RCPT_ECOMM_VAL\", \"RCPT_ESHIP_PCT\", \"ROBOT_INDST_INOP_NUM\", \n    //     \"ROBOT_INDST_PRCH_NUM\", \"ROBOT_INDST_VAL\", \"VALUE_ADDED_DVAL\" \n    // ]; \n\n    if (record?.HISTSTAT == 'Y') {\n    } else {\n        let obj = {\"fact\":{}}\n        for (let i of ecUsed) {\n            obj[\"fact\"][i] = 0\n        }\n        msg.payload.tables.ec.push(obj)\n    }\n\n    return msg;\n} catch (e) {\n    msg.err = 'Exit Edit'\n    msg.payload.exit = 'histstat after pv'\n    return msg;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "670fcf981f211fb3",
        "type": "function",
        "z": "f0920ac3618eb45b",
        "name": "check writeback",
        "func": "let record_idx = global.get('ptrModuleFacts')\nlet record = msg.payload.csv[record_idx]\n\nif (record?.ENT_TYP_TXT == 'SU') {\n    if (['ENT','KAU'].includes(record?.REPORTING_ID_TYP_TXT)) {\n        if (record?.TABSTAT != 'Y') {\n            global.set('action','Exit Edit')\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "9a7a7971.dbc4b8",
        "type": "inject",
        "z": "67991373.45438c",
        "g": "19463268a6c67561",
        "name": "Inject Filename",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "/Users/revealgc/Desktop/4testMOD.csv",
        "payloadType": "str",
        "x": 140,
        "y": 140,
        "wires": [
            [
                "1e5beed02674863a"
            ]
        ],
        "outputLabels": [
            "Send Time"
        ]
    },
    {
        "id": "1e5beed02674863a",
        "type": "ui_text_input",
        "z": "67991373.45438c",
        "g": "19463268a6c67561",
        "name": "Input Parameter File Name",
        "label": "Params file...",
        "tooltip": "Enter the location of the parameters file",
        "group": "d5b306fd70950040",
        "order": 2,
        "width": 15,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 440,
        "y": 140,
        "wires": [
            [
                "b5c53653a76681bf"
            ]
        ]
    },
    {
        "id": "97cb22c43553888b",
        "type": "comment",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "name": "Fact from files",
        "info": "# Facts CSV File ",
        "x": 910,
        "y": 800,
        "wires": []
    },
    {
        "id": "b5c53653a76681bf",
        "type": "subflow:82cc831b154f3133",
        "z": "67991373.45438c",
        "g": "19463268a6c67561",
        "name": "",
        "x": 800,
        "y": 140,
        "wires": [
            [
                "06db3e224b379422"
            ]
        ]
    },
    {
        "id": "04f3b0fb456d2117",
        "type": "ui_text_input",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "name": "Input Dataset File Name",
        "label": "Facts",
        "tooltip": "Enter the location of the parameters file",
        "group": "1f86b2145e7e556a",
        "order": 2,
        "width": 15,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 370,
        "y": 600,
        "wires": [
            [
                "100234cf93c195b8"
            ]
        ]
    },
    {
        "id": "100234cf93c195b8",
        "type": "file in",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "name": "Read File",
        "filename": "payload",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 580,
        "y": 600,
        "wires": [
            [
                "c047c871d9c0e70d"
            ]
        ]
    },
    {
        "id": "c047c871d9c0e70d",
        "type": "csv",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "name": "",
        "sep": ",",
        "hdrin": true,
        "hdrout": "none",
        "multi": "mult",
        "ret": "\\r\\n",
        "temp": "",
        "skip": "0",
        "strings": true,
        "include_empty_strings": false,
        "include_null_values": false,
        "x": 730,
        "y": 600,
        "wires": [
            [
                "c9c9ca415ab95910",
                "58df41cd8e54a653"
            ]
        ]
    },
    {
        "id": "c9c9ca415ab95910",
        "type": "function",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "name": "Save Facts from file",
        "func": "let facts = {}\nmsg.payload.map((r, k) => {\n    facts = {...facts, ...{[r['name']]: r['value']}}\n})\n\nflow.set(\"facts\", facts)\n\n\nmsg.facts = msg.payload\nmsg.payload = [facts]\n\n\n\nmsg.topic = \"facts\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 600,
        "wires": [
            [
                "571a7beaed3ab093"
            ]
        ]
    },
    {
        "id": "16550455147cd747",
        "type": "ui_table",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "group": "134f09c88dd005fc",
        "name": "4. Facts",
        "order": 1,
        "width": 24,
        "height": 4,
        "columns": [
            {
                "field": "rule.event.ruleId",
                "title": "Row",
                "width": "80",
                "align": "left",
                "formatter": "rownum",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "name",
                "title": "Name",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "value",
                "title": "Value",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 1240,
        "y": 640,
        "wires": []
    },
    {
        "id": "211d46862546b6bf",
        "type": "inject",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "name": "FileName Inject",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "/Users/revealgc/Desktop/factsToTest.csv",
        "payloadType": "str",
        "x": 140,
        "y": 600,
        "wires": [
            [
                "04f3b0fb456d2117"
            ]
        ],
        "outputLabels": [
            "Send Time"
        ]
    },
    {
        "id": "571a7beaed3ab093",
        "type": "change",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "name": "Enable ",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "facts",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "set",
                "p": "value",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1110,
        "y": 600,
        "wires": [
            [
                "16550455147cd747",
                "24856db77f81d8bb",
                "21a2308db46311bb"
            ]
        ]
    },
    {
        "id": "fb483894819a453e",
        "type": "http request",
        "z": "67991373.45438c",
        "g": "ef50b77b253a7883",
        "name": "Get Rule Types from DB",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/rulesrepo/getruletype",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 410,
        "y": 340,
        "wires": [
            [
                "79f4bff451119fb7"
            ]
        ]
    },
    {
        "id": "5f12a638967ad520",
        "type": "inject",
        "z": "67991373.45438c",
        "g": "ef50b77b253a7883",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 380,
        "wires": [
            [
                "fb483894819a453e"
            ]
        ]
    },
    {
        "id": "199e84df3d73b845",
        "type": "ui_dropdown",
        "z": "67991373.45438c",
        "g": "ef50b77b253a7883",
        "name": "Rule Types Drop Down Topic: validationTopic",
        "label": "",
        "tooltip": "Select rule types",
        "place": "Select rule types from the db...",
        "group": "d5b306fd70950040",
        "order": 4,
        "width": 12,
        "height": 1,
        "passthru": true,
        "multiple": true,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "validationType",
        "topicType": "str",
        "className": "",
        "x": 1190,
        "y": 340,
        "wires": [
            [
                "739c4193fa8fce2c"
            ]
        ]
    },
    {
        "id": "79f4bff451119fb7",
        "type": "function",
        "z": "67991373.45438c",
        "g": "ef50b77b253a7883",
        "name": "Prep for DB Rules Dropdown Topic:dbruletypes",
        "func": "let ret = []\nmsg.payload.map(t => ret.push({ [t.type + '(' + t.cnt +')']: t.type}))\nmsg.options = ret\nmsg.payload = ret\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 340,
        "wires": [
            [
                "199e84df3d73b845"
            ]
        ]
    },
    {
        "id": "645a9d4772fcd00f",
        "type": "ui_button",
        "z": "67991373.45438c",
        "g": "ef50b77b253a7883",
        "name": "",
        "group": "d5b306fd70950040",
        "order": 5,
        "width": 3,
        "height": 1,
        "passthru": false,
        "label": "Get Rules",
        "tooltip": "Get rule types",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-database",
        "payload": "dbrules",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 100,
        "y": 280,
        "wires": [
            [
                "fb483894819a453e"
            ]
        ]
    },
    {
        "id": "24856db77f81d8bb",
        "type": "ui_gauge",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "name": "Gauge for Facts from file",
        "group": "4060ccd3b1b979fd",
        "order": 4,
        "width": 4,
        "height": 4,
        "gtype": "gage",
        "title": "Facts",
        "label": "units",
        "format": "{{msg.payload.length}}",
        "min": 0,
        "max": "300",
        "colors": [
            "#0d0b96",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 1290,
        "y": 560,
        "wires": []
    },
    {
        "id": "0cd9973f643e23da",
        "type": "ui_text_input",
        "z": "67991373.45438c",
        "g": "c0b83f35fdc02130",
        "name": "Input RID",
        "label": "Reporting IDs",
        "tooltip": "Enter at least 3 characters",
        "group": "1f86b2145e7e556a",
        "order": 5,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 100,
        "y": 980,
        "wires": [
            [
                "3b55370ad9fd31f5"
            ]
        ]
    },
    {
        "id": "3b55370ad9fd31f5",
        "type": "http request",
        "z": "67991373.45438c",
        "g": "c0b83f35fdc02130",
        "name": "Get RIDs from DB",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/reporting_unit/findRID/{{{payload}}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            }
        ],
        "x": 330,
        "y": 980,
        "wires": [
            [
                "7ce52ec9ef003b44"
            ]
        ]
    },
    {
        "id": "e76e13639b1f0475",
        "type": "ui_dropdown",
        "z": "67991373.45438c",
        "g": "c0b83f35fdc02130",
        "name": "Rule Types Drop Down Topic: dbreportingids",
        "label": "",
        "tooltip": "Select reporting ids...",
        "place": "Select reporting ids from the db...",
        "group": "1f86b2145e7e556a",
        "order": 4,
        "width": 10,
        "height": 1,
        "passthru": false,
        "multiple": true,
        "options": [
            {
                "label": "",
                "value": "",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "dbreportingids",
        "topicType": "msg",
        "className": "",
        "x": 1050,
        "y": 980,
        "wires": [
            [
                "d394b61bcc4755e6"
            ]
        ]
    },
    {
        "id": "7ce52ec9ef003b44",
        "type": "function",
        "z": "67991373.45438c",
        "g": "c0b83f35fdc02130",
        "name": "Prep for RID Dropdown Topic:dbreportingids",
        "func": "let ret = []\n msg.payload.map(t => ret.push({ [t.shortvalue + \" \"+ t.reporting_id]: t.reporting_id}))\nmsg.options = ret\nmsg.payload = ret\nmsg.topic = \"dbreportingids\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 980,
        "wires": [
            [
                "e76e13639b1f0475"
            ]
        ]
    },
    {
        "id": "d394b61bcc4755e6",
        "type": "function",
        "z": "67991373.45438c",
        "g": "c0b83f35fdc02130",
        "name": "Save Reporting IDs",
        "func": "let rid = msg.payload\nmsg.reporting_id = msg.payload\nflow.set(\"reporting_id\", rid)\nmsg.payload = rid.length > 0\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1430,
        "y": 980,
        "wires": [
            [
                "f45097235bf5254d",
                "b50c075944f35652"
            ]
        ]
    },
    {
        "id": "1e61b63c0502b4e9",
        "type": "debug",
        "z": "67991373.45438c",
        "name": "debug 4",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2600,
        "y": 880,
        "wires": []
    },
    {
        "id": "044139040f928c41",
        "type": "debug",
        "z": "67991373.45438c",
        "name": "debug 5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2400,
        "y": 740,
        "wires": []
    },
    {
        "id": "8c1b098c01bc4977",
        "type": "ui_switch",
        "z": "67991373.45438c",
        "name": "cb_ff",
        "label": "",
        "tooltip": "",
        "group": "1f86b2145e7e556a",
        "order": 1,
        "width": 1,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "cb_ff",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 2050,
        "y": 600,
        "wires": [
            [
                "fd562624ab71790e"
            ]
        ]
    },
    {
        "id": "5f1b840d2df55385",
        "type": "function",
        "z": "67991373.45438c",
        "name": "Save checkboxes",
        "func": "let P = msg.payload\n\n// Save Checkboxes\n\nflow.set(\"cb_ff\", P.cb_ff)\n\nflow.set(\"cb_fd\", P.cb_fd)\nflow.set(\"cb_rf\", P.cb_rf)\nflow.set(\"cb_rd\", P.cb_rd)\n\nflow.set(\"cb_network\", P.cb_network)\nflow.set(\"cb_attached\", P.cb_attached)\n\n\n// rules and facts must be from either files or db\nmsg.payload = (P.cb_ff || P.cb_fd) && (P.cb_rf || P.cb_rd)\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2430,
        "y": 820,
        "wires": [
            [
                "1e61b63c0502b4e9",
                "dfb61e11af38dafd"
            ]
        ]
    },
    {
        "id": "f45097235bf5254d",
        "type": "ui_switch",
        "z": "67991373.45438c",
        "name": "cb_fd",
        "label": "",
        "tooltip": "",
        "group": "1f86b2145e7e556a",
        "order": 3,
        "width": 1,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "cb_fd",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 2010,
        "y": 980,
        "wires": [
            [
                "fd562624ab71790e"
            ]
        ]
    },
    {
        "id": "7068b9cdbaed7677",
        "type": "function",
        "z": "67991373.45438c",
        "name": "Reset all",
        "func": "flow.set(\"rules\",[])\nflow.set(\"facts\", {})\nflow.set(\"reporting_id\", {})\nflow.set(\"validationType\", {})\n\n\nflow.set(\"cb_attached\", false)\n\nflow.set(\"cb_network\", false)\n\n\n flow.set('cb_ff', false)\nflow.set('cb_fd', false)\n\nflow.set('cb_rf', false)\nflow.set('cb_rd', false)\nmsg.payload = false\n\nmsg.enabled = false",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2400,
        "y": 1640,
        "wires": [
            []
        ]
    },
    {
        "id": "fd562624ab71790e",
        "type": "join",
        "z": "67991373.45438c",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "6",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 2250,
        "y": 820,
        "wires": [
            [
                "5f1b840d2df55385",
                "044139040f928c41"
            ]
        ]
    },
    {
        "id": "ef78548912a4d7aa",
        "type": "ui_switch",
        "z": "67991373.45438c",
        "name": "cb_rf",
        "label": "",
        "tooltip": "",
        "group": "d5b306fd70950040",
        "order": 1,
        "width": 1,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "cb_rf",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 2050,
        "y": 140,
        "wires": [
            [
                "fd562624ab71790e"
            ]
        ]
    },
    {
        "id": "9a41aca46f8e70f2",
        "type": "ui_switch",
        "z": "67991373.45438c",
        "name": "cb_rd",
        "label": "",
        "tooltip": "",
        "group": "d5b306fd70950040",
        "order": 3,
        "width": 1,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "cb_rd",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 2050,
        "y": 340,
        "wires": [
            [
                "fd562624ab71790e"
            ]
        ]
    },
    {
        "id": "7f5231b4f331e49b",
        "type": "ui_switch",
        "z": "67991373.45438c",
        "name": "",
        "label": "Network",
        "tooltip": "",
        "group": "779fdd53a3120890",
        "order": 2,
        "width": 8,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "cb_network",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 2060,
        "y": 1200,
        "wires": [
            [
                "fd562624ab71790e"
            ]
        ]
    },
    {
        "id": "ba7a7633a548b05b",
        "type": "ui_switch",
        "z": "67991373.45438c",
        "name": "",
        "label": "Attached",
        "tooltip": "",
        "group": "779fdd53a3120890",
        "order": 1,
        "width": 8,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "cb_attached",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 2040,
        "y": 1080,
        "wires": [
            [
                "fd562624ab71790e"
            ]
        ]
    },
    {
        "id": "48fe92c3d9b4d8bb",
        "type": "ui_button",
        "z": "67991373.45438c",
        "name": "",
        "group": "779fdd53a3120890",
        "order": 3,
        "width": 8,
        "height": 1,
        "passthru": false,
        "label": "Submit JOB",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-tasks",
        "payload": "DONE",
        "payloadType": "str",
        "topic": "",
        "topicType": "str",
        "x": 3010,
        "y": 820,
        "wires": [
            [
                "73055769ca44b5f7"
            ]
        ]
    },
    {
        "id": "dfb61e11af38dafd",
        "type": "function",
        "z": "67991373.45438c",
        "name": "Enable or Disable Submit JOB button",
        "func": "msg.enabled = msg.payload\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2750,
        "y": 820,
        "wires": [
            [
                "48fe92c3d9b4d8bb"
            ]
        ]
    },
    {
        "id": "06db3e224b379422",
        "type": "function",
        "z": "67991373.45438c",
        "g": "19463268a6c67561",
        "name": "Save RULES and Radio Button(rf)",
        "func": "\n\nlet rules = []\n\nmsg.payload.results.map(r => rules.push(r.rule))\nflow.set(\"rules\", rules)\n\nmsg.payload = !(msg.payload.outputErrorCount > 0)\nmsg.enabled = !(msg.payload.outputErrorCount > 0)\n\nmsg.disabled = true\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1280,
        "y": 140,
        "wires": [
            [
                "ef78548912a4d7aa",
                "2496a0361619e895"
            ]
        ]
    },
    {
        "id": "1e3847f427e4c74f",
        "type": "ui_button",
        "z": "67991373.45438c",
        "name": "",
        "group": "779fdd53a3120890",
        "order": 4,
        "width": 8,
        "height": 1,
        "passthru": true,
        "label": "Reset",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-circle-o",
        "payload": "false",
        "payloadType": "bool",
        "topic": "",
        "topicType": "str",
        "x": 1910,
        "y": 1700,
        "wires": [
            [
                "8701991a4839bab8",
                "b2a8b14d99432a2d",
                "cbbf5c9004d0946e",
                "30dce0e234d60286",
                "c3a24bb78c2a2175",
                "9db5fcbd4b1fd8c3",
                "093e4ef6e2a39496",
                "d67e28129722d643",
                "5d9d0ae34f31c5f4"
            ]
        ]
    },
    {
        "id": "21a2308db46311bb",
        "type": "function",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "name": "Change payload to true",
        "func": "msg.payload = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 600,
        "wires": [
            [
                "8c1b098c01bc4977"
            ]
        ]
    },
    {
        "id": "58df41cd8e54a653",
        "type": "debug",
        "z": "67991373.45438c",
        "g": "62708d0bbe922798",
        "name": "debug 21",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 640,
        "wires": []
    },
    {
        "id": "73055769ca44b5f7",
        "type": "function",
        "z": "67991373.45438c",
        "name": "Save QBES Payload",
        "func": "// workflow id will default to 0 if not provided. It corresponds to the spad.id db col.\n// \nlet reporting_id = flow.get(\"reporting_id\")// parseInt(flow.get(\"reporting_id\") || 2002865554)\nflow.set(\"startTime\", new Date().toLocaleString())\n// Save Checkboxes\n\nlet cb_ff = flow.get(\"cb_ff\")\nlet cb_fd = flow.get(\"cb_fd\")\n\nlet cb_rf = flow.get(\"cb_rf\")\nlet cb_rd = flow.get(\"cb_rd\")\n\n\nlet cb_network = flow.get(\"cb_network\") || true\nlet cb_attached = flow.get(\"cb_attached\") || false\n\n\nlet facts = (cb_ff) ? [flow.get(\"facts\")] : []\nlet rules = (cb_rf) ? flow.get(\"rules\") :[]\nlet attended = cb_attached\nlet showNetwork = cb_network\n\nlet QBESpayload = {\n    facts,     \n    rules, \n    attended, \n    showNetwork,\n    ruleType: (flow.get(\"validationType\")) || [],\n    parent_id: flow.get(\"workFlowId\") || 0,\n    reporting_id\n}\nflow.set(\"QBESPayload\",QBESpayload)\nmsg.payload = QBESpayload\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3220,
        "y": 820,
        "wires": [
            [
                "f87a1ec1239428aa",
                "bdf7069659cda7af"
            ]
        ]
    },
    {
        "id": "2d31a9cbb8b25e8f",
        "type": "debug",
        "z": "67991373.45438c",
        "name": "debug 23",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 4340,
        "y": 340,
        "wires": []
    },
    {
        "id": "8701991a4839bab8",
        "type": "link out",
        "z": "67991373.45438c",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "889e30d476808397"
        ],
        "x": 2135,
        "y": 1960,
        "wires": []
    },
    {
        "id": "889e30d476808397",
        "type": "link in",
        "z": "67991373.45438c",
        "name": "link in 1",
        "links": [
            "8701991a4839bab8"
        ],
        "x": 1965,
        "y": 300,
        "wires": [
            [
                "9a41aca46f8e70f2"
            ]
        ]
    },
    {
        "id": "b2a8b14d99432a2d",
        "type": "link out",
        "z": "67991373.45438c",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "24e108b562edc235"
        ],
        "x": 2135,
        "y": 1780,
        "wires": []
    },
    {
        "id": "24e108b562edc235",
        "type": "link in",
        "z": "67991373.45438c",
        "name": "link in 2",
        "links": [
            "b2a8b14d99432a2d"
        ],
        "x": 1965,
        "y": 100,
        "wires": [
            [
                "ef78548912a4d7aa"
            ]
        ]
    },
    {
        "id": "cbbf5c9004d0946e",
        "type": "link out",
        "z": "67991373.45438c",
        "name": "link out 3",
        "mode": "link",
        "links": [
            "4e7718304bce05d2"
        ],
        "x": 2145,
        "y": 1560,
        "wires": []
    },
    {
        "id": "4e7718304bce05d2",
        "type": "link in",
        "z": "67991373.45438c",
        "name": "link in 3",
        "links": [
            "cbbf5c9004d0946e"
        ],
        "x": 2575,
        "y": 780,
        "wires": [
            [
                "dfb61e11af38dafd"
            ]
        ]
    },
    {
        "id": "30dce0e234d60286",
        "type": "link out",
        "z": "67991373.45438c",
        "name": "link out 4",
        "mode": "link",
        "links": [
            "5b50d2fc0efaeade"
        ],
        "x": 2145,
        "y": 1640,
        "wires": []
    },
    {
        "id": "5b50d2fc0efaeade",
        "type": "link in",
        "z": "67991373.45438c",
        "name": "link in 4",
        "links": [
            "30dce0e234d60286"
        ],
        "x": 2295,
        "y": 1780,
        "wires": [
            [
                "7068b9cdbaed7677"
            ]
        ]
    },
    {
        "id": "c3a24bb78c2a2175",
        "type": "link out",
        "z": "67991373.45438c",
        "name": "link out 5",
        "mode": "link",
        "links": [
            "fc93792ff8aaff26"
        ],
        "x": 2135,
        "y": 1720,
        "wires": []
    },
    {
        "id": "fc93792ff8aaff26",
        "type": "link in",
        "z": "67991373.45438c",
        "name": "link in 5",
        "links": [
            "c3a24bb78c2a2175"
        ],
        "x": 1965,
        "y": 560,
        "wires": [
            [
                "8c1b098c01bc4977"
            ]
        ]
    },
    {
        "id": "9db5fcbd4b1fd8c3",
        "type": "link out",
        "z": "67991373.45438c",
        "name": "link out 6",
        "mode": "link",
        "links": [
            "5c24e7ac5f83708c"
        ],
        "x": 2145,
        "y": 1600,
        "wires": []
    },
    {
        "id": "5c24e7ac5f83708c",
        "type": "link in",
        "z": "67991373.45438c",
        "name": "link in 6",
        "links": [
            "9db5fcbd4b1fd8c3"
        ],
        "x": 1955,
        "y": 1040,
        "wires": [
            [
                "ba7a7633a548b05b"
            ]
        ]
    },
    {
        "id": "093e4ef6e2a39496",
        "type": "link out",
        "z": "67991373.45438c",
        "name": "link out 7",
        "mode": "link",
        "links": [
            "d2bbd2904874d7a2"
        ],
        "x": 2145,
        "y": 1680,
        "wires": []
    },
    {
        "id": "d2bbd2904874d7a2",
        "type": "link in",
        "z": "67991373.45438c",
        "name": "link in 7",
        "links": [
            "093e4ef6e2a39496"
        ],
        "x": 1955,
        "y": 1160,
        "wires": [
            [
                "7f5231b4f331e49b"
            ]
        ]
    },
    {
        "id": "d67e28129722d643",
        "type": "link out",
        "z": "67991373.45438c",
        "name": "link out 8",
        "mode": "link",
        "links": [
            "5561391c72b77ec4"
        ],
        "x": 2135,
        "y": 1840,
        "wires": []
    },
    {
        "id": "5561391c72b77ec4",
        "type": "link in",
        "z": "67991373.45438c",
        "name": "link in 8",
        "links": [
            "d67e28129722d643"
        ],
        "x": 1935,
        "y": 940,
        "wires": [
            [
                "f45097235bf5254d"
            ]
        ]
    },
    {
        "id": "739c4193fa8fce2c",
        "type": "function",
        "z": "67991373.45438c",
        "g": "ef50b77b253a7883",
        "name": "Save Validation Type and Radio Button(rd)",
        "func": "flow.set(\"validationType\", msg.payload)\nmsg.payload = msg.payload.length > 0 \nmsg.enabled = !(msg.payload.length > 0 )\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1620,
        "y": 340,
        "wires": [
            [
                "9a41aca46f8e70f2"
            ]
        ]
    },
    {
        "id": "3af468cd9306ec3e",
        "type": "debug",
        "z": "67991373.45438c",
        "name": "Output from QBES",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 4110,
        "y": 1000,
        "wires": []
    },
    {
        "id": "d7f2fcd5e791ba92",
        "type": "http request",
        "z": "67991373.45438c",
        "name": "Post: ProcessRules ",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/spad/processRules",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            },
            {
                "keyType": "other",
                "keyValue": "DEBUG",
                "valueType": "other",
                "valueValue": "true"
            }
        ],
        "x": 3850,
        "y": 820,
        "wires": [
            [
                "3af468cd9306ec3e",
                "711f05a68cde98f5"
            ]
        ]
    },
    {
        "id": "711f05a68cde98f5",
        "type": "function",
        "z": "67991373.45438c",
        "name": "Send to log the output of the results",
        "func": "let messages = []\n\nlet P = msg.payload\nif(P.rules) {\n    P.rules.valid.map(p=> messages.push({ruleId: p.id, message: p.message}))\n    msg.payload = {\n        wflid: msg.payload.workflowId,\n        passed: msg.payload.rules.valid.length,\n        failed: msg.payload.rules.invalid.length,\n        messages,\n        startTime: flow.get(\"startTime\"),\n        endTime: new Date().toLocaleString()\n\n    }\n} \n// else {\n//     msg.payload = {\n//         wflid: msg.payload.workflowId,\n//         startTime: flow.get(\"startTime\"),\n//         endTime: new Date().toLocaleString()\n\n//     }\n// }\nmsg.topic = \"QBES Output\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4210,
        "y": 820,
        "wires": [
            [
                "652ea1d3b066becc"
            ]
        ]
    },
    {
        "id": "5d9d0ae34f31c5f4",
        "type": "link out",
        "z": "67991373.45438c",
        "name": "link out 9",
        "mode": "link",
        "links": [
            "d587f5de3f4014c8"
        ],
        "x": 2135,
        "y": 1900,
        "wires": []
    },
    {
        "id": "d587f5de3f4014c8",
        "type": "link in",
        "z": "67991373.45438c",
        "g": "ef50b77b253a7883",
        "name": "link in 9",
        "links": [
            "5d9d0ae34f31c5f4"
        ],
        "x": 265,
        "y": 280,
        "wires": [
            [
                "fb483894819a453e"
            ]
        ]
    },
    {
        "id": "d445d2aa213681e6",
        "type": "http in",
        "z": "67991373.45438c",
        "name": "Test Input Point",
        "url": "/test",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 1360,
        "y": 1360,
        "wires": [
            [
                "077745dd4456572b",
                "4de57f6bb5f38231"
            ]
        ]
    },
    {
        "id": "7e3f13f11c3166e4",
        "type": "debug",
        "z": "67991373.45438c",
        "name": "debug 25",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1900,
        "y": 1360,
        "wires": []
    },
    {
        "id": "077745dd4456572b",
        "type": "function",
        "z": "67991373.45438c",
        "name": "function 7",
        "func": "msg.payload = \"Service called\"\nmsg.statusCode = 200\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1660,
        "y": 1360,
        "wires": [
            [
                "7e3f13f11c3166e4",
                "1e3847f427e4c74f"
            ]
        ]
    },
    {
        "id": "24a6d577acd5cbc7",
        "type": "catch",
        "z": "67991373.45438c",
        "name": "Catch read file errors",
        "scope": null,
        "uncaught": false,
        "x": 220,
        "y": 1180,
        "wires": [
            [
                "c3c54ddc39435b68"
            ]
        ]
    },
    {
        "id": "4fab4477a5dae9fd",
        "type": "ui_toast",
        "z": "67991373.45438c",
        "position": "top right",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 610,
        "y": 1160,
        "wires": []
    },
    {
        "id": "c3c54ddc39435b68",
        "type": "function",
        "z": "67991373.45438c",
        "name": "function 8",
        "func": "msg.payload = msg.error.message\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 1180,
        "wires": [
            [
                "4fab4477a5dae9fd",
                "3edc4444ae0d428e"
            ]
        ]
    },
    {
        "id": "3edc4444ae0d428e",
        "type": "debug",
        "z": "67991373.45438c",
        "name": "debug 26",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 580,
        "y": 1200,
        "wires": []
    },
    {
        "id": "96facefabfa129ae",
        "type": "inject",
        "z": "67991373.45438c",
        "name": "Inject a reporting ID",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "reporting_id",
                "v": "3010013214",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "3010013214",
        "payloadType": "num",
        "x": 830,
        "y": 1100,
        "wires": [
            [
                "b50c075944f35652"
            ]
        ]
    },
    {
        "id": "29e5403351fd72d9",
        "type": "debug",
        "z": "67991373.45438c",
        "name": "debug 28",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1060,
        "y": 1280,
        "wires": []
    },
    {
        "id": "b50c075944f35652",
        "type": "http request",
        "z": "67991373.45438c",
        "name": "API Get Facts by RID",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/rulesrepo/factsandrules/{{{reporting_id}}}?DEBUG=true",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            }
        ],
        "x": 1280,
        "y": 1100,
        "wires": [
            [
                "29e5403351fd72d9"
            ]
        ]
    },
    {
        "id": "2a1010c6c72b92ee",
        "type": "ui_toast",
        "z": "67991373.45438c",
        "position": "top right",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "Show Job is submitted",
        "x": 3610,
        "y": 1180,
        "wires": []
    },
    {
        "id": "f87a1ec1239428aa",
        "type": "function",
        "z": "67991373.45438c",
        "name": "Job Submitted",
        "func": "msg.payload = 'Job Submitted at: '+ new Date().toLocaleString()\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3400,
        "y": 1080,
        "wires": [
            [
                "2a1010c6c72b92ee"
            ]
        ]
    },
    {
        "id": "4de57f6bb5f38231",
        "type": "http response",
        "z": "67991373.45438c",
        "name": "Send Response Back",
        "statusCode": "msg.statusCode",
        "headers": {
            "status": "200"
        },
        "x": 1640,
        "y": 1700,
        "wires": []
    },
    {
        "id": "2496a0361619e895",
        "type": "ui_button",
        "z": "67991373.45438c",
        "name": "",
        "group": "18a5a593fcd64912",
        "order": 2,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "Save Rules",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "Ready to Save Rules",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 1510,
        "y": 40,
        "wires": [
            [
                "097b7c36f8623668",
                "9cdda70a448f80e0"
            ]
        ]
    },
    {
        "id": "967038b5dc63123e",
        "type": "debug",
        "z": "67991373.45438c",
        "name": "debug 35",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2220,
        "y": 40,
        "wires": []
    },
    {
        "id": "9cdda70a448f80e0",
        "type": "function",
        "z": "67991373.45438c",
        "name": "getrules ready for saving from params file",
        "func": "let rules = flow.get(\"rules\")\nlet rA = []\nrules.map((r) => {\n    let name = (r.event.name || \"Dynamic Rule\") + \": \"+r.event.ruleId\n    let description = name\n    \n    r.event.ruleId = \"0\"\n    r.event.type = \"0\"\n    r.event.eventType = \"impute\"\n    \n    \n\n    rA.push({ parsed_rule: r, data: r, name, description, id: 0 })\n})\n\nmsg.payload = {data:rA}\n\n// Send it to the backend for future processing\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1940,
        "y": 40,
        "wires": [
            [
                "967038b5dc63123e",
                "14d9e7a93f3dd56a"
            ]
        ]
    },
    {
        "id": "14d9e7a93f3dd56a",
        "type": "http request",
        "z": "67991373.45438c",
        "name": "Post: Save an array of rules",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/rulesrepo/new/parsedrules/0",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            },
            {
                "keyType": "other",
                "keyValue": "DEBUG",
                "valueType": "other",
                "valueValue": "true"
            }
        ],
        "x": 2380,
        "y": 160,
        "wires": [
            [
                "3c39b274d9df5304"
            ]
        ]
    },
    {
        "id": "f880226b0a4c82d0",
        "type": "debug",
        "z": "67991373.45438c",
        "name": "debug 36",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2600,
        "y": 60,
        "wires": []
    },
    {
        "id": "cd36dc8de00aa79e",
        "type": "ui_toast",
        "z": "67991373.45438c",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "QBES Output",
        "name": "",
        "x": 3010,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "3c39b274d9df5304",
        "type": "function",
        "z": "67991373.45438c",
        "name": "Prepare notification for rules saved",
        "func": "msg.payload = \"Job Completed at \" + new Date().toLocaleString() + \"\\nSubmitted/Saved Rules: \" \n+ msg.payload.data.length +\"/\"\n+ msg.payload.rulesSaved.length\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2700,
        "y": 160,
        "wires": [
            [
                "cd36dc8de00aa79e",
                "f880226b0a4c82d0"
            ]
        ]
    },
    {
        "id": "097b7c36f8623668",
        "type": "ui_toast",
        "z": "67991373.45438c",
        "position": "top right",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "Cancel",
        "raw": true,
        "className": "",
        "topic": "QBES Output",
        "name": "",
        "x": 1670,
        "y": 100,
        "wires": []
    },
    {
        "id": "3134b3146429fc29",
        "type": "inject",
        "z": "67991373.45438c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3400,
        "y": 480,
        "wires": [
            [
                "bdf7069659cda7af"
            ]
        ]
    },
    {
        "id": "bdf7069659cda7af",
        "type": "function",
        "z": "67991373.45438c",
        "name": "Split RIDs array and prepare for QBES",
        "func": "\nmsg.payload = flow.get(\"reporting_id\") || []\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3650,
        "y": 480,
        "wires": [
            [
                "d8efd0a725820987"
            ]
        ]
    },
    {
        "id": "27cb39e661a5761a",
        "type": "delay",
        "z": "67991373.45438c",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 3950,
        "y": 540,
        "wires": [
            [
                "7f28fb8befeb2f38"
            ]
        ]
    },
    {
        "id": "7f28fb8befeb2f38",
        "type": "function",
        "z": "67991373.45438c",
        "name": "Iterate over each RID",
        "func": "\nlet reporting_id = msg.payload\nlet QBESpayload = flow.get(\"QBESPayload\")\nQBESpayload.reporting_id = parseInt(reporting_id)\n msg.payload = QBESpayload\n\n \nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4280,
        "y": 480,
        "wires": [
            [
                "2d31a9cbb8b25e8f",
                "d7f2fcd5e791ba92"
            ]
        ]
    },
    {
        "id": "d8efd0a725820987",
        "type": "split",
        "z": "67991373.45438c",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 3910,
        "y": 240,
        "wires": [
            [
                "27cb39e661a5761a"
            ]
        ]
    },
    {
        "id": "652ea1d3b066becc",
        "type": "debug",
        "z": "67991373.45438c",
        "name": "debug 45",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 4460,
        "y": 740,
        "wires": []
    },
    {
        "id": "5a1e132daec8024a",
        "type": "inject",
        "z": "2e37e573b3c922d6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"data\":[],\"message\":\"Submitting a job\",\"sentFrom\":\"QFlow\",\"sentTo\":\"Qbes\"}",
        "payloadType": "json",
        "x": 150,
        "y": 240,
        "wires": [
            [
                "a0412d3c94324572"
            ]
        ]
    },
    {
        "id": "a0412d3c94324572",
        "type": "http request",
        "z": "2e37e573b3c922d6",
        "name": "Post: ProcessRules ",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/notification",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            },
            {
                "keyType": "other",
                "keyValue": "DEBUG",
                "valueType": "other",
                "valueValue": "true"
            }
        ],
        "x": 330,
        "y": 240,
        "wires": [
            [
                "f93932c0230210fc"
            ]
        ]
    },
    {
        "id": "f93932c0230210fc",
        "type": "debug",
        "z": "2e37e573b3c922d6",
        "name": "debug 32",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 540,
        "y": 240,
        "wires": []
    },
    {
        "id": "a33d0b789237415b",
        "type": "http in",
        "z": "2e37e573b3c922d6",
        "name": "Qflow Notifications Receiving Post /qflow/notification",
        "url": "/qflow/notification",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 320,
        "y": 380,
        "wires": [
            [
                "cec8ed2593f9fd72",
                "f8840d14f1031c7a"
            ]
        ]
    },
    {
        "id": "cec8ed2593f9fd72",
        "type": "debug",
        "z": "2e37e573b3c922d6",
        "name": "debug Got data from QBES",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 540,
        "wires": []
    },
    {
        "id": "f8840d14f1031c7a",
        "type": "function",
        "z": "2e37e573b3c922d6",
        "name": "Save Events",
        "func": "// NK will set the submitted flow to null\n\n// flow.set(\"submitted\", null)\n// initialise the counter to 0 if it doesn't exist already\nvar notificationLog = context.get('notificationLog')|| [];\n// msg.payload.data = JSON.stringify(msg.payload.data)\nnotificationLog.push(msg.payload);\nif (notificationLog.length > 200){\n    // Delete oldest message if > 20\n    notificationLog.shift();\n    notificationLog.length = 200;\n} \n\ncontext.set('notificationLog', [])\n// store the value back\ncontext.set('notificationLog', notificationLog);\n\n// make it part of the outgoing msg object\nmsg = {};\n// msg.payload = {\n//     command: 'addData',\n//     arguments:[msg.payload]\n// }\n\nmsg.payload = [...notificationLog];\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 630,
        "y": 380,
        "wires": [
            [
                "27055eaf0324d25e"
            ]
        ]
    },
    {
        "id": "965096e09ca7c885",
        "type": "ui_toast",
        "z": "2e37e573b3c922d6",
        "position": "top right",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "QBES Output",
        "name": "",
        "x": 470,
        "y": 680,
        "wires": []
    },
    {
        "id": "01ad11cd828b155d",
        "type": "function",
        "z": "2e37e573b3c922d6",
        "name": "function 10",
        "func": "msg.payload = \"Job Completed at:\"+ new Date().toLocaleString()\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 680,
        "wires": [
            [
                "965096e09ca7c885"
            ]
        ]
    },
    {
        "id": "248ac488b1fb1009",
        "type": "ui_button",
        "z": "2e37e573b3c922d6",
        "name": "",
        "group": "48c415689cc2322d",
        "order": 4,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Reset Notifications",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-circle-o",
        "payload": "[]",
        "payloadType": "str",
        "topic": "",
        "topicType": "str",
        "x": 190,
        "y": 300,
        "wires": [
            [
                "187350ae70435f47"
            ]
        ]
    },
    {
        "id": "187350ae70435f47",
        "type": "function",
        "z": "2e37e573b3c922d6",
        "name": "Clear context set notificationLog to []",
        "func": "context.set('notificationLog', []);\nmsg.payload = []\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 300,
        "wires": [
            [
                "27055eaf0324d25e"
            ]
        ]
    },
    {
        "id": "27055eaf0324d25e",
        "type": "ui_table",
        "z": "2e37e573b3c922d6",
        "group": "48c415689cc2322d",
        "name": "Output",
        "order": 5,
        "width": 23,
        "height": 15,
        "columns": [
            {
                "field": "DEBUG",
                "title": "#",
                "width": "",
                "align": "left",
                "formatter": "rownum",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "data.id",
                "title": "JOBS ID",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "message",
                "title": "Message",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "sentFrom",
                "title": "Sent From",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "sentTo",
                "title": "Sent To",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 790,
        "y": 300,
        "wires": [
            [
                "751a113306f1cfd5"
            ]
        ]
    },
    {
        "id": "751a113306f1cfd5",
        "type": "debug",
        "z": "2e37e573b3c922d6",
        "name": "JOBS Output",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.data",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1040,
        "y": 300,
        "wires": []
    },
    {
        "id": "f3903be4e24d8dca",
        "type": "http request",
        "z": "d103860e993c1512",
        "g": "7dc18555ca029842",
        "name": "API call to validate",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/reporting_unit/{{{rid}}}/validate?DEBUG=true",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            }
        ],
        "x": 430,
        "y": 40,
        "wires": [
            [
                "999bbdaf976e7feb"
            ]
        ]
    },
    {
        "id": "97d2bd49cb3742bc",
        "type": "inject",
        "z": "d103860e993c1512",
        "g": "7dc18555ca029842",
        "name": "Validate RID Input",
        "props": [
            {
                "p": "rid",
                "v": "8771348140",
                "vt": "num"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "payload.type",
                "v": "validate",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "VALIDATE",
        "x": 190,
        "y": 40,
        "wires": [
            [
                "f3903be4e24d8dca",
                "d015bbe8f3761f7f"
            ]
        ]
    },
    {
        "id": "999bbdaf976e7feb",
        "type": "json",
        "z": "d103860e993c1512",
        "g": "7dc18555ca029842",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 590,
        "y": 40,
        "wires": [
            [
                "d529da54696a9982"
            ]
        ]
    },
    {
        "id": "d529da54696a9982",
        "type": "debug",
        "z": "d103860e993c1512",
        "g": "7dc18555ca029842",
        "name": "debug 4",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 40,
        "wires": []
    },
    {
        "id": "e5ca7c9975e3a6b5",
        "type": "comment",
        "z": "d103860e993c1512",
        "g": "d1e0f39ddacfeb20",
        "name": "Validate a specific Reporting ID with all rules",
        "info": "## ## Validate a specific Reporting ID with all rules",
        "x": 670,
        "y": 140,
        "wires": []
    },
    {
        "id": "d015bbe8f3761f7f",
        "type": "debug",
        "z": "d103860e993c1512",
        "g": "7dc18555ca029842",
        "name": "debug 8",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 440,
        "y": 80,
        "wires": []
    },
    {
        "id": "a52599d1e82370ad",
        "type": "inject",
        "z": "d103860e993c1512",
        "g": "5a28e866a67c90ec",
        "name": "Rule Generate from Free Text",
        "props": [
            {
                "p": "payload.conditionstring",
                "v": " What is the name, condition, compute as an array and message of the following rule and return it as a json:    Naveen:   I was talking to Patrick and he wanted another    rule name is \"IF the flag for hazardas materials is reported  and the NAICS is in 484\". It should have a rule priority of 5 on a scale of 1 to 10.   and condition is   substr(RECORD_NAICS_NUM, 1,3)== 484 and RCPT_MOTR_HAZRD_STAT == 1 and RCPT_MOTR_HAZRD_PCT == 0 if true then compute  RCPT_MOTR_HAZRD_STAT = 2  Send the message \"Hazardous Material rule fired\".  Do you think we could chat on this soon?  Thanks Amit",
                "vt": "str"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "AI",
        "x": 180,
        "y": 400,
        "wires": [
            [
                "3773a11cc06cd9db"
            ]
        ]
    },
    {
        "id": "3773a11cc06cd9db",
        "type": "http request",
        "z": "d103860e993c1512",
        "g": "5a28e866a67c90ec",
        "name": "Post AI Services",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/openai/aicomplete",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            }
        ],
        "x": 440,
        "y": 400,
        "wires": [
            [
                "6970f9e5cadfae30"
            ]
        ]
    },
    {
        "id": "f47d58da6a345fa9",
        "type": "debug",
        "z": "d103860e993c1512",
        "g": "5a28e866a67c90ec",
        "name": "debug 9",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.ruleName",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1060,
        "y": 400,
        "wires": []
    },
    {
        "id": "12d8ce370fc2153f",
        "type": "function",
        "z": "d103860e993c1512",
        "g": "5a28e866a67c90ec",
        "name": "Get RuleName",
        "func": "\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 400,
        "wires": [
            [
                "f47d58da6a345fa9"
            ]
        ]
    },
    {
        "id": "6970f9e5cadfae30",
        "type": "switch",
        "z": "d103860e993c1512",
        "g": "5a28e866a67c90ec",
        "name": "",
        "property": "payload.ruleName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 650,
        "y": 400,
        "wires": [
            [
                "12d8ce370fc2153f",
                "eee34fb243fcc025",
                "da904483e17171f2"
            ],
            []
        ]
    },
    {
        "id": "eee34fb243fcc025",
        "type": "debug",
        "z": "d103860e993c1512",
        "g": "5a28e866a67c90ec",
        "name": "Debug RuleName",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 480,
        "wires": []
    },
    {
        "id": "8764792a5250d529",
        "type": "comment",
        "z": "d103860e993c1512",
        "g": "5a28e866a67c90ec",
        "name": "Define AI end point. Pass free text",
        "info": "## # Open AI parse text",
        "x": 180,
        "y": 340,
        "wires": []
    },
    {
        "id": "2afe1b70382b1d3c",
        "type": "ui_toast",
        "z": "d103860e993c1512",
        "g": "5a28e866a67c90ec",
        "position": "top right",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 670,
        "y": 460,
        "wires": []
    },
    {
        "id": "da904483e17171f2",
        "type": "change",
        "z": "d103860e993c1512",
        "g": "5a28e866a67c90ec",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.ruleName",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 460,
        "wires": [
            [
                "2afe1b70382b1d3c"
            ]
        ]
    },
    {
        "id": "f0bda8ccf069c334",
        "type": "inject",
        "z": "d886a3864a88d832",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "508c4d88817d96f3",
        "type": "switch",
        "z": "d886a3864a88d832",
        "name": "1.0 Estab or KAU Switch",
        "property": "facts.level_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "d",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "e",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 310,
        "y": 60,
        "wires": [
            [],
            [],
            [
                "d457c366c48ae1e9"
            ]
        ]
    },
    {
        "id": "d457c366c48ae1e9",
        "type": "switch",
        "z": "d886a3864a88d832",
        "name": "2.0 Estab",
        "property": "facts.level_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "e",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 60,
        "wires": [
            [],
            [
                "48c251e7e1851bb1"
            ]
        ]
    },
    {
        "id": "1393263d0d520dfd",
        "type": "subflow:b99b7893add8c369",
        "z": "d886a3864a88d832",
        "name": "5.0 Logical Checks",
        "x": 1190,
        "y": 400,
        "wires": [
            [
                "22a7836fd0ee4876"
            ]
        ]
    },
    {
        "id": "22a7836fd0ee4876",
        "type": "subflow:27fccef587c0b218",
        "z": "d886a3864a88d832",
        "name": "6.0 Ratio/Range Testing",
        "x": 1210,
        "y": 480,
        "wires": [
            [
                "4242881485341267"
            ]
        ]
    },
    {
        "id": "4242881485341267",
        "type": "subflow:3fa869ffe40596e5",
        "z": "d886a3864a88d832",
        "name": "7.0 Post Ratio/Range",
        "x": 1200,
        "y": 540,
        "wires": [
            [
                "69135525ff74076e"
            ]
        ]
    },
    {
        "id": "69135525ff74076e",
        "type": "subflow:98b684914b5fce08",
        "z": "d886a3864a88d832",
        "name": "8.0 Unit Balance",
        "x": 1180,
        "y": 600,
        "wires": [
            [
                "f57362671b31528b"
            ]
        ]
    },
    {
        "id": "f57362671b31528b",
        "type": "subflow:2e55e3e8510e62d0",
        "z": "d886a3864a88d832",
        "name": "9.0 Company Additivity Check",
        "x": 1230,
        "y": 680,
        "wires": [
            [
                "66f76ef1f55de5b8"
            ]
        ]
    },
    {
        "id": "66f76ef1f55de5b8",
        "type": "subflow:2ad5fa373c21d0a3",
        "z": "d886a3864a88d832",
        "name": "10.0 Derived Items",
        "x": 1210,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "a0acac50eaa1f639",
        "type": "debug",
        "z": "d886a3864a88d832",
        "name": "debug 13",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1220,
        "y": 940,
        "wires": []
    },
    {
        "id": "48c251e7e1851bb1",
        "type": "subflow:045ba1012eb08b50",
        "z": "d886a3864a88d832",
        "name": "3.0 Determine Status",
        "x": 1200,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "3626fe7ffedf766a",
        "type": "inject",
        "z": "ae7e9f579855357c",
        "name": "Inject Worfklow ID",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SPAD",
        "payload": "29028",
        "payloadType": "num",
        "x": 130,
        "y": 40,
        "wires": [
            [
                "7a50cf774f7f5b56"
            ]
        ]
    },
    {
        "id": "98626aec5c5ae44f",
        "type": "ui_text_input",
        "z": "ae7e9f579855357c",
        "name": "Input Workflow ID",
        "label": "Workflow ID",
        "tooltip": "Enter a Workflow ID from the SPAD",
        "group": "48c415689cc2322d",
        "order": 2,
        "width": 7,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "7a50cf774f7f5b56"
            ]
        ]
    },
    {
        "id": "39fd1017ceb52b5b",
        "type": "ui_table",
        "z": "ae7e9f579855357c",
        "group": "440f78388bf9306a",
        "name": "Rules Repository",
        "order": 1,
        "width": 29,
        "height": "15",
        "columns": [
            {
                "field": "id",
                "title": "ID",
                "width": "10%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "type",
                "title": "Type",
                "width": "10%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "name",
                "title": "Description",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "conditions",
                "title": "Conditions",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "event",
                "title": "Event",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "active",
                "title": "Active",
                "width": "10%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "rvs",
                "title": "RV",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 1170,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "bfe5e89f0b386ed1",
        "type": "subflow:c5ce2d38887016b2",
        "z": "ae7e9f579855357c",
        "name": "",
        "x": 930,
        "y": 60,
        "wires": [
            [],
            [
                "9bce07e0bcd382ef",
                "39fd1017ceb52b5b"
            ]
        ]
    },
    {
        "id": "7a50cf774f7f5b56",
        "type": "http request",
        "z": "ae7e9f579855357c",
        "name": "Get Workflow by ID",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/spad/{{{payload}}}?DEBUG=true",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            }
        ],
        "x": 350,
        "y": 60,
        "wires": [
            [
                "b3a3ee5bc8d56868"
            ]
        ]
    },
    {
        "id": "b3a3ee5bc8d56868",
        "type": "function",
        "z": "ae7e9f579855357c",
        "name": "Get Facts from SPAD (WorkflowID)",
        "func": "msg.payload.facts = msg.payload.data[0].facts\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 60,
        "wires": [
            [
                "bfe5e89f0b386ed1"
            ]
        ]
    },
    {
        "id": "9526c76a9c6d970d",
        "type": "function",
        "z": "ae7e9f579855357c",
        "name": "Get Facts from DB",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 100,
        "wires": [
            [
                "bfe5e89f0b386ed1"
            ]
        ]
    },
    {
        "id": "7152a57907490b4f",
        "type": "function",
        "z": "ae7e9f579855357c",
        "name": "Get Facts from Spreadsheet",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 140,
        "wires": [
            [
                "bfe5e89f0b386ed1"
            ]
        ]
    },
    {
        "id": "9bce07e0bcd382ef",
        "type": "function",
        "z": "ae7e9f579855357c",
        "name": "Balancing",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "3e68d1dde251bd01",
        "type": "inject",
        "z": "908af5a748b37aba",
        "name": "Select RV",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SELECT-RV",
        "payload": "select  rvname as name, 'number' as type from response_variables;",
        "payloadType": "str",
        "x": 180,
        "y": 180,
        "wires": [
            [
                "25cd81b4ace00658"
            ]
        ]
    },
    {
        "id": "25cd81b4ace00658",
        "type": "function",
        "z": "908af5a748b37aba",
        "name": "function 1",
        "func": "msg.query = msg.payload\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "e22cfefc78836d2d",
        "type": "inject",
        "z": "908af5a748b37aba",
        "name": "Get Rules",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "GET-RULES",
        "payload": "  select id, name, description, active, type, rvs,    parsed_rule->>'event' as event ,   parsed_rule->>'conditions' as conditions,   (parsed_rule)::TEXT parsed_rule, data   from aies.rules_repository ",
        "payloadType": "str",
        "x": 180,
        "y": 120,
        "wires": [
            [
                "25cd81b4ace00658"
            ]
        ]
    },
    {
        "id": "61d9fb3b9c7c1d2d",
        "type": "http request",
        "z": "908af5a748b37aba",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://localhost/reporting_unit/8771348140/validate?DEBUG=true",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            }
        ],
        "x": 510,
        "y": 600,
        "wires": [
            [
                "2d03d52f5ca730a3"
            ]
        ]
    },
    {
        "id": "bbfa3ae528fd43ea",
        "type": "inject",
        "z": "908af5a748b37aba",
        "name": "CALL Validation GET",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "VALIDATE",
        "payload": "",
        "payloadType": "date",
        "x": 310,
        "y": 600,
        "wires": [
            [
                "61d9fb3b9c7c1d2d"
            ]
        ]
    },
    {
        "id": "2d03d52f5ca730a3",
        "type": "json",
        "z": "908af5a748b37aba",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 670,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "44ef1682.4b53e8",
        "type": "function",
        "z": "908af5a748b37aba",
        "name": "",
        "func": "msg.payload = '<iframe src=\"http://localhost:8080/#/home\" width = \"1200\" height = \"800\"  frameborder = \"0\" ></iframe >';\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "c99d37ca.90db78",
        "type": "ui_template",
        "z": "908af5a748b37aba",
        "group": "24e6f02ee5d4fe37",
        "name": "",
        "order": 3,
        "width": "13",
        "height": "8",
        "format": "<div ng-bind-html=\"msg.payload\"></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 630,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "80e5e88.32ed218",
        "type": "inject",
        "z": "908af5a748b37aba",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "http://localhost:8080/#/home",
        "payloadType": "str",
        "x": 230,
        "y": 1140,
        "wires": [
            [
                "44ef1682.4b53e8"
            ]
        ]
    },
    {
        "id": "4f32304b9c4675fc",
        "type": "ui_table",
        "z": "908af5a748b37aba",
        "group": "18e6e44c.b0561c",
        "name": "Rules Repository",
        "order": 3,
        "width": "14",
        "height": "4",
        "columns": [
            {
                "field": "id",
                "title": "ID",
                "width": "10%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "type",
                "title": "Type",
                "width": "10%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "name",
                "title": "Description",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "conditions",
                "title": "Conditions",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "event",
                "title": "Event",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "active",
                "title": "Active",
                "width": "10%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "rvs",
                "title": "RV",
                "width": "30%",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 690,
        "y": 260,
        "wires": [
            [
                "1f1180ec80919248"
            ]
        ]
    },
    {
        "id": "07687bc8cc1240b6",
        "type": "function",
        "z": "908af5a748b37aba",
        "name": "function 2",
        "func": "msg.payload = msg.payload.rows\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 260,
        "wires": [
            [
                "4f32304b9c4675fc"
            ]
        ]
    },
    {
        "id": "1f1180ec80919248",
        "type": "ui_form",
        "z": "908af5a748b37aba",
        "name": "Edit Rule",
        "label": "",
        "group": "24e6f02ee5d4fe37",
        "order": 4,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Name",
                "value": "name",
                "type": "text",
                "required": true,
                "rows": null
            },
            {
                "label": "Description",
                "value": "description",
                "type": "text",
                "required": false,
                "rows": null
            },
            {
                "label": "Active",
                "value": "active",
                "type": "text",
                "required": true,
                "rows": null
            },
            {
                "label": "Variables",
                "value": "rvs",
                "type": "text",
                "required": false,
                "rows": null
            },
            {
                "label": "Event",
                "value": "event",
                "type": "multiline",
                "required": true,
                "rows": 3
            },
            {
                "label": "Conditions",
                "value": "conditions",
                "type": "multiline",
                "required": false,
                "rows": 3
            },
            {
                "label": "DATA",
                "value": "data",
                "type": "text",
                "required": false,
                "rows": null
            }
        ],
        "formValue": {
            "name": "",
            "description": "",
            "active": "",
            "rvs": "",
            "event": "",
            "conditions": "",
            "data": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "cancel",
        "topic": "topic",
        "topicType": "msg",
        "splitLayout": true,
        "className": "",
        "x": 880,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "abe91f1e.21df",
        "type": "debug",
        "z": "c702b495.9cc2f8",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "x": 1050,
        "y": 120,
        "wires": []
    },
    {
        "id": "87b5b844.5719b8",
        "type": "inject",
        "z": "c702b495.9cc2f8",
        "name": "Input: Validate RID ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "8771348140",
        "payloadType": "num",
        "x": 130,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "2bb5276.49b45d8",
        "type": "http request",
        "z": "c702b495.9cc2f8",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://localhost/reporting_unit/{{{rid}}}/validate",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            },
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoor"
            }
        ],
        "x": 630,
        "y": 120,
        "wires": [
            [
                "178d7efeebb1045e",
                "21a1c9af.ba91a6"
            ]
        ]
    },
    {
        "id": "c775ecaa.a9813",
        "type": "function",
        "z": "c702b495.9cc2f8",
        "name": "Set HTTP Get Variable",
        "func": "// msg.rid = msg.req.params.rid\nmsg.limit = 100;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 240,
        "wires": [
            [
                "2bb5276.49b45d8"
            ]
        ]
    },
    {
        "id": "178d7efeebb1045e",
        "type": "json",
        "z": "c702b495.9cc2f8",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 810,
        "y": 60,
        "wires": [
            [
                "abe91f1e.21df",
                "fd7db6633a9cb081"
            ]
        ]
    },
    {
        "id": "8bc8887358552ee6",
        "type": "http in",
        "z": "c702b495.9cc2f8",
        "name": "",
        "url": "/validate/:rid",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "fd7db6633a9cb081",
        "type": "http response",
        "z": "c702b495.9cc2f8",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1070,
        "y": 220,
        "wires": []
    },
    {
        "id": "49d75074.37303",
        "type": "function",
        "z": "c702b495.9cc2f8",
        "name": "Assigning rid in msg",
        "func": "msg.rid=global.get('rid') ;\n// msg.b=global.get('b') ;\nmsg.payload = msg.rid\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 360,
        "wires": [
            [
                "c775ecaa.a9813"
            ]
        ]
    },
    {
        "id": "1373611.8d85b9f",
        "type": "inject",
        "z": "c702b495.9cc2f8",
        "name": "Initial Value",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "33",
        "payloadType": "num",
        "x": 170,
        "y": 480,
        "wires": [
            [
                "29981141.09dd9e"
            ]
        ]
    },
    {
        "id": "29981141.09dd9e",
        "type": "ui_text_input",
        "z": "c702b495.9cc2f8",
        "d": true,
        "name": "rid",
        "label": "Enter Reporting ID",
        "tooltip": "3449842849",
        "group": "1f48566b.e8958a",
        "order": 2,
        "width": 6,
        "height": 3,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "validate",
        "sendOnBlur": true,
        "className": "",
        "topicType": "str",
        "x": 390,
        "y": 480,
        "wires": [
            [
                "7894de12.4ed5f"
            ]
        ]
    },
    {
        "id": "7894de12.4ed5f",
        "type": "function",
        "z": "c702b495.9cc2f8",
        "name": "Store to Global Variable rid",
        "func": "global.set('rid',msg.payload);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "21a1c9af.ba91a6",
        "type": "ui_text",
        "z": "c702b495.9cc2f8",
        "d": true,
        "group": "1f48566b.e8958a",
        "order": 9,
        "width": 23,
        "height": 9,
        "name": "",
        "label": "Result",
        "format": "{{msg.payload}} ",
        "layout": "row-spread",
        "className": "",
        "x": 990,
        "y": 440,
        "wires": []
    },
    {
        "id": "d433feb1.6365e",
        "type": "http in",
        "z": "7d4690e10f209584",
        "name": "",
        "url": "/index",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 100,
        "y": 160,
        "wires": [
            [
                "98b6cece.37871"
            ]
        ]
    },
    {
        "id": "98b6cece.37871",
        "type": "template",
        "z": "7d4690e10f209584",
        "name": "web-template",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n   <head>\n      <!-- The jQuery library is a prerequisite for all jqSuite products -->\n      <script type=\"text/ecmascript\" src=\"http://www.guriddo.net/demo/js/jquery.min.js\"></script> \n      <!-- We support more than 40 localizations -->\n      <script type=\"text/ecmascript\" src=\"http://www.guriddo.net/demo/js/trirand/i18n/grid.locale-en.js\"></script>\n      <!-- This is the Javascript file of jqGrid -->   \n      <script type=\"text/ecmascript\" src=\"http://www.guriddo.net/demo/js/trirand/jquery.jqGrid.min.js\"></script>\n      <!-- This is the localization file of the grid controlling messages, labels, etc.\n      <!-- A link to a jQuery UI ThemeRoller theme, more than 22 built-in and many more custom -->\n      <link rel=\"stylesheet\" type=\"text/css\" media=\"screen\" href=\"http://struts.jgeppert.com/struts2-jquery-grid-showcase/themes/showcase/jquery-ui.css\" />\n      <!-- The link to the CSS that the grid needs -->\n      <link rel=\"stylesheet\" type=\"text/css\" media=\"screen\" href=\"http://www.guriddo.net/demo/css/trirand/ui.jqgrid.css\" />\n      <meta charset=\"utf-8\" />\n      <title>Demo CRUD with jqGrid</title>\n      <script type=\"text/javascript\"></script>\n      <link rel=\"stylesheet\" type=\"text/css\" href=\"http://www.guriddo.net/B1D671CF-E532-4481-99AA-19F420D90332/netdefender/hui/ndhui.css\" />\n   </head>\n   <body>\n      <script type=\"text/javascript\" language=\"javascript\" src=\"http://www.guriddo.net/B1D671CF-E532-4481-99AA-19F420D90332/netdefender/hui/ndhui.js?0=0&0=0&0=0\"></script>\n      <table id=\"jqGrid\"></table>\n      <div id=\"jqGridPager\"></div>\n      <script type=\"text/javascript\"> \n         $(document).ready(function () {\n             $(\"#jqGrid\").jqGrid({\n                 url: '/search',\n                 mtype: \"GET\",\n                 datatype: \"json\",\n                 colModel: [\n                     { label: 'ID', name: 'id', key: true, search: false, width: 75 },\n                     { label: 'Name', name: 'name', width: 150, editable: true, formoptions: { colpos: 1, rowpos: 1 }  },\n                     { label: 'Last Name', name: 'lastname', width: 150, editable: true, edittype: \"select\", formoptions: { colpos: 1, rowpos: 2 },\n                       editoptions: {\n                            dataUrl:'/search/lastname',\n                            type:\"GET\",\n                            buildSelect: function(data) {\n                                var response = jQuery.parseJSON(data); //JSON data\n                                var s = '<select>';\n                                if (response && response.length) {\n                                    s += '<option hidden=\"true\">--- Select Lastname ---</option>';\n                                    for (var i = 0, l=response.length; i<l ; i++) {\n                                    var id = response[i].id;\n                                    var val = response[i].value; \n                                    // You can concatenate ID or any other string here\n                                    //For example: var ri = response[i].id + response[i].value; \n                                        s += '<option value=\"'+id+'\">'+val+'</option>';\n                                    }\n                                }\n                                return s + \"</select>\";\n                            } \n                         } \n                     },\n                     { label: 'Code', name: 'code', width: 150, editable: true, formoptions: { colpos: 2, rowpos: 1 } },  \n                     { label: 'Married', name: 'married', width: 150, align: \"center\", search: false, editable: true, edittype: \"checkbox\", formatter: \"checkbox\", editoptions: { value: \"1:0\" }, formoptions: { colpos: 2, rowpos: 2 } }\n                 ],\n                 width: 500,\n                 height: 260,\n                 rowNum: 10,\n                 loadonce: true,\n                 viewrecords: true,\n                 pager: \"#jqGridPager\"\n             });\n             \n             $('#jqGrid').navGrid('#jqGridPager',\n                 // The buttons to appear on the toolbar of the grid\n                 { edit: true, add: true, del: true, search: true, refresh: true, view: true, position: \"left\", cloneToTop: true },\n                 \n                 // Options for the Edit Dialog\n                 {\n                     url: '/update',\n                     editCaption: \"The Edit Dialog\",\n                     recreateForm: true,\n\t\t\t\t\t //checkOnUpdate : true,\n\t\t\t\t\t //checkOnSubmit : true,\n\t\t\t\t\t beforeSubmit : function( postdata, form , oper) {\n\t\t\t\t\t\t if(confirm('Are you sure you want to update this information?') ) {\n\t\t\t\t\t\t\t // Do something\n\t\t\t\t\t\t \t return [true,'/update'];\n\t\t\t\t\t\t } else {\n\t\t\t\t\t\t\treturn [false, 'Update failed!'];\n\t\t\t\t\t\t }\n\t\t\t\t\t },\n                     afterSubmit: function () {\n                         $(this).jqGrid(\"setGridParam\", {datatype: 'json'});\n                         return [true];\n                     },\n                     closeAfterEdit: true,\n                     errorTextFormat: function (data) {\n                         return 'Error: ' + data.responseText\n                     }\n                 },\n                 // Options for the Add Dialog\n                 {\n                     url: '/insert',\n                     addCaption: \"Add Dialog\",\n                     afterSubmit: function () {\n                         $(this).jqGrid(\"setGridParam\", {datatype: 'json'});\n                         return [true];\n                     },\n                     closeAfterAdd: true,\n                     recreateForm: true,\n                     errorTextFormat: function (data) {\n                         return 'Error: ' + data.responseText\n                     }\n                 },\n                 // Options for the Delete Dialog\n                 {   \n                     url: '/delete',\n                     errorTextFormat: function (data) {\n                         return 'Error: ' + data.responseText\n                     }\n             });\n             $(\"#jqGrid\").jqGrid('filterToolbar', { stringResult: true, searchOnEnter: true });\n         });\n      </script>\n   </body>\n</html>",
        "output": "str",
        "x": 360,
        "y": 160,
        "wires": [
            [
                "3c1830eb.33b9"
            ]
        ]
    },
    {
        "id": "3c1830eb.33b9",
        "type": "http response",
        "z": "7d4690e10f209584",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1080,
        "y": 160,
        "wires": []
    },
    {
        "id": "ef285826.0e9738",
        "type": "http in",
        "z": "7d4690e10f209584",
        "name": "",
        "url": "/search",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 220,
        "wires": [
            [
                "e396f56a.dcda38"
            ]
        ]
    },
    {
        "id": "e396f56a.dcda38",
        "type": "function",
        "z": "7d4690e10f209584",
        "name": "search-query",
        "func": "//msg.topic=\"SELECT CONCAT('M00','',test.id) AS id,test.name AS name,lastname.lastname AS lastname,test.code AS code,test.married AS married FROM test INNER JOIN lastname ON lastname.id = test.lastname ORDER BY test.id DESC\";\nmsg.query=\"SELECT * from response_variables  order by rvname\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 220,
        "wires": [
            [
                "37bbae99e2515339"
            ]
        ]
    },
    {
        "id": "458b0528.a4d98c",
        "type": "http response",
        "z": "7d4690e10f209584",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1080,
        "y": 220,
        "wires": []
    },
    {
        "id": "d84f16f7.3d9698",
        "type": "function",
        "z": "7d4690e10f209584",
        "name": "search-response",
        "func": "return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 745,
        "y": 220,
        "wires": [
            [
                "2b952c3a.f63884",
                "054e18b51109bc59"
            ]
        ]
    },
    {
        "id": "2b952c3a.f63884",
        "type": "json",
        "z": "7d4690e10f209584",
        "name": "",
        "property": "payload.rows",
        "action": "",
        "pretty": false,
        "x": 930,
        "y": 220,
        "wires": [
            [
                "458b0528.a4d98c"
            ]
        ]
    },
    {
        "id": "c91568f0.c3f2f8",
        "type": "http in",
        "z": "7d4690e10f209584",
        "name": "",
        "url": "/insert",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 340,
        "wires": [
            [
                "81bb8cdf.93e5b"
            ]
        ]
    },
    {
        "id": "e4b82091.b8e9a",
        "type": "function",
        "z": "7d4690e10f209584",
        "name": "insert-response",
        "func": "msg.payload=msg.result;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 735,
        "y": 340,
        "wires": [
            [
                "c224cbcf.e3e718"
            ]
        ]
    },
    {
        "id": "81bb8cdf.93e5b",
        "type": "function",
        "z": "7d4690e10f209584",
        "name": "insert-query",
        "func": "msg.topic=\"INSERT INTO test (name,lastname,code,married,timestamp) VALUES ('\" + msg.payload.name + \"','\" + msg.payload.lastname + \"','\" + msg.payload.code + \"','\" + msg.payload.married + \"',CURRENT_TIMESTAMP)\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 350,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "c224cbcf.e3e718",
        "type": "http response",
        "z": "7d4690e10f209584",
        "name": "",
        "x": 1080,
        "y": 340,
        "wires": []
    },
    {
        "id": "9929a22b.66471",
        "type": "function",
        "z": "7d4690e10f209584",
        "name": "lastname-query",
        "func": "msg.topic=\"SELECT id, lastname as value FROM lastname\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "4bfc0ef6.e8511",
        "type": "function",
        "z": "7d4690e10f209584",
        "name": "lastname-response",
        "func": "return msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 745,
        "y": 280,
        "wires": [
            [
                "7b9f8d8b.c6d4e4"
            ]
        ]
    },
    {
        "id": "c70c0833.831ab8",
        "type": "http in",
        "z": "7d4690e10f209584",
        "name": "",
        "url": "/search/lastname",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 280,
        "wires": [
            [
                "9929a22b.66471"
            ]
        ]
    },
    {
        "id": "f92b07.fa8e84f8",
        "type": "http response",
        "z": "7d4690e10f209584",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1080,
        "y": 280,
        "wires": []
    },
    {
        "id": "7b9f8d8b.c6d4e4",
        "type": "json",
        "z": "7d4690e10f209584",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 930,
        "y": 280,
        "wires": [
            [
                "f92b07.fa8e84f8"
            ]
        ]
    },
    {
        "id": "857ff60c.da9078",
        "type": "http in",
        "z": "7d4690e10f209584",
        "name": "",
        "url": "/delete",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 460,
        "wires": [
            [
                "5b19502.0bae0b"
            ]
        ]
    },
    {
        "id": "9a8b3fa.c0817c",
        "type": "function",
        "z": "7d4690e10f209584",
        "name": "delete-response",
        "func": "msg.payload=msg.result;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 735,
        "y": 460,
        "wires": [
            [
                "4520409.a2751c"
            ]
        ]
    },
    {
        "id": "5b19502.0bae0b",
        "type": "function",
        "z": "7d4690e10f209584",
        "name": "delete-query",
        "func": "msg.topic=\"DELETE FROM test WHERE id='\" + msg.payload.id + \"'\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 350,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "4520409.a2751c",
        "type": "http response",
        "z": "7d4690e10f209584",
        "name": "",
        "x": 1080,
        "y": 460,
        "wires": []
    },
    {
        "id": "b9aef47c.8f0938",
        "type": "http in",
        "z": "7d4690e10f209584",
        "name": "",
        "url": "/update",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 400,
        "wires": [
            [
                "930f03c1.94bd5"
            ]
        ]
    },
    {
        "id": "ece93a93.ebc878",
        "type": "function",
        "z": "7d4690e10f209584",
        "name": "update-response",
        "func": "msg.payload=msg.result;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 745,
        "y": 400,
        "wires": [
            [
                "e51fe384.1db73"
            ]
        ]
    },
    {
        "id": "930f03c1.94bd5",
        "type": "function",
        "z": "7d4690e10f209584",
        "name": "update-query",
        "func": "msg.topic=\"UPDATE test SET name='\" + msg.payload.name + \"', lastname='\" + msg.payload.lastname + \"', code='\" + msg.payload.code + \"', married='\" + msg.payload.married + \"' WHERE id='\" + msg.payload.id + \"'\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 350,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "e51fe384.1db73",
        "type": "http response",
        "z": "7d4690e10f209584",
        "name": "",
        "x": 1080,
        "y": 400,
        "wires": []
    },
    {
        "id": "37bbae99e2515339",
        "type": "digitaloak-postgresql-query",
        "z": "7d4690e10f209584",
        "d": true,
        "name": "PG-AIES",
        "server": "ea3e0b5d6b96f47a",
        "inputs": 1,
        "outputs": 1,
        "x": 540,
        "y": 220,
        "wires": [
            [
                "d84f16f7.3d9698"
            ]
        ]
    },
    {
        "id": "054e18b51109bc59",
        "type": "debug",
        "z": "7d4690e10f209584",
        "name": "debug 6",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 80,
        "wires": []
    },
    {
        "id": "ee4d312b.cc342",
        "type": "ui_template",
        "z": "7d4690e10f209584",
        "group": "18e6e44c.b0561c",
        "name": "Search Sortable Table",
        "order": 1,
        "width": "0",
        "height": "0",
        "format": "<style>\n\n<!--\n{\n      \"rvid\": \"165\",\n      \"rvname\": \"ACTV_MIO\",\n      \"mu_flag\": \"YES\",\n      \"kau_flag\": \"YES\",\n      \"estab_flag\": \"YES\",\n      \"rv_description\": \"Active months in operation - STG\",\n      \"qdm_flag\": \"YES\",\n      \"data_type\": \"STRING\",\n      \"visible\": \"1\",\n      \"created_by\": \"DATALOAD\",\n      \"created_date\": \"2022-05-23T15:49:23.000Z\",\n      \"last_modified_by\": \"faker001\",\n      \"last_modified_date\": \"2022-08-16T20:58:59.000Z\",\n      \"variable_type_id\": \"2\",\n      \"control_group_id\": \"22\"\n    },\n\n\n  -->\ntable {\n    color: #333;\n    font-family: Helvetica, Arial, sans-serif;\n    width: 100%;\n    border-collapse: collapse;\n    border-spacing: 0;\n}\ntd, th {\n    border: 1px solid transparent;\n    /* No more visible border */\n    height: 30px;\n    transition: all 0.3s;\n    /* Simple transition for hover effect */\n}\nth {\n    background: #DFDFDF;\n    /* Darken header a bit */\n    font-weight: bold;\n}\ntd {\n    background: #FAFAFA;\n}\n\n/* Cells in even rows (2,4,6...) are one color */\n\ntr:nth-child(even) td {\n    background: #F1F1F1;\n}\n\n/* Cells in odd rows (1,3,5...) are another (excludes header cells)  */\n\ntr:nth-child(odd) td {\n    background: #FEFEFE;\n}\ntr td:hover {\n    background: #666;\n    color: #FFF;\n}\n\n/* Hover cell effect! */\n    \n.animate-enter, \n.animate-leave\n{ \n    -webkit-transition: 400ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n    -moz-transition: 400ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n    -ms-transition: 400ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n    -o-transition: 400ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n    transition: 400ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n    position: relative;\n    display: block;\n} \n\n.animate-enter.animate-enter-active, \n.animate-leave {\n    opacity: 1;\n    top: 0;\n    height: 30px;\n}\n\n.animate-leave.animate-leave-active,\n.animate-enter {\n    opacity: 0;\n    top: -50px;\n    height: 0px;\n}\n    \n.container\n{\n    max-height: 450px;\n    overflow-y: scroll;\n    overflow-x: hidden;\n}\n</style>\n\n<div>\n     <form>\n      <span class=\"input-group\">\n          <i class=\"fa fa-search\"></i>\n        <input type=\"text\" class=\"form-control\" placeholder=\"Search\" ng-model=\"search\">\n      </span>      \n  </form>\n  <div class=\"container\" ng-app=\"sortApp\">\n\n      <table>\n        <thead>\n        <tr style=\"width:100%\">\n            <td>\n          <a href=\"#\">\n            Index\n          </a>\n        </td>\n        <td>\n          <a href=\"#\" ng-click=\"sortType = 'firstname'; sortReverse = !sortReverse\">\n            First Name \n            <span ng-show=\"sortType == 'firstname' && !sortReverse\" class=\"fa fa-caret-down\"></span>\n            <span ng-show=\"sortType == 'firstname' && sortReverse\" class=\"fa fa-caret-up\"></span>\n          </a>\n        </td>\n        <td>\n          <a href=\"#\" ng-click=\"sortType = 'lastname'; sortReverse = !sortReverse\">\n          Last Name \n            <span ng-show=\"sortType == 'lastname' && !sortReverse\" class=\"fa fa-caret-down\"></span>\n            <span ng-show=\"sortType == 'lastname' && sortReverse\" class=\"fa fa-caret-up\"></span>\n          </a>\n        </td>\n        <td>\n          <a href=\"#\" ng-click=\"sortType = '(age -0)'; sortReverse = !sortReverse\">\n            Age\n            <span ng-show=\"sortType == '(age -0)' && !sortReverse\" class=\"fa fa-caret-down\"></span>\n            <span ng-show=\"sortType == '(age -0)' && sortReverse\" class=\"fa fa-caret-up\"></span>\n          </a>\n        </td>\n\n          </tr>\n          </thead>\n          <tbody>\n        <tr ng-repeat=\"user in msg.options | orderBy:sortType:sortReverse | filter:search track by $index\" ng-click=\"msg.payload = user;send(msg);\" style=\"width:100%\" flex>\n                <td><b ng-bind=\"$index+1\"></b></td>\n               <td ng-bind=\"user.firstname\"></td>\n               <td ng-bind=\"user.lastname\"></td>\n               <td ng-bind=\"user.age\"></td>\n         </tr>\n        </tbody>\n      </table>\n\n</div>\n</div>\n</body></html>",
        "storeOutMessages": true,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 600,
        "y": 640,
        "wires": [
            [
                "e91124.de6c3ee"
            ]
        ]
    },
    {
        "id": "a60a7430.d10bd8",
        "type": "inject",
        "z": "7d4690e10f209584",
        "name": "Go",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "1",
        "payloadType": "str",
        "x": 210,
        "y": 640,
        "wires": [
            [
                "bece8dfc.55e45"
            ]
        ]
    },
    {
        "id": "e91124.de6c3ee",
        "type": "debug",
        "z": "7d4690e10f209584",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 830,
        "y": 640,
        "wires": []
    },
    {
        "id": "bece8dfc.55e45",
        "type": "change",
        "z": "7d4690e10f209584",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "options",
                "pt": "msg",
                "to": "[{\"firstname\":\"Paul\",\"lastname\":\"Doe\",\"age\":24},{\"firstname\":\"Greg\",\"lastname\":\"Jones\",\"age\":31},{\"firstname\":\"Able\",\"lastname\":\"Smith\",\"age\":29}]",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 380,
        "y": 640,
        "wires": [
            [
                "ee4d312b.cc342"
            ]
        ]
    },
    {
        "id": "3aece19508694869",
        "type": "ui_button",
        "z": "4821a41b2fd327fb",
        "name": "Button",
        "group": "d68e7be3.88f088",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Button",
        "tooltip": "",
        "color": "#fffff",
        "bgcolor": "",
        "icon": "fa-star",
        "payload": "true",
        "payloadType": "bool",
        "topic": "Button",
        "x": 150,
        "y": 100,
        "wires": [
            [
                "71ec6c626243f535"
            ]
        ]
    },
    {
        "id": "bb213dd9d74c4713",
        "type": "ui_dropdown",
        "z": "4821a41b2fd327fb",
        "name": "Choice",
        "label": "Choose what you want ",
        "tooltip": "",
        "place": "",
        "group": "d68e7be3.88f088",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "options": [
            {
                "label": "Choice 1 : String",
                "value": "String",
                "type": "str"
            },
            {
                "label": "Choice 2 : Number",
                "value": 4,
                "type": "num"
            },
            {
                "label": "Choice 3 :Boolean",
                "value": true,
                "type": "bool"
            }
        ],
        "payload": "",
        "topic": "Choice ",
        "x": 160,
        "y": 140,
        "wires": [
            [
                "71ec6c626243f535"
            ]
        ]
    },
    {
        "id": "bfd61d2bb51bb7d3",
        "type": "debug",
        "z": "4821a41b2fd327fb",
        "name": "Dashboard Log",
        "active": false,
        "tosidebar": true,
        "console": false,
        "complete": "payload",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 200,
        "wires": []
    },
    {
        "id": "e6fb6f269c616c1e",
        "type": "ui_switch",
        "z": "4821a41b2fd327fb",
        "name": "Light Switch",
        "label": "switch",
        "tooltip": "",
        "group": "d68e7be3.88f088",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "Light Switch ",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 150,
        "y": 180,
        "wires": [
            [
                "71ec6c626243f535"
            ]
        ]
    },
    {
        "id": "e666116ddc314a9d",
        "type": "ui_slider",
        "z": "4821a41b2fd327fb",
        "name": "Slider",
        "label": "slider",
        "tooltip": "",
        "group": "d68e7be3.88f088",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "all",
        "topic": "Slider",
        "min": 0,
        "max": 10,
        "step": 1,
        "x": 170,
        "y": 220,
        "wires": [
            [
                "71ec6c626243f535"
            ]
        ]
    },
    {
        "id": "d6620b9a7fdd152f",
        "type": "ui_numeric",
        "z": "4821a41b2fd327fb",
        "name": "",
        "label": "numeric",
        "tooltip": "",
        "group": "d68e7be3.88f088",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "Numérique",
        "format": "{{value}}",
        "min": 0,
        "max": 10,
        "step": "",
        "x": 160,
        "y": 260,
        "wires": [
            [
                "71ec6c626243f535"
            ]
        ]
    },
    {
        "id": "f3c2c582f77fb627",
        "type": "ui_text_input",
        "z": "4821a41b2fd327fb",
        "name": "",
        "label": "Text Entry Field ",
        "tooltip": "",
        "group": "d68e7be3.88f088",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "Text Entry Feild",
        "x": 140,
        "y": 300,
        "wires": [
            [
                "71ec6c626243f535"
            ]
        ]
    },
    {
        "id": "c053339d3d485845",
        "type": "ui_form",
        "z": "4821a41b2fd327fb",
        "name": "",
        "label": "Form in Node-RED ",
        "group": "54bca71e.4287f",
        "order": 0,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Name",
                "value": "Name",
                "type": "text",
                "required": true
            },
            {
                "label": "Number",
                "value": "Number",
                "type": "number",
                "required": false
            },
            {
                "label": "Email",
                "value": "Email",
                "type": "email",
                "required": false
            },
            {
                "label": "Password",
                "value": "Password",
                "type": "password",
                "required": false
            },
            {
                "label": "Check Box",
                "value": "Check Box",
                "type": "checkbox",
                "required": false
            },
            {
                "label": "Light Switch",
                "value": "Light Switch",
                "type": "switch",
                "required": false
            }
        ],
        "formValue": {
            "Name": "",
            "Number": "",
            "Email": "",
            "Password": "",
            "Check Box": false,
            "Light Switch": false
        },
        "payload": "",
        "submit": "Submit",
        "cancel": "Cancle",
        "topic": "Form",
        "x": 130,
        "y": 460,
        "wires": [
            [
                "71ec6c626243f535"
            ]
        ]
    },
    {
        "id": "71ec6c626243f535",
        "type": "function",
        "z": "4821a41b2fd327fb",
        "name": "Save Events",
        "func": "\n// initialise the counter to 0 if it doesn't exist already\nvar dashboardLog = context.get('dashboardLog')|| [];\n\ndashboardLog.push(msg);\nif (dashboardLog.length > 20){\n    // Delete oldest message if > 20\n    dashboardLog.shift();\n    dashboardLog.length = 20;\n} \n\n\n// store the value back\ncontext.set('dashboardLog',dashboardLog);\n\n// make it part of the outgoing msg object\nmsg = {};\nmsg.payload = dashboardLog;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 450,
        "y": 260,
        "wires": [
            [
                "bfd61d2bb51bb7d3",
                "2851e691d3bfa1a6"
            ]
        ]
    },
    {
        "id": "2851e691d3bfa1a6",
        "type": "ui_template",
        "z": "4821a41b2fd327fb",
        "group": "785c383535b14b7d",
        "name": "Dashboard Event Log ",
        "order": 1,
        "width": "8",
        "height": "10",
        "format": "<ul>\n <li ng-repeat=\"x in msg.payload\">\n <font color=\"red\">{{x.topic}}</font>\n    <ul>\n        <li>{{x.payload}}</li>\n    </ul>\n </li>\n</ul>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 780,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "971963f55e94c5ec",
        "type": "ui_text_input",
        "z": "4821a41b2fd327fb",
        "name": "",
        "label": "Email Field",
        "tooltip": "",
        "group": "d68e7be3.88f088",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "email",
        "delay": 300,
        "topic": "Email Field",
        "x": 150,
        "y": 340,
        "wires": [
            [
                "71ec6c626243f535"
            ]
        ]
    },
    {
        "id": "3cc9c2ca3da31eef",
        "type": "ui_text_input",
        "z": "4821a41b2fd327fb",
        "name": "",
        "label": "Password Field",
        "tooltip": "",
        "group": "d68e7be3.88f088",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "password",
        "delay": 300,
        "topic": "Password ",
        "x": 140,
        "y": 380,
        "wires": [
            [
                "71ec6c626243f535"
            ]
        ]
    },
    {
        "id": "864b89d6485ddac4",
        "type": "ui_text_input",
        "z": "4821a41b2fd327fb",
        "name": "",
        "label": "Select a color",
        "tooltip": "",
        "group": "d68e7be3.88f088",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "color",
        "delay": 300,
        "topic": "Select a color",
        "x": 140,
        "y": 420,
        "wires": [
            [
                "71ec6c626243f535"
            ]
        ]
    },
    {
        "id": "cffb599fd51d0200",
        "type": "http in",
        "z": "813a171cf0470b24",
        "name": "Test Input Point",
        "url": "/test",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 220,
        "y": 140,
        "wires": [
            [
                "3cc51bee5b3acd4c"
            ]
        ]
    },
    {
        "id": "0d49c1e77a91ecc4",
        "type": "debug",
        "z": "813a171cf0470b24",
        "name": "debug 24",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 140,
        "wires": []
    },
    {
        "id": "3cc51bee5b3acd4c",
        "type": "function",
        "z": "813a171cf0470b24",
        "name": "function 6",
        "func": "msg.payload = \"Service called\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 140,
        "wires": [
            [
                "0d49c1e77a91ecc4"
            ]
        ]
    },
    {
        "id": "751ee28017f82114",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET)>0 and TOT=0",
        "func": "msg.payload = {\n    \"facts\": {\n        \"failure\": 1,\n        \"SUM(DET)\": 1,\n        \"TOT\": 0\n    },\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 560,
        "wires": [
            [
                "11de8bde4637a9a8"
            ]
        ]
    },
    {
        "id": "3fc2c4e0ee9964c4",
        "type": "inject",
        "z": "ebc615704b7e2ae8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 880,
        "y": 460,
        "wires": [
            [
                "1527a2966802760b"
            ]
        ]
    },
    {
        "id": "1527a2966802760b",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "Failure not present",
        "func": "msg.payload = {\n    \"facts\": {\n        \"failure\": 0,\n        \"SUM(DET)\": 1,\n        \"TOT\": 1\n    },\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 460,
        "wires": [
            [
                "11de8bde4637a9a8"
            ]
        ]
    },
    {
        "id": "04a24b4e62ec2c9f",
        "type": "inject",
        "z": "ebc615704b7e2ae8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 880,
        "y": 560,
        "wires": [
            [
                "751ee28017f82114"
            ]
        ]
    },
    {
        "id": "299c20ed5761987a",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET)=0 and TOT>0",
        "func": "msg.payload = {\n    \"facts\": {\n        \"failure\": 1,\n        \"SUM(DET)\": 0,\n        \"TOT\": 1\n    },\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 660,
        "wires": [
            [
                "11de8bde4637a9a8"
            ]
        ]
    },
    {
        "id": "b6b113a3e3a05e13",
        "type": "inject",
        "z": "ebc615704b7e2ae8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 880,
        "y": 660,
        "wires": [
            [
                "299c20ed5761987a"
            ]
        ]
    },
    {
        "id": "c74c908267123db7",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET)>0 and TOT>0",
        "func": "msg.payload = {\n    \"facts\": {\n        \"failure\": 1,\n        \"SUM(DET)\": 1,\n        \"TOT\": 1\n    },\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 760,
        "wires": [
            [
                "11de8bde4637a9a8"
            ]
        ]
    },
    {
        "id": "ad3a56ce27aeeeed",
        "type": "inject",
        "z": "ebc615704b7e2ae8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 880,
        "y": 760,
        "wires": [
            [
                "c74c908267123db7"
            ]
        ]
    },
    {
        "id": "1cc8638f5c3e5c18",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET)=0 and TOT=0",
        "func": "msg.payload = {\n    \"facts\": {\n        \"failure\": 1,\n        \"SUM(DET)\": 0,\n        \"TOT\": 0\n    },\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 860,
        "wires": [
            [
                "11de8bde4637a9a8"
            ]
        ]
    },
    {
        "id": "1dfbf9ccaf916433",
        "type": "inject",
        "z": "ebc615704b7e2ae8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 880,
        "y": 860,
        "wires": [
            [
                "1cc8638f5c3e5c18"
            ]
        ]
    },
    {
        "id": "c3511da9c0380ee2",
        "type": "inject",
        "z": "ebc615704b7e2ae8",
        "name": "Inject Worfklow ID",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "SPAD",
        "payload": "29028",
        "payloadType": "num",
        "x": 230,
        "y": 100,
        "wires": [
            [
                "43fa7108ad5731fb"
            ]
        ]
    },
    {
        "id": "92528f916a9d42e9",
        "type": "ui_text_input",
        "z": "ebc615704b7e2ae8",
        "name": "Input Workflow ID",
        "label": "Workflow ID",
        "tooltip": "Enter a Workflow ID from the SPAD",
        "group": "48c415689cc2322d",
        "order": 2,
        "width": 7,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 230,
        "y": 160,
        "wires": [
            [
                "43fa7108ad5731fb"
            ]
        ]
    },
    {
        "id": "8f07215339b32651",
        "type": "subflow:c5ce2d38887016b2",
        "z": "ebc615704b7e2ae8",
        "name": "",
        "x": 1030,
        "y": 120,
        "wires": [
            [
                "3b24e0953c2b9c64"
            ],
            []
        ]
    },
    {
        "id": "43fa7108ad5731fb",
        "type": "http request",
        "z": "ebc615704b7e2ae8",
        "name": "Get Workflow by ID",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://localhost/spad/{{{payload}}}?DEBUG=true",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "other",
                "keyValue": "X-JBID",
                "valueType": "other",
                "valueValue": "kapoo"
            },
            {
                "keyType": "other",
                "keyValue": "X-API-KEY",
                "valueType": "other",
                "valueValue": "x5nDCpvGTkvHniq8wJ9m"
            }
        ],
        "x": 450,
        "y": 120,
        "wires": [
            [
                "10ed8cae4434227a"
            ]
        ]
    },
    {
        "id": "10ed8cae4434227a",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "Get Facts from SPAD (WorkflowID)",
        "func": "msg.payload.facts = msg.payload.data[0].facts\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 120,
        "wires": [
            [
                "8f07215339b32651"
            ]
        ]
    },
    {
        "id": "c26c18b504bdf465",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "Get Facts from DB",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 240,
        "wires": [
            [
                "8f07215339b32651"
            ]
        ]
    },
    {
        "id": "43ed29bdfec959cc",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "Get Facts from Spreadsheet",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 740,
        "y": 340,
        "wires": [
            [
                "8f07215339b32651"
            ]
        ]
    },
    {
        "id": "3b24e0953c2b9c64",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "function 11",
        "func": "\nmsg.payload.facts.failure = 1\nmsg.payload.facts[\"SUM(DET)\"] = 1\nmsg.payload.facts[\"TOT\"] = 0\n\nmsg.payload.csv = [{}]\nmsg.payload.csv[0] = msg.payload.facts\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 320,
        "wires": [
            [
                "92069d020a645ba5",
                "11de8bde4637a9a8"
            ]
        ]
    },
    {
        "id": "92069d020a645ba5",
        "type": "debug",
        "z": "ebc615704b7e2ae8",
        "name": "debug 44",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1360,
        "y": 240,
        "wires": []
    },
    {
        "id": "d43d98523cecf095",
        "type": "link in",
        "z": "ebc615704b7e2ae8",
        "name": "link in 14",
        "links": [
            "1d6882431fd8622b"
        ],
        "x": 1435,
        "y": 500,
        "wires": [
            [
                "11de8bde4637a9a8",
                "6461700eed93af3c"
            ]
        ]
    },
    {
        "id": "9b085224f1089d53",
        "type": "debug",
        "z": "ebc615704b7e2ae8",
        "name": "Go To: Company Additivity Check",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2060,
        "y": 520,
        "wires": []
    },
    {
        "id": "11de8bde4637a9a8",
        "type": "switch",
        "z": "ebc615704b7e2ae8",
        "name": "Failure Present?",
        "property": "payload.csv[0].failure",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1560,
        "y": 660,
        "wires": [
            [
                "d4dbcb211cdb2e13"
            ],
            [
                "7aeadf48809a024a",
                "d631b7c1b3f67b00"
            ]
        ]
    },
    {
        "id": "d4dbcb211cdb2e13",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "Failure is not present",
        "func": "msg.payload.csv[0].action = \"Go To: Company Additivity Check\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1800,
        "y": 520,
        "wires": [
            [
                "9b085224f1089d53",
                "4e52903910e4d97b"
            ]
        ]
    },
    {
        "id": "7aeadf48809a024a",
        "type": "switch",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET) = 0 || SUM(DET) > 0",
        "property": "payload.csv[0][\"SUM(DET)\"]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1830,
        "y": 840,
        "wires": [
            [
                "594d1934dd5ccf1b"
            ],
            [
                "0784305320700a40"
            ]
        ]
    },
    {
        "id": "594d1934dd5ccf1b",
        "type": "switch",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET)=0 && [TOT = 0 || TOT >0]",
        "property": "payload.csv[0][\"TOT\"]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2170,
        "y": 760,
        "wires": [
            [
                "8b52f2e03f6b0b70"
            ],
            [
                "795397987b2a49b7"
            ]
        ]
    },
    {
        "id": "0784305320700a40",
        "type": "switch",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET)=0 && [TOT = 0 || TOT >0]",
        "property": "payload.csv[0][\"TOT\"]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2170,
        "y": 920,
        "wires": [
            [
                "9ff33c64e58ec21f"
            ],
            [
                "98f3fa50f4e3cd02"
            ]
        ]
    },
    {
        "id": "9ff33c64e58ec21f",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET)>0 and TOT=0",
        "func": "msg.payload.csv[0][\"TOT\"] = msg.payload.csv[0][\"SUM(DET)\"]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2450,
        "y": 900,
        "wires": [
            [
                "d6c96ee5ed2662fa",
                "4e52903910e4d97b"
            ]
        ]
    },
    {
        "id": "795397987b2a49b7",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET)=0 and TOT>0",
        "func": "msg.payload.csv[0].action = \"Proate data based on X(DET) = TOT\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2450,
        "y": 780,
        "wires": [
            [
                "54f845d7783dae6d",
                "4e52903910e4d97b"
            ]
        ]
    },
    {
        "id": "8b52f2e03f6b0b70",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET)=0 and TOT=0",
        "func": "msg.payload.csv[0].action = \"Impute?\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2450,
        "y": 740,
        "wires": [
            [
                "3eb1863692f174b0",
                "4e52903910e4d97b"
            ]
        ]
    },
    {
        "id": "98f3fa50f4e3cd02",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "SUM(DET)>0 and TOT>0",
        "func": "msg.payload.csv[0][\"ESMD\"] = msg.payload.csv[0][\"SUM(DET)\"] / msg.payload.csv[0][\"TOT\"]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2450,
        "y": 1020,
        "wires": [
            [
                "117f7620efb84422",
                "4e52903910e4d97b"
            ]
        ]
    },
    {
        "id": "3eb1863692f174b0",
        "type": "debug",
        "z": "ebc615704b7e2ae8",
        "name": "balance output 1",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2670,
        "y": 740,
        "wires": []
    },
    {
        "id": "54f845d7783dae6d",
        "type": "debug",
        "z": "ebc615704b7e2ae8",
        "name": "balance output 2",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2670,
        "y": 780,
        "wires": []
    },
    {
        "id": "d6c96ee5ed2662fa",
        "type": "debug",
        "z": "ebc615704b7e2ae8",
        "name": "balance output 3",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 2670,
        "y": 900,
        "wires": []
    },
    {
        "id": "117f7620efb84422",
        "type": "switch",
        "z": "ebc615704b7e2ae8",
        "name": "msg.payload[\"ESMD\"]",
        "property": "payload.csv[0][\"ESMD\"]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "btwn",
                "v": "0.8",
                "vt": "num",
                "v2": "1.2",
                "v2t": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2680,
        "y": 1020,
        "wires": [
            [
                "25247c97a53e8d68"
            ],
            [
                "1c783596898c8467"
            ]
        ]
    },
    {
        "id": "25247c97a53e8d68",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "Set TOTAL = SUM(DET)",
        "func": "msg.payload.csv[0][\"TOTAL\"] = msg.payload.csv[0][\"SUM(DET)\"]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2930,
        "y": 980,
        "wires": [
            [
                "b1d071a4c7595931",
                "4e52903910e4d97b"
            ]
        ]
    },
    {
        "id": "1c783596898c8467",
        "type": "switch",
        "z": "ebc615704b7e2ae8",
        "name": "INDP(ind and geo)>1?",
        "property": "payload.csv[0].INDP",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2920,
        "y": 1080,
        "wires": [
            [
                "e57d82407e9255e7"
            ],
            [
                "c3405e214ce0544a"
            ]
        ]
    },
    {
        "id": "b1d071a4c7595931",
        "type": "debug",
        "z": "ebc615704b7e2ae8",
        "name": "balance output 4",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 3150,
        "y": 980,
        "wires": []
    },
    {
        "id": "9831d99463f98853",
        "type": "debug",
        "z": "ebc615704b7e2ae8",
        "name": "balance output 5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 3370,
        "y": 1060,
        "wires": []
    },
    {
        "id": "7b38443176fcdeba",
        "type": "debug",
        "z": "ebc615704b7e2ae8",
        "name": "balance output 6",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 3330,
        "y": 1100,
        "wires": []
    },
    {
        "id": "e57d82407e9255e7",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "SET IMPUTATION FLAG",
        "func": "msg.payload.csv[0].action = \"SET IMPUTATION FLAG?\"\nmsg.payload.csv[0][\"Varx-IMBALANCE\"] = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3150,
        "y": 1060,
        "wires": [
            [
                "9831d99463f98853",
                "4e52903910e4d97b"
            ]
        ]
    },
    {
        "id": "c3405e214ce0544a",
        "type": "function",
        "z": "ebc615704b7e2ae8",
        "name": "Rake (DET) = TOT",
        "func": "msg.payload.csv[0][\"Rake(DET)\"] = msg.payload.csv[0][\"TOT\"]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3130,
        "y": 1100,
        "wires": [
            [
                "7b38443176fcdeba",
                "4e52903910e4d97b"
            ]
        ]
    },
    {
        "id": "4e52903910e4d97b",
        "type": "link out",
        "z": "ebc615704b7e2ae8",
        "name": "link out 16",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 2825,
        "y": 360,
        "wires": []
    },
    {
        "id": "d631b7c1b3f67b00",
        "type": "debug",
        "z": "ebc615704b7e2ae8",
        "name": "debug 46",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1840,
        "y": 660,
        "wires": []
    },
    {
        "id": "6461700eed93af3c",
        "type": "debug",
        "z": "ebc615704b7e2ae8",
        "name": "debug 57",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1580,
        "y": 400,
        "wires": []
    },
    {
        "id": "2c6bccf874de19c8",
        "type": "link in",
        "z": "01f5b46ca228a07e",
        "name": "link in 16",
        "links": [
            "dbbcb48515f896cb"
        ],
        "x": 185,
        "y": 80,
        "wires": [
            [
                "80a0b818fdf305bc"
            ]
        ]
    },
    {
        "id": "80a0b818fdf305bc",
        "type": "function",
        "z": "01f5b46ca228a07e",
        "name": "NONNORM module",
        "func": "if (msg.payload.csv[0].OPSTATS === \"Y\") {\n    if (msg.payload.csv[0].SURVUTYP === \"MU\" && msg.payload.csv[0].ACTVMIO < 12 && (msg.payload.csv[0].ACTVMIO_F === \"L\" || msg.payload.csv[0].EPPAYANN === 0)) {\n        msg.payload.csv[0].NONNORM = \"B\";\n        msg.payload.csv[0].NONNORM_F = \"J\";\n    } else {\n        if (msg.payload.csv[0].ACTVMIO < 12) {\n            msg.payload.csv[0].NONNORM = \"S\";\n            msg.payload.csv[0].NONNORM_F = \"J\";\n        }\n    }\n} else {\n    msg.payload.csv[0].NONNORM = \"D\";\n    msg.payload.csv[0].NONNORM_F = \"J\";\n}\nmsg.payload.csv[0].A = true\nmsg.payload.csv[0].action = \"Return to RWS NonNORM Routing\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 140,
        "wires": [
            [
                "3327d8455cf7e97b",
                "b37e6545ddd4e8be"
            ]
        ]
    },
    {
        "id": "3327d8455cf7e97b",
        "type": "debug",
        "z": "01f5b46ca228a07e",
        "name": "Set_NONNORM output",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 140,
        "wires": []
    },
    {
        "id": "b37e6545ddd4e8be",
        "type": "link out",
        "z": "01f5b46ca228a07e",
        "name": "link out 13",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 445,
        "y": 200,
        "wires": []
    },
    {
        "id": "7d91540d69ac16c1",
        "type": "link in",
        "z": "b658ecf4c9aae708",
        "name": "link in 17",
        "links": [
            "02482c164222726b",
            "434436c270b7f283",
            "4e52903910e4d97b",
            "a6ab628560a7c8c9",
            "b37e6545ddd4e8be",
            "bad79e5ee645cc24",
            "eb575c3f71964e1e",
            "edf06df5cb8410e9",
            "f7e7a2a2e4eb195a",
            "d6c45ec5ceb3d90d",
            "2e09b853297763c9",
            "05e1e9f94e92a19d",
            "62e629bde644c4ac",
            "312be7f6e10bbadc",
            "b6899b0c09b0259e",
            "1550efeda1667825",
            "7dae0df881453eeb",
            "45908235e45f6dfd",
            "eda519aa8a1db303",
            "8b699616f9c5a9b5",
            "d9030a8fd1f031b8",
            "63e57e09491e405e",
            "fcf92106d34fe5ff",
            "aafa3aaec7fae7e6",
            "d167c6cf7b89444d",
            "ca558b1ab669675d",
            "782e6a52f1a66003",
            "daa2e09cc7fbb842",
            "6de317f273718e08",
            "42f918976305a0a4",
            "86f363969a0f8d77",
            "a6250f4cc9b410d4",
            "94f8c7ddd4beeac8",
            "ed77e55538e24a1f",
            "b6bebbeac0549686",
            "ece1e11393b49799",
            "18792e3b18514eb9",
            "8499c812e62fc00c",
            "83cf5c1c02a121e8",
            "2e4029be13b46163",
            "108f9747956b439a",
            "25627bf820122fe8",
            "739edc4c44d5eb0b",
            "163aa434e03fa911",
            "ec6bfe4f7818633f",
            "246d06dd46410f88",
            "70c4debe9a1adfae",
            "67cb21d2f5fc02bd",
            "5f40acc0f51bf3a2",
            "01595edbd5bb3ca9",
            "ada77cfa9573c816",
            "9fe7f21d3c9037a4",
            "daf2afc7f182f934",
            "9343c59ba9dd4152",
            "55d8b26f48ef05bd",
            "b683e25439a951d1",
            "e74d8d0f9702bdb7",
            "b72ac573a0a35c8a",
            "93b50ff4956eb444",
            "2b91281b80bace6b",
            "290f0910bd81e94b",
            "f34ac015feb048da",
            "76205591b8230183",
            "e608a1d198c82a60",
            "641e46c32d5b58f3",
            "8be3531210d71bdc",
            "0b0f86b61f9edc20",
            "c79880fef432a005",
            "e75b332d63ba3e20",
            "bb4dba28bc4486e1",
            "d23c27e777f90ccd",
            "33026067404b94f9",
            "91b34f7b64e183bd",
            "b8f1ae7b487a68f6",
            "2dcb1956c632490d",
            "b2edc9dbdd9af134",
            "b206e07710f5e28f",
            "cae6e041faaff1fb",
            "0422aeccc8321ad8",
            "f096483c422c4725",
            "7f9f9ce1831e7eba",
            "5ff66799891fa56d",
            "11fe39a5537b93ed",
            "d72287bcf3f34206",
            "1d11154531f64d4c",
            "f66f6ac43184ea78",
            "45c55d6a472cb198",
            "aa56e68e83817d61",
            "7a94579055cc72b8"
        ],
        "x": 205,
        "y": 260,
        "wires": [
            [
                "9ef8d3c13114fdf5"
            ]
        ]
    },
    {
        "id": "9ef8d3c13114fdf5",
        "type": "function",
        "z": "b658ecf4c9aae708",
        "name": "Post Data Format",
        "func": "// let arr = []\n\n// if (msg.payload.csv) {\n//     msg.payload = msg.payload.csv\n// }\n\n// for (let prop in msg.payload[0]) {\n//     if (msg.payload[0].hasOwnProperty(prop)) {\n//         arr.push(\n//             {\n//                 \"postData\": JSON.stringify(prop) + \": \" + JSON.stringify(msg.payload[0][prop])\n//             }\n//         )\n//     }\n// }\n\n// msg.payload = arr\n// return msg;\n\n// ------\n\n// let postDataObj = {};\n\n// if (msg.payload.csv) {\n//     msg.payload = msg.payload.csv;\n// }\n\n// for (let prop in msg.payload[0]) {\n//     if (msg.payload[0].hasOwnProperty(prop)) {\n//         postDataObj[prop] = msg.payload[0][prop];\n//     }\n// }\n\n// msg.topic = \"post\"; // Add a topic to help the join node distinguish between pre and post data\n// msg.payload = postDataObj; // The payload is now an object containing all the post-data variables\n// return msg;\n\n\n// --------\n\n// Initialize postDataObj to an empty object\nlet postDataObj = {};\n\n// Check if msg.payload.csv exists and if so, use it\nif (msg.payload.csv) {\n    msg.payload = msg.payload.csv;\n}\n\n// Check if msg.payload[0] exists\n\n// get the global pointer in the csv\nlet ptr = global.get(\"ptrModuleFacts\") || 0\n\n\nif (msg.payload[ptr]) {\n    // Loop through the properties of msg.payload[0]\n    for (let prop in msg.payload[ptr]) {\n        if (msg.payload[ptr].hasOwnProperty(prop)) {\n            postDataObj[prop] = msg.payload[ptr][prop];\n        }\n    }\n} else {\n    // If msg.payload[0] doesn't exist, postDataObj remains an empty object\n    postDataObj = {};\n}\n\nmsg.topic = \"post\";  // Add a topic to help the join node distinguish between pre and post data\nmsg.payload = {\n    \"post\": postDataObj  // The payload is now an object containing all the post-data variables\n}\nreturn msg;  // Return the modified message object\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 260,
        "wires": [
            [
                "5f0e9f1e3f037661"
            ]
        ]
    },
    {
        "id": "617d768f3414b52e",
        "type": "link in",
        "z": "b658ecf4c9aae708",
        "name": "link in 19",
        "links": [
            "500b5d417bd3a1ee",
            "8fc8da4acdeb51a4"
        ],
        "x": 75,
        "y": 240,
        "wires": [
            [
                "02d678f5c34fe438",
                "ceeca7b3bb06c2d8"
            ]
        ]
    },
    {
        "id": "ceeca7b3bb06c2d8",
        "type": "function",
        "z": "b658ecf4c9aae708",
        "name": "PreData Format",
        "func": "let preDataObj = {};\n\nif (msg.payload.csv) {\n    msg.payload = msg.payload.csv;\n}\nlet ptr = global.get(\"ptrModuleFacts\") || 0\n\nfor (let prop in msg.payload[ptr]) {\n    if (msg.payload[ptr].hasOwnProperty(prop)) {\n        preDataObj[prop] = msg.payload[ptr][prop];\n    }\n}\n\nmsg.topic = \"pre\"; // Add a topic to help the join node distinguish between pre and post data\n// msg.payload = preDataObj; // The payload is now an object containing all the pre-data variables\nmsg.payload = {\n    'pre': global.get(\"originalData\")// preDataObj // NK\n}\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 200,
        "wires": [
            [
                "dcc989e7a52a4892",
                "5f0e9f1e3f037661"
            ]
        ]
    },
    {
        "id": "fe9f3d905539c784",
        "type": "function",
        "z": "b658ecf4c9aae708",
        "name": "Table Display Pre/Post/Changes",
        "func": "// Retrieve existing tableData from context, or initialize to an empty array if it doesn't exist\nvar tableData = flow.get(\"tableData\") || [];\n\n// var tableData = global.get(\"tableData\") || []; // NK added\n\n// Function to find an existing row based on \"Variable\" field\nfunction findRow(variable) {\n    return tableData.find(r => r.Variable === variable);\n}\n\n// Handle \"pre\" data\nif (msg.topic === \"pre\") {\n    let preData = msg.payload.pre;\n\n    // Update existing rows and/or add new rows\n    for (let key in preData) {\n        if (preData.hasOwnProperty(key)) {\n            let row = findRow(key);\n            if (!row) {\n                row = {\n                    \"Variable\": key,\n                    \"Pre\": preData[key],\n                    \"Post\": \"Not Available\",\n                    \"Changed_Indicator\": \"\"\n                };\n                tableData.push(row);\n            } else {\n                row.Pre = preData[key];\n            }\n        }\n    }\n\n    // Handle \"post\" data\n} else if (msg.topic === \"post\") {\n    let postData = msg.payload.post;\n\n    // Update existing rows with post data\n    tableData.forEach(function (row) {\n        if (postData.hasOwnProperty(row.Variable)) {\n            row.Post = postData[row.Variable];\n            if (row.Pre !== \"Not Available\" && row.Pre !== row.Post) {\n                row.Changed_Indicator = \"Y\";\n            }\n        }\n    });\n\n    // Add new rows for new post data variables\n    for (let key in postData) {\n        if (postData.hasOwnProperty(key)) {\n            let row = findRow(key);\n            if (!row) {\n                row = {\n                    \"Variable\": key,\n                    \"Pre\": \"Not Available\",\n                    \"Post\": postData[key],\n                    \"Changed_Indicator\": \"Y\"\n                };\n                tableData.push(row);\n            }\n        }\n    }\n}\n\n// Save the updated tableData back into the context\nflow.set(\"tableData\", tableData);\n\n// Return the updated tableData as the message payload\nmsg.payload = tableData;\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 220,
        "wires": [
            [
                "2b372b60778aab71"
            ]
        ]
    },
    {
        "id": "06c0561ca1caaf86",
        "type": "function",
        "z": "b658ecf4c9aae708",
        "name": "Insert Edits to Original Data",
        "func": "let variable = msg.payload.Pre.updates.Variable;\nlet preValue = msg.payload.Pre.updates.Pre;\n\n// Get the original data from the flow context, initialize to empty object if undefined\nlet original = flow.get('originalData') || {}; // commented NK\n// let original = global.get('originalData') || {}; // Added\n// Check if preValue can be converted to a number\nif (!isNaN(parseFloat(preValue)) && isFinite(preValue)) {\n    preValue = Number(preValue); // Convert to number\n}\n\noriginal[variable] = preValue; // Update the value in the object\n// global.set('originalData', original); //HF\n\n// flow.set('originalData', original); // Save the updated object back to flow context\n// flow.set('moduleFacts', original); // Save the updated object back to flow context\n\nconsole.log('original after', original);\nmsg.payload = [original]; // Update msg.payload to send the object further down the flow\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1720,
        "y": 140,
        "wires": [
            [
                "60931347e15bc805"
            ]
        ]
    },
    {
        "id": "8dee06773380424f",
        "type": "join",
        "z": "b658ecf4c9aae708",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1510,
        "y": 140,
        "wires": [
            [
                "06c0561ca1caaf86"
            ]
        ]
    },
    {
        "id": "dcc989e7a52a4892",
        "type": "function",
        "z": "b658ecf4c9aae708",
        "name": "Capture Original Data",
        "func": "msg.payload = {\n    original: msg.payload\n};\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 140,
        "wires": [
            [
                "8dee06773380424f"
            ]
        ]
    },
    {
        "id": "6b789f06055f6c99",
        "type": "function",
        "z": "b658ecf4c9aae708",
        "name": "Capture Table Edits",
        "func": "let p = msg.payload\n\nlet dataPtr = global.get(\"ptrModuleFacts\") || 0\n\nlet facts = global.get(\"moduleFacts\") || []\nlet fact = facts[dataPtr] || {}\n// get the key and value of the msg.payload.updates\nfact[p.Variable] = p.Pre\n\nfacts[dataPtr] = fact\nglobal.set(\"moduleFacts\", facts)\n// global.set(\"originalData\", facts[dataPtr]) //Hf\n\nmsg.payload = facts\nmsg.payload.updates = p\n\n\n\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 400,
        "wires": [
            [
                "8dee06773380424f",
                "88fa3b7e9e7044fd"
            ]
        ]
    },
    {
        "id": "5f0e9f1e3f037661",
        "type": "join",
        "z": "b658ecf4c9aae708",
        "name": "join",
        "mode": "custom",
        "build": "merged",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 550,
        "y": 220,
        "wires": [
            [
                "fe9f3d905539c784"
            ]
        ]
    },
    {
        "id": "02d678f5c34fe438",
        "type": "function",
        "z": "b658ecf4c9aae708",
        "name": "Table Display PreData Only",
        "func": "// Initialize tableData array to store rows\nvar tableData = [];\n\nlet preDataObj = {};\nif (msg.payload.csv) {\n    msg.payload = msg.payload.csv;\n}\nelse {\n    msg.payload = global.get(\"moduleFacts\")\n}\n\n// get the global pointer in the csv\nlet ptr = global.get(\"ptrModuleFacts\") || 0\n\nfor (let prop in msg.payload[ptr]) {\n    if (msg.payload[ptr].hasOwnProperty(prop)) {\n        preDataObj[prop] = msg.payload[ptr][prop];\n    }\n}\n\n// Prepare the payload for ui_table\nfor (let key in preDataObj) {\n    if (preDataObj.hasOwnProperty(key)) {\n        let row = {\n            \"Variable\": key,\n            \"Pre\": preDataObj[key],\n            \"Post\": \"\",  // Empty since Post data is not available\n            \"Changed_Indicator\": \"\"  // Empty since Post data is not available\n        };\n        tableData.push(row);\n    }\n}\n\nmsg.payload = tableData;  // Replace the payload with the array of table rows\nflow.set(\"tableData\", tableData);\nflow.set(\"originalData\", msg.payload[ptr]);\n\n\nreturn msg;  // Send the message for ui_table to display\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 400,
        "wires": [
            [
                "2b372b60778aab71",
                "f0f155bfff8415a5"
            ]
        ]
    },
    {
        "id": "2b372b60778aab71",
        "type": "ui_etable",
        "z": "b658ecf4c9aae708",
        "payload": "[{\"field\":\"Variable\",\"title\":\"Variable\",\"width\":250,\"align\":\"left\",\"formatter\":\"plaintext\"},{\"field\":\"Pre\",\"title\":\"Pre\",\"width\":150,\"align\":\"left\",\"formatter\":\"plaintext\",\"editor\":\"input\"},{\"field\":\"Post\",\"title\":\"Post\",\"width\":150,\"align\":\"left\",\"formatter\":\"plaintext\"},{\"field\":\"Changed_Indicator\",\"title\":\"Changed\",\"width\":100,\"align\":\"left\",\"formatter\":\"plaintext\"}]",
        "payloadType": "json",
        "options": "{}",
        "group": "1d1a43b7179c848f",
        "name": "Results",
        "order": 4,
        "width": 12,
        "height": 12,
        "columns": [],
        "outputs": 1,
        "cts": false,
        "x": 1040,
        "y": 400,
        "wires": [
            [
                "6b789f06055f6c99"
            ]
        ]
    },
    {
        "id": "60931347e15bc805",
        "type": "link out",
        "z": "b658ecf4c9aae708",
        "name": "link out 55",
        "mode": "link",
        "links": [
            "ca8be9e1afb53866"
        ],
        "x": 1915,
        "y": 140,
        "wires": []
    },
    {
        "id": "88fa3b7e9e7044fd",
        "type": "debug",
        "z": "b658ecf4c9aae708",
        "name": "Display Edited Data",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1570,
        "y": 400,
        "wires": []
    },
    {
        "id": "f0f155bfff8415a5",
        "type": "debug",
        "z": "b658ecf4c9aae708",
        "name": "Checking for Select Record ptr",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 360,
        "wires": []
    },
    {
        "id": "665f97ef69efc31f",
        "type": "ui_text_input",
        "z": "b658ecf4c9aae708",
        "name": "",
        "label": "Search",
        "tooltip": "Enter text for search...",
        "group": "1d1a43b7179c848f",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 380,
        "y": 580,
        "wires": [
            [
                "2b40a9d2b73972ba"
            ]
        ]
    },
    {
        "id": "2b40a9d2b73972ba",
        "type": "function",
        "z": "b658ecf4c9aae708",
        "name": "Pass search data for tabledata",
        "func": "// msg.payload = {\n//     command: \"searchData\",\n//     arguments: [msg.payload],  // search term from ui_text_input\n//     returnPromise: true\n// };\n\n\n\n// Sample data (replace with your actual data source or previous payload)\nvar data = flow.get(\"tableData\")\n\n// Filter the data based on the search term\nvar searchTerm = msg.payload;\nvar filteredData = data.filter(row => {\n    return Object.values(row).some(value => String(value).toLowerCase().includes(searchTerm.toLowerCase()));\n});\n\nmsg.payload = filteredData;\nreturn msg;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 580,
        "wires": [
            [
                "2b372b60778aab71",
                "57f21802ddfb06f5"
            ]
        ]
    },
    {
        "id": "57f21802ddfb06f5",
        "type": "debug",
        "z": "b658ecf4c9aae708",
        "name": "debug 92",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1060,
        "y": 580,
        "wires": []
    },
    {
        "id": "f21a93fafc0f5662",
        "type": "ui_button",
        "z": "5e1c7c0d7569a4cb",
        "name": "",
        "group": "ef4f9868d6da5e21",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Generate",
        "tooltip": "",
        "color": "blue",
        "bgcolor": "",
        "className": "",
        "icon": "send",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 240,
        "y": 320,
        "wires": [
            [
                "112195b8c626c5d5"
            ]
        ]
    },
    {
        "id": "32db157c82a77669",
        "type": "ui_text_input",
        "z": "5e1c7c0d7569a4cb",
        "name": "",
        "label": "Prompt Input",
        "tooltip": "",
        "group": "a54754fb1b7c0694",
        "order": 1,
        "width": 16,
        "height": 2,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 230,
        "y": 400,
        "wires": [
            [
                "3391b53461b573fb"
            ]
        ]
    },
    {
        "id": "67f9148a915473ca",
        "type": "join",
        "z": "5e1c7c0d7569a4cb",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 650,
        "y": 340,
        "wires": [
            [
                "90f2ba4ed97317e5",
                "6ac31ee306c88d7e"
            ]
        ]
    },
    {
        "id": "b02686cfec3ca4ab",
        "type": "chatgpt",
        "z": "5e1c7c0d7569a4cb",
        "name": "ChatGPT API",
        "API_KEY": "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",
        "Organization": "org-pIsSU8akeKm4icKTYZaBQXqM",
        "topic": "__EMPTY__",
        "BaseUrl": "https://api.openai.com",
        "x": 830,
        "y": 340,
        "wires": [
            [
                "4e99a0f541ed2aa4",
                "cd54c5f7cbcd9b46"
            ]
        ]
    },
    {
        "id": "4e99a0f541ed2aa4",
        "type": "debug",
        "z": "5e1c7c0d7569a4cb",
        "name": "gpt output",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 340,
        "wires": []
    },
    {
        "id": "112195b8c626c5d5",
        "type": "change",
        "z": "5e1c7c0d7569a4cb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "completion",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "complete",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 320,
        "wires": [
            [
                "67f9148a915473ca"
            ]
        ]
    },
    {
        "id": "3391b53461b573fb",
        "type": "change",
        "z": "5e1c7c0d7569a4cb",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "prompt",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 400,
        "wires": [
            [
                "67f9148a915473ca"
            ]
        ]
    },
    {
        "id": "90f2ba4ed97317e5",
        "type": "debug",
        "z": "5e1c7c0d7569a4cb",
        "name": "Topic",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 930,
        "y": 540,
        "wires": []
    },
    {
        "id": "6ac31ee306c88d7e",
        "type": "function",
        "z": "5e1c7c0d7569a4cb",
        "name": "function 19",
        "func": "msg.payload=msg.payload.prompt\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 560,
        "wires": [
            [
                "b02686cfec3ca4ab"
            ]
        ]
    },
    {
        "id": "cd54c5f7cbcd9b46",
        "type": "ui_text",
        "z": "5e1c7c0d7569a4cb",
        "group": "ef4f9868d6da5e21",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1090,
        "y": 540,
        "wires": []
    },
    {
        "id": "e37d1480a526c577",
        "type": "inject",
        "z": "6f369789c773517d",
        "name": "Incoming Data from QBES",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"csv\":[{\"failure\":1,\"SUM(DET)\":1,\"TOT\":1,\"REPORTING_ID_TYP\":\"SU\",\"FORM_CODE_IRS\":\"01\",\"NAICS_SECTOR\":51,\"RCPT_NET_IRS_CURR\":100,\"RCPT_INTEREST_IRS_CURR\":10,\"RCPT_GROSSRENT_IRS_CURR\":20,\"RCPT_OTHINCOME_IRS_CURR\":30,\"RCPT_GROSSINC_IRS_CURR\":40,\"RCPT_TOTINC_IRS_CURR\":50,\"RCPT_TOTREV_IRS_CURR\":60,\"COST_GOODSOLD_IRS_CURR\":70,\"AIES_SCOPE\":\"Y\",\"BR_STAT\":\"Y\",\"NAICS_CODE_OLD\":4821,\"NAICS_WRITIN_TEXT\":\"na\",\"KAU_NAICS\":6221101,\"COVCHGCD\":111,\"COVCHGDT\":\"2022-12-31\",\"Data\":0,\"PDIV\":\"S\",\"ANAIC\":1151234,\"EDTROUTE\":1,\"NAICOLD\":2151234,\"NAICSDSG\":3151234,\"NAICMAIL\":4151234,\"TRADCODE\":\"M\",\"STFIPS\":\"01\",\"GEOREG\":\"03\",\"ACTV_MIO_NUM\":8,\"ACTV_MIO_NUM_FLG\":\"RC\",\"OPSTATS\":\"\",\"OPSTATS_FLG\":\"R\",\"COV_CHG_CODE\":791,\"ACTVMIO_R\":10,\"COV_CHG_DATE\":\"2022-12-31\",\"OPSTAT\":5,\"OPSTAT_FLAG\":\"R\",\"RECORD_TYP\":89,\"BMF_FR941\":3,\"EPPAYANN\":0,\"NONNORM_FLG\":\"\",\"NONNORM\":\"\",\"PAY_QTR1_VAL\":0,\"EMP_MAR12_NUM\":0,\"OPSTATS_F\":\"RC\",\"TEMPMIO\":0,\"ECPAYQ1\":0,\"ACTV_MIO_VAL\":0,\"ACTV_MIO_VAL_FLG\":\"L\",\"ECPAYQ2\":3,\"ECPAYQ3\":4,\"ECPAYQ4\":5,\"ECPAYQ4_F\":\"\",\"REFPER\":\"2023A1\",\"MADBPAYANN\":0,\"EMP_MAR12_NUM_F\":\"RG\",\"PAY_ANN_VAL\":1,\"PAY_QTR1_VAL_R\":0,\"PAY_QTR1_VAL_FLG\":\"R\",\"EMP_MAR12_NUM_FLG\":\"R\",\"CY_PAY_QTR1_VAL\":1,\"ECPAYQ1ZERO\":\"\",\"CY_EMP_MAR12_NUM\":1,\"ECEMPQ1\":1}]}",
        "payloadType": "json",
        "x": 150,
        "y": 60,
        "wires": [
            [
                "bf0c4cfa8872661e"
            ]
        ]
    },
    {
        "id": "bf0c4cfa8872661e",
        "type": "switch",
        "z": "6f369789c773517d",
        "name": "AIES_SCOPE = Y?",
        "property": "payload.csv[0].AIES_SCOPE",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 370,
        "y": 60,
        "wires": [
            [],
            [
                "84a1f619dc333f6f"
            ]
        ]
    },
    {
        "id": "84a1f619dc333f6f",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "No, go to KAU to Company Additivity Check",
        "x": 670,
        "y": 40,
        "wires": [
            [
                "53749bc75b1dfefd"
            ]
        ]
    },
    {
        "id": "4ee1acdd5f25eedf",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "PV Prep",
        "x": 1360,
        "y": 200,
        "wires": [
            [
                "ec5fe14247aedef2"
            ]
        ]
    },
    {
        "id": "ec5fe14247aedef2",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Call PV",
        "x": 1470,
        "y": 120,
        "wires": [
            [
                "d33c05b3903dd607"
            ]
        ]
    },
    {
        "id": "d33c05b3903dd607",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "PV Unload",
        "x": 1580,
        "y": 200,
        "wires": [
            [
                "350185b801143687"
            ]
        ]
    },
    {
        "id": "350185b801143687",
        "type": "http request",
        "z": "6f369789c773517d",
        "name": "Hot Deck Imputation for Estab Core",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1790,
        "y": 120,
        "wires": [
            [
                "224ebed81db4d417"
            ]
        ]
    },
    {
        "id": "224ebed81db4d417",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Derived Items",
        "x": 1990,
        "y": 200,
        "wires": [
            [
                "2ec08aae604e8496"
            ]
        ]
    },
    {
        "id": "2ec08aae604e8496",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Logical Checks",
        "x": 380,
        "y": 300,
        "wires": [
            [
                "e28f7745010476f6"
            ]
        ]
    },
    {
        "id": "e28f7745010476f6",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Unit Balance",
        "x": 570,
        "y": 300,
        "wires": [
            [
                "8365a07470601995"
            ]
        ]
    },
    {
        "id": "8365a07470601995",
        "type": "http request",
        "z": "6f369789c773517d",
        "name": "MFG Imputation for Estab Non- Core/Raking",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 870,
        "y": 300,
        "wires": [
            [
                "5c34a139ed514d2a"
            ]
        ]
    },
    {
        "id": "5c34a139ed514d2a",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Derived Items",
        "x": 1150,
        "y": 300,
        "wires": [
            [
                "ff19d31c6a2b2466"
            ]
        ]
    },
    {
        "id": "ff19d31c6a2b2466",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Post Edit/Set Donor Stat",
        "x": 1370,
        "y": 300,
        "wires": [
            [
                "a6d9bbd9d7de92d6"
            ]
        ]
    },
    {
        "id": "a6d9bbd9d7de92d6",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Classification",
        "x": 370,
        "y": 420,
        "wires": [
            [
                "ddb465088b8f229f"
            ]
        ]
    },
    {
        "id": "b26e87d4c3c7d83a",
        "type": "comment",
        "z": "6f369789c773517d",
        "name": "Yes, Estab",
        "info": "Create decision point\nCheck if record_typ_txt in (20,90)",
        "x": 120,
        "y": 140,
        "wires": []
    },
    {
        "id": "26906fbefd3e1105",
        "type": "comment",
        "z": "6f369789c773517d",
        "name": "KAU",
        "info": "Check if record_typ_txt = 30",
        "x": 110,
        "y": 420,
        "wires": []
    },
    {
        "id": "ddb465088b8f229f",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Completeness Check / Core Variables",
        "x": 610,
        "y": 420,
        "wires": [
            [
                "13fe8441e829301b"
            ]
        ]
    },
    {
        "id": "13fe8441e829301b",
        "type": "http request",
        "z": "6f369789c773517d",
        "name": "HB Edits/Error localization/ Industry Av Imputation for KAU Core",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1010,
        "y": 420,
        "wires": [
            [
                "8c74ba923194419e"
            ]
        ]
    },
    {
        "id": "8c74ba923194419e",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Derived Items",
        "x": 1330,
        "y": 420,
        "wires": [
            [
                "3592468b7a37a4e5"
            ]
        ]
    },
    {
        "id": "3592468b7a37a4e5",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Logical Checks",
        "x": 1500,
        "y": 420,
        "wires": [
            [
                "d841a19d43f75a4d"
            ]
        ]
    },
    {
        "id": "d841a19d43f75a4d",
        "type": "http request",
        "z": "6f369789c773517d",
        "name": "HB Edits/Error localization/ Industry Av Imputation for KAU Totals",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1840,
        "y": 420,
        "wires": [
            [
                "ba41a6d6bbadf123"
            ]
        ]
    },
    {
        "id": "ba41a6d6bbadf123",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Unit Balance",
        "x": 2170,
        "y": 420,
        "wires": [
            [
                "93d3a3bb2bc7fe51"
            ]
        ]
    },
    {
        "id": "93d3a3bb2bc7fe51",
        "type": "http request",
        "z": "6f369789c773517d",
        "name": "HDI Imputation for KAU Non- Totals",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 2400,
        "y": 420,
        "wires": [
            [
                "d304099f5907aeda"
            ]
        ]
    },
    {
        "id": "d304099f5907aeda",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Derived Items",
        "x": 2630,
        "y": 420,
        "wires": [
            [
                "5e55a24b5e76bb41"
            ]
        ]
    },
    {
        "id": "5e55a24b5e76bb41",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Post Edit",
        "x": 2620,
        "y": 480,
        "wires": [
            [
                "c85e165158b85de6"
            ]
        ]
    },
    {
        "id": "c85e165158b85de6",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Estab to KAU Additivity Check",
        "x": 420,
        "y": 540,
        "wires": [
            [
                "e1e45eb7e0325db3"
            ]
        ]
    },
    {
        "id": "24c0de35cd825782",
        "type": "comment",
        "z": "6f369789c773517d",
        "name": "Company",
        "info": "Check if record_typ_txt = 10",
        "x": 120,
        "y": 620,
        "wires": []
    },
    {
        "id": "e1e45eb7e0325db3",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Derived Items",
        "x": 370,
        "y": 620,
        "wires": [
            [
                "f56806d39ee1ec63"
            ]
        ]
    },
    {
        "id": "f56806d39ee1ec63",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Logical Checks",
        "x": 540,
        "y": 620,
        "wires": [
            [
                "cc3b9239a087da4e"
            ]
        ]
    },
    {
        "id": "cc3b9239a087da4e",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Unit Balance",
        "x": 710,
        "y": 620,
        "wires": [
            [
                "650789b4359cdb2f"
            ]
        ]
    },
    {
        "id": "650789b4359cdb2f",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Derived Items",
        "x": 870,
        "y": 620,
        "wires": [
            [
                "76f7c8d52c791e39"
            ]
        ]
    },
    {
        "id": "76f7c8d52c791e39",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Post Edit",
        "x": 1020,
        "y": 620,
        "wires": [
            [
                "c77ef0698bfb465b"
            ]
        ]
    },
    {
        "id": "41a709043abe1e2b",
        "type": "http request",
        "z": "6f369789c773517d",
        "name": "Company verification and possible use of data",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1360,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "c77ef0698bfb465b",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "KAU to Company Additivity Check",
        "x": 440,
        "y": 700,
        "wires": [
            [
                "5e1163b33bca81bc"
            ]
        ]
    },
    {
        "id": "5e1163b33bca81bc",
        "type": "switch",
        "z": "6f369789c773517d",
        "name": "Changes made?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 680,
        "y": 700,
        "wires": [
            [
                "a052cfcdea9284e3"
            ],
            [
                "9a3177f2d2f508f3"
            ]
        ]
    },
    {
        "id": "a052cfcdea9284e3",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Yes, go to BR stat evaluation",
        "x": 920,
        "y": 700,
        "wires": [
            [
                "d6c3ae19808aee07"
            ]
        ]
    },
    {
        "id": "9a3177f2d2f508f3",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Company Complete",
        "x": 710,
        "y": 780,
        "wires": [
            [
                "0d24eb67498d5cdd"
            ]
        ]
    },
    {
        "id": "0d24eb67498d5cdd",
        "type": "http request",
        "z": "6f369789c773517d",
        "name": "Send to HDI/Imputation/Estimation  Night run",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1010,
        "y": 780,
        "wires": [
            [
                "3ca182248e494d75"
            ]
        ]
    },
    {
        "id": "3ca182248e494d75",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6f369789c773517d",
        "name": "Rerun data prep edits or just Derived Items?",
        "x": 1390,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "53749bc75b1dfefd",
        "type": "link out",
        "z": "6f369789c773517d",
        "name": "go to KAU additivity check",
        "mode": "link",
        "links": [
            "e269a48b71e0ab14"
        ],
        "x": 885,
        "y": 40,
        "wires": []
    },
    {
        "id": "e269a48b71e0ab14",
        "type": "link in",
        "z": "6f369789c773517d",
        "name": "link in 25",
        "links": [
            "53749bc75b1dfefd"
        ],
        "x": 195,
        "y": 700,
        "wires": [
            [
                "c77ef0698bfb465b"
            ]
        ]
    },
    {
        "id": "d6c3ae19808aee07",
        "type": "link out",
        "z": "6f369789c773517d",
        "name": "go to BR stat eval",
        "mode": "link",
        "links": [
            "dcf620309c0b3c92"
        ],
        "x": 1075,
        "y": 700,
        "wires": []
    },
    {
        "id": "dcf620309c0b3c92",
        "type": "link in",
        "z": "6f369789c773517d",
        "name": "link in 26",
        "links": [
            "d6c3ae19808aee07"
        ],
        "x": 275,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "2ef7b6af2d61c69b",
        "type": "comment",
        "z": "6f369789c773517d",
        "name": "param file required",
        "info": "",
        "x": 1050,
        "y": 160,
        "wires": []
    },
    {
        "id": "49b8c4d94cef7ff7",
        "type": "link in",
        "z": "a1c50a528dd6cf36",
        "name": "link in 23",
        "links": [
            "32b24311da4a3220",
            "dfab7d8648324af5"
        ],
        "x": 165,
        "y": 220,
        "wires": [
            [
                "bf5eb8d7072f98cb"
            ]
        ]
    },
    {
        "id": "bf5eb8d7072f98cb",
        "type": "function",
        "z": "a1c50a528dd6cf36",
        "name": "completeness function",
        "func": "if (msg.payload.csv[0].PAYANN && msg.payload.csv[0].EMPQ1 && msg.payload.csv[0].PAYQTR1 && msg.payload.csv[0].RCPTOT) {\n    msg.payload.csv[0].PAYANN = 0\n    msg.payload.csv[0].EMPQ1 = 0\n    msg.payload.csv[0].PAYQTR1 = 0\n    msg.payload.csv[0].RCPTOT = 0\n    msg.payload.csv[0].action = \"Go to Balance Module\"\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 220,
        "wires": [
            [
                "a6ab628560a7c8c9"
            ]
        ]
    },
    {
        "id": "a6ab628560a7c8c9",
        "type": "link out",
        "z": "a1c50a528dd6cf36",
        "name": "link out 20",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 495,
        "y": 220,
        "wires": []
    },
    {
        "id": "7700d41f2bff649a",
        "type": "digitaloak-postgresql-query",
        "z": "d772b64609d590ad",
        "d": true,
        "name": "",
        "server": "ea3e0b5d6b96f47a",
        "inputs": 1,
        "outputs": 1,
        "x": 250,
        "y": 80,
        "wires": [
            [
                "6c5c30122a8dd550",
                "75a9736d9a433f4b"
            ]
        ]
    },
    {
        "id": "313558df85cfacfe",
        "type": "inject",
        "z": "d772b64609d590ad",
        "name": "",
        "props": [
            {
                "p": "query",
                "v": "SELECT * FROM product_aies.item_estabs_2023a1 LIMIT 12500;",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 90,
        "y": 80,
        "wires": [
            [
                "7700d41f2bff649a"
            ]
        ]
    },
    {
        "id": "6c5c30122a8dd550",
        "type": "function",
        "z": "d772b64609d590ad",
        "name": "getSurveyDatefromTableName",
        "func": "let query = msg.query;\nlet parts = query.split('FROM');\nlet fullTableName = parts[1].trim();\n\nlet tableNameParts = fullTableName.split('.');\ntableNameParts = tableNameParts[1].split(' ');\nlet tbNamePartsYear = tableNameParts[0].split('_');\nmsg.surveyYear = parseInt(tbNamePartsYear[2].slice(0,4));\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "75a9736d9a433f4b",
        "type": "function",
        "z": "d772b64609d590ad",
        "name": "parse",
        "func": "msg.payload = JSON.parse(JSON.stringify(msg.payload))\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 20,
        "wires": [
            []
        ]
    },
    {
        "id": "f6c5a7e7.8b1d28",
        "type": "inject",
        "z": "7904b0afeb2b68c0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"api_key\":\"x5nDCpvGTkvHniq8wJ9m\",\"page\":1,\"itemsPerPage\":10,\"filter\":\"\",\"jobName\":\"New Job\",\"totalRows\":100}",
        "payloadType": "json",
        "x": 190,
        "y": 260,
        "wires": [
            [
                "f3a3d8d2.5b1b98"
            ]
        ]
    },
    {
        "id": "f3a3d8d2.5b1b98",
        "type": "ui_form",
        "z": "7904b0afeb2b68c0",
        "name": "JOB",
        "label": "",
        "group": "eb430edea69b48da",
        "order": 3,
        "width": 24,
        "height": 1,
        "options": [
            {
                "label": "Job Name",
                "value": "jobName",
                "type": "text",
                "required": true,
                "rows": null
            },
            {
                "label": "Records per batch",
                "value": "itemsPerPage",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Where",
                "value": "filters",
                "type": "multiline",
                "required": false,
                "rows": 1
            },
            {
                "label": "Rule Types (csv)",
                "value": "ruleTypes",
                "type": "multiline",
                "required": false,
                "rows": 1
            },
            {
                "label": "Start Page",
                "value": "page",
                "type": "number",
                "required": true,
                "rows": null
            },
            {
                "label": "Time to submit",
                "value": "time_to_submit",
                "type": "time",
                "required": false,
                "rows": null
            },
            {
                "label": "Total Rows",
                "value": "totalRows",
                "type": "number",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "jobName": "",
            "itemsPerPage": "",
            "filters": "",
            "ruleTypes": "",
            "page": "",
            "time_to_submit": "",
            "totalRows": ""
        },
        "payload": "",
        "submit": "Submit",
        "cancel": "Cancel",
        "topic": "",
        "topicType": "str",
        "splitLayout": true,
        "className": "",
        "x": 430,
        "y": 260,
        "wires": [
            [
                "f5e5a6d4.7a9c28"
            ]
        ]
    },
    {
        "id": "f5e5a6d4.7a9c28",
        "type": "function",
        "z": "7904b0afeb2b68c0",
        "name": "",
        "func": "flow.set('startTime', new Date())\nlet elapsedTime = 0\nlet startTime = flow.get('startTime')\n\nlet timerInterval = setInterval(() => {\n    const currentTime = Date.now();\n    elapsedTime = currentTime - startTime;\n\n    let milliseconds = parseInt(elapsedTime % 1000);\n    let seconds = parseInt((elapsedTime / 1000) % 60);\n    let minutes = parseInt((elapsedTime / (1000 * 60)) % 60);\n\n    milliseconds = milliseconds < 10 ? \"0\" + milliseconds : milliseconds;\n    seconds = seconds < 10 ? \"0\" + seconds : seconds;\n    minutes = minutes < 10 ? \"0\" + minutes : minutes;\n\n}, 10)\n\nflow.set('interval', timerInterval)\nflow.set('timer', elapsedTime)\n\n// time\nfunction getTime() {\n    const currentDate = new Date();\n    const hours = String(currentDate.getHours()).padStart(2, '0');\n    const minutes = String(currentDate.getMinutes()).padStart(2, '0');\n    const seconds = String(currentDate.getSeconds()).padStart(2, '0');\n    const milliseconds = String(currentDate.getMilliseconds()).padStart(3, '0');\n\n    const formattedDate = ` - ${hours}:${minutes}:${seconds}:${milliseconds}`;\n\n\n    return formattedDate\n}\n\nvar jobName = msg.payload.jobName+getTime();\nvar api_token = msg.payload.api_token;\nvar time_to_submit = msg.payload.time_to_submit;\nvar filterString = msg.payload.filters || \"{}\"\nvar filters = JSON.parse(filterString);//msg.payload.filters);\nvar itemsPerPage = msg.payload.itemsPerPage;\nvar page = msg.payload.page;\nvar totalRows = msg.payload.totalRows;\n\n\n\n\n\n\n\n\nvar ruleTypes = msg.payload.ruleTypes || 'new,estab'\n\nmsg.payload = JSON.stringify({\n    \"jobName\": jobName,\n    \"api_key\": \"x5nDCpvGTkvHniq8wJ9m\",\n    \"time_to_submit\": time_to_submit,\n    \"where\": filters,\n    \"whereClause\": filterString,\n    \"limit\": itemsPerPage,\n    \"offset\": page,\n    \"ruleTypes\": ruleTypes,\n    \"totalRows\": totalRows\n})\n\n\n\n//msg.payload = `{\"filters\":{\"parent_name\":\"\"},\"page\":1,\"itemsPerPage\":5}`\nmsg.topic = \"jobRequest\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 260,
        "wires": [
            [
                "298f0efcfe6e4509"
            ]
        ]
    },
    {
        "id": "f8a3b1e8.ee2b",
        "type": "http request",
        "z": "7904b0afeb2b68c0",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://localhost/companies?api_key=x5nDCpvGTkvHniq8wJ9m&DEBUG=false&filters=' + encodeURIComponent(msg.payload.filters) + '&page=' + encodeURIComponent(msg.payload.page)",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 850,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "e515d6fd.b0b65",
        "type": "inject",
        "z": "7904b0afeb2b68c0",
        "name": "Sample Data",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "[{\"id\":1,\"name\":\"John\"},{\"id\":2,\"name\":\"Alice\"},{\"id\":3,\"name\":\"Bob\"},{\"id\":4,\"name\":\"Emma\"},{\"id\":5,\"name\":\"Michael\"},{\"id\":6,\"name\":\"Olivia\"},{\"id\":7,\"name\":\"William\"},{\"id\":8,\"name\":\"Sophia\"},{\"id\":9,\"name\":\"James\"},{\"id\":10,\"name\":\"Charlotte\"},{\"id\":11,\"name\":\"Alexander\"},{\"id\":12,\"name\":\"Emily\"},{\"id\":13,\"name\":\"Daniel\"},{\"id\":14,\"name\":\"Mia\"},{\"id\":15,\"name\":\"Henry\"},{\"id\":16,\"name\":\"Ava\"},{\"id\":17,\"name\":\"Oliver\"},{\"id\":18,\"name\":\"Amelia\"},{\"id\":19,\"name\":\"Benjamin\"},{\"id\":20,\"name\":\"Ella\"},{\"id\":21,\"name\":\"Jacob\"},{\"id\":22,\"name\":\"Grace\"},{\"id\":23,\"name\":\"Matthew\"},{\"id\":24,\"name\":\"Lily\"},{\"id\":25,\"name\":\"Joseph\"},{\"id\":26,\"name\":\"Lucy\"},{\"id\":27,\"name\":\"Samuel\"},{\"id\":28,\"name\":\"Chloe\"},{\"id\":29,\"name\":\"David\"},{\"id\":30,\"name\":\"Abigail\"}]",
        "payloadType": "json",
        "x": 170,
        "y": 620,
        "wires": [
            [
                "4f4b7e54.8b7164"
            ]
        ]
    },
    {
        "id": "4f4b7e54.8b7164",
        "type": "function",
        "z": "7904b0afeb2b68c0",
        "name": "Paging",
        "func": "// Load 10 records per page by default\nvar perPage = 10;\n\n// Retrieve the payload from the input message\nvar payload = msg.payload;\n\n// Retrieve the current page from the input message\nvar page = msg.page || 1;\n\n// Calculate the starting index for the current page\nvar startIndex = (page - 1) * perPage;\n\n// Calculate the ending index for the current page\nvar endIndex = page * perPage;\n\n// Slice the data array to retrieve the records for the current page\nvar pagedData = payload.slice(startIndex, endIndex);\n\n// Create a new message with the paged data\nmsg.payload = pagedData;\n\n// Return the modified message\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 360,
        "y": 620,
        "wires": [
            [
                "e0ef206c.ae46b8"
            ]
        ]
    },
    {
        "id": "e0ef206c.ae46b8",
        "type": "ui_table",
        "z": "7904b0afeb2b68c0",
        "group": "",
        "name": "",
        "order": 1,
        "width": "6",
        "height": "4",
        "columns": [
            {
                "field": "id",
                "title": "ID",
                "width": "80px",
                "align": "center",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "name",
                "title": "Name",
                "width": "200px",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 560,
        "y": 620,
        "wires": []
    },
    {
        "id": "950bc7a38b7588b2",
        "type": "Kafka Admin",
        "z": "7904b0afeb2b68c0",
        "name": "Connect",
        "broker": "01239f0e2e5d8173",
        "x": 120,
        "y": 500,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "f94006127c4e3798",
        "type": "debug",
        "z": "7904b0afeb2b68c0",
        "name": "Debug Facts Requested",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 380,
        "wires": []
    },
    {
        "id": "d9fb626ff6d93c12",
        "type": "inject",
        "z": "7904b0afeb2b68c0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "2",
        "topic": "getFacts",
        "payload": "{\"filters\":{\"parent_name\":\"\"},\"page\":1,\"itemsPerPage\":5}",
        "payloadType": "str",
        "x": 410,
        "y": 220,
        "wires": [
            [
                "298f0efcfe6e4509"
            ]
        ]
    },
    {
        "id": "298f0efcfe6e4509",
        "type": "Kafka Producer",
        "z": "7904b0afeb2b68c0",
        "name": "",
        "broker": "01239f0e2e5d8173",
        "topic": "getFacts15",
        "topicSlash2dot": false,
        "requireAcks": 1,
        "ackTimeoutMs": 100,
        "partitionerType": 0,
        "key": "",
        "partition": 0,
        "attributes": 0,
        "connectionType": "Producer",
        "convertFromJson": false,
        "x": 740,
        "y": 160,
        "wires": []
    },
    {
        "id": "9df7ae035994eeaa",
        "type": "kafka-consumer",
        "z": "7904b0afeb2b68c0",
        "name": "getFactsKafka",
        "broker": "a734a95fe6c7b3dc",
        "outOfRangeOffset": "earliest",
        "fromOffset": "latest",
        "topic": "jobRequest",
        "groupid": "",
        "x": 670,
        "y": 440,
        "wires": [
            [
                "1e011873a5266a77"
            ]
        ]
    },
    {
        "id": "4f09d6b681cf35af",
        "type": "ui_table",
        "z": "7904b0afeb2b68c0",
        "group": "eb430edea69b48da",
        "name": "Submitted JOBS",
        "order": 2,
        "width": 24,
        "height": 8,
        "columns": [
            {
                "field": "timestamp",
                "title": "Index",
                "width": "80",
                "align": "left",
                "formatter": "rownum",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "valueJSON.jobName",
                "title": "JOB Name",
                "width": "180",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "valueJSON.ruleTypes",
                "title": "Rule Types (csv)",
                "width": "120",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "valueJSON.whereClause",
                "title": "Where",
                "width": "120",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "valueJSON.limit",
                "title": "Limit",
                "width": "80",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "valueJSON.offset",
                "title": "Offset",
                "width": "80",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "timestamp",
                "title": "Time",
                "width": "120",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "valueJSON.totalRows",
                "title": "Total Rows",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 1290,
        "y": 440,
        "wires": []
    },
    {
        "id": "1e011873a5266a77",
        "type": "function",
        "z": "7904b0afeb2b68c0",
        "name": "Get Submitted JOBs Request",
        "func": "\nlet getFactsRequest =flow.get(\"getFactsRequest\") || []\n\n\n\nmsg.payload.valueJSON = JSON.parse(msg.payload.value)\ngetFactsRequest.unshift(msg.payload)\n\nif(getFactsRequest.length > 50) getFactsRequest.pop()\nflow.set('getFactsRequest', getFactsRequest)\n\nmsg.payload = getFactsRequest\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 440,
        "wires": [
            [
                "f94006127c4e3798",
                "4f09d6b681cf35af"
            ]
        ]
    },
    {
        "id": "2fe66324eaaf88a2",
        "type": "function",
        "z": "7904b0afeb2b68c0",
        "name": "function 1",
        "func": "msg.payload =[\n    {\n\n        \"topic\": \"getFacts2\",\n        \"value\": \"{\\\"filters\\\":{\\\"parent_name\\\":\\\"\\\"},\\\"page\\\":1,\\\"itemsPerPage\\\":5}\",\n        \"offset\": 55,\n        \"partition\": 0,\n        \"highWaterOffset\": 56,\n        \"key\": \"JOB2\",\n        \"timestamp\": \"2023-05-22T17:51:37.915Z\"\n    },\n    {\n        \"topic\": \"getFacts3\",\n        \"value\": \"{\\\"filters\\\":{\\\"parent_name\\\":\\\"\\\"},\\\"page\\\":1,\\\"itemsPerPage\\\":5}\",\n        \"offset\": 55,\n        \"partition\": 0,\n        \"highWaterOffset\": 56,\n        \"key\": \"JOB3\",\n        \"timestamp\": \"2023-05-22T17:51:37.915Z\"\n    }\n]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "efb170aa269caec2",
        "type": "inject",
        "z": "7904b0afeb2b68c0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 840,
        "y": 540,
        "wires": [
            [
                "2fe66324eaaf88a2"
            ]
        ]
    },
    {
        "id": "9f5e64e6da2963a2",
        "type": "kafka-consumer",
        "z": "7904b0afeb2b68c0",
        "name": "getNotification",
        "broker": "a734a95fe6c7b3dc",
        "outOfRangeOffset": "earliest",
        "fromOffset": "latest",
        "topic": "notification",
        "groupid": "",
        "x": 420,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "cc85bb2b1dcd0c22",
        "type": "ui_button",
        "z": "7904b0afeb2b68c0",
        "name": "",
        "group": "eb430edea69b48da",
        "order": 1,
        "width": "2",
        "height": "1",
        "passthru": false,
        "label": "Add",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-plus",
        "payload": "{\"api_key\":\"x5nDCpvGTkvHniq8wJ9m\",\"page\":1,\"itemsPerPage\":10,\"filters\":\"\",\"jobName\":\"New Job\",\"time_to_submit\":\"now\",\"ruleTypes\":\"estab\",\"where\":{},\"totalRows\":100}",
        "payloadType": "json",
        "topic": "topic",
        "topicType": "msg",
        "x": 190,
        "y": 340,
        "wires": [
            [
                "f3a3d8d2.5b1b98"
            ]
        ]
    },
    {
        "id": "e95f3d11.449c1",
        "type": "inject",
        "z": "50e56d1290888d82",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 120,
        "wires": [
            [
                "4ff91880.4d278"
            ]
        ]
    },
    {
        "id": "4ff91880.4d278",
        "type": "function",
        "z": "50e56d1290888d82",
        "name": "Initial Filter",
        "func": "msg.payload = {\n\n    filters:{ \"parent_name1\":\"\"},\n    page: 1,\n    itemsPerPage: 1\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 120,
        "wires": [
            [
                "8d257f7c.160ea"
            ]
        ]
    },
    {
        "id": "8d257f7c.160ea",
        "type": "http request",
        "z": "50e56d1290888d82",
        "name": "API Request",
        "method": "GET",
        "ret": "json",
        "paytoqs": "body",
        "url": "http://localhost/companies?api_token=x5nDCpvGTkvHniq8wJ9m&DEBUG=false&filters={}&page={{payload.page}}&itemsPerPage={{payload.itemsPerPage}}",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 480,
        "y": 120,
        "wires": [
            [
                "2ee7e10c.eedc26"
            ]
        ]
    },
    {
        "id": "2ee7e10c.eedc26",
        "type": "function",
        "z": "50e56d1290888d82",
        "name": "Data Transformation",
        "func": "// Perform data transformation here\n\ntry {\n    // Parse the response string as JSON\n    var rows = JSON.parse(msg.payload);\n\n    // Assign the parsed JSON to the payload for further processing\n    msg.payload = rows;\n\n    // Return the modified message object\n\n\n    // Calculate the next page number\n    var nextPage = msg.payload.page + 1;\n\n    // // Check if there are more pages to fetch\n    if (nextPage <= msg.payload.totalPages) {\n        msg.payload.page = nextPage;\n        return [msg, null]; // Send the updated filter to fetch more data\n    } else {\n        return [null, msg]; // End the flow\n\n\n\n    }\n\n\n    return msg;\n} catch (error) {\n    // Handle parsing errors\n    node.error(\"Failed to parse JSON: \" + error.message);\n    return null;\n}\n\n\n\n\n// Extract the necessary data from the API response\nvar rows = msg.payload.data;\n\n\n\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 480,
        "y": 420,
        "wires": [
            [],
            [
                "7f7cc704.f4ee0c"
            ]
        ]
    },
    {
        "id": "7f7cc704.f4ee0c",
        "type": "debug",
        "z": "50e56d1290888d82",
        "name": "Final Result",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 120,
        "wires": []
    },
    {
        "id": "f4f42ec4abed4ed1",
        "type": "debug",
        "z": "50e56d1290888d82",
        "name": "debug 3",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 540,
        "y": 580,
        "wires": []
    },
    {
        "id": "dc7fae5b6b8d3247",
        "type": "Kafka Admin",
        "z": "50e56d1290888d82",
        "d": true,
        "name": "",
        "broker": "01239f0e2e5d8173",
        "x": 130,
        "y": 340,
        "wires": [
            [
                "f4f42ec4abed4ed1"
            ],
            [
                "f4f42ec4abed4ed1"
            ]
        ]
    },
    {
        "id": "a8eca61a1377607f",
        "type": "kafka-producer",
        "z": "50e56d1290888d82",
        "d": true,
        "name": "GetFacts",
        "broker": "a734a95fe6c7b3dc",
        "topic": "getFacts",
        "requireAcks": 1,
        "ackTimeoutMs": 100,
        "attributes": 0,
        "x": 160,
        "y": 440,
        "wires": []
    },
    {
        "id": "68b02e77b331c7e0",
        "type": "kafka-consumer",
        "z": "5b93d75bf6b1464b",
        "d": true,
        "name": "gotFactsAndRules",
        "broker": "a734a95fe6c7b3dc",
        "outOfRangeOffset": "earliest",
        "fromOffset": "latest",
        "topic": "gotFactsAndRules",
        "groupid": "monitor-FactsAndRules",
        "x": 130,
        "y": 160,
        "wires": [
            [
                "d7313916b7f09773"
            ]
        ]
    },
    {
        "id": "2590f66be1246f75",
        "type": "ui_gauge",
        "z": "5b93d75bf6b1464b",
        "name": "gotFactsAndRules",
        "group": "48f7a1eaae28d5a3",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Prep (gotFactsAndRules)",
        "label": "msg/s",
        "format": "{{value}}",
        "min": 0,
        "max": "1000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 870,
        "y": 40,
        "wires": []
    },
    {
        "id": "0e9a705cb36107a9",
        "type": "kafka-consumer",
        "z": "5b93d75bf6b1464b",
        "d": true,
        "name": "gotQBES",
        "broker": "a734a95fe6c7b3dc",
        "outOfRangeOffset": "earliest",
        "fromOffset": "latest",
        "topic": "gotQBES",
        "groupid": "monitor-QBES",
        "x": 160,
        "y": 320,
        "wires": [
            [
                "5fbc44228a934cef"
            ]
        ]
    },
    {
        "id": "5fbc44228a934cef",
        "type": "function",
        "z": "5b93d75bf6b1464b",
        "name": "",
        "func": "let count = flow.get('Qcount') || 0\n++count\n\nflow.set('Qcount', count)\nmsg.payload = count\n\n// time\n// const currentDate = new Date();\n// const hours = String(currentDate.getHours()).padStart(2, '0');\n// const minutes = String(currentDate.getMinutes()).padStart(2, '0');\n// const seconds = String(currentDate.getSeconds()).padStart(2, '0');\n// const milliseconds = String(currentDate.getMilliseconds()).padStart(3, '0');\n\n// const formattedDate = `${hours}:${minutes}:${seconds}.${milliseconds}`;\n// console.log(formattedDate);\n\n\n// msg.time = formattedDate\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 300,
        "y": 320,
        "wires": [
            [
                "736a098e0d89c486",
                "f1e3cc8d17f0d90a"
            ]
        ]
    },
    {
        "id": "cb61f630f72a3a72",
        "type": "ui_gauge",
        "z": "5b93d75bf6b1464b",
        "name": "gotQBES",
        "group": "996eec6072a83356",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "gotQBES",
        "label": "msg/s",
        "format": "{{value}}",
        "min": 0,
        "max": "1000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 640,
        "y": 280,
        "wires": []
    },
    {
        "id": "047292666e30524f",
        "type": "ui_chart",
        "z": "5b93d75bf6b1464b",
        "name": "gotFactsAndRules Rate",
        "group": "48f7a1eaae28d5a3",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "1500",
        "removeOlder": "20",
        "removeOlderPoints": "",
        "removeOlderUnit": "1",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 930,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "d7313916b7f09773",
        "type": "function",
        "z": "5b93d75bf6b1464b",
        "name": "function 3",
        "func": "let count = flow.get('FRcount') || 0\n++count\n\nflow.set('FRcount', count)\nmsg.payload = count\n\n// time\nconst currentDate = new Date();\nconst hours = String(currentDate.getHours()).padStart(2, '0');\nconst minutes = String(currentDate.getMinutes()).padStart(2, '0');\nconst seconds = String(currentDate.getSeconds()).padStart(2, '0');\nconst milliseconds = String(currentDate.getMilliseconds()).padStart(3, '0');\n\nconst formattedDate = `${hours}:${minutes}:${seconds}.${milliseconds}`;\nconsole.log(formattedDate);\n\n\nmsg.time = formattedDate\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 120,
        "wires": [
            [
                "209dc2041dfe2c8f",
                "6a35c7156aa8dac8"
            ]
        ]
    },
    {
        "id": "f0a226f43452b982",
        "type": "ui_chart",
        "z": "5b93d75bf6b1464b",
        "name": "gotQBES Rate",
        "group": "996eec6072a83356",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "1500",
        "removeOlder": "20",
        "removeOlderPoints": "",
        "removeOlderUnit": "1",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 920,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "209dc2041dfe2c8f",
        "type": "msg-speed",
        "z": "5b93d75bf6b1464b",
        "name": "Rate of gotFactsAndRules",
        "frequency": "sec",
        "interval": 1,
        "estimation": false,
        "ignore": false,
        "pauseAtStartup": false,
        "topicDependent": false,
        "x": 580,
        "y": 40,
        "wires": [
            [
                "2590f66be1246f75",
                "662dc610f097b1d5"
            ],
            []
        ]
    },
    {
        "id": "736a098e0d89c486",
        "type": "msg-speed",
        "z": "5b93d75bf6b1464b",
        "name": "Rate of gotQBES",
        "frequency": "sec",
        "interval": 1,
        "estimation": false,
        "ignore": false,
        "pauseAtStartup": false,
        "topicDependent": false,
        "x": 470,
        "y": 320,
        "wires": [
            [
                "cb61f630f72a3a72",
                "7f56704fac4a07f8"
            ],
            []
        ]
    },
    {
        "id": "f1e3cc8d17f0d90a",
        "type": "ui_text",
        "z": "5b93d75bf6b1464b",
        "group": "996eec6072a83356",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "large-text",
        "x": 490,
        "y": 420,
        "wires": []
    },
    {
        "id": "6a35c7156aa8dac8",
        "type": "ui_text",
        "z": "5b93d75bf6b1464b",
        "group": "48f7a1eaae28d5a3",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": ".num1",
        "x": 490,
        "y": 200,
        "wires": []
    },
    {
        "id": "2435f540dcad5cd3",
        "type": "kafka-consumer",
        "z": "5b93d75bf6b1464b",
        "d": true,
        "name": "gotFLOW",
        "broker": "a734a95fe6c7b3dc",
        "outOfRangeOffset": "earliest",
        "fromOffset": "latest",
        "topic": "gotFLOW",
        "groupid": "monitor-FLOW",
        "x": 120,
        "y": 540,
        "wires": [
            [
                "0b818dde7278d861"
            ]
        ]
    },
    {
        "id": "0b818dde7278d861",
        "type": "function",
        "z": "5b93d75bf6b1464b",
        "name": "",
        "func": "let count = flow.get('Flcount') || 0\n++count\n\nflow.set('Flcount', count)\nmsg.payload = count\n\n// time\n// const currentDate = new Date();\n// const hours = String(currentDate.getHours()).padStart(2, '0');\n// const minutes = String(currentDate.getMinutes()).padStart(2, '0');\n// const seconds = String(currentDate.getSeconds()).padStart(2, '0');\n// const milliseconds = String(currentDate.getMilliseconds()).padStart(3, '0');\n\n// const formattedDate = `${hours}:${minutes}:${seconds}.${milliseconds}`;\n// console.log(formattedDate);\n\n\n// msg.time = formattedDate\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 540,
        "wires": [
            [
                "ad770cdd757f61b0",
                "910cda8ecced866a"
            ]
        ]
    },
    {
        "id": "b5b3f3ba092e5086",
        "type": "ui_gauge",
        "z": "5b93d75bf6b1464b",
        "name": "gotFLOW",
        "group": "114d7a8d369bd580",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "gotFLOW",
        "label": "msg/s",
        "format": "{{value}}",
        "min": 0,
        "max": "1000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 620,
        "y": 500,
        "wires": []
    },
    {
        "id": "5ffca1f4b79bed35",
        "type": "ui_chart",
        "z": "5b93d75bf6b1464b",
        "name": "gotFLOW Rate",
        "group": "114d7a8d369bd580",
        "order": 3,
        "width": 0,
        "height": 0,
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "1500",
        "removeOlder": "20",
        "removeOlderPoints": "",
        "removeOlderUnit": "1",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 800,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "ad770cdd757f61b0",
        "type": "msg-speed",
        "z": "5b93d75bf6b1464b",
        "name": "Rate of gotFLOW",
        "frequency": "sec",
        "interval": 1,
        "estimation": false,
        "ignore": false,
        "pauseAtStartup": false,
        "topicDependent": false,
        "x": 450,
        "y": 540,
        "wires": [
            [
                "b5b3f3ba092e5086",
                "f4a31c78cdd7a7ed"
            ],
            []
        ]
    },
    {
        "id": "910cda8ecced866a",
        "type": "ui_text",
        "z": "5b93d75bf6b1464b",
        "group": "114d7a8d369bd580",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "large-text",
        "x": 470,
        "y": 640,
        "wires": []
    },
    {
        "id": "ef4f0392366d1ebc",
        "type": "ui_button",
        "z": "5b93d75bf6b1464b",
        "name": "",
        "group": "e9f83f755d518ecd",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "replay",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 190,
        "y": 760,
        "wires": [
            [
                "71bfae055bcddd8c"
            ]
        ]
    },
    {
        "id": "71bfae055bcddd8c",
        "type": "function",
        "z": "5b93d75bf6b1464b",
        "name": "function",
        "func": "flow.set('Flcount', 0)\nflow.set('Qcount', 0)\nflow.set('FRcount', 0)\n\nmsg.payload = 0\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 760,
        "wires": [
            [
                "33715e06582ea903"
            ]
        ]
    },
    {
        "id": "33715e06582ea903",
        "type": "link out",
        "z": "5b93d75bf6b1464b",
        "name": "link out clearbutton",
        "mode": "link",
        "links": [
            "f453bd68030b7579",
            "acfb6194fd1c2634",
            "429686d6c1a3a7c7"
        ],
        "x": 435,
        "y": 760,
        "wires": []
    },
    {
        "id": "429686d6c1a3a7c7",
        "type": "link in",
        "z": "5b93d75bf6b1464b",
        "name": "link in clear text 3",
        "links": [
            "33715e06582ea903"
        ],
        "x": 365,
        "y": 640,
        "wires": [
            [
                "910cda8ecced866a"
            ]
        ]
    },
    {
        "id": "acfb6194fd1c2634",
        "type": "link in",
        "z": "5b93d75bf6b1464b",
        "name": "link in clear text 2",
        "links": [
            "33715e06582ea903"
        ],
        "x": 385,
        "y": 420,
        "wires": [
            [
                "f1e3cc8d17f0d90a"
            ]
        ]
    },
    {
        "id": "f453bd68030b7579",
        "type": "link in",
        "z": "5b93d75bf6b1464b",
        "name": "link in clear text 1",
        "links": [
            "33715e06582ea903"
        ],
        "x": 385,
        "y": 200,
        "wires": [
            [
                "6a35c7156aa8dac8"
            ]
        ]
    },
    {
        "id": "662dc610f097b1d5",
        "type": "rbe",
        "z": "5b93d75bf6b1464b",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 730,
        "y": 100,
        "wires": [
            [
                "047292666e30524f"
            ]
        ]
    },
    {
        "id": "7f56704fac4a07f8",
        "type": "rbe",
        "z": "5b93d75bf6b1464b",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 690,
        "y": 320,
        "wires": [
            [
                "f0a226f43452b982"
            ]
        ]
    },
    {
        "id": "f4a31c78cdd7a7ed",
        "type": "rbe",
        "z": "5b93d75bf6b1464b",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 630,
        "y": 540,
        "wires": [
            [
                "5ffca1f4b79bed35"
            ]
        ]
    },
    {
        "id": "918f1a6a7f8e0da0",
        "type": "ui_table",
        "z": "762437ab597e66e7",
        "group": "f1ba9b7b3ccb3021",
        "name": "PreData",
        "order": 1,
        "width": 8,
        "height": 13,
        "columns": [
            {
                "field": "preData",
                "title": "PreData",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 720,
        "y": 320,
        "wires": []
    },
    {
        "id": "08499d1a576e8c5e",
        "type": "function",
        "z": "762437ab597e66e7",
        "name": "Edit PreData for table display",
        "func": "let arr = []\n\nif (msg.payload.rows[0]) {\n    msg.payload = msg.payload.rows[0]\n}\n\nfor (let prop in msg.payload) {\n    if (msg.payload.hasOwnProperty(prop)) {\n        arr.push(\n            {\n                \"preData\": JSON.stringify(prop) + \": \" + JSON.stringify(msg.payload[prop])\n            }\n        )\n    }\n}\n\nmsg.payload = arr\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 320,
        "wires": [
            [
                "918f1a6a7f8e0da0"
            ]
        ]
    },
    {
        "id": "3078bbd57bbee057",
        "type": "digitaloak-postgresql-query",
        "z": "762437ab597e66e7",
        "d": true,
        "name": "",
        "server": "d25654593e23b264",
        "inputs": 1,
        "outputs": 1,
        "x": 230,
        "y": 260,
        "wires": [
            [
                "56566e824f8876c0"
            ]
        ]
    },
    {
        "id": "d083dbfbcc7f8565",
        "type": "inject",
        "z": "762437ab597e66e7",
        "name": "",
        "props": [
            {
                "p": "query",
                "v": "SELECT *  FROM product_aies.balance",
                "vt": "str"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 170,
        "y": 200,
        "wires": [
            [
                "3078bbd57bbee057"
            ]
        ]
    },
    {
        "id": "56566e824f8876c0",
        "type": "function",
        "z": "762437ab597e66e7",
        "name": "function 26",
        "func": "msg.payload = JSON.parse(JSON.stringify(msg.payload))\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 320,
        "wires": [
            [
                "4487da4bad26b086",
                "08499d1a576e8c5e",
                "b1b0259364f23c4f"
            ]
        ]
    },
    {
        "id": "4487da4bad26b086",
        "type": "debug",
        "z": "762437ab597e66e7",
        "name": "debug 53",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 260,
        "y": 360,
        "wires": []
    },
    {
        "id": "b1b0259364f23c4f",
        "type": "function",
        "z": "762437ab597e66e7",
        "name": "balance module",
        "func": "\nif (msg.payload.rows[0]) {\n    msg.payload = msg.payload.rows[0]\n}\n\nfunction sumOfVariables(total, arr) {\n    let sumDET = 0;\n    for (let i = 0; i < arr.length; i++) {\n        sumDET += arr[i];\n    }    \n    \n    if (sumDET > 0 && total == 0 ) {\n        total = sumDET\n        msg.payload.total_flg ? msg.payload.total_flg + 'L' : msg.payload.total_flg = 'L'\n    } else if (sumDET == 0 && total > 0 ) {\n        total = sumDET\n        msg.payload.details_flg ? msg.payload.details_flg + 'X' : msg.payload.details_flg = 'X'\n    } else if (sumDET > 0 && total > 0) {\n        let ratio = sumDET / total;\n        if (ratio >= 0.8 && ratio <= 1.2) {\n            msg.payload.details_flg ? msg.payload.details_flg + 'X' : msg.payload.details_flg = 'X'\n        } else {\n            total = sumDET\n            msg.payload.details_flg ? msg.payload.details_flg + 'X' : msg.payload.details_flg = 'X'\n        }\n    } else if (sumDET == 0 && total == 0 ) {\n        msg.imputations = true\n        msg.payload.details_flg ? msg.payload.details_flg + 'X' : msg.payload.details_flg = 'X'\n    }\n}\n\nsumOfVariables(msg.payload.capex_mach_tot_dval, [msg.payload.capex_build_new_val, msg.payload.capex_build_used_val] )\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 420,
        "wires": [
            [
                "fef8d59666620920",
                "ee87e1c7492c79a6"
            ]
        ]
    },
    {
        "id": "f992b22ba61fed2a",
        "type": "ui_table",
        "z": "762437ab597e66e7",
        "group": "05ad88d05dd28ef3",
        "name": "PostData",
        "order": 1,
        "width": 8,
        "height": 13,
        "columns": [
            {
                "field": "postData",
                "title": "PostData",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 1,
        "cts": true,
        "x": 960,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "fef8d59666620920",
        "type": "function",
        "z": "762437ab597e66e7",
        "name": "Edit PostData for table display",
        "func": "let arr = []\n\nfor (let prop in msg.payload) {\n    if (msg.payload.hasOwnProperty(prop)) {\n        arr.push(\n            {\n                \"postData\": JSON.stringify(prop) + \": \" + JSON.stringify(msg.payload[prop])\n            }\n        )\n    }\n}\n\nmsg.payload = arr\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 420,
        "wires": [
            [
                "f992b22ba61fed2a"
            ]
        ]
    },
    {
        "id": "ee87e1c7492c79a6",
        "type": "debug",
        "z": "762437ab597e66e7",
        "name": "debug 54",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 540,
        "wires": []
    },
    {
        "id": "e9fa3350f5c93cb6",
        "type": "switch",
        "z": "6e9fd4ed1a3126bb",
        "name": "AIES_SCOPE = Y?",
        "property": "payload.csv[0].AIES_SCOPE",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 410,
        "y": 60,
        "wires": [
            [
                "0cca7ad92d65e9cb"
            ],
            []
        ]
    },
    {
        "id": "0cca7ad92d65e9cb",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6e9fd4ed1a3126bb",
        "name": "No, go to KAU to Company Additivity Check",
        "x": 730,
        "y": 60,
        "wires": [
            [
                "91a9fa721bc780a7"
            ]
        ]
    },
    {
        "id": "28d12ec798feff1f",
        "type": "comment",
        "z": "6e9fd4ed1a3126bb",
        "name": "Yes, Estab",
        "info": "",
        "x": 180,
        "y": 120,
        "wires": []
    },
    {
        "id": "3be8086856cf7054",
        "type": "comment",
        "z": "6e9fd4ed1a3126bb",
        "name": "KAU",
        "info": "",
        "x": 190,
        "y": 420,
        "wires": []
    },
    {
        "id": "8308a860a28a667a",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6e9fd4ed1a3126bb",
        "name": "Estab to KAU Additivity Check",
        "x": 430,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "9a33c9d5fc0da1ac",
        "type": "comment",
        "z": "6e9fd4ed1a3126bb",
        "name": "Company",
        "info": "",
        "x": 180,
        "y": 680,
        "wires": []
    },
    {
        "id": "316698c0494d4e3b",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6e9fd4ed1a3126bb",
        "name": "KAU to Company Additivity Check",
        "x": 440,
        "y": 760,
        "wires": [
            [
                "b0b45ae1f1bdcdbd"
            ]
        ]
    },
    {
        "id": "b0b45ae1f1bdcdbd",
        "type": "switch",
        "z": "6e9fd4ed1a3126bb",
        "name": "Changes made?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Y",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Y",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 740,
        "y": 760,
        "wires": [
            [
                "3157732f4bf84ecd"
            ],
            [
                "0af56ba421e1a804"
            ]
        ]
    },
    {
        "id": "3157732f4bf84ecd",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6e9fd4ed1a3126bb",
        "name": "Yes, go to BR stat evaluation",
        "x": 980,
        "y": 760,
        "wires": [
            [
                "ae6ad5331182af2d"
            ]
        ]
    },
    {
        "id": "0af56ba421e1a804",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6e9fd4ed1a3126bb",
        "name": "Company Complete",
        "x": 760,
        "y": 840,
        "wires": [
            [
                "93e6d382a25077f2"
            ]
        ]
    },
    {
        "id": "93e6d382a25077f2",
        "type": "subflow:03552ca229e3a7a0",
        "z": "6e9fd4ed1a3126bb",
        "name": "Rerun data prep edits or just Derived Items?",
        "x": 1110,
        "y": 840,
        "wires": [
            [
                "36ac45a273e5509f"
            ]
        ]
    },
    {
        "id": "91a9fa721bc780a7",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "go to KAU additivity check",
        "mode": "link",
        "links": [
            "67f5350a6d95fbeb"
        ],
        "x": 945,
        "y": 60,
        "wires": []
    },
    {
        "id": "67f5350a6d95fbeb",
        "type": "link in",
        "z": "6e9fd4ed1a3126bb",
        "name": "link in 31",
        "links": [
            "91a9fa721bc780a7"
        ],
        "x": 285,
        "y": 760,
        "wires": [
            [
                "316698c0494d4e3b"
            ]
        ]
    },
    {
        "id": "ae6ad5331182af2d",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "go to BR stat eval",
        "mode": "link",
        "links": [
            "86d4c2b68eb247d4"
        ],
        "x": 1115,
        "y": 760,
        "wires": []
    },
    {
        "id": "9f944ba2a098566c",
        "type": "function",
        "z": "6e9fd4ed1a3126bb",
        "name": "Append Data",
        "func": "let s = flow.get(\"state\") || []\nlet p = msg.payload.csv[0]\np.inputOrOutput = \"out\"\np.timestamp = generateTimestamp()\ns.unshift(p)\n\nif (s.length > 50) {\n    s = s.slice(0, 50);\n}\n\nflow.set(\"state\", s)\nmsg.payload = s\n\n\nfunction generateTimestamp() {\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = String(now.getMonth() + 1).padStart(2, '0');\n    const day = String(now.getDate()).padStart(2, '0');\n    let hour = now.getHours();\n    const minute = String(now.getMinutes()).padStart(2, '0');\n    const second = String(now.getSeconds()).padStart(2, '0');\n\n    let period = 'AM';\n    if (hour >= 12) {\n        period = 'PM';\n        hour -= 12;\n    }\n    if (hour === 0) {\n        hour = 12;\n    }\n\n    const timestamp = `${year}-${month}-${day} ${hour}:${minute}:${second} ${period}`;\n    return timestamp;\n}\n\n\nnode.send(msg);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 1000,
        "wires": [
            [
                "8adc41f28f4031b3",
                "cb8e966fa360d484"
            ]
        ]
    },
    {
        "id": "8adc41f28f4031b3",
        "type": "ui_table",
        "z": "6e9fd4ed1a3126bb",
        "group": "6414e38571345793",
        "name": "Modules Data",
        "order": 1,
        "width": "18",
        "height": "20",
        "columns": [
            {
                "field": "EPPAYANN",
                "title": "Index",
                "width": "",
                "align": "left",
                "formatter": "rownum",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "timestamp",
                "title": "Created",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "module",
                "title": "Module",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "inputOrOutput",
                "title": "In / Out",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "PAY_ANN_VAL",
                "title": "PAY_ANN_VAL",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "EMP_MAR12_NUM",
                "title": "EMP_MAR12_NUM",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "PAY_QTR1_VAL",
                "title": "PAY_QTR1_VAL",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            },
            {
                "field": "RCPT_TOT_VAL",
                "title": "RCPT_TOT_VAL",
                "width": "",
                "align": "left",
                "formatter": "plaintext",
                "formatterParams": {
                    "target": "_blank"
                }
            }
        ],
        "outputs": 0,
        "cts": false,
        "x": 620,
        "y": 1000,
        "wires": []
    },
    {
        "id": "d50a64a5a0668810",
        "type": "link in",
        "z": "6e9fd4ed1a3126bb",
        "name": "link in TABLE",
        "links": [
            "0213c59c5c3e5daa",
            "1728e38a2a40b462",
            "29f9126c35b5deb6",
            "2a4d52398bb3d587",
            "455c8bacb3059701",
            "4b287c6a84b703e2",
            "5a039fea024b882c",
            "5e2818279732d1d4",
            "608e1d25710336f8",
            "86016fdfc48b4351",
            "875ce7d3fc33f058",
            "892b56b0bc650876",
            "97538a9f125810a7",
            "9f74945d93f983f1",
            "b65643afe0093cf5",
            "b73c8d9aecceec59",
            "ba4f6f3992473497",
            "c261422973f8441f",
            "c8729912fca5fc84",
            "d8f39773080a0179",
            "e3b9801fea0e353f",
            "eebe4f43ea98127d",
            "f2e55b876978ee47",
            "f51d8c89650868a3",
            "f8c507b76d49363e",
            "76611ce4593cf7cb"
        ],
        "x": 305,
        "y": 1000,
        "wires": [
            [
                "9f944ba2a098566c"
            ]
        ]
    },
    {
        "id": "f2e55b876978ee47",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 28",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 455,
        "y": 200,
        "wires": []
    },
    {
        "id": "86016fdfc48b4351",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 29",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 655,
        "y": 200,
        "wires": []
    },
    {
        "id": "5a039fea024b882c",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 30",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 975,
        "y": 200,
        "wires": []
    },
    {
        "id": "2a4d52398bb3d587",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 31",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1335,
        "y": 200,
        "wires": []
    },
    {
        "id": "c261422973f8441f",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 32",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1695,
        "y": 200,
        "wires": []
    },
    {
        "id": "c8729912fca5fc84",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 33",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 455,
        "y": 300,
        "wires": []
    },
    {
        "id": "892b56b0bc650876",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 34",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 655,
        "y": 300,
        "wires": []
    },
    {
        "id": "97538a9f125810a7",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 35",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 895,
        "y": 300,
        "wires": []
    },
    {
        "id": "f8c507b76d49363e",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 36",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1115,
        "y": 300,
        "wires": []
    },
    {
        "id": "ba4f6f3992473497",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 37",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 455,
        "y": 420,
        "wires": []
    },
    {
        "id": "4b287c6a84b703e2",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 38",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 815,
        "y": 420,
        "wires": []
    },
    {
        "id": "d8f39773080a0179",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 39",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1015,
        "y": 420,
        "wires": []
    },
    {
        "id": "5e2818279732d1d4",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 40",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1215,
        "y": 420,
        "wires": []
    },
    {
        "id": "b65643afe0093cf5",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 41",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1415,
        "y": 420,
        "wires": []
    },
    {
        "id": "eebe4f43ea98127d",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 42",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1635,
        "y": 420,
        "wires": []
    },
    {
        "id": "f51d8c89650868a3",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 43",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1615,
        "y": 480,
        "wires": []
    },
    {
        "id": "875ce7d3fc33f058",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 45",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 455,
        "y": 680,
        "wires": []
    },
    {
        "id": "9f74945d93f983f1",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 46",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 665,
        "y": 680,
        "wires": []
    },
    {
        "id": "1728e38a2a40b462",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 47",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 855,
        "y": 680,
        "wires": []
    },
    {
        "id": "29f9126c35b5deb6",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 48",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1075,
        "y": 680,
        "wires": []
    },
    {
        "id": "0213c59c5c3e5daa",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 49",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1255,
        "y": 680,
        "wires": []
    },
    {
        "id": "b73c8d9aecceec59",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 52",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 1495,
        "y": 200,
        "wires": []
    },
    {
        "id": "0d309d88aeecd224",
        "type": "subflow:acd9862f30af144d",
        "z": "6e9fd4ed1a3126bb",
        "name": "PV",
        "x": 1430,
        "y": 200,
        "wires": [
            [
                "b73c8d9aecceec59"
            ]
        ]
    },
    {
        "id": "faa95fef437a3a8f",
        "type": "subflow:fd9469a0efbb8a77",
        "z": "6e9fd4ed1a3126bb",
        "name": "Unit Balance",
        "x": 570,
        "y": 300,
        "wires": [
            [
                "892b56b0bc650876"
            ]
        ]
    },
    {
        "id": "d1d4ee74592f6469",
        "type": "subflow:fd9469a0efbb8a77",
        "z": "6e9fd4ed1a3126bb",
        "name": "Unit Balance",
        "x": 1330,
        "y": 420,
        "wires": [
            [
                "b65643afe0093cf5"
            ]
        ]
    },
    {
        "id": "84eeb0777962ace2",
        "type": "subflow:fd9469a0efbb8a77",
        "z": "6e9fd4ed1a3126bb",
        "name": "Unit Balance",
        "x": 770,
        "y": 680,
        "wires": [
            [
                "1728e38a2a40b462"
            ]
        ]
    },
    {
        "id": "cb8e966fa360d484",
        "type": "debug",
        "z": "6e9fd4ed1a3126bb",
        "name": "Modules Data to Table",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 1060,
        "wires": []
    },
    {
        "id": "fa428e05926d3d8a",
        "type": "subflow:96f29b19e2260e65",
        "z": "6e9fd4ed1a3126bb",
        "name": "Post Edit",
        "x": 1040,
        "y": 300,
        "wires": [
            [
                "f8c507b76d49363e"
            ]
        ]
    },
    {
        "id": "a813b3bcc9032af7",
        "type": "subflow:96f29b19e2260e65",
        "z": "6e9fd4ed1a3126bb",
        "name": "Post Edit",
        "x": 1540,
        "y": 480,
        "wires": [
            [
                "f51d8c89650868a3",
                "8308a860a28a667a"
            ]
        ]
    },
    {
        "id": "054a7fbcddde2975",
        "type": "subflow:96f29b19e2260e65",
        "z": "6e9fd4ed1a3126bb",
        "name": "Post Edit",
        "x": 1180,
        "y": 680,
        "wires": [
            [
                "0213c59c5c3e5daa",
                "316698c0494d4e3b"
            ]
        ]
    },
    {
        "id": "23051ea3268843f2",
        "type": "ui_button",
        "z": "6e9fd4ed1a3126bb",
        "name": "",
        "group": "6414e38571345793",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Reset",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 390,
        "y": 920,
        "wires": [
            [
                "358bd9e6e520f05e"
            ]
        ]
    },
    {
        "id": "358bd9e6e520f05e",
        "type": "function",
        "z": "6e9fd4ed1a3126bb",
        "name": "Clear Data",
        "func": "flow.set(\"state\", []);\n\nmsg.payload = []\n\nnode.send(msg);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 920,
        "wires": [
            [
                "8adc41f28f4031b3"
            ]
        ]
    },
    {
        "id": "76611ce4593cf7cb",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 53",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 255,
        "y": 60,
        "wires": []
    },
    {
        "id": "86d4c2b68eb247d4",
        "type": "link in",
        "z": "6e9fd4ed1a3126bb",
        "name": "link in 32",
        "links": [
            "ae6ad5331182af2d"
        ],
        "x": 265,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "e3b9801fea0e353f",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 25",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 495,
        "y": 120,
        "wires": []
    },
    {
        "id": "608e1d25710336f8",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 26",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 695,
        "y": 120,
        "wires": []
    },
    {
        "id": "455c8bacb3059701",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out 27",
        "mode": "link",
        "links": [
            "d50a64a5a0668810"
        ],
        "x": 895,
        "y": 120,
        "wires": []
    },
    {
        "id": "113d3062305ee712",
        "type": "inject",
        "z": "6e9fd4ed1a3126bb",
        "name": "Incoming Data from QBES",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"csv\":[{\"failure\":1,\"SUM(DET)\":1,\"TOT\":1,\"INDP\":1,\"ESMD\":1,\"REPORTING_ID_TYP\":\"SU\",\"FORM_CODE_IRS\":\"01\",\"NAICS_SECTOR\":51,\"RCPT_NET_IRS_CURR\":24041,\"RCPT_INTEREST_IRS_CURR\":10,\"RCPT_GROSSRENT_IRS_CURR\":20,\"RCPT_OTHINCOME_IRS_CURR\":30,\"RCPT_GROSSINC_IRS_CURR\":40,\"RCPT_TOTINC_IRS_CURR\":50,\"RCPT_TOTREV_IRS_CURR\":60,\"COST_GOODSOLD_IRS_CURR\":70,\"AIES_SCOPE\":\"Y\",\"BR_STAT\":\"Y\",\"NAICS_CODE_OLD\":4821,\"NAICS_WRITIN_TEXT\":\"na\",\"KAU_NAICS\":6221101,\"COVCHGCD\":111,\"COVCHGDT\":\"2022-12-31\",\"Data\":0,\"PDIV\":\"S\",\"ANAIC\":1151234,\"EDTROUTE\":1,\"NAICOLD\":2151234,\"NAICSDSG\":3151234,\"NAICMAIL\":4151234,\"TRADCODE\":\"M\",\"STFIPS\":\"01\",\"GEOREG\":\"03\",\"ACTV_MIO_NUM\":8,\"ACTV_MIO_NUM_FLG\":\"RC\",\"OPSTATS\":\"\",\"OPSTATS_FLG\":\"R\",\"COV_CHG_CODE\":791,\"ACTVMIO_R\":10,\"COV_CHG_DATE\":\"2022-12-31\",\"OPSTAT\":5,\"OPSTAT_FLAG\":\"R\",\"RECORD_TYP\":89,\"BMF_FR941\":3,\"EPPAYANN\":0,\"NONNORM_FLG\":\"\",\"NONNORM\":\"\",\"PAY_QTR1_VAL\":0,\"EMP_MAR12_NUM\":0,\"OPSTATS_F\":\"RC\",\"TEMPMIO\":0,\"ECPAYQ1\":0,\"ACTV_MIO_VAL\":0,\"ACTV_MIO_VAL_FLG\":\"L\",\"ECPAYQ2\":3,\"ECPAYQ3\":4,\"ECPAYQ4\":5,\"ECPAYQ4_F\":\"\",\"REFPER\":2023,\"MADBPAYANN\":0,\"EMP_MAR12_NUM_F\":\"RG\",\"PAY_ANN_VAL\":0,\"PAY_QTR1_VAL_R\":0,\"PAY_QTR1_VAL_FLG\":\"R\",\"EMP_MAR12_NUM_FLG\":\"R\",\"CY_PAY_QTR1_VAL\":1,\"ECPAYQ1ZERO\":\"\",\"CY_EMP_MAR12_NUM\":1,\"ECEMPQ1\":1,\"RCPT_TOT_VAL\":0,\"module\":\"Incoming QBES\",\"UNIT\":\"ESTAB\",\"PAY_ANN_LSD\":0,\"EXPS_TEMPSTAF_VAL\":0,\"PROCESS_DIV_CODE\":\"I\",\"PAY_ANN_PRDWRK_VAL\":0,\"PAY_ANN_NONPRDWRK_VAL\":0,\"ECPAYANN\":10900,\"CY_PAY_ANN\":0,\"CY_PAY_ANN_FLG\":\"K123\",\"ESTABS\":1,\"HISTORIC_ECON_CENSUS\":1,\"MADB_2022_PAYANN\":1,\"ECRCPTOT\":1000,\"MONTHLY_data\":1,\"QSS_data\":1,\"MONTHLY_CMON\":1000,\"QUARTERLY_QREV\":1,\"MADB_2022_RCPTOT\":1,\"MADB_2022_PAYQ1\":1,\"RCPT_TOT_VAL_FLG\":\"\",\"PAY_QTR1_PRDWRK_VAL\":400,\"PAY_QTR1_NONPRDWRK_VAL\":12,\"EMP_MAR12_VAL\":0,\"EMP_MAR12_PRDWRK_NUM\":0,\"EMP_MAR12_NONPRDWRK_NUM\":0,\"MADB_2022_EMPQ1\":120,\"CY_EMP_MAR12\":70,\"CY_EMP_MAR12_FLG\":\"B\",\"EMP_MAR12_VAL_FLG\":\"C\"}]}",
        "payloadType": "json",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "e9fa3350f5c93cb6",
                "76611ce4593cf7cb"
            ]
        ]
    },
    {
        "id": "4480a2673228edf6",
        "type": "link in",
        "z": "6e9fd4ed1a3126bb",
        "name": "link in gotQBES",
        "links": [
            "47bbe840e0da7226",
            "3ec01d49fbdfba54"
        ],
        "x": 265,
        "y": 20,
        "wires": [
            [
                "e9fa3350f5c93cb6"
            ]
        ]
    },
    {
        "id": "36ac45a273e5509f",
        "type": "link out",
        "z": "6e9fd4ed1a3126bb",
        "name": "link out to gotFLOW",
        "mode": "link",
        "links": [
            "b982c1cf6a93e62d",
            "8ad2ab7c27d8d248"
        ],
        "x": 1335,
        "y": 840,
        "wires": []
    },
    {
        "id": "ed77e55538e24a1f",
        "type": "link out",
        "z": "b2e59c2394f7c26c",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 825,
        "y": 760,
        "wires": []
    },
    {
        "id": "3a3f1620dbce8bb0",
        "type": "link in",
        "z": "b2e59c2394f7c26c",
        "name": "Post Edit Status Status Field Link",
        "links": [
            "270941def4b7c8b6"
        ],
        "x": 225,
        "y": 980,
        "wires": [
            []
        ]
    },
    {
        "id": "b6bebbeac0549686",
        "type": "link out",
        "z": "b2e59c2394f7c26c",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 625,
        "y": 980,
        "wires": []
    },
    {
        "id": "6ee2ec45fe951e56",
        "type": "subflow:9e4e212b0811233d",
        "z": "b2e59c2394f7c26c",
        "name": "",
        "x": 480,
        "y": 1140,
        "wires": [
            [
                "ece1e11393b49799"
            ]
        ]
    },
    {
        "id": "384ea40a25aa8e76",
        "type": "link in",
        "z": "b2e59c2394f7c26c",
        "name": "Pre Db Write Back For Leased",
        "links": [
            "fbcbf9510de0509c"
        ],
        "x": 225,
        "y": 1140,
        "wires": [
            [
                "6ee2ec45fe951e56"
            ]
        ]
    },
    {
        "id": "ece1e11393b49799",
        "type": "link out",
        "z": "b2e59c2394f7c26c",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 685,
        "y": 1140,
        "wires": []
    },
    {
        "id": "82512cd1437a65ef",
        "type": "subflow:0be109393cb5f28a",
        "z": "6399b853963e761e",
        "name": "",
        "x": 630,
        "y": 980,
        "wires": [
            [
                "446e40b2499253e6"
            ]
        ]
    },
    {
        "id": "5ffef6c04222007d",
        "type": "debug",
        "z": "6399b853963e761e",
        "name": "debug 107",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1050,
        "y": 980,
        "wires": []
    },
    {
        "id": "446e40b2499253e6",
        "type": "function",
        "z": "6399b853963e761e",
        "name": "function 37",
        "func": "let paramsT = global.get(\"lookupCache\")\nmsg.cache = paramsT\nlet record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\nconst params = paramsT?.data[0]?.json_values\nconst input = record\nconst NAICS_NUM = input?.NAICS_NUM;\n\nfunction LogicalEdits(input) {\n    const { NAICS_NUM } = input;\n    if (parseFloat(EXPS_ELEC_VAL) <= 10000) {\n        console.log(1)\n        msg.payload.csv[record_idx].ACTION = \"Go To A\";\n    } else{\n        console.log(2)\n        msg.payload.csv[record_idx].ELEC_PRCH_KWH_NUM = Math.round(parseFloat(EXPS_ELEC_VAL) * parseFloat(parameter.AVG1));\n        msg.payload.csv[record_idx].ELEC_PRCH_KWH_NUM_F = 'B'; // What is (3,1) here ?\n        msg.payload.csv[record_idx].ACTION = \"Go To A - END\";\n    }\n    return msg;\n}\n\nreturn LogicalEdits(input)",
        "outputs": 1,
        "noerr": 5,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 980,
        "wires": [
            [
                "5ffef6c04222007d",
                "782e6a52f1a66003"
            ]
        ]
    },
    {
        "id": "affe73445eec8a4f",
        "type": "link in",
        "z": "6399b853963e761e",
        "name": "link in 46",
        "links": [
            "cede3264bdcd0a70",
            "36c4687d5f1bee6b",
            "24ae978c7feb5fc3"
        ],
        "x": 155,
        "y": 980,
        "wires": [
            [
                "d6716f22d2ac0593"
            ]
        ]
    },
    {
        "id": "d6716f22d2ac0593",
        "type": "change",
        "z": "6399b853963e761e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"electric_energy\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"electric_energy_module\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 980,
        "wires": [
            [
                "82512cd1437a65ef"
            ]
        ]
    },
    {
        "id": "782e6a52f1a66003",
        "type": "link out",
        "z": "6399b853963e761e",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 930,
        "y": 1040,
        "wires": []
    },
    {
        "id": "c903163629df82af",
        "type": "function",
        "z": "6399b853963e761e",
        "name": "electricImputeModule",
        "func": "let record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\n// Assumed JavaScript function based on the newest extracted OCR text (Electric Impute Module)\nfunction electricImputeModule(T_STFIPS, REFPER, ELEC_PRCH_KWH_NUM, EXPS_ELEC_VAL) {\n    // Placeholder for NM_State parameter table\n    let NM_STATE_PARAMETER_TABLE = {\n        AVG1: 0,\n        AVG2: 0\n    };\n\n    let { AVG1, AVG2 } = NM_STATE_PARAMETER_TABLE;\n\n    if (EXPS_ELEC_VAL <= 10000) {\n        // Logic for Year 1 historic values (H_) referencing 2022 EC data. Year 2 and on will refer to prior year AIES data\n    }\n\n    if (ELEC_PRCH_KWH_NUM_F[3][1] !== 'B') {\n        ELEC_PRCH_KWH_NUM = Math.round(EXPS_ELEC_VAL * AVG2);\n        ELEC_PRCH_KWH_NUM_F[3][1] = 'B';\n    } else {\n        ELEC_PRCH_KWH_NUM = Math.round(EXPS_ELEC_VAL * AVG1);\n    }\n\n    // Additional logic...\n\n    return EXPS_ELEC_VAL;\n}\n\n",
        "outputs": 1,
        "noerr": 9,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 240,
        "wires": [
            [
                "ba693bb539d071b9",
                "eda519aa8a1db303"
            ]
        ]
    },
    {
        "id": "ba693bb539d071b9",
        "type": "debug",
        "z": "6399b853963e761e",
        "name": "debug electricImputeModule",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 160,
        "wires": []
    },
    {
        "id": "eda519aa8a1db303",
        "type": "link out",
        "z": "6399b853963e761e",
        "name": "link out 58",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 585,
        "y": 280,
        "wires": []
    },
    {
        "id": "5f5ca49f66f32b41",
        "type": "function",
        "z": "6399b853963e761e",
        "name": "electricImputeModule",
        "func": "let record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\n// Assumed JavaScript function based on the newest extracted OCR text (Electric Impute Module)\nfunction electricImputeModule(T_STFIPS, REFPER, ELEC_PRCH_KWH_NUM, EXPS_ELEC_VAL) {\n    // Placeholder for NM_State parameter table\n    let NM_STATE_PARAMETER_TABLE = {\n        AVG1: 0,\n        AVG2: 0\n    };\n\n    let { AVG1, AVG2 } = NM_STATE_PARAMETER_TABLE;\n\n    if (EXPS_ELEC_VAL <= 10000) {\n        // Logic for Year 1 historic values (H_) referencing 2022 EC data. Year 2 and on will refer to prior year AIES data\n    }\n\n    if (ELEC_PRCH_KWH_NUM_F[3][1] !== 'B') {\n        ELEC_PRCH_KWH_NUM = Math.round(EXPS_ELEC_VAL * AVG2);\n        ELEC_PRCH_KWH_NUM_F[3][1] = 'B';\n    } else {\n        ELEC_PRCH_KWH_NUM = Math.round(EXPS_ELEC_VAL * AVG1);\n    }\n\n    // Additional logic...\n\n    return EXPS_ELEC_VAL;\n}\n\n",
        "outputs": 1,
        "noerr": 9,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 460,
        "wires": [
            [
                "d024af4d5725903e",
                "8b699616f9c5a9b5"
            ]
        ]
    },
    {
        "id": "d024af4d5725903e",
        "type": "debug",
        "z": "6399b853963e761e",
        "name": "debug electricImputeModule",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 380,
        "wires": []
    },
    {
        "id": "8b699616f9c5a9b5",
        "type": "link out",
        "z": "6399b853963e761e",
        "name": "link out 59",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 585,
        "y": 500,
        "wires": []
    },
    {
        "id": "1455ef9792b755e9",
        "type": "function",
        "z": "6399b853963e761e",
        "name": "Main",
        "func": "let record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\nconst params = {\n    MN_ELECTRIC_STATE: [\n        { 'GEO_ST': '01', 'AVG1': 6.99263, 'AVG2': 12.1924, 'ELEC_INTERSECT': 1000, 'LL': 0.02, 'UL': 0.29 },\n        { 'GEO_ST': '02', 'AVG1': 2.97017, 'AVG2': 6.2589, 'ELEC_INTERSECT': 1000, 'LL': 0.03, 'UL': 0.21 },\n    ],\n    MN_ELEC_CUTOFF: {\n        REFPER: '2008A1',\n        CUTOFF1: '50000',\n        CUTOFF2: '10000',\n        FIXED: '684953',\n        BETA: '6.017'\n    }\n}\nconst input = {\n    STFIPS: '',\n    ELECGEN:'',\n    CSTELEC: '',\n    ELECSLD:'',\n    H_ELECGEN: '',\n    H_ELECSLD: '',\n    HISTSTAT: '',\n    EXPS_ELEC_VAL: 0,\n    ELEC_PRCH_KWH_NUM: 0\n}\nconst T_STFIPS = input?.STFIPS;\nlet MISSING_ST_FLIPS_ELECTRIC = 0;\nconst cutoffs = params.MN_ELEC_CUTOFF;\n\nfunction getParameterByGeoSt(geoSt) {\n    if (!geoSt || geoSt === 'NULL') return null;\n    return params.MN_ELECTRIC_STATE.find(item => item.GEO_ST === geoSt);\n}\nfunction electricEnergyModule(input){\n    const { EXPS_ELEC_VAL, ELEC_PRCH_KWH_NUM } = input;\n    if(EXPS_ELEC_VAL === 0 && ELEC_PRCH_KWH_NUM === 0){\n        // Go to A\n    }else if (EXPS_ELEC_VAL === 0 && ELEC_PRCH_KWH_NUM > 0){\n            // ELEC_PRCH_KWH_NUM = 0\n            // ELEC_PRCH_KWH_NUM_F (3,1) = 'J'\n            // go to A \n    }else if(T_STFIPS) {\n        // Go to electricEnergyModuleCont\n    }else{\n        MISSING_ST_FLIPS_ELECTRIC = 1;\n    }\n}\n// function electricEnergyModule(T_STFIPS, REFPER, ELEC_PRCH_KWH_NUM, x_CURR) {\n//     console.log(\"Executing electricEnergyModule...\");\n\n//     if (!T_STFIPS || !REFPER || !ELEC_PRCH_KWH_NUM || !x_CURR ||\n//         [T_STFIPS, REFPER, ELEC_PRCH_KWH_NUM, x_CURR].includes('NULL')) {\n//         console.log('Invalid parameters');\n//         return 'Invalid parameters';\n//     }\n\n//     const parameter = getParameterByGeoSt(T_STFIPS);\n//     if (!parameter) {\n//         console.log('Invalid STFIPS');\n//         return 'Invalid STFIPS';\n//     }\n\n//     // ... rest of the logic\n\n//     return electricEnergyModuleCont(T_STFIPS, REFPER, ELEC_PRCH_KWH_NUM, 0, x_CURR);\n// }\n\n// function electricEnergyModuleCont(T_STFIPS, REFPER, ELEC_PRCH_KWH_NUM, EXPS_ELEC_VAL, x_CURR) {\n//     console.log(\"Executing electricEnergyModuleCont...\");\n//     if (!T_STFIPS || !REFPER || ELEC_PRCH_KWH_NUM === null || EXPS_ELEC_VAL === null || !x_CURR ||\n//         [T_STFIPS, REFPER, ELEC_PRCH_KWH_NUM, EXPS_ELEC_VAL, x_CURR].includes('NULL')) {\n//         console.log('Invalid parameters');\n//         return 'Invalid parameters';\n//     }\n\n//     const parameter = getParameterByGeoSt(T_STFIPS);\n//     let FIXED = 0;\n//     let BETA = 0;\n\n//     if (EXPS_ELEC_VAL / ELEC_PRCH_KWH_NUM > BETA) {\n//         return electricImputeModule(T_STFIPS, REFPER, ELEC_PRCH_KWH_NUM, EXPS_ELEC_VAL, x_CURR);\n//     }\n\n//     console.log('Returning from electricEnergyModuleCont:', EXPS_ELEC_VAL);\n//     return EXPS_ELEC_VAL;\n// }\n\n// function electricImputeModule(T_STFIPS, REFPER, ELEC_PRCH_KWH_NUM, EXPS_ELEC_VAL, x_CURR) {\n//     console.log(\"Executing electricImputeModule...\");\n//     if (!T_STFIPS || !REFPER || ELEC_PRCH_KWH_NUM === null || EXPS_ELEC_VAL === null || !x_CURR ||\n//         [T_STFIPS, REFPER, ELEC_PRCH_KWH_NUM, EXPS_ELEC_VAL, x_CURR].includes('NULL')) {\n//         console.log('Invalid parameters');\n//         return 'Invalid parameters';\n//     }\n\n//     const parameter = getParameterByGeoSt(T_STFIPS);\n//     let NM_STATE_PARAMETER_TABLE = {\n//         AVG1: parameter ? parameter.AVG1 : 0,\n//         AVG2: parameter ? parameter.AVG2 : 0\n//     };\n\n//     // ... rest of the logic\n\n//     console.log('Returning from electricImputeModule:', EXPS_ELEC_VAL);\n//     return EXPS_ELEC_VAL;\n// }\n\n// console.log(electricEnergyModule(T_STFIPS, '2022', 1000, 'M'));\n\n// Test cases\n// console.log(electricEnergyModule('01', '2022', 1000, 'M'));  // Should execute all three functions for GEO_ST '01'\n// console.log(electricEnergyModule(undefined, '2022', 500, 'M'));  // Should return 'Invalid parameters'\n// console.log(electricEnergyModule('02', 'NULL', 500, 'M'));  // Should return 'Invalid parameters'\n// console.log(electricEnergyModule('03', '2022', 500, 'M'));  // Should return 'Invalid STFIPS' because '03' is not in parameterTableData\n\n// function getElecState(REFPER, params) {\n//     let stateParam;\n//     // Choose parameter table based on REFPER\n//     if (REFPER.slice(0, 4) === '2022') {\n//         stateParam = params.MN_ELECTRIC_STATE;\n//     } else if (REFPER === '2023A1') {\n//         stateParam = params.ASM23_ELECTRIC_STATE;\n//     } else if (REFPER === '2024A1') {\n//         stateParam = params.ASM24_ELECTRIC_STATE;\n//     } // ... add other conditions for other years\n\n//     return stateParam;\n// }\n// console.log(getElecState('2022', params));\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 680,
        "wires": [
            [
                "fb0490d46f6dac6d",
                "d9030a8fd1f031b8"
            ]
        ]
    },
    {
        "id": "fb0490d46f6dac6d",
        "type": "debug",
        "z": "6399b853963e761e",
        "name": "debug Main",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 600,
        "wires": []
    },
    {
        "id": "d9030a8fd1f031b8",
        "type": "link out",
        "z": "6399b853963e761e",
        "name": "link out 60",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9",
            "95d077dd39781efe"
        ],
        "x": 595,
        "y": 720,
        "wires": []
    },
    {
        "id": "6a2c84e1dce8bff9",
        "type": "function",
        "z": "e1c94d5011366338",
        "name": "BR Stat",
        "func": "let record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\nfunction A(msg) {\n    msg.payload.csv[record_idx].TABSTAT = \"N\";\n    msg.payload.csv[record_idx].NONTABFL = \"D\";\n    msg.payload.csv[record_idx].ACTION = \"Exit Edit\";\n    global.set('action', 'Exit Edit')\n}\n\n// Is RECORD_TYP_TXT in ('10','20','3O','90')\nif ([\"10\", \"20\", \"30\", \"90\"].includes(String(record.RECORD_TYP_TXT))) {\n    msg.payload.DEBUG_STATUS = \"RECORD_TYP_TXT-10-20-30-90-true\"\n    // Set TABSTAT and NONTABFL variables\n    msg.payload.csv[record_idx].TABSTAT = \"Y\";\n    msg.payload.csv[record_idx].NONTABFL = null;\n\n    // Is RECORD_TYP_TXT in ('10','20','90')\n    if ([\"10\", \"20\", \"90\"].includes(String(record.RECORD_TYP_TXT))) {\n        // Is BR_STAT equal to \"N\"\n        if (record.BR_STAT === \"N\") {\n            A(msg); // Go to A\n        } else { // BR_STAT not equal to \"N\"\n            // Is RECORD_TYP_TXT \"20\" or \"90\"\n            if ([\"20\", \"90\"].includes(String(record.RECORD_TYP_TXT))) {\n                msg.payload.csv[record_idx].ACTION = \"Go to main Routing\";\n                return msg;\n\n            } else { // RECORD_TYP_TXT not \"20\" or \"90\"\n                msg.payload.csv[record_idx].ACTION = \"Go to main Routing\";\n                return msg;\n            }\n        }\n\n    } else { // RECORD_TYP_TXT not in ('10','20','3O','90')\n        if (record.KAU_STAT === \"N\") {\n            A(msg); // Go to A\n        } else {\n            msg.payload.csv[record_idx].ACTION = \"Go to main Routing\";\n            global.set('action', 'Go to main Routing')\n            return msg;\n        }\n    }\n\n} else {  // RECORD_TYP_TXT not in ('10','20','3O','90')\n    msg.payload.record_idx = record_idx\n    msg.payload.DEBUG_STATUS = \"RECORD_TYP_TXT-10-20-30-90-false\"\n    msg.payload.csv[record_idx].ACTION = \"ERROR\";\n    global.set('action', 'ERROR')\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 180,
        "wires": [
            [
                "c74136ccac77c41a"
            ]
        ]
    },
    {
        "id": "d1302884ac348646",
        "type": "function",
        "z": "e1c94d5011366338",
        "name": "critical error",
        "func": "let record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\nfunction setResult() {\n    record['TABSTAT'] = \"N\";\n    record['NONTABFL'] = \"D\";\n    record['ACTION'] = \"Exit Edit\";\n    global.set('action', 'Exit Edit')\n}\n\n// function parseToNum(val) {\n//     return isNaN(val) ? 0 : parseInt(val, 10);\n// }\nfunction naicsSectorCheck() {\n    let result =\n        parseFloat(record['PAY_ANN_VAL']) +\n        parseFloat(record['EMP_MAR12_NUM']) +\n        parseFloat(record['PAY_QTR1_VAL']) +\n        parseFloat(record['ECPAYANN']) +\n        parseFloat(record['ECPAYQ1']) +\n        parseFloat(record['ECEMPQ1']) +\n        parseFloat(record['ECPAYANL']);\n\n    if (parseFloat(record['NAICS_SECTOR_OLD_NUM']) === 31) {\n        result = parseFloat(result) + parseFloat(record['EXPS_TEMPSTAF_VAL']);\n    }\n    return result\n}\nlet data = naicsSectorCheck();\nrecord['DATA'] = data\n\nif (record.hasOwnProperty('COV_CHG_CODE') &&\n    [\"111\", \"131\", \"791\"].includes(record['COV_CHG_CODE']?.toString()) &&\n    new Date(record['COV_CHG_DATE']) <=\n    new Date(\"01-01-\" + record.REF_PER.substring(0, 4)) &&\n    data == 0\n) {\n    setResult();\n    return msg;\n\n} else if (record.hasOwnProperty('COV_CHG_CODE') && [\"181\", \"201\", \"801\", \"091\", \"121\", \"171\"].includes(record['COV_CHG_CODE']?.toString())) {\n    setResult();\n    return msg;\n} else {\n    record['ACTION'] = \"Go To Main Routing\";\n    global.set('action', 'Go To Main Routing')\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 240,
        "wires": [
            [
                "8dd01db339ac1096"
            ]
        ]
    },
    {
        "id": "513713eac5d2b9ba",
        "type": "link in",
        "z": "e1c94d5011366338",
        "name": "Got Batchmode 1",
        "links": [
            "8eb6f6b4ca5cb88d",
            "54cb70dfe4b43956"
        ],
        "x": 235,
        "y": 160,
        "wires": [
            [
                "acfd749424c9c93f"
            ]
        ]
    },
    {
        "id": "d749199ab42b9801",
        "type": "debug",
        "z": "e1c94d5011366338",
        "name": "Results",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1220,
        "y": 220,
        "wires": []
    },
    {
        "id": "7cdbce6d4b28412b",
        "type": "link out",
        "z": "e1c94d5011366338",
        "name": "link out gotQBES",
        "mode": "link",
        "links": [
            "8ad2ab7c27d8d248"
        ],
        "x": 1415,
        "y": 340,
        "wires": []
    },
    {
        "id": "c9b7e7142a50a57a",
        "type": "function",
        "z": "e1c94d5011366338",
        "name": "Set Path",
        "func": "let record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\nrecord['RANDOM'] = Math.floor(Math.random() * 10) + 1\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 160,
        "wires": [
            [
                "c9f1b90676a7bee6"
            ]
        ]
    },
    {
        "id": "c9f1b90676a7bee6",
        "type": "function",
        "z": "e1c94d5011366338",
        "name": "Fake PV",
        "func": "\n// function setCharAt(str, index, chr) {\n//     if (index > str.length - 1) {\n//         let addstr = index - str.length\n//         let newstr = str\n//         for (let i = 0; i < addstr; i++) {\n//             newstr = newstr + ' ';            \n//         }\n//         newstr = newstr + chr \n//         return newstr;\n//     } else { return str.substring(0, index) + chr + str.substring(index + 1);\n//     }\n// }\n\n// function initializeVariables(record) {\n//     record.PAY_ANN_VAL_F = setCharAt(record.PAY_ANN_VAL_F.toString(), 2, 'X');\n//     record.RCPT_TOT_VAL_F = setCharAt(record.RCPT_TOT_VAL_F.toString(), 2, 'X');\n//     record.EMP_MAR12_NUM_F = setCharAt(record.EMP_MAR12_NUM_F.toString(), 2, 'X');\n//     record.PAY_QTR1_VAL_F = setCharAt(record.PAY_QTR1_VAL_F.toString(), 2, 'U');\n//     record.PAY_ANN_VAL = 0\n//     record.RCPT_TOT_VAL = 0\n//     record.EMP_MAR12_NUM = 0\n//     record.PAY_QTR1_VAL = 0\n//     return record;\n// }\n\n// let record_idx = global.get(\"ptrModuleFacts\");\n// let record = msg.payload.csv[record_idx];\n\n// // record.PAY_ANN_VAL = (record.PAY_ANN_VAL && record.PAY_ANN_VAL != 'NULL') ? record.PAY_ANN_VAL : \"0\";\n// // record.RCPT_TOT_VAL = (record.RCPT_TOT_VAL && record.RCPT_TOT_VAL != 'NULL') ? record.RCPT_TOT_VAL : \"0\";\n// // record.EMP_MAR12_NUM = (record.EMP_MAR12_NUM && record.EMP_MAR12_NUM != 'NULL') ? record.EMP_MAR12_NUM : \"0\";\n// // record.PAY_QTR1_VAL = (record.PAY_QTR1_VAL && record.PAY_QTR1_VAL != 'NULL') ? record.PAY_QTR1_VAL : \"0\";\n\n// if(parseInt(record['RANDOM']) > 5){\n//     record = initializeVariables(record);\n// }\n\n// return msg;\n\n\n// function setCharAt(str, index, chr) {\n//     if (index > str.length - 1) return str;\n//     return str.substring(0, index) + chr + str.substring(index + 1);\n// }\n\n// function initializeVariables(record) {\n//     record.PAY_ANN_VAL = setCharAt(record.PAY_ANN_VAL.toString(), 2, 'U');\n//     record.RCPT_TOT_VAL = setCharAt(record.RCPT_TOT_VAL.toString(), 2, 'X');\n//     record.EMP_MAR12_NUM = setCharAt(record.EMP_MAR12_NUM.toString(), 2, 'U');\n//     record.PAY_QTR1_VAL = setCharAt(record.PAY_QTR1_VAL.toString(), 2, 'U');\n\n//     return record;\n// }\n\n// let record_idx = global.get(\"ptrModuleFacts\");\n// let record = msg.payload.csv[record_idx];\n\n// record.PAY_ANN_VAL = (record.PAY_ANN_VAL && record.PAY_ANN_VAL !== 'NULL') ? record.PAY_ANN_VAL : \"0\";\n// record.RCPT_TOT_VAL = (record.RCPT_TOT_VAL && record.RCPT_TOT_VAL !== 'NULL') ? record.RCPT_TOT_VAL : \"0\";\n// record.EMP_MAR12_NUM = (record.EMP_MAR12_NUM && record.EMP_MAR12_NUM !== 'NULL') ? record.EMP_MAR12_NUM : \"0\";\n// record.PAY_QTR1_VAL = (record.PAY_QTR1_VAL && record.PAY_QTR1_VAL !== 'NULL') ? record.PAY_QTR1_VAL : \"0\";\n\n// if(parseInt(record['RANDOM']) > 5){\n//     record = initializeVariables(record);\n// }\n\n// return msg;\n\n// function setCharAt(str, index, chr) {\n//     if (index > str.length - 1) return str;\n//     return str.substring(0, index) + chr + str.substring(index + 1);\n// }\n\n// function initializeVariables(record) {\n//     record.PAY_ANN_VAL = setCharAt(record.PAY_ANN_VAL.toString(), 2, 'U');\n\n//     record.RCPT_TOT_VAL = setCharAt(record.RCPT_TOT_VAL.toString(), 2, 'X');\n\n//     record.EMP_MAR12_NUM = setCharAt(record.EMP_MAR12_NUM.toString(), 2, 'U');\n\n//     record.PAY_QTR1_VAL = setCharAt(record.PAY_QTR1_VAL.toString(), 2, 'U');\n\n//     return record;\n// }\n\n\n// let record_idx = global.get(\"ptrModuleFacts\");\n// let record = msg.payload.csv[record_idx];\n\n// record.PAY_ANN_VAL = record.PAY_ANN_VAL || \"0\";\n// record.RCPT_TOT_VAL = record.RCPT_TOT_VAL || \"0\";\n// record.EMP_MAR12_NUM = record.EMP_MAR12_NUM || \"0\";\n// record.PAY_QTR1_VAL = record.PAY_QTR1_VAL || \"0\";\n\n// if(parseInt(record['RANDOM']) > 10){\n//     record = initializeVariables(record);\n// }\n\n\n// return msg;\nfunction setCharAt(str, index, chr) {\n    if ([null, undefined].includes(str)) {\n        let newstr = ''\n        for (let i = 0; i < index; i++) {\n            newstr = newstr + ' ';\n        }\n        newstr = newstr + chr\n        return newstr;\n    } else {\n        if (index > str.length - 1) {\n            let addstr = index - str.length\n            let newstr = str\n            for (let i = 0; i < addstr; i++) {\n                newstr = newstr + ' ';\n            }\n            newstr = newstr + chr\n            return newstr;\n        } else {\n            return str.substring(0, index) + chr + str.substring(index + 1);\n        }\n    }\n}\n\n\nfunction initializeVariables(record) {\n    record.PAY_ANN_VAL_F = setCharAt(record.PAY_ANN_VAL_F, 2, 'X');\n    record.RCPT_TOT_VAL_F = setCharAt(record.RCPT_TOT_VAL_F, 2, 'X');\n    record.EMP_MAR12_NUM_F = setCharAt(record.EMP_MAR12_NUM_F, 2, 'X');\n    record.PAY_QTR1_VAL_F = setCharAt(record.PAY_QTR1_VAL_F, 2, 'U');\n    record.PAY_ANN_VAL = 0\n    record.RCPT_TOT_VAL = 0\n    record.EMP_MAR12_NUM = 0\n    record.PAY_QTR1_VAL = 0\n    return record;\n}\n\nlet record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\n// record.PAY_ANN_VAL = (record.PAY_ANN_VAL && record.PAY_ANN_VAL != 'NULL') ? record.PAY_ANN_VAL : \"0\";\n// record.RCPT_TOT_VAL = (record.RCPT_TOT_VAL && record.RCPT_TOT_VAL != 'NULL') ? record.RCPT_TOT_VAL : \"0\";\n// record.EMP_MAR12_NUM = (record.EMP_MAR12_NUM && record.EMP_MAR12_NUM != 'NULL') ? record.EMP_MAR12_NUM : \"0\";\n// record.PAY_QTR1_VAL = (record.PAY_QTR1_VAL && record.PAY_QTR1_VAL != 'NULL') ? record.PAY_QTR1_VAL : \"0\";\n\nif (parseInt(record['RANDOM']) > 5) {\n    record = initializeVariables(record);\n}\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 160,
        "wires": [
            [
                "d749199ab42b9801",
                "45c8faeb65e8f7cb"
            ]
        ]
    },
    {
        "id": "45c8faeb65e8f7cb",
        "type": "function",
        "z": "e1c94d5011366338",
        "name": "Check and udpate Recipe",
        "func": "// msg.payload.recipe.currentStepIndex = msg.payload.recipe.currentStepIndex + 1\nmsg.payload.facts =  msg.payload.csv\n// msg.payload.results.fact = msg.payload.csv[global.get(\"ptrModuleFacts\")]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 160,
        "wires": [
            [
                "7cdbce6d4b28412b",
                "67cb21d2f5fc02bd"
            ]
        ]
    },
    {
        "id": "a7f0c8bc56765c6a",
        "type": "link in",
        "z": "e1c94d5011366338",
        "name": "Interactive Mode Batch Mode 1 UI Input",
        "links": [
            "6386460ff91d3960"
        ],
        "x": 225,
        "y": 260,
        "wires": [
            [
                "acfd749424c9c93f"
            ]
        ]
    },
    {
        "id": "67cb21d2f5fc02bd",
        "type": "link out",
        "z": "e1c94d5011366338",
        "name": "link out 64",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1415,
        "y": 420,
        "wires": []
    },
    {
        "id": "c74136ccac77c41a",
        "type": "switch",
        "z": "e1c94d5011366338",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 510,
        "y": 320,
        "wires": [
            [
                "67cb21d2f5fc02bd",
                "7cdbce6d4b28412b"
            ],
            [
                "d1302884ac348646"
            ]
        ]
    },
    {
        "id": "8dd01db339ac1096",
        "type": "switch",
        "z": "e1c94d5011366338",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 850,
        "y": 280,
        "wires": [
            [
                "7cdbce6d4b28412b",
                "67cb21d2f5fc02bd"
            ],
            [
                "c9b7e7142a50a57a"
            ]
        ]
    },
    {
        "id": "acfd749424c9c93f",
        "type": "change",
        "z": "e1c94d5011366338",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "action",
                "pt": "global",
                "to": "\"\"",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 120,
        "wires": [
            [
                "6a2c84e1dce8bff9"
            ]
        ]
    },
    {
        "id": "30cba14a34807b8f",
        "type": "function",
        "z": "cd5dca18afec6561",
        "name": "Unit Balance Function",
        "func": "let record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\nmsg.cache = global.get(\"lookupCache\").data.find(\n    item =>\n        item.module === \"balance\" &&\n        item.param === \"unit_balance\" &&\n        item.program === \"aies\" &&\n        item.unit_type === \"estab\"\n)?.json_values;\n\nfunction checkNaics(data, naics, rec_typ, rec_typop, rec_tax) {\n    let list = data['NAICS']\n    let unit = data['UNIT TYPE']\n    let typop = data['TYPOP']\n    let tax = data['TAXSTAT']\n    let rectyp = rec_typ\n    if (['20', '90', 20, 90].includes(rectyp)) {\n        rec_typ = 'ESTAB'\n    } else if (['30', 30].includes(rectyp)) {\n        rec_typ = 'KAU'\n    } else if ([10, '10'].includes(rectyp)) {\n        rec_typ = 'ENT'\n    }\n    if ([null, undefined, 'null', 'undefined'].includes(typop)) {\n        rec_typop = typop\n    }\n    if ([null, undefined, 'null', 'undefined'].includes(tax)) {\n        rec_tax = tax\n    }\n    // console.log(rec_tax, tax, rec_typop, typop)\n    if (rec_typ === unit && rec_tax === tax && rec_typop === typop) {\n        if ([\"ALL\", \"All\"].includes(list)) {\n            return (true);\n        } else {\n            list = list.replace(/ /g, \"\");\n            list = list.replace(/'/g, \"\");\n            var array = list.split(',')\n\n            if (array.find(r => naics.startsWith(r))) {\n                return (true);\n            } else {\n                return (false)\n            }\n        }\n    }\n}\n\nfunction sumRow(data) {\n    let sum = 0;\n    var keys = [];\n    for (var key in data) {\n        if (key.startsWith('DETAIL') && data[key] != null) {\n            let variable = data[key]\n            // console.log(variable)\n            if (!Number.isNaN(parseFloat(record[variable]))) {\n                sum = parseFloat(sum) + parseFloat(record[variable])\n            }\n            // else {\n            //     record[variable] = 0\n            // }\n            keys.push(variable)\n        }\n    }\n    return [sum, keys];\n}\n\nfunction raking(rectot, sum, keys, tol) {\n    if ((Math.abs(rectot - sum) / rectot) <= tol) {\n        keys.sort((a, b) => record[b] - record[a]);\n        let remainder = 0\n        for (let i = 0; i < keys.length; i++) {\n            let num1 = (rectot / sum) * parseFloat(record[keys[i]]) + remainder\n            let num2 = Math.round(num1)\n            remainder = num1 - num2\n            record[keys[i]] = num2\n        }\n    }\n}\n\nlet naics = record['NAICS_NUM']\nnaics = '' + naics\n\nconst RECORD_TYP_TXT = record['RECORD_TYP_TXT']\nlet TYPOP = record['TYPOP_WHSL_OLD_NUM']\nlet TAXSTAT = record['TAXSTAT']\n\nfor (let i in msg.cache['UNIT_BALANCE']) {\n    let unitBalance = msg.cache['UNIT_BALANCE'][i]\n    if (checkNaics(unitBalance, naics, RECORD_TYP_TXT, TYPOP, TAXSTAT)) {\n        let tot = unitBalance['TOTAL']\n        let rectot = 0\n        if ([100, '100'].includes(tot)) {\n            rectot = 100\n        } else {\n            if (!Number.isNaN(parseFloat(record[tot]))) {\n                rectot = parseFloat(record[tot])\n            }\n            // else {\n            //     record[tot] = 0\n            // }\n        }\n        let name_f = tot + '_F'\n        let [sum, keys] = sumRow(unitBalance)\n        sum = parseFloat(sum)\n        // let name = 'DET_' + tot\n        // record[name] = sum\n\n        // begin fail logic\n        if (rectot === sum && sum != 0) {\n            record['ACTION'] = 'Go To: Main Routing'\n            // global.set('action', 'Go To: Main Routing')\n        } else {\n            const tolerance = parseFloat(unitBalance['Tolerance'])\n            if (sum > 0 && rectot <= 0) {\n                record[tot] = sum\n                if (record[name_f] && record[name_f].length >= 3) {\n                    record[name_f] = record[name_f].substring(0, 2) + 'L' + record[name_f].substring(3);\n                } else if (record[name_f] && record[name_f].length >= 2) {\n                    record[name_f] = record[name_f].substring(0, 2) + 'L';\n                } else if (record[name_f] && record[name_f].length >= 1) {\n                    record[name_f] = record[name_f].substring(0, 1) + ' L';\n                } else {\n                    record[name_f] = '  L';\n                }\n            } else if (sum == 0 && rectot > 0) {\n                // raking(rectot, sum, keys, tolerance)\n                for (let i = 0; i < keys.length; i++) {\n                    let det_f = keys[i] + '_F'\n                    if (record[det_f] && record[det_f].length >= 3) {\n                        record[det_f] = record[det_f].substring(0, 2) + 'X' + record[det_f].substring(3);\n                    } else if (record[det_f] && record[det_f].length >= 2) {\n                        record[det_f] = record[det_f].substring(0, 2) + 'X';\n                    } else if (record[det_f] && record[det_f].length >= 1) {\n                        record[det_f] = record[det_f].substring(0, 1) + ' X';\n                    } else {\n                        record[det_f] = '  X';\n                    }\n                }\n            } else if (sum > 0 && rectot > 0) {\n                // check range\n                if ((Math.abs(rectot - sum) / rectot) <= tolerance) {\n                    let flag_check1 = ''\n                    try {\n                        if (['P', 'C', 'A', 'S', 'O', 'E', 'F'].includes(record[name_f].substring(1, 2))) {\n                            flag_check1 = 'Yes'\n                        }\n                    } catch {\n                        console.log('flag column does not exist: ' + name_f)\n                    }\n                    let flag_check2 = ''\n                    for (let i = 0; i < keys.length; i++) {\n                        let det_f = keys[i] + '_F'\n                        try {\n                            if (['P', 'C', 'A', 'S', 'O', 'E', 'F'].includes(record[det_f].substring(1, 2))) {\n                                flag_check2 = 'Yes'\n                            }\n                        } catch {\n                            console.log('flag column does not exist: ' + det_f)\n                        }\n                    }\n                    if (flag_check2 == 'Yes') {\n                        record[tot] = sum\n                        if (record[name_f] && record[name_f].length >= 3) {\n                            record[name_f] = record[name_f].substring(0, 2) + 'L' + record[name_f].substring(3);\n                        } else if (record[name_f] && record[name_f].length >= 2) {\n                            record[name_f] = record[name_f].substring(0, 2) + 'L';\n                        } else if (record[name_f] && record[name_f].length >= 1) {\n                            record[name_f] = record[name_f].substring(0, 1) + ' L';\n                        } else {\n                            record[name_f] = '  L';\n                        }\n                    } else {\n                        raking(rectot, sum, keys, tolerance)\n                        for (let i = 0; i < keys.length; i++) {\n                            let det_f = keys[i] + '_F'\n                            if (record[det_f] && record[det_f].length >= 3) {\n                                record[det_f] = record[det_f].substring(0, 2) + 'K' + record[det_f].substring(3);\n                            } else if (record[det_f] && record[det_f].length >= 2) {\n                                record[det_f] = record[det_f].substring(0, 2) + 'K';\n                            } else if (record[det_f] && record[det_f].length >= 1) {\n                                record[det_f] = record[det_f].substring(0, 1) + ' K';\n                            } else {\n                                record[det_f] = '  K';\n                            }\n                        }\n                    }\n                } else {\n                    // raking(rectot, sum, keys, tolerance)\n                    for (let i = 0; i < keys.length; i++) {\n                        let variable = keys[i]\n                        if (Number.isNaN(parseFloat(record[variable]))) {\n                            continue;\n                        }\n                        let det_f = keys[i] + '_F'\n                        if (record[det_f] && record[det_f].length >= 3) {\n                            record[det_f] = record[det_f].substring(0, 2) + 'X' + record[det_f].substring(3);\n                        } else if (record[det_f] && record[det_f].length >= 2) {\n                            record[det_f] = record[det_f].substring(0, 2) + 'X';\n                        } else if (record[det_f] && record[det_f].length >= 1) {\n                            record[det_f] = record[det_f].substring(0, 1) + ' X';\n                        } else {\n                            record[det_f] = '  X';\n                        }\n                    }\n                }\n            } else if (sum == 0 && rectot <= 0) {\n                if (record[name_f] && record[name_f].length >= 3) {\n                    record[name_f] = record[name_f].substring(0, 2) + 'X' + record[name_f].substring(3);\n                } else if (record[name_f] && record[name_f].length >= 2) {\n                    record[name_f] = record[name_f].substring(0, 2) + 'X';\n                } else if (record[name_f] && record[name_f].length >= 1) {\n                    record[name_f] = record[name_f].substring(0, 1) + ' X';\n                } else {\n                    record[name_f] = '  X';\n                }\n\n                for (let i = 0; i < keys.length; i++) {\n                    let det_f = keys[i] + '_F'\n                    if (record[det_f] && record[det_f].length >= 3) {\n                        record[det_f] = record[det_f].substring(0, 2) + 'X' + record[det_f].substring(3);\n                    } else if (record[det_f] && record[det_f].length >= 2) {\n                        record[det_f] = record[det_f].substring(0, 2) + 'X';\n                    } else if (record[det_f] && record[det_f].length >= 1) {\n                        record[det_f] = record[det_f].substring(0, 1) + ' X';\n                    } else {\n                        record[det_f] = '  X';\n                    }\n                }\n            } else {\n            }\n        }\n    }\n}\n\nrecord['ACTION'] = 'Go To: Main Routing'\n// global.set('action', 'Go To: Main Routing')\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 280,
        "wires": [
            [
                "0adad313378dfbc6",
                "9988694dd625e1cd"
            ]
        ]
    },
    {
        "id": "7524317b716e4316",
        "type": "link in",
        "z": "cd5dca18afec6561",
        "name": "Got Batchmode 2",
        "links": [
            "8eb6f6b4ca5cb88d",
            "d6116234e9829874"
        ],
        "x": 165,
        "y": 280,
        "wires": [
            [
                "d8442184f4563e70"
            ]
        ]
    },
    {
        "id": "9aee892d0909f5a2",
        "type": "link out",
        "z": "cd5dca18afec6561",
        "name": "link out gotQBES",
        "mode": "link",
        "links": [
            "8ad2ab7c27d8d248"
        ],
        "x": 1305,
        "y": 280,
        "wires": []
    },
    {
        "id": "0adad313378dfbc6",
        "type": "debug",
        "z": "cd5dca18afec6561",
        "name": "Results",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1040,
        "y": 360,
        "wires": []
    },
    {
        "id": "d8442184f4563e70",
        "type": "change",
        "z": "cd5dca18afec6561",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"balance\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"unit_balance\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 280,
        "wires": [
            [
                "c0a9e032612eefc4"
            ]
        ]
    },
    {
        "id": "c0a9e032612eefc4",
        "type": "subflow:0be109393cb5f28a",
        "z": "cd5dca18afec6561",
        "name": "",
        "x": 590,
        "y": 280,
        "wires": [
            [
                "30cba14a34807b8f"
            ]
        ]
    },
    {
        "id": "9988694dd625e1cd",
        "type": "function",
        "z": "cd5dca18afec6561",
        "name": "Check and udpate Recipe",
        "func": "// msg.payload.recipe.currentStepIndex = msg.payload.recipe.currentStepIndex + 1\nmsg.payload.facts =  msg.payload.csv\n// msg.payload.results.fact = msg.payload.csv[global.get(\"ptrModuleFacts\")]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 280,
        "wires": [
            [
                "9aee892d0909f5a2",
                "5f40acc0f51bf3a2"
            ]
        ]
    },
    {
        "id": "f0c5660583e686c0",
        "type": "link in",
        "z": "cd5dca18afec6561",
        "name": "Interactive Mode Batch Mode 2 UI Input",
        "links": [
            "6982bc340b585149"
        ],
        "x": 165,
        "y": 360,
        "wires": [
            [
                "d8442184f4563e70"
            ]
        ]
    },
    {
        "id": "5f40acc0f51bf3a2",
        "type": "link out",
        "z": "cd5dca18afec6561",
        "name": "link out 65",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1305,
        "y": 340,
        "wires": []
    },
    {
        "id": "4ddcca6cfb35501a",
        "type": "function",
        "z": "de517a9172230cbe",
        "name": "AIES NAPCS PREP",
        "func": "function AIESNAPCSPrep(){\n    if(record?.NAICS_SECTOR == '31' && record?.SUBSAMP_IND_TXT != 'MC'){\n        // call Reset NAPCS\n        // call Imputing with Historic NAPCS\n        let NAPCS_BLTOT = record?.reduce((sum, item) => {\n            return item.PROD_CODE.substring(6, 9) === '000' ? sum + item.PROD_CODE_VAL : sum;\n        }, 0);\n\n        let NAPCS_BAL = record?.RCPT_TOT_VAL - NAPCS_BLTOT;\n\n        let NAPCS_PRM = record?.reduce((sum, item) => {\n            return item.PROD_CODE.substring(0, 1) === '2' ? sum + item.PROD_CODE_VAL : sum;\n        }, 0);\n\n        let NAPCS_OTH = record?.reduce((sum, item) => {\n            return item.PROD_CODE.substring(0, 1) < '2' ? sum + item.PROD_CODE_VAL : sum;\n        }, 0);\n\n        let sumOfSpecificPROD_CODE_VAL = record?.reduce((sum, item) => {\n            return item.PROD_CODE.substring(0, 7) === '9000000' ? sum + item.PROD_CODE_VAL : sum;\n        }, 0);\n    }\n    \n}",
        "outputs": 1,
        "noerr": 19,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 320,
        "wires": [
            [
                "33026067404b94f9"
            ]
        ]
    },
    {
        "id": "1cd1d79faa68ac91",
        "type": "link in",
        "z": "de517a9172230cbe",
        "name": "AIES NAPCS PREP Link",
        "links": [],
        "x": 775,
        "y": 320,
        "wires": [
            [
                "4ddcca6cfb35501a"
            ]
        ]
    },
    {
        "id": "33026067404b94f9",
        "type": "link out",
        "z": "de517a9172230cbe",
        "name": "link out 87",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1045,
        "y": 320,
        "wires": []
    },
    {
        "id": "06a9cb383fa7e864",
        "type": "function",
        "z": "de517a9172230cbe",
        "name": "Get NAPCS",
        "func": "msg.query = 'SELECT * FROM product_aies.napcs LIMIT 100'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 540,
        "wires": [
            [
                "2f18c1e4a89c757f"
            ]
        ]
    },
    {
        "id": "2f18c1e4a89c757f",
        "type": "postgresql",
        "z": "de517a9172230cbe",
        "name": "Update FACTS",
        "query": "",
        "postgreSQLConfig": "481a641c4005d1c8",
        "split": false,
        "rowsPerMsg": "1",
        "outputs": 1,
        "x": 1060,
        "y": 540,
        "wires": [
            [
                "7bad4b8dee7f732a"
            ]
        ]
    },
    {
        "id": "60d8b06caa63ccbd",
        "type": "inject",
        "z": "de517a9172230cbe",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 690,
        "y": 540,
        "wires": [
            [
                "06a9cb383fa7e864"
            ]
        ]
    },
    {
        "id": "7bad4b8dee7f732a",
        "type": "debug",
        "z": "de517a9172230cbe",
        "name": "debug 113",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 540,
        "wires": []
    },
    {
        "id": "1c611eb0c30a9863",
        "type": "link in",
        "z": "3248e82e44cba772",
        "name": "link in 47",
        "links": [
            "cede3264bdcd0a70",
            "36c4687d5f1bee6b",
            "b9b9acc35bdd0b75"
        ],
        "x": 255,
        "y": 400,
        "wires": [
            [
                "e0cf58452cb9a95f"
            ]
        ]
    },
    {
        "id": "daa2e09cc7fbb842",
        "type": "link out",
        "z": "3248e82e44cba772",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1095,
        "y": 400,
        "wires": []
    },
    {
        "id": "bac40e27e751601f",
        "type": "subflow:0be109393cb5f28a",
        "z": "3248e82e44cba772",
        "name": "",
        "x": 690,
        "y": 400,
        "wires": [
            [
                "eecb05adfc87798e"
            ]
        ]
    },
    {
        "id": "e0cf58452cb9a95f",
        "type": "change",
        "z": "3248e82e44cba772",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"core_4\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"core_4, kau_total_details\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 400,
        "wires": [
            [
                "bac40e27e751601f"
            ]
        ]
    },
    {
        "id": "eecb05adfc87798e",
        "type": "subflow:89f071f1deb9a1b1",
        "z": "3248e82e44cba772",
        "name": "",
        "x": 940,
        "y": 400,
        "wires": [
            [
                "daa2e09cc7fbb842"
            ]
        ]
    },
    {
        "id": "3f936d74a59fd02d",
        "type": "link in",
        "z": "624a1e6caab6a819",
        "name": "link in 13",
        "links": [
            "dc2a2ca809797dbd",
            "8e91643b66472855"
        ],
        "x": 335,
        "y": 320,
        "wires": [
            [
                "1001b705b43e55b4"
            ]
        ]
    },
    {
        "id": "edf06df5cb8410e9",
        "type": "link out",
        "z": "624a1e6caab6a819",
        "name": "link out 14",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 605,
        "y": 320,
        "wires": []
    },
    {
        "id": "1001b705b43e55b4",
        "type": "subflow:20d530cc0b193752",
        "z": "624a1e6caab6a819",
        "name": "",
        "x": 470,
        "y": 320,
        "wires": [
            [
                "edf06df5cb8410e9"
            ]
        ]
    },
    {
        "id": "95217c8ed8e79881",
        "type": "link in",
        "z": "5e1a962405c84d2b",
        "name": "link in 15",
        "links": [
            "a42aa429654aa772",
            "db3b91da76ec41a9"
        ],
        "x": 355,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "02482c164222726b",
        "type": "link out",
        "z": "5e1a962405c84d2b",
        "name": "link out 15",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 685,
        "y": 120,
        "wires": []
    },
    {
        "id": "2eee0041d9d93424",
        "type": "link in",
        "z": "2245e192a734f1bb",
        "name": "link in 21",
        "links": [
            "81f5d75ffbcd549e",
            "55c9e7195d7f2786"
        ],
        "x": 575,
        "y": 300,
        "wires": [
            [
                "3bb1c04de6dd0a22"
            ]
        ]
    },
    {
        "id": "eb575c3f71964e1e",
        "type": "link out",
        "z": "2245e192a734f1bb",
        "name": "link out 18",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 865,
        "y": 300,
        "wires": []
    },
    {
        "id": "3bb1c04de6dd0a22",
        "type": "subflow:aadaa91727c0d579",
        "z": "2245e192a734f1bb",
        "name": "",
        "x": 720,
        "y": 300,
        "wires": [
            [
                "eb575c3f71964e1e"
            ]
        ]
    },
    {
        "id": "8feba05e91ff48f3",
        "type": "link in",
        "z": "0a014270e6816fdf",
        "name": "link in 22",
        "links": [
            "b1540f3459d95049",
            "51e14578de8e4e73"
        ],
        "x": 215,
        "y": 240,
        "wires": [
            [
                "11714487a76a3d36"
            ]
        ]
    },
    {
        "id": "f7e7a2a2e4eb195a",
        "type": "link out",
        "z": "0a014270e6816fdf",
        "name": "link out 19",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 445,
        "y": 240,
        "wires": []
    },
    {
        "id": "11714487a76a3d36",
        "type": "subflow:42be4655fd3a8c84",
        "z": "0a014270e6816fdf",
        "name": "",
        "x": 330,
        "y": 240,
        "wires": [
            [
                "f7e7a2a2e4eb195a"
            ]
        ]
    },
    {
        "id": "8807ce2046dc8a32",
        "type": "link in",
        "z": "a51d10c50d9dbbe0",
        "name": "link in 27",
        "links": [
            "cd8a05808eedb5f3",
            "9b4f297579e277a4"
        ],
        "x": 295,
        "y": 180,
        "wires": [
            [
                "45eb8a37ebc4e2d8"
            ]
        ]
    },
    {
        "id": "d6c45ec5ceb3d90d",
        "type": "link out",
        "z": "a51d10c50d9dbbe0",
        "name": "link out 21",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 595,
        "y": 180,
        "wires": []
    },
    {
        "id": "45eb8a37ebc4e2d8",
        "type": "subflow:5eae5184a8f175fd",
        "z": "a51d10c50d9dbbe0",
        "name": "",
        "x": 430,
        "y": 180,
        "wires": [
            [
                "d6c45ec5ceb3d90d"
            ]
        ]
    },
    {
        "id": "b16c9d56493fb914",
        "type": "link in",
        "z": "f06fc99b8cb78464",
        "name": "link in 49",
        "links": [
            "cede3264bdcd0a70",
            "36c4687d5f1bee6b",
            "d5aac8a297ee6dd2"
        ],
        "x": 395,
        "y": 400,
        "wires": [
            [
                "bc5811906ba3b90e"
            ]
        ]
    },
    {
        "id": "42f918976305a0a4",
        "type": "link out",
        "z": "f06fc99b8cb78464",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1175,
        "y": 400,
        "wires": []
    },
    {
        "id": "b346b1331786dd15",
        "type": "subflow:7c71f52633d8c794",
        "z": "f06fc99b8cb78464",
        "name": "",
        "x": 1030,
        "y": 400,
        "wires": [
            [
                "42f918976305a0a4"
            ]
        ]
    },
    {
        "id": "35b620dcee5b9adc",
        "type": "subflow:0be109393cb5f28a",
        "z": "f06fc99b8cb78464",
        "name": "",
        "x": 800,
        "y": 400,
        "wires": [
            [
                "b346b1331786dd15"
            ]
        ]
    },
    {
        "id": "bc5811906ba3b90e",
        "type": "change",
        "z": "f06fc99b8cb78464",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"core_4\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"core_4\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 400,
        "wires": [
            [
                "35b620dcee5b9adc"
            ]
        ]
    },
    {
        "id": "76691f5ac3362ba9",
        "type": "link in",
        "z": "0e31453ffacd3b3c",
        "name": "link in 51",
        "links": [
            "cede3264bdcd0a70",
            "36c4687d5f1bee6b",
            "28494dbc74f30091"
        ],
        "x": 385,
        "y": 200,
        "wires": [
            [
                "2419643bb69bf4c2"
            ]
        ]
    },
    {
        "id": "a6250f4cc9b410d4",
        "type": "link out",
        "z": "0e31453ffacd3b3c",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1205,
        "y": 200,
        "wires": []
    },
    {
        "id": "b525b8d500819cf7",
        "type": "subflow:4781d07fda613850",
        "z": "0e31453ffacd3b3c",
        "name": "",
        "x": 1040,
        "y": 200,
        "wires": [
            [
                "a6250f4cc9b410d4"
            ]
        ]
    },
    {
        "id": "4fab01abfbcb603e",
        "type": "subflow:0be109393cb5f28a",
        "z": "0e31453ffacd3b3c",
        "name": "",
        "x": 800,
        "y": 200,
        "wires": [
            [
                "b525b8d500819cf7"
            ]
        ]
    },
    {
        "id": "2419643bb69bf4c2",
        "type": "change",
        "z": "0e31453ffacd3b3c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"core_4\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"core_4\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 200,
        "wires": [
            [
                "4fab01abfbcb603e"
            ]
        ]
    },
    {
        "id": "b9aedad7e15bc0ed",
        "type": "link in",
        "z": "0a690414bffb7c2e",
        "name": "link in 50",
        "links": [
            "cede3264bdcd0a70",
            "36c4687d5f1bee6b",
            "5d05b108e4e3f722"
        ],
        "x": 385,
        "y": 100,
        "wires": [
            [
                "15908f258e534bec"
            ]
        ]
    },
    {
        "id": "86f363969a0f8d77",
        "type": "link out",
        "z": "0a690414bffb7c2e",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1175,
        "y": 100,
        "wires": []
    },
    {
        "id": "64f46886626de204",
        "type": "subflow:0be109393cb5f28a",
        "z": "0a690414bffb7c2e",
        "name": "",
        "x": 810,
        "y": 100,
        "wires": [
            [
                "d6a394de90525a6b"
            ]
        ]
    },
    {
        "id": "15908f258e534bec",
        "type": "change",
        "z": "0a690414bffb7c2e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"core_4\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"core_4\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 100,
        "wires": [
            [
                "64f46886626de204"
            ]
        ]
    },
    {
        "id": "d6a394de90525a6b",
        "type": "subflow:27c40a87c581e266",
        "z": "0a690414bffb7c2e",
        "name": "",
        "x": 1040,
        "y": 100,
        "wires": [
            [
                "86f363969a0f8d77"
            ]
        ]
    },
    {
        "id": "447f05b7589104a7",
        "type": "link in",
        "z": "10a17d9f63b31aef",
        "name": "NONNORM: Init Set ACTVMIO & OPSTATS Link",
        "links": [
            "48c2bbd321b77688"
        ],
        "x": 535,
        "y": 200,
        "wires": [
            [
                "b89260cefb3ae3e6"
            ]
        ]
    },
    {
        "id": "01595edbd5bb3ca9",
        "type": "link out",
        "z": "10a17d9f63b31aef",
        "name": "link out 66",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 995,
        "y": 200,
        "wires": []
    },
    {
        "id": "b89260cefb3ae3e6",
        "type": "subflow:f9a2a2262f95bae3",
        "z": "10a17d9f63b31aef",
        "name": "",
        "x": 760,
        "y": 200,
        "wires": [
            [
                "01595edbd5bb3ca9"
            ]
        ]
    },
    {
        "id": "918d1db8979aef15",
        "type": "link in",
        "z": "0a29fbfc598a6eb6",
        "name": "NONNORM: Router Link",
        "links": [
            "a0a9a69afb297619"
        ],
        "x": 225,
        "y": 260,
        "wires": [
            [
                "4b7f2f11bbac5011"
            ]
        ]
    },
    {
        "id": "ada77cfa9573c816",
        "type": "link out",
        "z": "0a29fbfc598a6eb6",
        "name": "link out 67",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 545,
        "y": 260,
        "wires": []
    },
    {
        "id": "4b7f2f11bbac5011",
        "type": "subflow:b93bf22bc3258992",
        "z": "0a29fbfc598a6eb6",
        "name": "",
        "x": 380,
        "y": 260,
        "wires": [
            [
                "ada77cfa9573c816"
            ]
        ]
    },
    {
        "id": "7439226c767a87a3",
        "type": "link in",
        "z": "1ff0abce01e8a9b4",
        "name": "NONNORM: Set OPSTATS & ACTVMIO Link",
        "links": [
            "879c5a04e7f7b3ba"
        ],
        "x": 555,
        "y": 180,
        "wires": [
            [
                "6f80af51c885e7b1"
            ]
        ]
    },
    {
        "id": "9fe7f21d3c9037a4",
        "type": "link out",
        "z": "1ff0abce01e8a9b4",
        "name": "link out 68",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 905,
        "y": 180,
        "wires": []
    },
    {
        "id": "6f80af51c885e7b1",
        "type": "subflow:a661e33a6e4be4fe",
        "z": "1ff0abce01e8a9b4",
        "name": "",
        "x": 730,
        "y": 180,
        "wires": [
            [
                "9fe7f21d3c9037a4"
            ]
        ]
    },
    {
        "id": "bc67815db9dee1e7",
        "type": "link in",
        "z": "749f57d4ab869e77",
        "name": "NONNORM: Set NONORM Link",
        "links": [
            "601d06243349006e"
        ],
        "x": 605,
        "y": 160,
        "wires": [
            [
                "3a9a26d917d13d8d"
            ]
        ]
    },
    {
        "id": "daf2afc7f182f934",
        "type": "link out",
        "z": "749f57d4ab869e77",
        "name": "link out 69",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 905,
        "y": 160,
        "wires": []
    },
    {
        "id": "3a9a26d917d13d8d",
        "type": "subflow:5251d9acce14d156",
        "z": "749f57d4ab869e77",
        "name": "",
        "x": 750,
        "y": 160,
        "wires": [
            [
                "daf2afc7f182f934"
            ]
        ]
    },
    {
        "id": "b7d9dea2a407d5ab",
        "type": "link in",
        "z": "cc39e0013d1bbd14",
        "name": "NONNORM: Router Link",
        "links": [
            "9924458ebb7935cd"
        ],
        "x": 565,
        "y": 160,
        "wires": [
            [
                "46062d8781904fcb"
            ]
        ]
    },
    {
        "id": "9343c59ba9dd4152",
        "type": "link out",
        "z": "cc39e0013d1bbd14",
        "name": "link out 70",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 915,
        "y": 160,
        "wires": []
    },
    {
        "id": "46062d8781904fcb",
        "type": "subflow:b8154c600987e319",
        "z": "cc39e0013d1bbd14",
        "name": "",
        "x": 750,
        "y": 160,
        "wires": [
            [
                "9343c59ba9dd4152"
            ]
        ]
    },
    {
        "id": "7191fc9544f07b32",
        "type": "link in",
        "z": "2214caf84b0847ec",
        "name": "NONNORM: Special Season final",
        "links": [
            "51d4f6e460537ff8"
        ],
        "x": 465,
        "y": 180,
        "wires": [
            [
                "8cf1411b0623572f"
            ]
        ]
    },
    {
        "id": "55d8b26f48ef05bd",
        "type": "link out",
        "z": "2214caf84b0847ec",
        "name": "link out 71",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 835,
        "y": 180,
        "wires": []
    },
    {
        "id": "8cf1411b0623572f",
        "type": "subflow:e1f601e2c56dfda4",
        "z": "2214caf84b0847ec",
        "name": "",
        "x": 650,
        "y": 180,
        "wires": [
            [
                "55d8b26f48ef05bd"
            ]
        ]
    },
    {
        "id": "e74d8d0f9702bdb7",
        "type": "link out",
        "z": "bb181ffb5aeab92c",
        "name": "link out 72",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 835,
        "y": 120,
        "wires": []
    },
    {
        "id": "7fd7c15cd9b5a645",
        "type": "link in",
        "z": "bb181ffb5aeab92c",
        "name": "mfg_payqtr1",
        "links": [
            "8cc4aec631b9f7ab"
        ],
        "x": 585,
        "y": 120,
        "wires": [
            [
                "244fe14c689939c9"
            ]
        ]
    },
    {
        "id": "244fe14c689939c9",
        "type": "subflow:05d1a91987f08f14",
        "z": "bb181ffb5aeab92c",
        "name": "",
        "x": 710,
        "y": 120,
        "wires": [
            [
                "e74d8d0f9702bdb7"
            ]
        ]
    },
    {
        "id": "d638deea262939f1",
        "type": "link in",
        "z": "83d1ac7cb83077ea",
        "name": "mfg_payann",
        "links": [
            "6e0891f1d9b0f50b"
        ],
        "x": 625,
        "y": 300,
        "wires": [
            [
                "dd25208da485d586"
            ]
        ]
    },
    {
        "id": "b72ac573a0a35c8a",
        "type": "link out",
        "z": "83d1ac7cb83077ea",
        "name": "link out 73",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 895,
        "y": 300,
        "wires": []
    },
    {
        "id": "dd25208da485d586",
        "type": "subflow:48bdd199705157b9",
        "z": "83d1ac7cb83077ea",
        "name": "",
        "x": 750,
        "y": 300,
        "wires": [
            [
                "b72ac573a0a35c8a"
            ]
        ]
    },
    {
        "id": "c6e825877bca50ae",
        "type": "link in",
        "z": "c2d60c8918a1622a",
        "name": "mfg_empq1",
        "links": [
            "405380585cc28809"
        ],
        "x": 685,
        "y": 320,
        "wires": [
            [
                "81be448255c6de23"
            ]
        ]
    },
    {
        "id": "93b50ff4956eb444",
        "type": "link out",
        "z": "c2d60c8918a1622a",
        "name": "link out 74",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 925,
        "y": 320,
        "wires": []
    },
    {
        "id": "81be448255c6de23",
        "type": "subflow:9f8b85fce167ad51",
        "z": "c2d60c8918a1622a",
        "name": "",
        "x": 810,
        "y": 320,
        "wires": [
            [
                "93b50ff4956eb444"
            ]
        ]
    },
    {
        "id": "8bc3b4ce5f96ef53",
        "type": "link in",
        "z": "fe75af5be53552a9",
        "name": "NAPCS HDICAT Link",
        "links": [
            "f96645ae14ef8fb7"
        ],
        "x": 645,
        "y": 400,
        "wires": [
            [
                "1e4c9d1cf7b9c6de"
            ]
        ]
    },
    {
        "id": "91b34f7b64e183bd",
        "type": "link out",
        "z": "fe75af5be53552a9",
        "name": "link out 88",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 975,
        "y": 400,
        "wires": []
    },
    {
        "id": "1e4c9d1cf7b9c6de",
        "type": "subflow:b3b1701e035827dc",
        "z": "fe75af5be53552a9",
        "name": "",
        "x": 820,
        "y": 400,
        "wires": [
            [
                "91b34f7b64e183bd"
            ]
        ]
    },
    {
        "id": "23a30ef7226c1c9c",
        "type": "link in",
        "z": "6ca99eb94adab0b6",
        "name": "NAPCS NODONOR Link",
        "links": [
            "628a357ebf92b85e"
        ],
        "x": 295,
        "y": 140,
        "wires": [
            [
                "3e9e6c5951dea430"
            ]
        ]
    },
    {
        "id": "b8f1ae7b487a68f6",
        "type": "link out",
        "z": "6ca99eb94adab0b6",
        "name": "link out 89",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1178.05126953125,
        "y": 140.18634033203125,
        "wires": []
    },
    {
        "id": "2a88fb912978f3bc",
        "type": "subflow:4b2a066dec42e6f4",
        "z": "6ca99eb94adab0b6",
        "name": "",
        "x": 1000,
        "y": 140,
        "wires": [
            [
                "b8f1ae7b487a68f6"
            ]
        ]
    },
    {
        "id": "3e9e6c5951dea430",
        "type": "change",
        "z": "6ca99eb94adab0b6",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"napcs\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"napcs_m_goco, naics_to_napcs_m_goco, napcs_nodonor_cutoff\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 140,
        "wires": [
            [
                "75ae4bd5c0d07b66"
            ]
        ]
    },
    {
        "id": "75ae4bd5c0d07b66",
        "type": "subflow:0be109393cb5f28a",
        "z": "6ca99eb94adab0b6",
        "name": "",
        "x": 750,
        "y": 140,
        "wires": [
            [
                "2a88fb912978f3bc"
            ]
        ]
    },
    {
        "id": "ebd6fd2b33dd0765",
        "type": "link in",
        "z": "5f0ae7529035d4ee",
        "name": "NAPCS RECALCULATE Link",
        "links": [
            "13026c6f9554fd48"
        ],
        "x": 575,
        "y": 120,
        "wires": [
            [
                "63d111ccee4dd4bd"
            ]
        ]
    },
    {
        "id": "b2edc9dbdd9af134",
        "type": "link out",
        "z": "5f0ae7529035d4ee",
        "name": "link out 91",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 995,
        "y": 120,
        "wires": []
    },
    {
        "id": "63d111ccee4dd4bd",
        "type": "subflow:e77217f4bfc52a38",
        "z": "5f0ae7529035d4ee",
        "name": "",
        "x": 780,
        "y": 120,
        "wires": [
            [
                "b2edc9dbdd9af134"
            ]
        ]
    },
    {
        "id": "aca56c4b68c05d08",
        "type": "link in",
        "z": "601cd75dc2c42d32",
        "name": "NAPCS BL ROUNDING Link",
        "links": [
            "184f643c8c0c9483"
        ],
        "x": 675,
        "y": 80,
        "wires": [
            [
                "f8dd3df2bd97bba6"
            ]
        ]
    },
    {
        "id": "b206e07710f5e28f",
        "type": "link out",
        "z": "601cd75dc2c42d32",
        "name": "link out 92",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 975,
        "y": 80,
        "wires": []
    },
    {
        "id": "f8dd3df2bd97bba6",
        "type": "subflow:fbb1e70dfe5fe82f",
        "z": "601cd75dc2c42d32",
        "name": "",
        "x": 820,
        "y": 80,
        "wires": [
            [
                "b206e07710f5e28f"
            ]
        ]
    },
    {
        "id": "5749501cd685bc0c",
        "type": "link in",
        "z": "05f553d24173a3fe",
        "name": "NAPCS Balancing Link",
        "links": [
            "03b4a30c8b73aaa1"
        ],
        "x": 305,
        "y": 120,
        "wires": [
            [
                "c4afb9e4495acabb"
            ]
        ]
    },
    {
        "id": "d23c27e777f90ccd",
        "type": "link out",
        "z": "05f553d24173a3fe",
        "name": "link out 86",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1245,
        "y": 120,
        "wires": []
    },
    {
        "id": "c4afb9e4495acabb",
        "type": "change",
        "z": "05f553d24173a3fe",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"naics\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"naics_tolerance\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 120,
        "wires": [
            [
                "37c7607695a89691"
            ]
        ]
    },
    {
        "id": "37c7607695a89691",
        "type": "subflow:0be109393cb5f28a",
        "z": "05f553d24173a3fe",
        "name": "",
        "x": 770,
        "y": 120,
        "wires": [
            [
                "2d33567cedf1c562"
            ]
        ]
    },
    {
        "id": "2d33567cedf1c562",
        "type": "subflow:c706d1ca2706f3bf",
        "z": "05f553d24173a3fe",
        "name": "",
        "x": 1060,
        "y": 120,
        "wires": [
            [
                "d23c27e777f90ccd"
            ]
        ]
    },
    {
        "id": "2e8dc577c6d85be5",
        "type": "link in",
        "z": "184cce6ee0df3c6f",
        "name": "NAPCS Balance Link",
        "links": [
            "f2d1653b5ba3e5d2"
        ],
        "x": 975,
        "y": 200,
        "wires": [
            [
                "2eae68298302fb1b"
            ]
        ]
    },
    {
        "id": "bb4dba28bc4486e1",
        "type": "link out",
        "z": "184cce6ee0df3c6f",
        "name": "link out 85",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1225,
        "y": 200,
        "wires": []
    },
    {
        "id": "2eae68298302fb1b",
        "type": "subflow:d32a58c0544f501c",
        "z": "184cce6ee0df3c6f",
        "name": "",
        "x": 1100,
        "y": 200,
        "wires": [
            [
                "bb4dba28bc4486e1"
            ]
        ]
    },
    {
        "id": "61e767d06ab72a43",
        "type": "link in",
        "z": "05f39827e3106c22",
        "name": "MIV: NonLIFORANDOMModule Link",
        "links": [
            "9a0ffed7eefbb31e"
        ],
        "x": 485,
        "y": 160,
        "wires": [
            [
                "b90ae9ebe0541241"
            ]
        ]
    },
    {
        "id": "e75b332d63ba3e20",
        "type": "link out",
        "z": "05f39827e3106c22",
        "name": "link out 84",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1045,
        "y": 340,
        "wires": []
    },
    {
        "id": "559f1564a8e1908f",
        "type": "change",
        "z": "05f39827e3106c22",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "B",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 160,
        "wires": [
            [
                "83c4d2d8283342c2"
            ]
        ]
    },
    {
        "id": "9536c43abc24b429",
        "type": "change",
        "z": "05f39827e3106c22",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "E",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 280,
        "wires": [
            [
                "7824ea3d1dfb2654"
            ]
        ]
    },
    {
        "id": "b90ae9ebe0541241",
        "type": "function",
        "z": "05f39827e3106c22",
        "name": "set nlflo",
        "func": "let NLFLO = 0\nNLFLO = parseInt(Math.floor(Math.random() * 100))\nif (NLFLO < 10) {\n    NLFLO = '0' + NLFLO\n} else {\n    NLFLO = '' + NLFLO\n}\nglobal.set('nlflo',NLFLO)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 160,
        "wires": [
            [
                "559f1564a8e1908f"
            ]
        ]
    },
    {
        "id": "83c4d2d8283342c2",
        "type": "subflow:6f23d11cf5bb4bde",
        "z": "05f39827e3106c22",
        "name": "",
        "x": 850,
        "y": 220,
        "wires": [
            [
                "9536c43abc24b429"
            ]
        ]
    },
    {
        "id": "7824ea3d1dfb2654",
        "type": "subflow:6f23d11cf5bb4bde",
        "z": "05f39827e3106c22",
        "name": "",
        "x": 850,
        "y": 340,
        "wires": [
            [
                "e75b332d63ba3e20"
            ]
        ]
    },
    {
        "id": "d81c18d7166b9e59",
        "type": "link in",
        "z": "306dda6a5dd83c4d",
        "name": "MIV: EvaluateNoNLIFOValuationMethodModule Link",
        "links": [
            "17eb7e821e3b7ea0"
        ],
        "x": 555,
        "y": 200,
        "wires": [
            [
                "3fdb32b44754d1c0"
            ]
        ]
    },
    {
        "id": "c79880fef432a005",
        "type": "link out",
        "z": "306dda6a5dd83c4d",
        "name": "link out 83",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1035,
        "y": 380,
        "wires": []
    },
    {
        "id": "3fdb32b44754d1c0",
        "type": "change",
        "z": "306dda6a5dd83c4d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "B",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 200,
        "wires": [
            [
                "c72c511dead7ab57"
            ]
        ]
    },
    {
        "id": "5b5cb15d6d926683",
        "type": "change",
        "z": "306dda6a5dd83c4d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "E",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 320,
        "wires": [
            [
                "e944b6f9d10bbf22"
            ]
        ]
    },
    {
        "id": "c72c511dead7ab57",
        "type": "subflow:625b8c982fed66b7",
        "z": "306dda6a5dd83c4d",
        "name": "",
        "x": 800,
        "y": 260,
        "wires": [
            [
                "5b5cb15d6d926683"
            ]
        ]
    },
    {
        "id": "e944b6f9d10bbf22",
        "type": "subflow:625b8c982fed66b7",
        "z": "306dda6a5dd83c4d",
        "name": "",
        "x": 800,
        "y": 380,
        "wires": [
            [
                "c79880fef432a005"
            ]
        ]
    },
    {
        "id": "e0fccd45e6604bda",
        "type": "link in",
        "z": "ad669800801ee84f",
        "name": "MIV: EvaluateDetailValuationMethods Link",
        "links": [
            "ff930476a898868c"
        ],
        "x": 465,
        "y": 160,
        "wires": [
            [
                "506d036bf96b09fa"
            ]
        ]
    },
    {
        "id": "0b0f86b61f9edc20",
        "type": "link out",
        "z": "ad669800801ee84f",
        "name": "link out 82",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1075,
        "y": 400,
        "wires": []
    },
    {
        "id": "b34f6a80f2e05754",
        "type": "change",
        "z": "ad669800801ee84f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "B",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 160,
        "wires": [
            [
                "12268d3017aaa7bc"
            ]
        ]
    },
    {
        "id": "ae5d41afd41f2d59",
        "type": "change",
        "z": "ad669800801ee84f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "E",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 320,
        "wires": [
            [
                "4bdccf96b7117b8d"
            ]
        ]
    },
    {
        "id": "506d036bf96b09fa",
        "type": "function",
        "z": "ad669800801ee84f",
        "name": "set nlflo",
        "func": "let NLFLO = 0\nNLFLO = parseInt(Math.floor(Math.random() * 100))\nif (NLFLO < 10) {\n    NLFLO = '0' + NLFLO\n} else {\n    NLFLO = '' + NLFLO\n}\nglobal.set('nlflo',NLFLO)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 160,
        "wires": [
            [
                "b34f6a80f2e05754"
            ]
        ]
    },
    {
        "id": "2d30be0edb0171fc",
        "type": "subflow:3e0275f580e2d77c",
        "z": "ad669800801ee84f",
        "name": "",
        "x": 850,
        "y": 240,
        "wires": [
            [
                "ae5d41afd41f2d59"
            ]
        ]
    },
    {
        "id": "0c834bd82dffbb97",
        "type": "subflow:3e0275f580e2d77c",
        "z": "ad669800801ee84f",
        "name": "",
        "x": 850,
        "y": 400,
        "wires": [
            [
                "0b0f86b61f9edc20"
            ]
        ]
    },
    {
        "id": "12268d3017aaa7bc",
        "type": "function",
        "z": "ad669800801ee84f",
        "name": "set temps B",
        "func": "let record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\nflow.set('invvsumx', record?.['INVVSUMB'])\nflow.set('invdiffx', record?.['INVDIFFB'])\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 160,
        "wires": [
            [
                "2d30be0edb0171fc"
            ]
        ]
    },
    {
        "id": "4bdccf96b7117b8d",
        "type": "function",
        "z": "ad669800801ee84f",
        "name": "set temps E",
        "func": "let record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\nflow.set('invvsumx', record?.['INVVSUME'])\nflow.set('invdiffx', record?.['INVDIFFE'])\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 320,
        "wires": [
            [
                "0c834bd82dffbb97"
            ]
        ]
    },
    {
        "id": "c72b098afa64f560",
        "type": "link in",
        "z": "f75347023218039f",
        "name": "MIV: EvaluateNoNLIFOValuationMethodsModule Link",
        "links": [
            "ac696618fbdb5b2b"
        ],
        "x": 455,
        "y": 160,
        "wires": [
            [
                "364732f96dc88bf3"
            ]
        ]
    },
    {
        "id": "8be3531210d71bdc",
        "type": "link out",
        "z": "f75347023218039f",
        "name": "link out 81",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1125,
        "y": 340,
        "wires": []
    },
    {
        "id": "6c38fea91ef1311a",
        "type": "change",
        "z": "f75347023218039f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "B",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 160,
        "wires": [
            [
                "145be6c135dd53a0"
            ]
        ]
    },
    {
        "id": "05770e7ca6d01f18",
        "type": "change",
        "z": "f75347023218039f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "E",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 280,
        "wires": [
            [
                "58cca489d9e88a6d"
            ]
        ]
    },
    {
        "id": "364732f96dc88bf3",
        "type": "function",
        "z": "f75347023218039f",
        "name": "set nlflo",
        "func": "let NLFLO = 0\nNLFLO = parseInt(Math.floor(Math.random() * 100))\nif (NLFLO < 10) {\n    NLFLO = '0' + NLFLO\n} else {\n    NLFLO = '' + NLFLO\n}\nglobal.set('nlflo',NLFLO)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 160,
        "wires": [
            [
                "6c38fea91ef1311a"
            ]
        ]
    },
    {
        "id": "145be6c135dd53a0",
        "type": "subflow:0ab9d9d713d5103c",
        "z": "f75347023218039f",
        "name": "",
        "x": 880,
        "y": 220,
        "wires": [
            [
                "05770e7ca6d01f18"
            ]
        ]
    },
    {
        "id": "58cca489d9e88a6d",
        "type": "subflow:0ab9d9d713d5103c",
        "z": "f75347023218039f",
        "name": "",
        "x": 880,
        "y": 340,
        "wires": [
            [
                "8be3531210d71bdc"
            ]
        ]
    },
    {
        "id": "b55a0bc87142a940",
        "type": "link in",
        "z": "944313b2df8d5d35",
        "name": "MIV: NONLIFOValuationMethodsModule Link",
        "links": [
            "6a7a578fbd272b1f"
        ],
        "x": 475,
        "y": 140,
        "wires": [
            [
                "1e8a54cb55c66f60"
            ]
        ]
    },
    {
        "id": "641e46c32d5b58f3",
        "type": "link out",
        "z": "944313b2df8d5d35",
        "name": "link out 80",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1105,
        "y": 320,
        "wires": []
    },
    {
        "id": "62c27a6d99d41eeb",
        "type": "subflow:379e12b168b021d1",
        "z": "944313b2df8d5d35",
        "name": "",
        "x": 880,
        "y": 200,
        "wires": [
            [
                "54b4a45e94e53f13"
            ]
        ]
    },
    {
        "id": "1e58fe43686c1435",
        "type": "change",
        "z": "944313b2df8d5d35",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "B",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 140,
        "wires": [
            [
                "62c27a6d99d41eeb"
            ]
        ]
    },
    {
        "id": "54b4a45e94e53f13",
        "type": "change",
        "z": "944313b2df8d5d35",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "E",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 260,
        "wires": [
            [
                "ae1dd349d9d76ac2"
            ]
        ]
    },
    {
        "id": "1e8a54cb55c66f60",
        "type": "function",
        "z": "944313b2df8d5d35",
        "name": "set nlflo",
        "func": "let NLFLO = 0\nNLFLO = parseInt(Math.floor(Math.random() * 100))\nif (NLFLO < 10) {\n    NLFLO = '0' + NLFLO\n} else {\n    NLFLO = '' + NLFLO\n}\nglobal.set('nlflo',NLFLO)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 600,
        "y": 140,
        "wires": [
            [
                "1e58fe43686c1435"
            ]
        ]
    },
    {
        "id": "ae1dd349d9d76ac2",
        "type": "subflow:379e12b168b021d1",
        "z": "944313b2df8d5d35",
        "name": "",
        "x": 880,
        "y": 320,
        "wires": [
            [
                "641e46c32d5b58f3"
            ]
        ]
    },
    {
        "id": "f64b690f11b0f463",
        "type": "link in",
        "z": "f61aed28e038a8f6",
        "name": "MIV: Evaluate LIFO Module Link",
        "links": [
            "6e4d6926b48c4bfc"
        ],
        "x": 315,
        "y": 480,
        "wires": [
            [
                "0b400c8b8b927db4"
            ]
        ]
    },
    {
        "id": "e608a1d198c82a60",
        "type": "link out",
        "z": "f61aed28e038a8f6",
        "name": "link out 79",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1225,
        "y": 660,
        "wires": []
    },
    {
        "id": "1354c2083bbb52d7",
        "type": "subflow:0be109393cb5f28a",
        "z": "f61aed28e038a8f6",
        "name": "",
        "x": 750,
        "y": 480,
        "wires": [
            [
                "b0d152586d3db1a4"
            ]
        ]
    },
    {
        "id": "0b400c8b8b927db4",
        "type": "change",
        "z": "f61aed28e038a8f6",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"inv_reserve\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"inv_reserve\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 480,
        "wires": [
            [
                "1354c2083bbb52d7"
            ]
        ]
    },
    {
        "id": "e5d985d5ec354ffd",
        "type": "subflow:c65f463988b11e12",
        "z": "f61aed28e038a8f6",
        "name": "",
        "x": 1020,
        "y": 540,
        "wires": [
            [
                "8acc169be6c24cf1"
            ]
        ]
    },
    {
        "id": "b0d152586d3db1a4",
        "type": "change",
        "z": "f61aed28e038a8f6",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "B",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 480,
        "wires": [
            [
                "e5d985d5ec354ffd"
            ]
        ]
    },
    {
        "id": "0a0100cebf952e09",
        "type": "subflow:c65f463988b11e12",
        "z": "f61aed28e038a8f6",
        "name": "",
        "x": 1020,
        "y": 660,
        "wires": [
            [
                "e608a1d198c82a60"
            ]
        ]
    },
    {
        "id": "8acc169be6c24cf1",
        "type": "change",
        "z": "f61aed28e038a8f6",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "E",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 600,
        "wires": [
            [
                "0a0100cebf952e09"
            ]
        ]
    },
    {
        "id": "62eb4cacd21b3528",
        "type": "link in",
        "z": "3ace7cf3e57a1ba5",
        "name": "MIV: Evaluate LIFO Reverse Module Link",
        "links": [
            "256113e429ce586b"
        ],
        "x": 175,
        "y": 380,
        "wires": [
            [
                "e0a9bfdcca121925"
            ]
        ]
    },
    {
        "id": "76205591b8230183",
        "type": "link out",
        "z": "3ace7cf3e57a1ba5",
        "name": "link out 78",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1105,
        "y": 560,
        "wires": []
    },
    {
        "id": "a981a63d5e1218de",
        "type": "subflow:0be109393cb5f28a",
        "z": "3ace7cf3e57a1ba5",
        "name": "",
        "x": 590,
        "y": 380,
        "wires": [
            [
                "d48624fb6027aeb9"
            ]
        ]
    },
    {
        "id": "e0a9bfdcca121925",
        "type": "change",
        "z": "3ace7cf3e57a1ba5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"inv_reserve\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"inv_reserve\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 380,
        "wires": [
            [
                "a981a63d5e1218de"
            ]
        ]
    },
    {
        "id": "fcfe601afe862834",
        "type": "subflow:17fe2bc799b77fa4",
        "z": "3ace7cf3e57a1ba5",
        "name": "",
        "x": 900,
        "y": 440,
        "wires": [
            [
                "bd047194d7a76e0d"
            ]
        ]
    },
    {
        "id": "d48624fb6027aeb9",
        "type": "change",
        "z": "3ace7cf3e57a1ba5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "B",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 380,
        "wires": [
            [
                "fcfe601afe862834"
            ]
        ]
    },
    {
        "id": "2de7dbcba8fcadc0",
        "type": "subflow:17fe2bc799b77fa4",
        "z": "3ace7cf3e57a1ba5",
        "name": "",
        "x": 900,
        "y": 560,
        "wires": [
            [
                "76205591b8230183"
            ]
        ]
    },
    {
        "id": "bd047194d7a76e0d",
        "type": "change",
        "z": "3ace7cf3e57a1ba5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "E",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 500,
        "wires": [
            [
                "2de7dbcba8fcadc0"
            ]
        ]
    },
    {
        "id": "0e055cc10b2d1df5",
        "type": "link in",
        "z": "23d58ce1d9a3a4af",
        "name": "MIV: LIFO Valuation Method Link",
        "links": [
            "961d21f9c9d6935d"
        ],
        "x": 335,
        "y": 120,
        "wires": [
            [
                "cd95c6b8c7209888"
            ]
        ]
    },
    {
        "id": "f34ac015feb048da",
        "type": "link out",
        "z": "23d58ce1d9a3a4af",
        "name": "link out 77",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1205,
        "y": 300,
        "wires": []
    },
    {
        "id": "94f35dd8381caf94",
        "type": "subflow:0be109393cb5f28a",
        "z": "23d58ce1d9a3a4af",
        "name": "",
        "x": 750,
        "y": 120,
        "wires": [
            [
                "d1737eaf01c6f29d"
            ]
        ]
    },
    {
        "id": "cd95c6b8c7209888",
        "type": "change",
        "z": "23d58ce1d9a3a4af",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"inv_reserve\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"inv_reserve\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 120,
        "wires": [
            [
                "94f35dd8381caf94"
            ]
        ]
    },
    {
        "id": "bc6290e3c677a114",
        "type": "subflow:7d33e2bb432d595f",
        "z": "23d58ce1d9a3a4af",
        "name": "",
        "x": 1020,
        "y": 180,
        "wires": [
            [
                "b7f941d43eea928b"
            ]
        ]
    },
    {
        "id": "d1737eaf01c6f29d",
        "type": "change",
        "z": "23d58ce1d9a3a4af",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "B",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 120,
        "wires": [
            [
                "bc6290e3c677a114"
            ]
        ]
    },
    {
        "id": "40691549892e467a",
        "type": "subflow:7d33e2bb432d595f",
        "z": "23d58ce1d9a3a4af",
        "name": "",
        "x": 1020,
        "y": 300,
        "wires": [
            [
                "f34ac015feb048da"
            ]
        ]
    },
    {
        "id": "b7f941d43eea928b",
        "type": "change",
        "z": "23d58ce1d9a3a4af",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "miv",
                "pt": "global",
                "to": "E",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 240,
        "wires": [
            [
                "40691549892e467a"
            ]
        ]
    },
    {
        "id": "b2b244030212674a",
        "type": "link in",
        "z": "538d3e65e0f18773",
        "name": "MIV: Inventories Balance Link",
        "links": [
            "be79a45237eac5df"
        ],
        "x": 365,
        "y": 240,
        "wires": [
            [
                "eed24de8223d7695"
            ]
        ]
    },
    {
        "id": "290f0910bd81e94b",
        "type": "link out",
        "z": "538d3e65e0f18773",
        "name": "link out 76",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1205,
        "y": 240,
        "wires": []
    },
    {
        "id": "594b9aeaf4c1606a",
        "type": "subflow:0be109393cb5f28a",
        "z": "538d3e65e0f18773",
        "name": "",
        "x": 770,
        "y": 240,
        "wires": [
            [
                "96ee84f0b1050f1a"
            ]
        ]
    },
    {
        "id": "eed24de8223d7695",
        "type": "change",
        "z": "538d3e65e0f18773",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"inv_reserve\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"inv_reserve\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 240,
        "wires": [
            [
                "594b9aeaf4c1606a"
            ]
        ]
    },
    {
        "id": "96ee84f0b1050f1a",
        "type": "subflow:75eae7f006cc0f8a",
        "z": "538d3e65e0f18773",
        "name": "",
        "x": 1030,
        "y": 240,
        "wires": [
            [
                "290f0910bd81e94b"
            ]
        ]
    },
    {
        "id": "cd68a9923d85636d",
        "type": "link in",
        "z": "2eed7cf661bbf727",
        "name": "KAU To Company Additivity Check Link",
        "links": [
            "8ab5edfeddc79fdc"
        ],
        "x": 805,
        "y": 300,
        "wires": [
            [
                "d4df19e56ce67906"
            ]
        ]
    },
    {
        "id": "2b91281b80bace6b",
        "type": "link out",
        "z": "2eed7cf661bbf727",
        "name": "link out 75",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1215,
        "y": 300,
        "wires": []
    },
    {
        "id": "d4df19e56ce67906",
        "type": "subflow:24afab78ca973c73",
        "z": "2eed7cf661bbf727",
        "name": "",
        "x": 1020,
        "y": 300,
        "wires": [
            [
                "2b91281b80bace6b"
            ]
        ]
    },
    {
        "id": "3bd1372bd16d2eb2",
        "type": "subflow:e4fb9739caef0397",
        "z": "9edb2d8ae946822f",
        "name": "",
        "x": 1070,
        "y": 120,
        "wires": [
            [
                "83cf5c1c02a121e8"
            ]
        ]
    },
    {
        "id": "83cf5c1c02a121e8",
        "type": "link out",
        "z": "9edb2d8ae946822f",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1245,
        "y": 120,
        "wires": []
    },
    {
        "id": "df20d97837fa1d09",
        "type": "link in",
        "z": "9edb2d8ae946822f",
        "name": "Unit Balance",
        "links": [
            "05b67576d444bda4"
        ],
        "x": 395,
        "y": 120,
        "wires": [
            [
                "b44b9fdec27454f0"
            ]
        ]
    },
    {
        "id": "b44b9fdec27454f0",
        "type": "change",
        "z": "9edb2d8ae946822f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"balance\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"unit_balance\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "e429f87bbbca5ea4"
            ]
        ]
    },
    {
        "id": "e429f87bbbca5ea4",
        "type": "subflow:0be109393cb5f28a",
        "z": "9edb2d8ae946822f",
        "name": "",
        "x": 810,
        "y": 120,
        "wires": [
            [
                "3bd1372bd16d2eb2"
            ]
        ]
    },
    {
        "id": "108f9747956b439a",
        "type": "link out",
        "z": "236c2e1a5554a6f0",
        "name": "link out 61",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1125,
        "y": 180,
        "wires": []
    },
    {
        "id": "c8919561eea2a059",
        "type": "link in",
        "z": "236c2e1a5554a6f0",
        "name": "Valid Zero Link",
        "links": [
            "45b768d58693d73d"
        ],
        "x": 345,
        "y": 180,
        "wires": [
            [
                "978e9426a1803b88"
            ]
        ]
    },
    {
        "id": "f6d4e4102317abc6",
        "type": "subflow:998aa04bd1bb677d",
        "z": "236c2e1a5554a6f0",
        "name": "",
        "x": 1000,
        "y": 180,
        "wires": [
            [
                "108f9747956b439a"
            ]
        ]
    },
    {
        "id": "978e9426a1803b88",
        "type": "change",
        "z": "236c2e1a5554a6f0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"valid_zero\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"valid_zero\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 180,
        "wires": [
            [
                "1d9f4963787d9cc6"
            ]
        ]
    },
    {
        "id": "1d9f4963787d9cc6",
        "type": "subflow:0be109393cb5f28a",
        "z": "236c2e1a5554a6f0",
        "name": "",
        "x": 770,
        "y": 180,
        "wires": [
            [
                "f6d4e4102317abc6"
            ]
        ]
    },
    {
        "id": "25627bf820122fe8",
        "type": "link out",
        "z": "067b1d1ff9443ad3",
        "name": "link out 62",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1175,
        "y": 120,
        "wires": []
    },
    {
        "id": "8671a6e9c3be6ad6",
        "type": "link in",
        "z": "067b1d1ff9443ad3",
        "name": "Valid Negative Value Link",
        "links": [
            "854cd7a417cbbc6e"
        ],
        "x": 405,
        "y": 120,
        "wires": [
            [
                "49bca15a17b08352"
            ]
        ]
    },
    {
        "id": "6094d4bb7aa33b22",
        "type": "subflow:c79b244779411ead",
        "z": "067b1d1ff9443ad3",
        "name": "",
        "x": 1040,
        "y": 120,
        "wires": [
            [
                "25627bf820122fe8"
            ]
        ]
    },
    {
        "id": "49bca15a17b08352",
        "type": "change",
        "z": "067b1d1ff9443ad3",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"valid_negative\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"valid_negative_value\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 120,
        "wires": [
            [
                "8a019b7abd631568"
            ]
        ]
    },
    {
        "id": "8a019b7abd631568",
        "type": "subflow:0be109393cb5f28a",
        "z": "067b1d1ff9443ad3",
        "name": "",
        "x": 830,
        "y": 120,
        "wires": [
            [
                "6094d4bb7aa33b22"
            ]
        ]
    },
    {
        "id": "b93299e2e56af480",
        "type": "link in",
        "z": "69164b36a28c9eff",
        "name": "NAPCS M GOCO Link",
        "links": [
            "23110971cf0ed68c"
        ],
        "x": 435,
        "y": 80,
        "wires": [
            [
                "e0dc4f01a62685d7"
            ]
        ]
    },
    {
        "id": "2dcb1956c632490d",
        "type": "link out",
        "z": "69164b36a28c9eff",
        "name": "link out 90",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1"
        ],
        "x": 1185,
        "y": 80,
        "wires": []
    },
    {
        "id": "ff5aebd5d103af86",
        "type": "subflow:b576348e42469acf",
        "z": "69164b36a28c9eff",
        "name": "",
        "x": 1060,
        "y": 80,
        "wires": [
            [
                "2dcb1956c632490d"
            ]
        ]
    },
    {
        "id": "b135a26127969931",
        "type": "subflow:0be109393cb5f28a",
        "z": "69164b36a28c9eff",
        "name": "",
        "x": 850,
        "y": 80,
        "wires": [
            [
                "ff5aebd5d103af86"
            ]
        ]
    },
    {
        "id": "e0dc4f01a62685d7",
        "type": "change",
        "z": "69164b36a28c9eff",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"napcs\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"naics_to_napcs_m_goco\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 80,
        "wires": [
            [
                "b135a26127969931"
            ]
        ]
    },
    {
        "id": "6de317f273718e08",
        "type": "link out",
        "z": "4afed9425459216e",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1295,
        "y": 180,
        "wires": []
    },
    {
        "id": "a9fa566fb3fb1f74",
        "type": "link in",
        "z": "4afed9425459216e",
        "name": "link in 48",
        "links": [
            "cede3264bdcd0a70",
            "36c4687d5f1bee6b",
            "43545e3b96e7f60c"
        ],
        "x": 515,
        "y": 180,
        "wires": [
            [
                "732b540726152341"
            ]
        ]
    },
    {
        "id": "3c5b06b90858059c",
        "type": "subflow:27c40a87c581e266",
        "z": "4afed9425459216e",
        "name": "",
        "x": 1160,
        "y": 180,
        "wires": [
            [
                "6de317f273718e08"
            ]
        ]
    },
    {
        "id": "b1be3e239b72f3d3",
        "type": "subflow:0be109393cb5f28a",
        "z": "4afed9425459216e",
        "name": "",
        "x": 930,
        "y": 180,
        "wires": [
            [
                "3c5b06b90858059c"
            ]
        ]
    },
    {
        "id": "732b540726152341",
        "type": "change",
        "z": "4afed9425459216e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"core_4\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"core_4\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 180,
        "wires": [
            [
                "b1be3e239b72f3d3"
            ]
        ]
    },
    {
        "id": "57c75bd58af75621",
        "type": "link in",
        "z": "475c4bbdee672833",
        "name": "link in 20",
        "links": [
            "4a50e74e63590ec7",
            "6cd6c27ee7f2bd7d"
        ],
        "x": 635,
        "y": 60,
        "wires": [
            [
                "b552d858621572e5"
            ]
        ]
    },
    {
        "id": "bad79e5ee645cc24",
        "type": "link out",
        "z": "475c4bbdee672833",
        "name": "link out 17",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1375,
        "y": 60,
        "wires": []
    },
    {
        "id": "d90c284a67f6e1b7",
        "type": "subflow:b22812dba408ab8f",
        "z": "475c4bbdee672833",
        "name": "",
        "x": 1270,
        "y": 60,
        "wires": [
            [
                "bad79e5ee645cc24"
            ]
        ]
    },
    {
        "id": "b552d858621572e5",
        "type": "change",
        "z": "475c4bbdee672833",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"geography\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"geography\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 790,
        "y": 60,
        "wires": [
            [
                "57cb2ba29b5e996e"
            ]
        ]
    },
    {
        "id": "57cb2ba29b5e996e",
        "type": "subflow:0be109393cb5f28a",
        "z": "475c4bbdee672833",
        "name": "",
        "x": 1050,
        "y": 60,
        "wires": [
            [
                "d90c284a67f6e1b7"
            ]
        ]
    },
    {
        "id": "f2f56f84d002ec0f",
        "type": "link in",
        "z": "d416a739a235277c",
        "name": "link in 43",
        "links": [
            "89e7e315b3a8c30b"
        ],
        "x": 575,
        "y": 60,
        "wires": [
            [
                "ba808bf2520da70a"
            ]
        ]
    },
    {
        "id": "63e57e09491e405e",
        "type": "link out",
        "z": "d416a739a235277c",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1405,
        "y": 60,
        "wires": []
    },
    {
        "id": "071bb94d4092dc47",
        "type": "subflow:1159e6c8f76efda3",
        "z": "d416a739a235277c",
        "name": "",
        "x": 1260,
        "y": 60,
        "wires": [
            [
                "63e57e09491e405e"
            ]
        ]
    },
    {
        "id": "ba808bf2520da70a",
        "type": "change",
        "z": "d416a739a235277c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"electric_energy\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"electric_energy_module\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 60,
        "wires": [
            [
                "475236651a5b2d4f"
            ]
        ]
    },
    {
        "id": "475236651a5b2d4f",
        "type": "subflow:0be109393cb5f28a",
        "z": "d416a739a235277c",
        "name": "",
        "x": 1010,
        "y": 60,
        "wires": [
            [
                "071bb94d4092dc47"
            ]
        ]
    },
    {
        "id": "d946e5bca62e02d1",
        "type": "link in",
        "z": "c54f3247808fdf7f",
        "name": "link in 44",
        "links": [
            "ba5d5bdad0bc957e"
        ],
        "x": 625,
        "y": 60,
        "wires": [
            [
                "1a26d214cba4c42b"
            ]
        ]
    },
    {
        "id": "d167c6cf7b89444d",
        "type": "link out",
        "z": "c54f3247808fdf7f",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1455,
        "y": 60,
        "wires": []
    },
    {
        "id": "3bae3318fcbf535f",
        "type": "subflow:aadd13b9b9077fc3",
        "z": "c54f3247808fdf7f",
        "name": "",
        "x": 1300,
        "y": 60,
        "wires": [
            [
                "d167c6cf7b89444d"
            ]
        ]
    },
    {
        "id": "1a26d214cba4c42b",
        "type": "change",
        "z": "c54f3247808fdf7f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"electric_energy\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"electric_energy_module\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 790,
        "y": 60,
        "wires": [
            [
                "0d8c91218e476015"
            ]
        ]
    },
    {
        "id": "0d8c91218e476015",
        "type": "subflow:0be109393cb5f28a",
        "z": "c54f3247808fdf7f",
        "name": "",
        "x": 1050,
        "y": 60,
        "wires": [
            [
                "3bae3318fcbf535f"
            ]
        ]
    },
    {
        "id": "24fea5e6f5d0c6b0",
        "type": "link in",
        "z": "ed71400b88bb6305",
        "name": "Derived Naics Code Link",
        "links": [
            "039e4172b173ea18"
        ],
        "x": 365,
        "y": 80,
        "wires": [
            [
                "3ed8dcad8bf11749"
            ]
        ]
    },
    {
        "id": "2e4029be13b46163",
        "type": "link out",
        "z": "ed71400b88bb6305",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1145,
        "y": 80,
        "wires": []
    },
    {
        "id": "c003a5dafd8972d5",
        "type": "subflow:f07c9ae4084738fc",
        "z": "ed71400b88bb6305",
        "name": "",
        "x": 1020,
        "y": 80,
        "wires": [
            [
                "2e4029be13b46163"
            ]
        ]
    },
    {
        "id": "bddf89357662d3b1",
        "type": "subflow:0be109393cb5f28a",
        "z": "ed71400b88bb6305",
        "name": "",
        "x": 770,
        "y": 80,
        "wires": [
            [
                "c003a5dafd8972d5"
            ]
        ]
    },
    {
        "id": "3ed8dcad8bf11749",
        "type": "change",
        "z": "ed71400b88bb6305",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"electric_energy\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"electric_energy_module\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 80,
        "wires": [
            [
                "bddf89357662d3b1"
            ]
        ]
    },
    {
        "id": "3cd3e107ac0789b7",
        "type": "link in",
        "z": "1c6c32346fee9416",
        "name": "link in 45",
        "links": [
            "8434c6c16c1fbaaf",
            "cede3264bdcd0a70",
            "36c4687d5f1bee6b"
        ],
        "x": 635,
        "y": 80,
        "wires": [
            [
                "651b041f7e61e179"
            ]
        ]
    },
    {
        "id": "ca558b1ab669675d",
        "type": "link out",
        "z": "1c6c32346fee9416",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1505,
        "y": 80,
        "wires": []
    },
    {
        "id": "bf94fdbc220bc178",
        "type": "subflow:3ccae806a14cca8d",
        "z": "1c6c32346fee9416",
        "name": "",
        "x": 1340,
        "y": 80,
        "wires": [
            [
                "ca558b1ab669675d"
            ]
        ]
    },
    {
        "id": "651b041f7e61e179",
        "type": "change",
        "z": "1c6c32346fee9416",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"electric_energy\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"electric_energy_module\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 80,
        "wires": [
            [
                "51888bfbb37a0690"
            ]
        ]
    },
    {
        "id": "51888bfbb37a0690",
        "type": "subflow:0be109393cb5f28a",
        "z": "1c6c32346fee9416",
        "name": "",
        "x": 1090,
        "y": 80,
        "wires": [
            [
                "bf94fdbc220bc178"
            ]
        ]
    },
    {
        "id": "d9650115f85479a9",
        "type": "link in",
        "z": "112a2e5b60c3f3a8",
        "name": "link in 18",
        "links": [
            "f14b49f36a5b83fc",
            "ae36b936ef8f7cc6"
        ],
        "x": 685,
        "y": 100,
        "wires": [
            [
                "f924038bf9ba3790"
            ]
        ]
    },
    {
        "id": "434436c270b7f283",
        "type": "link out",
        "z": "112a2e5b60c3f3a8",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1465,
        "y": 100,
        "wires": []
    },
    {
        "id": "bd4aeaec47bb4136",
        "type": "subflow:bfe1ab19e0cbe2cf",
        "z": "112a2e5b60c3f3a8",
        "name": "",
        "x": 1350,
        "y": 100,
        "wires": [
            [
                "434436c270b7f283"
            ]
        ]
    },
    {
        "id": "f924038bf9ba3790",
        "type": "change",
        "z": "112a2e5b60c3f3a8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"classification\",\"program\":\"aies\",\"unit_type\":\"estab\",\"params\":\"naics_alt,naics_validation\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 100,
        "wires": [
            [
                "9d7b5173ac8dfe70"
            ]
        ]
    },
    {
        "id": "9d7b5173ac8dfe70",
        "type": "subflow:0be109393cb5f28a",
        "z": "112a2e5b60c3f3a8",
        "name": "",
        "x": 1110,
        "y": 100,
        "wires": [
            [
                "bd4aeaec47bb4136"
            ]
        ]
    },
    {
        "id": "c0fb97b1232af4ac",
        "type": "link in",
        "z": "b03832cc4c2422fd",
        "name": "load_referrals_link",
        "links": [
            "f49fb32690ddbe1a"
        ],
        "x": 1265,
        "y": 60,
        "wires": [
            [
                "1c814e15cc421b32"
            ]
        ]
    },
    {
        "id": "1c814e15cc421b32",
        "type": "subflow:1a584bfe7f4a2458",
        "z": "b03832cc4c2422fd",
        "name": "",
        "x": 1420,
        "y": 60,
        "wires": [
            [
                "f096483c422c4725"
            ]
        ]
    },
    {
        "id": "f096483c422c4725",
        "type": "link out",
        "z": "b03832cc4c2422fd",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1575,
        "y": 60,
        "wires": []
    },
    {
        "id": "58074eed293851bb",
        "type": "change",
        "z": "d85ecef9a21f8c9c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"napcs\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"napcs_prep\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 140,
        "wires": [
            [
                "a46833e13dc1cb98"
            ]
        ]
    },
    {
        "id": "a46833e13dc1cb98",
        "type": "subflow:0be109393cb5f28a",
        "z": "d85ecef9a21f8c9c",
        "name": "",
        "x": 910,
        "y": 140,
        "wires": [
            [
                "29d0f3b7fa443f8a"
            ]
        ]
    },
    {
        "id": "7f9f9ce1831e7eba",
        "type": "link out",
        "z": "d85ecef9a21f8c9c",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1275,
        "y": 140,
        "wires": []
    },
    {
        "id": "43159eefde8b9ec7",
        "type": "link in",
        "z": "d85ecef9a21f8c9c",
        "name": "load_referrals_link",
        "links": [
            "bf91ad9e062838cc"
        ],
        "x": 475,
        "y": 140,
        "wires": [
            [
                "58074eed293851bb"
            ]
        ]
    },
    {
        "id": "29d0f3b7fa443f8a",
        "type": "subflow:e7b7501b29427db9",
        "z": "d85ecef9a21f8c9c",
        "name": "",
        "x": 1140,
        "y": 140,
        "wires": [
            [
                "7f9f9ce1831e7eba"
            ]
        ]
    },
    {
        "id": "9f524f80692dc3ae",
        "type": "subflow:7e80c62ce8c753dc",
        "z": "8d66eac23e096d21",
        "name": "",
        "x": 1090,
        "y": 100,
        "wires": [
            [
                "5ff66799891fa56d"
            ]
        ]
    },
    {
        "id": "31044b289c96eb9f",
        "type": "subflow:0be109393cb5f28a",
        "z": "8d66eac23e096d21",
        "name": "",
        "x": 850,
        "y": 100,
        "wires": [
            [
                "9f524f80692dc3ae"
            ]
        ]
    },
    {
        "id": "988326d7ffcdae39",
        "type": "change",
        "z": "8d66eac23e096d21",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"mfg_napcs\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"mfg_napcs\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 100,
        "wires": [
            [
                "31044b289c96eb9f"
            ]
        ]
    },
    {
        "id": "5ff66799891fa56d",
        "type": "link out",
        "z": "8d66eac23e096d21",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1265,
        "y": 100,
        "wires": []
    },
    {
        "id": "49960e045e84befd",
        "type": "link in",
        "z": "8d66eac23e096d21",
        "name": "derive_mfg_naics_link",
        "links": [
            "bbfea30cdba9957b"
        ],
        "x": 425,
        "y": 100,
        "wires": [
            [
                "988326d7ffcdae39"
            ]
        ]
    },
    {
        "id": "7a7af6643c8cdc10",
        "type": "link in",
        "z": "f63af22e81ed47a8",
        "name": "link in 28",
        "links": [
            "ff27924ce01b7894",
            "f4fc1424aec01ccf"
        ],
        "x": 425,
        "y": 80,
        "wires": [
            [
                "d821c6ccde657b7e"
            ]
        ]
    },
    {
        "id": "2e09b853297763c9",
        "type": "link out",
        "z": "f63af22e81ed47a8",
        "name": "link out 22",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1215,
        "y": 80,
        "wires": []
    },
    {
        "id": "d821c6ccde657b7e",
        "type": "change",
        "z": "f63af22e81ed47a8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"derived\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"derived\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 80,
        "wires": [
            [
                "74d25250d06177ff"
            ]
        ]
    },
    {
        "id": "74d25250d06177ff",
        "type": "subflow:0be109393cb5f28a",
        "z": "f63af22e81ed47a8",
        "name": "",
        "x": 850,
        "y": 80,
        "wires": [
            [
                "649d54a6aab70586"
            ]
        ]
    },
    {
        "id": "649d54a6aab70586",
        "type": "subflow:b68b1cdb465a831c",
        "z": "f63af22e81ed47a8",
        "name": "",
        "x": 1080,
        "y": 80,
        "wires": [
            [
                "2e09b853297763c9"
            ]
        ]
    },
    {
        "id": "60a8272cfde55a5e",
        "type": "link in",
        "z": "91e923b1d58a25de",
        "name": "link in 30",
        "links": [
            "1597f28db268d317",
            "fa7a570c778cff30"
        ],
        "x": 415,
        "y": 60,
        "wires": [
            [
                "cec9c31fd94a1ab5"
            ]
        ]
    },
    {
        "id": "62e629bde644c4ac",
        "type": "link out",
        "z": "91e923b1d58a25de",
        "name": "link out 24",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1245,
        "y": 60,
        "wires": []
    },
    {
        "id": "8f2445107331a868",
        "type": "subflow:96f29b19e2260e65",
        "z": "91e923b1d58a25de",
        "name": "",
        "x": 1090,
        "y": 60,
        "wires": [
            [
                "62e629bde644c4ac"
            ]
        ]
    },
    {
        "id": "cec9c31fd94a1ab5",
        "type": "change",
        "z": "91e923b1d58a25de",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{     \"moduleName\": \"flags\",     \"program\": \"aies\",     \"unit_type\": \"all\",     \"params\": \"load_referrals\" }",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 60,
        "wires": [
            [
                "7cb8891ca5caafab"
            ]
        ]
    },
    {
        "id": "7cb8891ca5caafab",
        "type": "subflow:0be109393cb5f28a",
        "z": "91e923b1d58a25de",
        "name": "",
        "x": 850,
        "y": 60,
        "wires": [
            [
                "8f2445107331a868"
            ]
        ]
    },
    {
        "id": "6a660fccf443bde2",
        "type": "link in",
        "z": "0952db06f674f8bc",
        "name": "link in 29",
        "links": [
            "3fd3586e01a6e2dc",
            "6413daba1c8991e2"
        ],
        "x": 435,
        "y": 220,
        "wires": [
            [
                "c33fc2971a1649d2"
            ]
        ]
    },
    {
        "id": "c33fc2971a1649d2",
        "type": "change",
        "z": "0952db06f674f8bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.lookup",
                "pt": "msg",
                "to": "{\"moduleName\":\"logical_edit\",\"program\":\"aies\",\"unit_type\":\"all\",\"params\":\"logical_edit\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 220,
        "wires": [
            [
                "0e7e45c109b5dd47"
            ]
        ]
    },
    {
        "id": "0e7e45c109b5dd47",
        "type": "subflow:0be109393cb5f28a",
        "z": "0952db06f674f8bc",
        "name": "",
        "x": 850,
        "y": 220,
        "wires": [
            [
                "215759fb43139523"
            ]
        ]
    },
    {
        "id": "05e1e9f94e92a19d",
        "type": "link out",
        "z": "0952db06f674f8bc",
        "name": "link out 23",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1235,
        "y": 220,
        "wires": []
    },
    {
        "id": "215759fb43139523",
        "type": "subflow:5e2c6717be2fdd36",
        "z": "0952db06f674f8bc",
        "name": "",
        "x": 1090,
        "y": 220,
        "wires": [
            [
                "05e1e9f94e92a19d"
            ]
        ]
    },
    {
        "id": "523b46f795f0a997",
        "type": "ui_dropdown",
        "z": "dad88d9a3132fed6",
        "name": "select_modules",
        "label": "",
        "tooltip": "List of available modules",
        "place": "Select Option",
        "group": "96ded9aa7c8ec809",
        "order": 1,
        "width": "8",
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "BR Stat Evaluation",
                "value": "br_stat_evaluation",
                "type": "str"
            },
            {
                "label": "Derive NAICS Code",
                "value": "derived_naics_code",
                "type": "str"
            },
            {
                "label": "Classification",
                "value": "classification",
                "type": "str"
            },
            {
                "label": "Geography",
                "value": "geography",
                "type": "str"
            },
            {
                "label": "Calculate Best Admin Receipts",
                "value": "best_admin_receipts",
                "type": "str"
            },
            {
                "label": "Critical Error",
                "value": "critical_error",
                "type": "str"
            },
            {
                "label": "Completeness Check",
                "value": "completeness_check",
                "type": "str"
            },
            {
                "label": "NONNORM",
                "value": "nonnorm",
                "type": "str"
            },
            {
                "label": "derived_items",
                "value": "derived_items",
                "type": "str"
            },
            {
                "label": "Logical Edit",
                "value": "logical",
                "type": "str"
            },
            {
                "label": "Post Edit",
                "value": "post_edit",
                "type": "str"
            },
            {
                "label": "Electric Energy Module",
                "value": "electric_energy_module",
                "type": "str"
            },
            {
                "label": "Electric Energy Module Cont",
                "value": "electric_energy_module_cont",
                "type": "str"
            },
            {
                "label": "Electric Impute Module",
                "value": "electric_impute_module",
                "type": "str"
            },
            {
                "label": "Completeness",
                "value": "completeness",
                "type": "str"
            },
            {
                "label": "RCPT_TOT_VAL",
                "value": "rcpt_tot_val",
                "type": "str"
            },
            {
                "label": "PAY_ANN_VAL",
                "value": "pay_ann_val",
                "type": "str"
            },
            {
                "label": "PAY_QTR1_VAL",
                "value": "pay_qtr1_val",
                "type": "str"
            },
            {
                "label": "Emp MAR12_NUM",
                "value": "emp_mar12_num",
                "type": "str"
            },
            {
                "label": "Q Flow",
                "value": "qflow",
                "type": "str"
            },
            {
                "label": "Pre Db Write Back For Leased",
                "value": "pre_db_write_back_for_leased",
                "type": "str"
            },
            {
                "label": "Unit Balance",
                "value": "unit_balance",
                "type": "str"
            },
            {
                "label": "Valid Zero",
                "value": "valid_zero",
                "type": "str"
            },
            {
                "label": "Estab To KAU Addivity Prep and Check",
                "value": "estab_to_kau_addivity_prep_and_check",
                "type": "str"
            },
            {
                "label": "Valid Negative Value",
                "value": "valid_negative_value",
                "type": "str"
            },
            {
                "label": "KAU To Company Addivity_prep_and_check",
                "value": "kau_to_company_addivity_prep_and_check",
                "type": "str"
            },
            {
                "label": "Demo: Interactive Mode",
                "value": "interactive_mode",
                "type": "str"
            },
            {
                "label": "Demo: Batch Mode 1",
                "value": "batch_mode_1",
                "type": "str"
            },
            {
                "label": "Demo: Batch Mode 2",
                "value": "batch_mode_2",
                "type": "str"
            },
            {
                "label": "NONNORM: Init Set ACTVMIO & OPSTATS",
                "value": "nonorm_init_set",
                "type": "str"
            },
            {
                "label": "NONNORM: Router",
                "value": "nonorm_router",
                "type": "str"
            },
            {
                "label": "NONNORM: Set OPSTATS & ACTVMIO",
                "value": "nonorm_set_opstats_and_actvmio",
                "type": "str"
            },
            {
                "label": "NONNORM: Set NONORM",
                "value": "nonorm_set",
                "type": "str"
            },
            {
                "label": "NONNORM: Set Basic to 0",
                "value": "nonorm_set_basic_to_zero",
                "type": "str"
            },
            {
                "label": "NONNORM: Special Season final",
                "value": "nonorm_special_season_final",
                "type": "str"
            },
            {
                "label": "mfg_payqtr1",
                "value": "mfg_payqtr1",
                "type": "str"
            },
            {
                "label": "mfg_payann",
                "value": "mfg_payann",
                "type": "str"
            },
            {
                "label": "mfg_empq1",
                "value": "mfg_empq1",
                "type": "str"
            },
            {
                "label": "KAU To Company Additivity Check",
                "value": "kau_to_company_additivity_check",
                "type": "str"
            },
            {
                "label": "inventories_balance",
                "value": "inventories_balance",
                "type": "str"
            },
            {
                "label": "lifo_valuation_method",
                "value": "lifo_valuation_method",
                "type": "str"
            },
            {
                "label": "evaluate_lifo_reverse_module",
                "value": "evaluate_lifo_reverse_module",
                "type": "str"
            },
            {
                "label": "evaluate_lifo_module",
                "value": "evaluate_lifo_module",
                "type": "str"
            },
            {
                "label": "non_lifo_valuation_methods_module",
                "value": "non_lifo_valuation_methods_module",
                "type": "str"
            },
            {
                "label": "evaluatenon_lifo_valuation_methods_module",
                "value": "evaluatenon_lifo_valuation_methods_module",
                "type": "str"
            },
            {
                "label": "evaluate_detail_valuation_methods",
                "value": "evaluate_detail_valuation_methods",
                "type": "str"
            },
            {
                "label": "evaluate_non_lifo_valuation_method_module",
                "value": "evaluate_non_lifo_valuation_method_module",
                "type": "str"
            },
            {
                "label": "non_lifo_random_module",
                "value": "non_lifo_random_module",
                "type": "str"
            },
            {
                "label": "napcs_balance",
                "value": "napcs_balance",
                "type": "str"
            },
            {
                "label": "napcs_balancing",
                "value": "napcs_balance_balancing",
                "type": "str"
            },
            {
                "label": "napcs_hdicat",
                "value": "napcs_hdicat",
                "type": "str"
            },
            {
                "label": "napcs_m_goco",
                "value": "napcs_m_goco",
                "type": "str"
            },
            {
                "label": "napcs_no_donor",
                "value": "napcs_no_donor",
                "type": "str"
            },
            {
                "label": "napcs_recalculate_napcs_fields",
                "value": "napcs_recalculate_napcs_fields",
                "type": "str"
            },
            {
                "label": "napcs_bl_rounding",
                "value": "napcs_bl_rounding",
                "type": "str"
            },
            {
                "label": "load_referrals",
                "value": "load_referrals",
                "type": "str"
            },
            {
                "label": "napcs_prep",
                "value": "napcs_prep",
                "type": "str"
            },
            {
                "label": "derive_mfg_naics",
                "value": "derive_mfg_naics",
                "type": "str"
            },
            {
                "label": "estab_to_kau_additivity",
                "value": "estab_to_kau_additivity",
                "type": "str"
            },
            {
                "label": "estab_to_kau_raking",
                "value": "estab_to_kau_raking",
                "type": "str"
            },
            {
                "label": "SU_to_Ent_MFG_nonMFG",
                "value": "su_to_ent",
                "type": "str"
            },
            {
                "label": "NonMFG_SU_to_KAU",
                "value": "su_to_kau_nonmfg",
                "type": "str"
            },
            {
                "label": "MFG_MU_SU_to_KAU",
                "value": "su_mu_to_kau_mfg",
                "type": "str"
            },
            {
                "label": "KAU_to_SU",
                "value": "kau_to_su",
                "type": "str"
            },
            {
                "label": "histstat",
                "value": "histstat",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 100,
        "y": 340,
        "wires": [
            [
                "38960acd0c73918d"
            ]
        ]
    },
    {
        "id": "0695b3dc79291692",
        "type": "switch",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "property": "payload.selectModule",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "br_stat_evaluation",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "classification",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "geography",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "best_admin_receipts",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "critical_error",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "completeness",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "nonnorm",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "derived_items",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "logical",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "post_edit",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "electric_energy_module",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "electric_energy_module_cont",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "electric_impute_module",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "logical_edits",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "completeness",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pay_ann_val",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "rcpt_tot_val",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "emp_mar12_num",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pay_qtr1_val",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "qflow",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "pre_db_write_back_for_leased",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "unit_balance",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "derived_naics_code",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "valid_zero",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "kau_to_company_addivity_prep_and_check",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "valid_negative_value",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "interactive_mode",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "batch_mode_1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "batch_mode_2",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "nonorm_init_set",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "nonorm_router",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "nonorm_set_opstats_and_actvmio",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "nonorm_set",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "nonorm_set_basic_to_zero",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "nonorm_special_season_final",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "mfg_payqtr1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "mfg_payann",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "mfg_empq1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "kau_to_company_additivity_check",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "inventories_balance",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "lifo_valuation_method",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evaluate_lifo_reverse_module",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evaluate_lifo_module",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "non_lifo_valuation_methods_module",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evaluatenon_lifo_valuation_methods_module",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evaluate_detail_valuation_methods",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evaluate_non_lifo_valuation_method_module",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "non_lifo_random_module",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "napcs_balance",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "napcs_balance_balancing",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "napcs_bl_rounding",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "napcs_recalculate_napcs_fields",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "napcs_no_donor",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "napcs_m_goco",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "napcs_hdicat",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "m_k",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "load_referrals",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "napcs_prep",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "derive_mfg_naics",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "estab_to_kau_additivity",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "estab_to_kau_raking",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "su_to_ent",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "su_to_kau_nonmfg",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "su_mu_to_kau_mfg",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "kau_to_su",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "histstat",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 66,
        "x": 450,
        "y": 1760,
        "wires": [
            [
                "dc2a2ca809797dbd"
            ],
            [
                "f14b49f36a5b83fc"
            ],
            [
                "4a50e74e63590ec7"
            ],
            [
                "81f5d75ffbcd549e"
            ],
            [
                "b1540f3459d95049"
            ],
            [
                "32b24311da4a3220"
            ],
            [
                "cd8a05808eedb5f3"
            ],
            [
                "ff27924ce01b7894"
            ],
            [
                "3fd3586e01a6e2dc"
            ],
            [
                "1597f28db268d317"
            ],
            [
                "89e7e315b3a8c30b"
            ],
            [
                "ba5d5bdad0bc957e"
            ],
            [
                "8434c6c16c1fbaaf"
            ],
            [
                "24ae978c7feb5fc3"
            ],
            [
                "b9b9acc35bdd0b75"
            ],
            [
                "43545e3b96e7f60c"
            ],
            [
                "d5aac8a297ee6dd2"
            ],
            [
                "28494dbc74f30091"
            ],
            [
                "5d05b108e4e3f722"
            ],
            [
                "8272974b9a32a0ac"
            ],
            [
                "fbcbf9510de0509c"
            ],
            [
                "05b67576d444bda4"
            ],
            [
                "039e4172b173ea18"
            ],
            [
                "45b768d58693d73d"
            ],
            [],
            [
                "854cd7a417cbbc6e"
            ],
            [
                "6c8827ce7a4c83d8"
            ],
            [
                "6386460ff91d3960"
            ],
            [
                "6982bc340b585149"
            ],
            [
                "48c2bbd321b77688"
            ],
            [
                "a0a9a69afb297619"
            ],
            [
                "879c5a04e7f7b3ba"
            ],
            [
                "601d06243349006e"
            ],
            [
                "9924458ebb7935cd"
            ],
            [
                "51d4f6e460537ff8"
            ],
            [
                "8cc4aec631b9f7ab"
            ],
            [
                "6e0891f1d9b0f50b"
            ],
            [
                "405380585cc28809"
            ],
            [
                "8ab5edfeddc79fdc"
            ],
            [
                "be79a45237eac5df"
            ],
            [
                "961d21f9c9d6935d"
            ],
            [
                "256113e429ce586b"
            ],
            [
                "6e4d6926b48c4bfc"
            ],
            [
                "6a7a578fbd272b1f"
            ],
            [
                "ac696618fbdb5b2b"
            ],
            [
                "ff930476a898868c"
            ],
            [
                "17eb7e821e3b7ea0"
            ],
            [
                "9a0ffed7eefbb31e"
            ],
            [
                "f2d1653b5ba3e5d2"
            ],
            [
                "03b4a30c8b73aaa1"
            ],
            [
                "184f643c8c0c9483"
            ],
            [
                "13026c6f9554fd48"
            ],
            [
                "628a357ebf92b85e"
            ],
            [
                "23110971cf0ed68c"
            ],
            [
                "f96645ae14ef8fb7"
            ],
            [
                "1b801f920c932ed1"
            ],
            [
                "f49fb32690ddbe1a"
            ],
            [
                "bf91ad9e062838cc"
            ],
            [
                "bbfea30cdba9957b"
            ],
            [
                "2c7eaaca104f6a2c"
            ],
            [
                "5e674b959c1b250a"
            ],
            [
                "2ae1f1be82166f95"
            ],
            [
                "3acafa8baa321281"
            ],
            [
                "63be9b3202d985e3"
            ],
            [
                "537b24e51dc942ff"
            ],
            [
                "7da3e97012eb822e"
            ]
        ]
    },
    {
        "id": "0f1620a9dfb42cf6",
        "type": "ui_button",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "group": "96ded9aa7c8ec809",
        "order": 2,
        "width": 6,
        "height": 1,
        "passthru": true,
        "label": "Run Selected Module",
        "tooltip": "Run Module",
        "color": "blue",
        "bgcolor": "",
        "className": "",
        "icon": "send",
        "payload": "payload",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 140,
        "y": 1760,
        "wires": [
            [
                "2197046546278bb4"
            ]
        ]
    },
    {
        "id": "dc2a2ca809797dbd",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out br stat eval",
        "mode": "link",
        "links": [
            "3f936d74a59fd02d"
        ],
        "x": 1045,
        "y": 1280,
        "wires": []
    },
    {
        "id": "38960acd0c73918d",
        "type": "change",
        "z": "dad88d9a3132fed6",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "selectModule",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "version",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 340,
        "wires": [
            [
                "33c11d41bc54bd5d",
                "d629ef47b7e7edbe"
            ]
        ]
    },
    {
        "id": "8fc8da4acdeb51a4",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "name": "link out 10",
        "mode": "link",
        "links": [
            "30c2b54a06202964",
            "617d768f3414b52e"
        ],
        "x": 1385,
        "y": 160,
        "wires": []
    },
    {
        "id": "33c11d41bc54bd5d",
        "type": "ui_template",
        "z": "dad88d9a3132fed6",
        "group": "22fec4fdabbf9dd8",
        "name": "",
        "order": 1,
        "width": 18,
        "height": 13,
        "format": "<div ng-switch=\"msg.payload\">\n        <div ng-switch-when=\"br_stat_evaluation\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/br_stat.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"critical_error\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/critical_error.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"logical\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/logical.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n        <div ng-switch-when=\"derived_naics_code\">\n             <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/derive_naics_code.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"classification\">\n             <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/classification.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"geography\">\n             <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/geography.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n     </div>\n    <div ng-switch-when=\"electric_energy_module\">\n             <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/electric_energy_module.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"electric_energy_module_cont\">\n             <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/electric_energy_module_cont.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"electric_impute_module\">\n             <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/electric_impute_module.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"best_admin_receipts\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/best_admin_receipt.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"emp_mar12_num\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/emp_mar12_num.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"pay_ann_val\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/pay_ann_val.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"pay_qtr1_val\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/pay_qtr1_val.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"rcpt_tot_val\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/rcpt_tot_val.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"qflow\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/qflow.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"post_edit_status_field\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/post_edit_status_field.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"pre_db_write_back_for_leased\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/pre_db_write_back_for_leased.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"unit_balance\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/unit_balance.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"derived_naics_code\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/derived_naics_code.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"valid_negative_value\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/valid_negative_value.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"valid_zero\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/valid_zero.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"estab_to_kau_addivity_prep_and_check\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/estab_to_kau_addivity_prep_and_check.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"kau_to_company_addivity_prep_and_check\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/kau_to_company_addivity_prep_and_check.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"interactive_mode\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/interactive_mode.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"batch_mode_1\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/batch_mode_1.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"batch_mode_2\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/batch_mode_2.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"nonorm_special_season_final\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/nonorm_special_season_final.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"nonorm_set\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/nonorm_set.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"nonorm_set_opstats_and_actvmio\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/nonorm_set_opstats_and_actvmio.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"nonorm_set_basic_to_zero\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/nonorm_set_basic_to_zero.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"nonorm_router\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/nonorm_router.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"nonorm_init_set\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/nonorm_init_set.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"mfg_payqtr1\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/mfg_payqtr1.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"mfg_payann\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/mfg_payann.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"mfg_empq1\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/mfg_empq1.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"kau_to_company_additivity_check\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/kau_to_company_additivity_check.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n\n    <div ng-switch-when=\"inventories_balance\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/inventories_balance.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"lifo_valuation_method\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/lifo_valuation_method.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"evaluate_lifo_reverse_module\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/evaluate_lifo_reverse_module.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"evaluate_lifo_module\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/evaluate_lifo_module.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"non_lifo_valuation_methods_module\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/non_lifo_valuation_methods_module.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"evaluatenon_lifo_valuation_methods_module\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/evaluatenon_lifo_valuation_methods_module.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"evaluate_detail_valuation_methods\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/evaluate_detail_valuation_methods.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"evaluate_non_lifo_valuation_method_module\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/evaluate_non_lifo_valuation_method_module.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"non_lifo_random_module\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/non_lifo_random_module.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"napcs_balance\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_balance.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"napcs_balance_balancing\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_balance_balancing.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n\n    <div ng-switch-when=\"napcs_hdicat\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_hdicat.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"napcs_m_goco\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_m_goco.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"napcs_no_donor\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_no_donor.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"napcs_recalculate_napcs_fields\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_recalculate_napcs_fields.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"napcs_bl_rounding\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_bl_rounding.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"load_referrals\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/load_referrals.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"napcs_prep\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_prep.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"derive_mfg_naics\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/derive_mfg_naics.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"derived_items\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/derived_items.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"post_edit\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/post_edit.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"estab_to_kau_additivity\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/estab_to_kau.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"estab_to_kau_raking\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/estab_to_kau_raking.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"su_to_ent\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/su_to_ent.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"su_to_kau_nonmfg\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/su_to_kau_nonmfg.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"su_mu_to_kau_mfg\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/su_mu_to_kau_mfg.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"kau_to_su\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/kau_to_su.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-when=\"histstat\">\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/histstat.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n    <div ng-switch-default>\n        <img src=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/completeness.png?version={{msg.version}}\" style=\"max-width: 100%; height: auto;\">\n    </div>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 480,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "f14b49f36a5b83fc",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "d9650115f85479a9",
            "af33a10fa21c5083"
        ],
        "x": 1135,
        "y": 1300,
        "wires": []
    },
    {
        "id": "4a50e74e63590ec7",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out geography",
        "mode": "link",
        "links": [
            "57c75bd58af75621"
        ],
        "x": 1195,
        "y": 1320,
        "wires": []
    },
    {
        "id": "81f5d75ffbcd549e",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out Best Admin Receipts",
        "mode": "link",
        "links": [
            "2eee0041d9d93424"
        ],
        "x": 1245,
        "y": 1340,
        "wires": []
    },
    {
        "id": "b1540f3459d95049",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out critical error",
        "mode": "link",
        "links": [
            "8feba05e91ff48f3"
        ],
        "x": 1285,
        "y": 1360,
        "wires": []
    },
    {
        "id": "32b24311da4a3220",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out completeness",
        "mode": "link",
        "links": [
            "49b8c4d94cef7ff7",
            "ef4348f935cbb1ca"
        ],
        "x": 1335,
        "y": 1380,
        "wires": []
    },
    {
        "id": "cd8a05808eedb5f3",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out nonnorm",
        "mode": "link",
        "links": [
            "8807ce2046dc8a32"
        ],
        "x": 1375,
        "y": 1400,
        "wires": []
    },
    {
        "id": "ff27924ce01b7894",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out derived items",
        "mode": "link",
        "links": [
            "7a7af6643c8cdc10"
        ],
        "x": 1415,
        "y": 1420,
        "wires": []
    },
    {
        "id": "3fd3586e01a6e2dc",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out logical edits",
        "mode": "link",
        "links": [
            "6a660fccf443bde2"
        ],
        "x": 1455,
        "y": 1440,
        "wires": []
    },
    {
        "id": "1597f28db268d317",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "60a8272cfde55a5e"
        ],
        "x": 1495,
        "y": 1460,
        "wires": []
    },
    {
        "id": "2197046546278bb4",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "setState",
        "func": "msg.payload = {\n    selectModule: flow.get('selectedModule'),\n    csv: global.get('moduleFacts')\n}\nmsg.topic = 'runModule'\nmsg.complete = true\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 1760,
        "wires": [
            [
                "0695b3dc79291692"
            ]
        ]
    },
    {
        "id": "d629ef47b7e7edbe",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "name": "Set selectModule To flow ctx",
        "func": "flow.set('selectedModule', msg.payload)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "12c94ce38056fc20",
        "type": "ui_text_input",
        "z": "dad88d9a3132fed6",
        "g": "302cb8040ecade52",
        "name": "File Name",
        "label": "Facts",
        "tooltip": "Enter the location of the parameters file",
        "group": "a5b67787a0857995",
        "order": 1,
        "width": 8,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "className": "",
        "topicType": "msg",
        "x": 800,
        "y": 760,
        "wires": [
            [
                "a47c991027033263"
            ]
        ]
    },
    {
        "id": "499c2706ea3d919f",
        "type": "file in",
        "z": "dad88d9a3132fed6",
        "name": "Read File",
        "filename": "payload",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 580,
        "y": 280,
        "wires": [
            [
                "d9f955651664d4a8"
            ]
        ]
    },
    {
        "id": "d9f955651664d4a8",
        "type": "csv",
        "z": "dad88d9a3132fed6",
        "name": "",
        "sep": ",",
        "hdrin": true,
        "hdrout": "none",
        "multi": "mult",
        "ret": "\\r\\n",
        "temp": "",
        "skip": "0",
        "strings": false,
        "include_empty_strings": false,
        "include_null_values": false,
        "x": 710,
        "y": 260,
        "wires": [
            [
                "792badd055e46ded"
            ]
        ]
    },
    {
        "id": "792badd055e46ded",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "name": "keysToUpperCase",
        "func": "function keysToUpperCase(obj) {\n    const output = {};\n    for (let key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            if (typeof obj[key] === 'object' && obj[key] !== null) {\n                output[key.toUpperCase()] = keysToUpperCase(obj[key]);\n            } else {\n                output[key.toUpperCase()] = obj[key];\n            }\n        }\n    }\n    return output;\n}\n\nlet p = msg.payload.map(keysToUpperCase);\nmsg.payload = p\n\nlet ptr = global.get(\"ptrModuleFacts\"); //HF\n\nflow.set('moduleFacts', p)\nglobal.set('moduleFacts', p)\nglobal.set('originalData', p[ptr]) //HF\n// global.set('originalData', p[0]) //NK\nmsg.topic = 'csv'\nmsg.ui_control = {\n    max: p.length // Assuming msg.payload contains the row count\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 220,
        "wires": [
            [
                "8fc8da4acdeb51a4",
                "8ff713c60410aa36"
            ]
        ]
    },
    {
        "id": "ca8be9e1afb53866",
        "type": "link in",
        "z": "dad88d9a3132fed6",
        "name": "link in 37",
        "links": [
            "60931347e15bc805"
        ],
        "x": 705,
        "y": 140,
        "wires": [
            [
                "792badd055e46ded"
            ]
        ]
    },
    {
        "id": "5f62bf825c6c1132",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "name": "nullify moduleFacts and originalData",
        "func": "flow.set(\"moduleFacts\", [])\nflow.set(\"originalData\", [])\n//NK initialize global context\nglobal.set(\"originalData\", [])\nglobal.set(\"moduleFacts\", [])\nglobal.set(\"ptrModuleFacts\",0)\n\n\n// // Reset flow context variables\n// flow.keys().forEach(function (key) {\n//     flow.context().set(key, undefined);\n// });\n\n// // Reset global context variables\n// global.keys().forEach(function (key) {\n//     global.context().set(key, undefined);\n// });\n\n\n\n\nif(global.get(\"filename\")){\n    // msg.filename = global.get(\"filename\")\n    msg.payload = global.get(\"filename\")\n    return msg\n}\nelse return null;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 260,
        "wires": [
            [
                "499c2706ea3d919f"
            ]
        ]
    },
    {
        "id": "a47c991027033263",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "302cb8040ecade52",
        "name": "Set FileName",
        "func": "global.set(\"filename\", msg.payload)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "aee5640ceffb474d",
        "type": "ui_text",
        "z": "dad88d9a3132fed6",
        "group": "1d1a43b7179c848f",
        "order": 3,
        "width": 8,
        "height": 1,
        "name": "Show Count",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1330,
        "y": 400,
        "wires": []
    },
    {
        "id": "8ff713c60410aa36",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "name": "Get counts",
        "func": "let p = msg.payload.length\nmsg.payload = p \nmsg.ui_control = {\n    max: p// Assuming msg.payload contains the row count\n};\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 260,
        "wires": [
            [
                "aee5640ceffb474d",
                "3c92b89522e322f8"
            ]
        ]
    },
    {
        "id": "3c92b89522e322f8",
        "type": "ui_numeric",
        "z": "dad88d9a3132fed6",
        "name": "",
        "label": "Select Record",
        "tooltip": "",
        "group": "1d1a43b7179c848f",
        "order": 1,
        "width": 4,
        "height": 1,
        "wrap": true,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "format": "{{value}}",
        "min": "1",
        "max": "",
        "step": 1,
        "className": "",
        "x": 860,
        "y": 80,
        "wires": [
            [
                "251d88e5cb4a68cb"
            ]
        ]
    },
    {
        "id": "251d88e5cb4a68cb",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "name": "Select ptr in csv file",
        "func": "// Get the pointer from the ui which record in the csv is selected\n// set the value of the ptr to the count from the ui\nlet ptr = msg.payload - 1\nglobal.set(\"ptrModuleFacts\", ptr)\nmsg.payload = global.get(\"moduleFacts\")\nglobal.set('originalData', msg.payload[ptr])\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1250,
        "y": 80,
        "wires": [
            [
                "8fc8da4acdeb51a4"
            ]
        ]
    },
    {
        "id": "7992553925c479af",
        "type": "ui_button",
        "z": "dad88d9a3132fed6",
        "name": "Load CSV",
        "group": "a5b67787a0857995",
        "order": 3,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Load CSV",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 80,
        "y": 260,
        "wires": [
            [
                "5f62bf825c6c1132"
            ]
        ]
    },
    {
        "id": "7c30fb48.99cd2c",
        "type": "http in",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "url": "/upload_page",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 640,
        "wires": [
            [
                "3153fbd3.203a64"
            ]
        ]
    },
    {
        "id": "3153fbd3.203a64",
        "type": "template",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Upload CSV File</title>\n    <!-- Include Materialize CSS and JS -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css\">\n    <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\"></script>\n</head>\n<body>\n  <nav>\n    <div class=\"blue nav-wrapper\">\n      <a href=\"#\" data-target=\"mobile-demo\" class=\"sidenav-trigger\"><i class=\"material-icons\">menu</i></a>\n      <ul class=\"left hide-on-med-and-down\">\n        <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n      </ul>\n    </div>\n  </nav>\n\n  <ul class=\"blue sidenav\" id=\"mobile-demo\">\n      <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n  </ul>\n<div class=\"container\">\n    <h1 class=\"center-align\">Upload CSV File</h1>\n    \n    <div class=\"row\">\n        <form action=\"/upload\" method=\"POST\" enctype=\"multipart/form-data\" class=\"col s12\">\n            <div class=\"file-field input-field\">\n                <div class=\"btn\">\n                    <span>File</span>\n                    <input type=\"file\" name=\"myFile\">\n                </div>\n                <div class=\"file-path-wrapper\">\n                    <input class=\"file-path validate\" type=\"text\" placeholder=\"Upload a CSV file\">\n                </div>\n            </div>\n            <div class=\"input-field center-align\">\n                <button onclick=\"showToast()\" class=\"btn waves-effect waves-light\" type=\"submit\">Submit\n                    <i class=\"material-icons right\">send</i>\n                </button>\n            </div>\n        </form>\n    </div>\n</div>\n<div class=\"container\">\n  <h4> CSV Links </h4>\n  <table class=\"responsive-table\">\n        <thead>\n          <tr>\n              <th>Name</th>\n              <th>Link</th>\n          </tr>\n        </thead>\n\n        <tbody>\n          <tr>\n            <td>rcpt_tot_val</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/rcpt_tot_val.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>pay_qtr1_val</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/pay_qtr1_val.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>pay_ann_val</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/pay_ann_val.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>emp_mar12_num</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/emp_mar12_num.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>post_edit_status_fields</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/post_edit_status_ields.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>pre_db_writeback_for_leased</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/pre_db_writeback_for_leased.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>unit_balance</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/unit_balance.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>electricity</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/electricity.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>derived_naics_code</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/derived_naics_code.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          </tr>\n           <tr>\n            <td>classification</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/classification.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n            <tr>\n            <td>valid_zero</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/valid_zero.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>best_admin_receipts</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/calculate_best_admin.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>critical_error</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/critical_error.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>completeness</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/completeness.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>Interactive Mode</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/interactive_mode.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>Geography</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/geography.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>mfg_payqtr1</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/mfg_payroll_and_employment.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>mfg_payann</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/mfg_payroll_and_employment.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>mfg_empq1</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/mfg_payroll_and_employment.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>valid_negative_value</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/valid_negative_value.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n            <tr>\n            <td>nonnorm_init_set_actvmio_opstats</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/nonnorm_init_set_actvmio_opstats.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>set_basic_to_0</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/set_basic_to_0.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n                    <tr>\n            <td>set_nonnorm</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/set_nonnorm.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>nonnorm_set_opstats_actvmio</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/nonnorm_set_opstats_actvmio.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n            <tr>\n            <td>nonnorm_special_season_final</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/nonnorm_special_season_final.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n            <tr>\n            <td>nonnorm_router</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/nonnorm_router.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n\n           <tr>\n            <td>miv_lifo_valuation_method</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/miv_lifo_valuation_method.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n\n           <tr>\n            <td>evaluate_lifo_reserve</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/evaluate_lifo_reserve.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n\n           <tr>\n            <td>miv_evaluate_lifo_module</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/miv_evaluate_lifo_module.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n\n           <tr>\n            <td>miv_nonlifo_random</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/miv_nonlifo_random.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n\n           <tr>\n            <td>miv_evaluate_nonlifo_valuation_method</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/miv_evaluate_nonlifo_valuation_method.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n\n           <tr>\n            <td>miv_evaluate_detail_valuation_method</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/miv_evaluate_detail_valuation_method.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n\n           <tr>\n            <td>miv_evaluate_valuation_method_module</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/miv_evaluate_valuation_method_module.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n\n           <tr>\n            <td>miv_nonlifo_valuation_methods_module</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/miv_nonlifo_valuation_methods_module.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n\n           <tr>\n            <td>miv_inventories_balance</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/miv_inventories_balance.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n\n          <!-- -->\n            <tr>\n            <td>napcs_balance</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_balance.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n            <tr>\n            <td>napcs_balance_balancing</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_balance_balancing.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n            <tr>\n            <td>napcs_hdicat</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_hdicat.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n            <tr>\n            <td>napcs_m_goco</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_m_goco.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n            <tr>\n            <td>napcs_no_donor</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_no_donor.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n            <tr>\n            <td>napcs_recalculate_napcs_fields</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_recalculate_napcs_fields.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n            <tr>\n            <td>napcs_bl_rounding</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_bl_rounding.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>load_referrals</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/load_referrals.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>napcs_prep</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/napcs_prep.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>derive_mfg_naics</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/derive_mfg_naics.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>derived_items</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/derived_items.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          <tr>\n            <td>post_edit</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/post_edit.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>logical_edits</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/logical_edits.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>estab_to_kau_additivity</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/estab_to_kau.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>estab_to_kau_raking</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/estab_to_kau_raking.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>su_to_ent</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/su_to_ent.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>su_to_kau_nonmfg</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/su_to_kau_nonmfg.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>su_mu_to_kau_mfg</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/su_mu_to_kau_mfg.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>kau_to_su</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/kau_to_su.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>histstat</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/histstat.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n           <tr>\n            <td>br_stat</td>\n            <td>\n              <a href=\"https://aies-qflow-modules.s3.us-gov-east-1.amazonaws.com/br_stat.csv?version={{msg.version}}\">\n                link\n              </a>\n            </td>\n          </tr>\n          \n        </tbody>\n        \n      </table>\n</div>\n<!-- Initialize Materialize Components -->\n<script>\n    M.AutoInit();\n    function showToast() {\n        M.toast({html: 'Uploading...'});\n    }\n</script>\n\n</body>\n</html>\n",
        "output": "str",
        "x": 310,
        "y": 640,
        "wires": [
            [
                "737e44d2.373a64"
            ]
        ]
    },
    {
        "id": "737e44d2.373a64",
        "type": "http response",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 490,
        "y": 640,
        "wires": []
    },
    {
        "id": "7d8e179a.283e4",
        "type": "http response",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "x": 790,
        "y": 680,
        "wires": []
    },
    {
        "id": "25859a94.7d9976",
        "type": "http in",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "url": "/upload",
        "method": "post",
        "upload": true,
        "swaggerDoc": "",
        "x": 110,
        "y": 700,
        "wires": [
            [
                "d7e5df8b.97a4e8"
            ]
        ]
    },
    {
        "id": "e1643981.20d7c8",
        "type": "template",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Upload CSV File</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css\">\n    <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\"></script>\n    <style>\n        /* Add custom styles for responsiveness */\n         .table-container {\n            width: 95%;\n            overflow-x: auto;\n            margin: 2%;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n\n        th, td {\n            border: 1px solid #dddddd;\n            text-align: left;\n            padding: 8px;\n        }\n\n        tr:nth-child(even) {\n            background-color: #f2f2f2;\n        }\n    </style>\n</head>\n<body>\n<nav>\n    <div class=\"blue nav-wrapper\">\n      <a href=\"#\" data-target=\"mobile-demo\" class=\"sidenav-trigger\"><i class=\"material-icons\">menu</i></a>\n      <ul class=\"left hide-on-med-and-down\">\n        <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n      </ul>\n    </div>\n  </nav>\n\n  <ul class=\"blue sidenav\" id=\"mobile-demo\">\n      <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n  </ul>\n\n  <div class=\"container\">\n    {{!-- <h1 class=\"center-align\">Uploaded</h1> --}}\n  </div>\n  <div id=\"hide_this_to_load\">{{payload}}</div>\n    <div class=\"table-container\">\n  <div id=\"load_table\"></div>\n  </div>\n  <p id=\"file_name\">{{name}}</p>\n    <div class=\"input-field center-align\">\n    <button onclick='saveCsv()' class=\"btn waves-effect waves-light\" type=\"submit\">Save\n    </button>\n     <a href='/ui_wrapper' class=\"btn waves-effect waves-light\" type=\"submit\">Go {{msg.filename}}\n    </a>\n  </div>\n<script>\n  let data = document.getElementById('hide_this_to_load').innerHTML\n  let file_name = document.getElementById('file_name').innerHTML\n  document.getElementById('hide_this_to_load').style.display = 'none';\n  document.getElementById('file_name').style.display = 'none';\n  data = JSON.parse(data);\n  let headers; \n  document.addEventListener('DOMContentLoaded', function() {\n    const loadTableDiv = document.getElementById('load_table');\n    const table = document.createElement('table');\n    table.classList.add('striped');\n    const tableHeader = document.createElement('thead');\n    const headerRow = document.createElement('tr');\n    headers = Object.keys(data[0]); // Set headers here\n    headers.forEach(headerText => {\n      const th = document.createElement('th');\n      th.textContent = headerText;\n      headerRow.appendChild(th);\n    });\n    tableHeader.appendChild(headerRow);\n    table.appendChild(tableHeader);\n    const tableBody = document.createElement('tbody');\n    data.forEach((item, index) => {\n      const row = document.createElement('tr');\n      headers.forEach(header => {\n        const cell = document.createElement('td');\n        if (index !== 0) { // Make fields editable for all rows except the header row\n          const input = document.createElement('input');\n          input.value = item[header];\n          input.addEventListener('input', function() {\n            item[header] = this.value;\n            const updatedJData = getUpdatedData();\n            // console.log(updatedJData);\n          });\n          cell.appendChild(input);\n        } else {\n          cell.textContent = item[header];\n        }\n        row.appendChild(cell);\n      });\n      tableBody.appendChild(row);\n    });\n    table.appendChild(tableBody);\n    loadTableDiv.appendChild(table);\n  });\n\n  function getUpdatedData() {\n    const updatedData = [];\n    const rows = document.querySelectorAll('#load_table tbody tr');\n    rows.forEach(row => {\n      const rowData = {};\n      const cells = row.querySelectorAll('td');\n      cells.forEach((cell, index) => {\n        const header = headers[index];\n        if (header) {\n          rowData[header] = cell.firstChild.value || cell.textContent;\n        }\n      });\n      updatedData.push(rowData);\n    });\n    return updatedData;\n  }\n  const jsonToCSV = (jsonArray) => {\n    const headers = Object.keys(jsonArray[0]);\n\n    let csv = headers.join(',') + '\\n';\n\n    jsonArray.forEach(obj => {\n        const values = headers.map(header => {\n            const escapedValue = obj[header].replace(/\"/g, '\\\\\"');\n            return `\"${escapedValue}\"`;\n        });\n        csv += values.join(',') + '\\n';\n    });\n\n    return csv;\n};\n  function saveCsv(){\n    console.log(JSON.stringify({filename: file_name, csvData:jsonToCSV(getUpdatedData())}))\n     fetch('/saveCsv', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({filename: file_name, csvData:jsonToCSV(getUpdatedData())})\n    })\n    .then(response => {\n      if (response.ok) {\n        console.log('Update successful!');\n      } else {\n        console.error('Error updating params:', response.status);\n      }\n    })\n    .catch(error => {\n      console.error('Error:', error);\n    });\n  }\n</script>\n\n\n</body>\n</html>\n",
        "output": "str",
        "x": 670,
        "y": 680,
        "wires": [
            [
                "7d8e179a.283e4"
            ]
        ]
    },
    {
        "id": "d7e5df8b.97a4e8",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "toBase64",
        "func": "msg.name = '/tmp/'+ msg.req.files[0].originalname;\nmsg.filename = msg.name;\n\nif (msg.req.files[0].mimetype.includes('image')) {\n    msg.payload = `<img src=\"data:image/gif;base64,${msg.req.files[0].buffer.toString('base64')}\">`;\n} else {\n    msg.payload = msg.req.files[0].buffer.toString();\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 700,
        "wires": [
            [
                "0464e4eb98976890",
                "81e3239593f9f1d1",
                "2319e5574f035f21"
            ]
        ]
    },
    {
        "id": "0464e4eb98976890",
        "type": "file",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "Write to /tmp on server",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 570,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "f5d8125e5f3946e2",
        "type": "ui_button",
        "z": "dad88d9a3132fed6",
        "d": true,
        "name": "Reset",
        "group": "a5b67787a0857995",
        "order": 3,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Reset",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 110,
        "y": 160,
        "wires": [
            [
                "9c2c34ae702579a8"
            ]
        ]
    },
    {
        "id": "9c2c34ae702579a8",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "d": true,
        "name": "Reset all flow and global keys",
        "func": "// flow.set(\"moduleFacts\", [])\n// flow.set(\"originalData\", [])\n// //NK initialize global context\n// global.set(\"originalData\", [])\n// global.set(\"moduleFacts\", [])\n// global.set(\"ptrModuleFacts\",0)\n\n// global.set('filename', null)\n// // if(global.get(\"filename\")){\n// //     // msg.filename = global.get(\"filename\")\n// //     msg.payload = global.get(\"filename\")\n// //     return msg\n// // }\n// // else \n// msg.payload = null\n\n// Reset flow context variables\nflow.context().keys().forEach(function (key) {\n    flow.context().set(key, undefined);\n});\n\n// Reset global context variables\nglobal.context().keys().forEach(function (key) {\n    global.context().set(key, undefined);\n});\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "bf95042aa95f74b7",
        "type": "catch",
        "z": "dad88d9a3132fed6",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 100,
        "y": 460,
        "wires": [
            [
                "67218bea97f26dc5"
            ]
        ]
    },
    {
        "id": "67218bea97f26dc5",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "name": "error message",
        "func": "msg.payload = msg.error.message\nglobal.set(\"ptrModuleFacts\",1)\n\nflow.set(\"moduleFacts\", [])\nflow.set(\"originalData\", [])\n//NK initialize global context\nglobal.set(\"originalData\", [])\nglobal.set(\"moduleFacts\", [])\nglobal.set(\"ptrModuleFacts\", 0)\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 460,
        "wires": [
            [
                "4345bc983bdc5ee2",
                "c7b88789c4731ee4"
            ]
        ]
    },
    {
        "id": "4345bc983bdc5ee2",
        "type": "ui_toast",
        "z": "dad88d9a3132fed6",
        "position": "top right",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 590,
        "y": 460,
        "wires": []
    },
    {
        "id": "c7b88789c4731ee4",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "name": "Reset counters",
        "func": "msg.ui_control = {\n    max: 1// Assuming msg.payload contains the row count\n};\n\nflow.set('moduleFacts', [])\nglobal.set('moduleFacts', [])\n\nglobal.set(\"ptrModuleFacts\", 1)\nglobal.set(\"originalData\", {})\n\n\nmsg.payload = 1\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 400,
        "wires": [
            [
                "3c92b89522e322f8",
                "aee5640ceffb474d"
            ]
        ]
    },
    {
        "id": "81e3239593f9f1d1",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "getFileName in payload",
        "func": "msg.payload=msg.filename\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 760,
        "wires": [
            [
                "12c94ce38056fc20"
            ]
        ]
    },
    {
        "id": "2b5207ce5d20fc0a",
        "type": "comment",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "Simple upload a file",
        "info": "",
        "x": 970,
        "y": 640,
        "wires": []
    },
    {
        "id": "903ab3bdc5e84545",
        "type": "http in",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "url": "/update_params",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 940,
        "wires": [
            [
                "070b2c6eb42b2ee1"
            ]
        ]
    },
    {
        "id": "26d5116b6bd90d58",
        "type": "template",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Update Params</title>\n   <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/7.0.4/jsoneditor.css\" >\n   <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/7.0.4/jsoneditor.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js\"></script>    \n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\"></script>\n</head>\n  <style>\n  #jsoneditor {\n    max-width: 100%;\n    height: auto;\n  }\n  p {\n    max-width: 100%;\n    font-family: \"DejaVu Sans\", sans-serif;\n  }\n  .preload {\n    display: none;\n  }\n\n  @media screen and (max-width: 600px) {\n    #jsoneditor, p {\n      width: 100%;\n    }\n  }\n  .custom-border {\n  border: 1px solid #00F; /* Dark border color */\n}\n</style>\n\n<body>\n  <nav>\n    <div class=\"blue nav-wrapper\">\n      <a href=\"#\" data-target=\"mobile-demo\" class=\"sidenav-trigger\"><i class=\"material-icons\">menu</i></a>\n      <ul class=\"left hide-on-med-and-down\">\n        <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n      </ul>\n    </div>\n  </nav>\n\n  <ul class=\"blue sidenav\" id=\"mobile-demo\">\n      <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n  </ul>\n\n<div class=\"container\">\n    <h1 class=\"center-align\">Update Params</h1>\n      <select class=\"browser-default custom-border\">\n        <option value=\"\" disabled selected>Choose your option</option>\n    </select>\n    <br>\n      <div id=\"jsoneditor\"></div>\n      <div class=\"preload\" id=\"preload\">{{payload.payload}}</div>\n    <div class=\"row\">\n        <form action=\"/update_params\" method=\"GET\" enctype=\"multipart/form-data\" class=\"col s12\">\n            <div class=\"input-field center-align\">\n                <button class=\"btn waves-effect waves-light\" type=\"submit\">Update\n                </button>\n            </div>\n        </form>\n    </div>\n</div>\n\n<!-- Initialize Materialize Components -->\n<script>\n    M.AutoInit();\n    var elems = document.querySelectorAll('.sidenav');\n    var instances = M.Sidenav.init(elems);\n</script>\n\n</body>\n<script>\n  const container = document.getElementById(\"jsoneditor\");\n\nconst options = {\n  mode: \"tree\",\n  modes: [\"text\", \"tree\", \"view\", \"preview\"],\n  expandAll: true,\n  // example editable\n  onEditable: function(node) {\n    // node is an object like:\n    //   {\n    //     field: 'FIELD',\n    //     value: 'VALUE',\n    //     path: ['PATH', 'TO', 'NODE']\n    //   }\n    switch (node.field) {\n      case \"_id\":\n        return false;\n\n      case \"name\":\n        return {\n          field: false,\n          value: true\n        };\n\n      default:\n        return true;\n    }\n  },\n  //   on event example\n  onError: function(err) {\n    alert(err.toString());\n  },\n  onEvent: function(node, event) {\n    if (event.type === \"click\") {\n      let message = \"field: \" + node.field + \" | path: \" + node.path;\n      if (node.value) {\n        message += \" | value: \" + node.value;\n      }\n      console.log(message);\n      // console.log(node, event);\n      //       update json field position\n      const my_clipboard = \"{ x: -3755.9812, y: 140.43, z: -3287.19 }\";\n      let my_room;\n      let my_item;\n      let x_pos = 0.0;\n      let y_pos = 0.0;\n      let z_pos = 0.0;\n      let i_count = 1;\n      if (node.field === \"position\") {\n        // get x coordinate\n        const regex = /(?<=x:\\s{0,})(?<x_pos>\\-{0,1}\\d{0,}\\.{0,1}\\d{0,})|(?<=y:\\s{0,})(?<y_pos>\\-{0,1}\\d{0,}\\.{0,1}\\d{0,})|(?<=z:\\s{0,})(?<z_pos>\\-{0,1}\\d{0,}\\.{0,1}\\d{0,})/gm;\n        const str = my_clipboard;\n        let m;\n        // m = regex.exec(str);\n        // console.log('m:', m);\n        // todo? check if it is a string with coordinates x_pos is found\n\n        // // x_pos = parseFloat(m[2], 10);\n        // x_pos = Number(m[2]);\n        // console.log('regex:', m[0], '-', m[1], '-', m[2]);\n        // console.log('x_pos:', m.x_pos);\n\n                while ((m = regex.exec(str)) !== null) {\n                  // This is necessary to avoid infinite loops with zero-width matches\n                  console.log('i_count:', i_count, '|group 0:', m[0] );\n                  switch (i_count) {\n                    case 2:\n                      x_pos = Number(m[0]);\n                      console.log('x_pos:', x_pos);\n                      break;\n                    case 4:\n                      y_pos = Number(m[0]);\n                      break;\n                    case 6:\n                      z_pos = Number(m[0]);\n                      break;\n                  }\n                  if (m.index === regex.lastIndex) {\n                    regex.lastIndex++;\n                  }\n\n                  // The result can be accessed through the `m`-variable.\n                  m.forEach((match, groupIndex) => {\n                    console.log(`Found match, group ${groupIndex}: ${match}`);\n                  });\n                  i_count++;\n                };\n\n        my_room = node.path[1];\n        my_item = node.path[3];\n        console.log(\"node.path[3]: \", node.path[3]);\n        json[\"rooms\"][my_room][\"items\"][my_item][\"position\"][\"x\"] = x_pos;\n        json[\"rooms\"][my_room][\"items\"][my_item][\"position\"][\"y\"] = y_pos;\n        json[\"rooms\"][my_room][\"items\"][my_item][\"position\"][\"z\"] = z_pos;\n        console.log({json})\n        editor.update(json);\n        editor.getEditor('root.id').disable();\n        console.log(editor)\n      }\n    }\n\n    function prettyPrintPath(path) {\n      let str = \"\";\n      for (let i = 0; i < path.length; i++) {\n        const element = path[i];\n        if (typeof element === \"number\") {\n          str += \"[\" + element + \"]\";\n        } else {\n          if (str.length > 0) str += \",\";\n          str += element;\n        }\n      }\n      return str;\n    }\n  }\n};\nconst j = document.getElementById(\"preload\").innerHTML;\nconst parsedJson = JSON.parse(j)\n\nconst selectElement = document.querySelector('.browser-default');\n\nconst selectOptions = parsedJson.params.map(i=> {\n  return { value: i.id, text: i.module + ' - ' + i.param }\n})\n\nselectOptions.forEach(option => {\n    const optionElement = document.createElement('option');\n    optionElement.value = option.value;\n    optionElement.text = option.text;\n    optionElement.disabled = option.disabled;\n    optionElement.selected = option.selected;\n    selectElement.appendChild(optionElement);\n});\nlet editor = new JSONEditor(container, options, {})\nlet selectedValue\nselectElement.addEventListener('change', function() {\n    selectedValue = this.value;\n    // editor = new JSONEditor(container, options, parsedJson?.params.find(i => i.id == selectedValue));\n    //  let dataToUpdate = parsedJson?.params.find(i => i => i.id == selectedValue)\n    // console.log({selectedValue, parsedJson, dataToUpdate: parsedJson?.params.find(i => i => i.id == selectedValue)});\n    //  console.log({\n    //   id: dataToUpdate.id,\n    //   json_values: dataToUpdate.json_values,\n    //   values: dataToUpdate.values\n    //  })\n      console.log(parsedJson?.params.map(i => {\n        if(i.id == selectedValue){\n          return i\n        }else{\n          return null;\n        }\n      }).filter(Boolean)[0])\n     editor.update(parsedJson?.params.map(i => {\n        if(i.id == selectedValue){\n          return {\n            json_values: i.json_values,\n            values: i.values,\n            // id: i.id\n          }\n        }else{\n          return null;\n        }\n      }).filter(Boolean)[0])\n      editor.getEditor('root.id').disable();\n     });\n// });\n// editor = new JSONEditor(container, options, {\n//     json_values: parsedJson.json_values,\n//     values: parsedJson.values\n// });\n  document.querySelector('form').addEventListener('submit', function(e) {\n    e.preventDefault();\n    const updatedJson = editor.get(); \n    console.log(updatedJson); \n      fetch('https://mc.edl-7529180-ite.ite.edl.census.gov/api/params/' + selectedValue, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({updatedValues:updatedJson})\n    })\n    .then(response => {\n      if (response.ok) {\n        console.log('Update successful!');\n      } else {\n        console.error('Error updating params:', response.status);\n      }\n    })\n    .catch(error => {\n      console.error('Error:', error);\n    });\n  });\n  // });\n\n  </script>\n</html>",
        "output": "str",
        "x": 950,
        "y": 940,
        "wires": [
            [
                "eec857548bfbe6b5"
            ]
        ]
    },
    {
        "id": "eec857548bfbe6b5",
        "type": "http response",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1090,
        "y": 940,
        "wires": []
    },
    {
        "id": "193adf68b854c196",
        "type": "http request",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://ec2-18-252-7-95.us-gov-east-1.compute.amazonaws.com/api/params?module=classification&params=naics_alt,naics_validation&program=aies&unit_type=estab",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 110,
        "y": 820,
        "wires": [
            [
                "2fd70cb03d1b3cb7"
            ]
        ]
    },
    {
        "id": "2fd70cb03d1b3cb7",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "function 29",
        "func": "msg.payload.payload = JSON.stringify({\n    values: msg.payload.data[0].values,\n    json_values: msg.payload.data[0].json_values,\n    id: msg.payload.data[0].id\n});\n// msg.payload.payload = JSON.stringify(msg.payload.data[0].json_values);\n// msg.payload.id = JSON.stringify(msg.payload.data[0].id);\n// msg.payload.values = JSON.stringify({\n//     values: msg.payload.data[0].values,\n//     json_values: msg.payload.data[0].json_values\n// });\n\n// msg.payload = msg.payload.data[0].json_values;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 820,
        "wires": [
            [
                "23ffb00caa077b23"
            ]
        ]
    },
    {
        "id": "399608507ce305d7",
        "type": "http request",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "https://mc.edl-7529180-ite.ite.edl.census.gov/api/params/params",
        "tls": "b7b0a64e307b71f5",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": true,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 590,
        "y": 940,
        "wires": [
            [
                "62a7ab56c461f544"
            ]
        ]
    },
    {
        "id": "65738b3d68734570",
        "type": "http in",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "url": "/ui_wrapper",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 880,
        "wires": [
            [
                "ea0778e9f5cd9498"
            ]
        ]
    },
    {
        "id": "62a7ab56c461f544",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "function 30",
        "func": "msg.payload.payload = JSON.stringify({params: msg.payload.data});\n// msg.payload.payload = JSON.stringify(msg.payload.data[0].json_values);\n// msg.payload.id = JSON.stringify(msg.payload.data[0].id);\n// msg.payload.values = JSON.stringify({\n//     values: msg.payload.data[0].values,\n//     json_values: msg.payload.data[0].json_values\n// });\n\n// msg.payload = msg.payload.data[0].json_values;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 940,
        "wires": [
            [
                "26d5116b6bd90d58"
            ]
        ]
    },
    {
        "id": "23ffb00caa077b23",
        "type": "template",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Update Params</title>\n   <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/7.0.4/jsoneditor.css\" >\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/7.0.4/jsoneditor.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js\"></script>    \n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\"></script>\n</head>\n  <style>\n  #jsoneditor {\n    max-width: 100%;\n    height: auto;\n  }\n  p {\n    max-width: 100%;\n    font-family: \"DejaVu Sans\", sans-serif;\n  }\n  .preload {\n    display: none;\n  }\n\n  @media screen and (max-width: 600px) {\n    #jsoneditor, p {\n      width: 100%;\n    }\n  }\n</style>\n\n<body>\n <nav>\n    <div class=\"nav-wrapper\">\n      <a href=\"#\" class=\"brand-logo ml-5\"> Cencus</a>\n      <ul id=\"nav-mobile\" class=\"right hide-on-med-and-down\">\n        <li><a href=\"/update_params\">Params</a></li>\n        <li><a href=\"/upload_page\">Upload csv</a></li>\n        <li><a href=\"/ui\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n      </ul>\n    </div>\n  </nav>\n<div class=\"container\">\n    <h1 class=\"center-align\">Update Params</h1>\n      <select class=\"browser-default\">\n        <option value=\"\" disabled selected>Choose your option</option>\n        <option value=\"1\">Option 1</option>\n        <option value=\"2\">Option 2</option>\n        <option value=\"3\">Option 3</option>\n    </select>\n    <br>\n      <div id=\"jsoneditor\"></div>\n      <div class=\"preload\" id=\"preload\">{{payload.payload}}</div>\n    <div class=\"row\">\n        <form action=\"/update_params\" method=\"GET\" enctype=\"multipart/form-data\" class=\"col s12\">\n            <div class=\"input-field center-align\">\n                <button class=\"btn waves-effect waves-light\" type=\"submit\">Update\n                </button>\n            </div>\n        </form>\n    </div>\n</div>\n\n<!-- Initialize Materialize Components -->\n<script>\n    M.AutoInit();\n</script>\n\n</body>\n<script>\n  const container = document.getElementById(\"jsoneditor\");\n\nconst options = {\n  mode: \"tree\",\n  modes: [\"text\", \"tree\", \"view\", \"preview\"],\n  expandAll: true,\n  // example editable\n  onEditable: function(node) {\n    // node is an object like:\n    //   {\n    //     field: 'FIELD',\n    //     value: 'VALUE',\n    //     path: ['PATH', 'TO', 'NODE']\n    //   }\n    switch (node.field) {\n      case \"_id\":\n        return false;\n\n      case \"name\":\n        return {\n          field: false,\n          value: true\n        };\n\n      default:\n        return true;\n    }\n  },\n  //   on event example\n  onError: function(err) {\n    alert(err.toString());\n  },\n  onEvent: function(node, event) {\n    if (event.type === \"click\") {\n      let message = \"field: \" + node.field + \" | path: \" + node.path;\n      if (node.value) {\n        message += \" | value: \" + node.value;\n      }\n      console.log(message);\n      // console.log(node, event);\n      //       update json field position\n      const my_clipboard = \"{ x: -3755.9812, y: 140.43, z: -3287.19 }\";\n      let my_room;\n      let my_item;\n      let x_pos = 0.0;\n      let y_pos = 0.0;\n      let z_pos = 0.0;\n      let i_count = 1;\n      if (node.field === \"position\") {\n        // get x coordinate\n        const regex = /(?<=x:\\s{0,})(?<x_pos>\\-{0,1}\\d{0,}\\.{0,1}\\d{0,})|(?<=y:\\s{0,})(?<y_pos>\\-{0,1}\\d{0,}\\.{0,1}\\d{0,})|(?<=z:\\s{0,})(?<z_pos>\\-{0,1}\\d{0,}\\.{0,1}\\d{0,})/gm;\n        const str = my_clipboard;\n        let m;\n        // m = regex.exec(str);\n        // console.log('m:', m);\n        // todo? check if it is a string with coordinates x_pos is found\n\n        // // x_pos = parseFloat(m[2], 10);\n        // x_pos = Number(m[2]);\n        // console.log('regex:', m[0], '-', m[1], '-', m[2]);\n        // console.log('x_pos:', m.x_pos);\n\n                while ((m = regex.exec(str)) !== null) {\n                  // This is necessary to avoid infinite loops with zero-width matches\n                  console.log('i_count:', i_count, '|group 0:', m[0] );\n                  switch (i_count) {\n                    case 2:\n                      x_pos = Number(m[0]);\n                      console.log('x_pos:', x_pos);\n                      break;\n                    case 4:\n                      y_pos = Number(m[0]);\n                      break;\n                    case 6:\n                      z_pos = Number(m[0]);\n                      break;\n                  }\n                  if (m.index === regex.lastIndex) {\n                    regex.lastIndex++;\n                  }\n\n                  // The result can be accessed through the `m`-variable.\n                  m.forEach((match, groupIndex) => {\n                    console.log(`Found match, group ${groupIndex}: ${match}`);\n                  });\n                  i_count++;\n                };\n\n        my_room = node.path[1];\n        my_item = node.path[3];\n        console.log(\"node.path[3]: \", node.path[3]);\n        json[\"rooms\"][my_room][\"items\"][my_item][\"position\"][\"x\"] = x_pos;\n        json[\"rooms\"][my_room][\"items\"][my_item][\"position\"][\"y\"] = y_pos;\n        json[\"rooms\"][my_room][\"items\"][my_item][\"position\"][\"z\"] = z_pos;\n        console.log({json})\n        editor.update(json);\n        console.log(editor)\n      }\n    }\n\n    function prettyPrintPath(path) {\n      let str = \"\";\n      for (let i = 0; i < path.length; i++) {\n        const element = path[i];\n        if (typeof element === \"number\") {\n          str += \"[\" + element + \"]\";\n        } else {\n          if (str.length > 0) str += \",\";\n          str += element;\n        }\n      }\n      return str;\n    }\n  }\n};\nconst j = document.getElementById(\"preload\").innerHTML;\nconst parsedJson = JSON.parse(j)\nconst editor = new JSONEditor(container, options, {\n    json_values: parsedJson.json_values,\n    values: parsedJson.values\n});\n  document.querySelector('form').addEventListener('submit', function(e) {\n    e.preventDefault();\n    const updatedJson = editor.get(); \n    console.log(updatedJson); \n      fetch('http://localhost:3000/params/' + parsedJson.id, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({updatedValues:updatedJson})\n    })\n    .then(response => {\n      if (response.ok) {\n        console.log('Update successful!');\n      } else {\n        console.error('Error updating params:', response.status);\n      }\n    })\n    .catch(error => {\n      console.error('Error:', error);\n    });\n  });\n  // });\n\n  </script>\n</html>",
        "output": "str",
        "x": 510,
        "y": 820,
        "wires": [
            [
                "6b05d518e4c1bc47"
            ]
        ]
    },
    {
        "id": "6b05d518e4c1bc47",
        "type": "http response",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 650,
        "y": 820,
        "wires": []
    },
    {
        "id": "ea0778e9f5cd9498",
        "type": "template",
        "z": "dad88d9a3132fed6",
        "name": "html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Update Params</title>\n   <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/7.0.4/jsoneditor.css\" >\n   <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/7.0.4/jsoneditor.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js\"></script>    \n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\"></script>\n</head>\n  <style>\n        iframe {\n            width: 100%;\n            height: 100vh;\n            border: none;\n        }\n  #jsoneditor {\n    max-width: 100%;\n    height: auto;\n  }\n  p {\n    max-width: 100%;\n    font-family: \"DejaVu Sans\", sans-serif;\n  }\n  .preload {\n    display: none;\n  }\n\n  @media screen and (max-width: 600px) {\n    #jsoneditor, p {\n      width: 100%;\n    }\n  }\n</style>\n\n<body>\n  <nav>\n    <div class=\"blue nav-wrapper\">\n      <a href=\"#\" data-target=\"mobile-demo\" class=\"sidenav-trigger\"><i class=\"material-icons\">menu</i></a>\n      <ul class=\"left hide-on-med-and-down\">\n        <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n      </ul>\n    </div>\n  </nav>\n\n  <ul class=\"blue sidenav\" id=\"mobile-demo\">\n      <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n  </ul>\n\n\n    <iframe src=\"/ui\"></iframe>\n\n\n<!-- Initialize Materialize Components -->\n<script>\n    M.AutoInit();\n    var elems = document.querySelectorAll('.sidenav');\n    var instances = M.Sidenav.init(elems);\n</script>\n\n</body>\n</html>",
        "output": "str",
        "x": 290,
        "y": 880,
        "wires": [
            [
                "74662df4569846c9"
            ]
        ]
    },
    {
        "id": "74662df4569846c9",
        "type": "http response",
        "z": "dad88d9a3132fed6",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 430,
        "y": 880,
        "wires": []
    },
    {
        "id": "2319e5574f035f21",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "function 31",
        "func": "msg.payload.payload = JSON.stringify({params: msg.payload});\n\nconst csvToJSON = (csv) => {\n    const lines = csv.split('\\n');\n    const headers = lines[0].split(',');\n    const result = [];\n    for (let i = 1; i < lines.length; i++) {\n        const obj = {};\n        const currentLine = lines[i].split(',');\n        for (let j = 0; j < headers.length; j++) {\n            obj[headers[j]] = currentLine[j];\n        }\n        result.push(obj);\n    }\n    return result;\n};\n\nconst csvString = msg.payload;\n\nconst jsonData = csvToJSON(csvString);\nmsg.payload = JSON.stringify(jsonData, null, 2);\n\n// msg.payload.payload = JSON.stringify(msg.payload.data[0].json_values);\n// msg.payload.id = JSON.stringify(msg.payload.data[0].id);\n// msg.payload.values = JSON.stringify({\n//     values: msg.payload.data[0].values,\n//     json_values: msg.payload.data[0].json_values\n// });\n\n// msg.payload = msg.payload.data[0].json_values;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 680,
        "wires": [
            [
                "e1643981.20d7c8"
            ]
        ]
    },
    {
        "id": "2e210837e211c8be",
        "type": "http in",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "url": "/saveCsv",
        "method": "post",
        "upload": true,
        "swaggerDoc": "",
        "x": 120,
        "y": 760,
        "wires": [
            [
                "20ef4922bea8d7fd"
            ]
        ]
    },
    {
        "id": "20ef4922bea8d7fd",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "toBase64",
        "func": "// msg.name = '/tmp/'+ msg.payload.filename\nmsg.name = msg.payload.filename\nmsg.filename = msg.name;\nmsg.payload = msg.payload.csvData;\n// console.log(\"=====\", msg.payload)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 760,
        "wires": [
            [
                "0464e4eb98976890"
            ]
        ]
    },
    {
        "id": "89e7e315b3a8c30b",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "f2f56f84d002ec0f"
        ],
        "x": 1545,
        "y": 1480,
        "wires": []
    },
    {
        "id": "ba5d5bdad0bc957e",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "d946e5bca62e02d1"
        ],
        "x": 1595,
        "y": 1500,
        "wires": []
    },
    {
        "id": "8434c6c16c1fbaaf",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "3cd3e107ac0789b7"
        ],
        "x": 1645,
        "y": 1520,
        "wires": []
    },
    {
        "id": "24ae978c7feb5fc3",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "affe73445eec8a4f"
        ],
        "x": 1695,
        "y": 1540,
        "wires": []
    },
    {
        "id": "b9b9acc35bdd0b75",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "1c611eb0c30a9863"
        ],
        "x": 1745,
        "y": 1560,
        "wires": []
    },
    {
        "id": "43545e3b96e7f60c",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "a9fa566fb3fb1f74"
        ],
        "x": 1785,
        "y": 1580,
        "wires": []
    },
    {
        "id": "d5aac8a297ee6dd2",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "b16c9d56493fb914"
        ],
        "x": 1825,
        "y": 1600,
        "wires": []
    },
    {
        "id": "5d05b108e4e3f722",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "b9aedad7e15bc0ed"
        ],
        "x": 1905,
        "y": 1640,
        "wires": []
    },
    {
        "id": "28494dbc74f30091",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "76691f5ac3362ba9"
        ],
        "x": 1865,
        "y": 1620,
        "wires": []
    },
    {
        "id": "8272974b9a32a0ac",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "8eacd61d364bbafe"
        ],
        "x": 1945,
        "y": 1660,
        "wires": []
    },
    {
        "id": "819f7cf369712137",
        "type": "ui_button",
        "z": "dad88d9a3132fed6",
        "d": true,
        "name": "Load DB",
        "group": "a5b67787a0857995",
        "order": 3,
        "width": "3",
        "height": "1",
        "passthru": false,
        "label": "Load DB",
        "tooltip": "",
        "color": "#FFF",
        "bgcolor": "#2196F3",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 80,
        "y": 220,
        "wires": [
            [
                "44e2b4944a4b9567"
            ]
        ]
    },
    {
        "id": "44e2b4944a4b9567",
        "type": "postgresql",
        "z": "dad88d9a3132fed6",
        "d": true,
        "name": "SELECT",
        "query": "SELECT * FROM product_aies.item_estabs_2023a1 limit 10;\n",
        "postgreSQLConfig": "481a641c4005d1c8",
        "split": false,
        "rowsPerMsg": "1",
        "outputs": 1,
        "x": 220,
        "y": 220,
        "wires": [
            [
                "31926946d13b83fa"
            ]
        ]
    },
    {
        "id": "31926946d13b83fa",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "name": "toUpperCaseDBCols",
        "func": "flow.set(\"moduleFacts\", [])\nflow.set(\"originalData\", [])\n//NK initialize global context\nglobal.set(\"originalData\", [])\nglobal.set(\"moduleFacts\", [])\nglobal.set(\"ptrModuleFacts\",0)\n\n\n\nconst result = msg.payload.map(obj => Object.fromEntries(Object.entries(obj).map(([key, val]) => [key.toUpperCase(), val])));\nmsg.payload.csv = result;\nmsg.payload.length = msg.pgsql.rowCount\n// console.log(msg.payload.csv)\n\nlet p = msg.payload.csv;\nmsg.payload = p;\n\nlet ptr = global.get(\"ptrModuleFacts\"); //HF\n\nflow.set('moduleFacts', p)\nglobal.set('moduleFacts', p)\nglobal.set('originalData', p[ptr]) //HF\n// global.set('originalData', p[0]) //NK\nmsg.topic = 'csv'\nmsg.ui_control = {\n    max: p.length // Assuming msg.payload contains the row count\n};\nmsg.payload.name = \"p\"\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 220,
        "wires": [
            [
                "8ff713c60410aa36",
                "8fc8da4acdeb51a4"
            ]
        ]
    },
    {
        "id": "08daf4161eddc269",
        "type": "http response",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 470,
        "y": 1120,
        "wires": []
    },
    {
        "id": "d990e40c5e545d4e",
        "type": "http in",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "url": "/test_ui",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 1120,
        "wires": [
            [
                "733a9e511bb97033"
            ]
        ]
    },
    {
        "id": "733a9e511bb97033",
        "type": "template",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Upload CSV File</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css\">\n    <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\"></script>\n    <style>\n        /* Add custom styles for responsiveness */\n         .table-container {\n            width: 95%;\n            overflow-x: auto;\n            margin: 2%;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n\n        th, td {\n            border: 1px solid #dddddd;\n            text-align: left;\n            padding: 8px;\n        }\n\n        tr:nth-child(even) {\n            background-color: #f2f2f2;\n        }\n    </style>\n</head>\n<body>\n<nav>\n    <div class=\"blue nav-wrapper\">\n      <a href=\"#\" data-target=\"mobile-demo\" class=\"sidenav-trigger\"><i class=\"material-icons\">menu</i></a>\n      <ul class=\"left hide-on-med-and-down\">\n        <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n      </ul>\n    </div>\n  </nav>\n\n  <ul class=\"blue sidenav\" id=\"mobile-demo\">\n      <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n  </ul>\n\n<div class=\"container mt-4 pt-4\">\n    <form id=\"dynamicForm\" action=\"/ui_test_post\" method=\"POST\">\n        <div id=\"inputContainer\"></div>\n        <button type=\"button\" class=\"btn blue waves-effect waves-light\" onclick=\"addInputField()\">Add Field\n            <i class=\"material-icons right\">add</i>\n        </button>\n        <button type=\"submit\" class=\"btn blue waves-effect waves-light\" onclick=\"getValues()\">Get Values\n            <i class=\"material-icons right\">send</i>\n        </button>\n    </form>\n</div>\n\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\"></script>\n<script>\n    let inputCounter = 1;\n\n    function addInputField() {\n        const inputContainer = document.getElementById('inputContainer');\n        const newDiv = document.createElement('div');\n        newDiv.className = 'input-field';\n        const newInput = document.createElement('input');\n        newInput.type = 'text';\n        newInput.name = 'input' + inputCounter;\n        newInput.id = 'input' + inputCounter;\n        newDiv.appendChild(newInput);\n        inputContainer.appendChild(newDiv);\n        inputCounter++;\n    }\n\n    function getValues() {\n        const form = document.getElementById('dynamicForm');\n        form.submit();\n    }\n</script>\n\n</body>\n</html>\n",
        "output": "str",
        "x": 310,
        "y": 1120,
        "wires": [
            [
                "08daf4161eddc269"
            ]
        ]
    },
    {
        "id": "3a09eefeb46e3070",
        "type": "template",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Upload CSV File</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css\">\n    <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\"></script>\n    <style>\n        /* Add custom styles for responsiveness */\n         .table-container {\n            width: 95%;\n            overflow-x: auto;\n            margin: 2%;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n\n        th, td {\n            border: 1px solid #dddddd;\n            text-align: left;\n            padding: 8px;\n        }\n\n        tr:nth-child(even) {\n            background-color: #f2f2f2;\n        }\n    </style>\n</head>\n<body>\n<nav>\n    <div class=\"blue nav-wrapper\">\n      <a href=\"#\" data-target=\"mobile-demo\" class=\"sidenav-trigger\"><i class=\"material-icons\">menu</i></a>\n      <ul class=\"left hide-on-med-and-down\">\n        <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n      </ul>\n    </div>\n  </nav>\n\n  <ul class=\"blue sidenav\" id=\"mobile-demo\">\n      <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n  </ul>\n\n  <div class=\"container\">\n    {{!-- <h1 class=\"center-align\">Uploaded</h1> --}}\n  </div>\n  <div id=\"hide_this_to_load\">{{payload}}</div>\n    <div class=\"table-container\">\n  <div id=\"load_table\"></div>\n  </div>\n  <p id=\"file_name\">{{name}}</p>\n   <p id=\"new_vars\">{{newVars}}</p>\n    <div class=\"input-field center-align\">\n    <button onclick='saveCsv()' class=\"btn waves-effect waves-light\" type=\"submit\">Save\n    </button>\n     <a href='/ui_wrapper' class=\"btn waves-effect waves-light\" type=\"submit\">Go {{name}}\n    </a>\n  </div>\n<script>\n  let data = document.getElementById('hide_this_to_load').innerHTML\n  let file_name = document.getElementById('file_name').innerHTML\n  let new_vars = document.getElementById('new_vars').innerHTML\n  \n  document.getElementById('new_vars').style.display = 'none';\n  document.getElementById('hide_this_to_load').style.display = 'none';\n  document.getElementById('file_name').style.display = 'none';\n  data = JSON.parse(data);\n  new_vars = JSON.parse(new_vars);\n  let headers; \n  document.addEventListener('DOMContentLoaded', function() {\n    const loadTableDiv = document.getElementById('load_table');\n    const table = document.createElement('table');\n    table.classList.add('striped');\n    const tableHeader = document.createElement('thead');\n    const headerRow = document.createElement('tr');\n    headers = [...new_vars.newVars.map(i=>i.toUpperCase()), ...(Object.keys(data[0]))]; // Set headers here\n    headers.forEach(headerText => {\n      const th = document.createElement('th');\n      th.textContent = headerText;\n      headerRow.appendChild(th);\n    });\n    tableHeader.appendChild(headerRow);\n    table.appendChild(tableHeader);\n    const tableBody = document.createElement('tbody');\n    data.forEach((item, index) => {\n      const row = document.createElement('tr');\n      headers.forEach(header => {\n        const cell = document.createElement('td');\n        cell.style.minWidth = '200px';\n        if (index !== -1) { // Make fields editable for all rows except the header row\n          const input = document.createElement('input');\n          input.value = item[header] == undefined ? 'NULL': item[header];\n          input.addEventListener('input', function() {\n            item[header] = this.value;\n            const updatedJData = getUpdatedData();\n            // console.log(updatedJData);\n          });\n          cell.appendChild(input);\n        } else {\n          cell.textContent = item[header];\n        }\n        row.appendChild(cell);\n      });\n      tableBody.appendChild(row);\n    });\n    table.appendChild(tableBody);\n    loadTableDiv.appendChild(table);\n  });\n\n  function getUpdatedData() {\n    const updatedData = [];\n    const rows = document.querySelectorAll('#load_table tbody tr');\n    rows.forEach(row => {\n      const rowData = {};\n      const cells = row.querySelectorAll('td');\n      cells.forEach((cell, index) => {\n        const header = headers[index];\n        if (header) {\n          rowData[header] = cell.firstChild.value || cell.textContent;\n        }\n      });\n      updatedData.push(rowData);\n    });\n    return updatedData;\n  }\n  const jsonToCSV = (jsonArray) => {\n    const headers = Object.keys(jsonArray[0]);\n\n    let csv = headers.join(',') + '\\n';\n\n    jsonArray.forEach(obj => {\n        const values = headers.map(header => {\n            const escapedValue = obj[header].replace(/\"/g, '\\\\\"');\n            return `\"${escapedValue}\"`;\n        });\n        csv += values.join(',') + '\\n';\n    });\n\n    return csv;\n};\n\n  function saveCsv(){\n    console.log(JSON.stringify({filename: file_name, csvData:jsonToCSV(getUpdatedData())}))\n     fetch('/saveCsv', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({filename: '/tmp/' + file_name, csvData:jsonToCSV(getUpdatedData())})\n    })\n    .then(response => {\n      if (response.ok) {\n        console.log('Update successful!');\n      } else {\n        console.error('Error updating params:', response.status);\n      }\n    })\n    .catch(error => {\n      console.error('Error:', error);\n    });\n  }\n</script>\n\n\n</body>\n</html>\n",
        "output": "str",
        "x": 1090,
        "y": 1200,
        "wires": [
            [
                "9ff082949b495698"
            ]
        ]
    },
    {
        "id": "76ae33256827ae89",
        "type": "http in",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "url": "/ui_test_post",
        "method": "post",
        "upload": true,
        "swaggerDoc": "",
        "x": 210,
        "y": 1200,
        "wires": [
            [
                "f192e59528bfd677"
            ]
        ]
    },
    {
        "id": "f192e59528bfd677",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "Get Body",
        "func": "msg.newVars = Object.values(msg.payload)\nmsg.name = 'DB_DATA.csv'\nflow.set(\"moduleFacts\", [])\nflow.set(\"originalData\", [])\n//NK initialize global context\nglobal.set(\"originalData\", [])\nglobal.set(\"moduleFacts\", [])\nglobal.set(\"ptrModuleFacts\", 0)\nglobal.set(\"filename\", '/tmp/DB_DATA.csv')\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 1200,
        "wires": [
            [
                "9e0c70dcbb4236fd"
            ]
        ]
    },
    {
        "id": "9ff082949b495698",
        "type": "http response",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1270,
        "y": 1200,
        "wires": []
    },
    {
        "id": "aecaf71d99c7d88b",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "toUpperCaseDBCols",
        "func": "flow.set(\"moduleFacts\", [])\nflow.set(\"originalData\", [])\nglobal.set(\"originalData\", [])\nglobal.set(\"moduleFacts\", [])\nglobal.set(\"ptrModuleFacts\",0)\nglobal.set(\"filename\", '/tmp/DB_DATA.csv')\n\n\n// .map(obj => Object.fromEntries(Object.entries(obj).map(([key, val]) => [key.toUpperCase(), val])));\n// // \nmsg.payload.csv = msg.payload.data.map(obj => Object.fromEntries(Object.entries(obj).map(([key, val]) => [key.toUpperCase(), val])));\nmsg.payload.length = msg.payload.data.length\n\nlet p = msg.payload.csv;\nmsg.payload = p;\n\nlet ptr = global.get(\"ptrModuleFacts\"); //HF\n\nflow.set('moduleFacts', p)\nglobal.set('moduleFacts', p)\nglobal.set('originalData', p[ptr]) //HF\nmsg.topic = 'csv'\nmsg.ui_control = {\n    max: p.length // Assuming msg.payload contains the row count\n};\nmsg.payload = JSON.stringify(msg.payload, null, 2);\n\nmsg.newVars = JSON.stringify({newVars: msg.newVars}, null, 2);\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 1200,
        "wires": [
            [
                "3a09eefeb46e3070",
                "3243d670e9d24a2d"
            ]
        ]
    },
    {
        "id": "270941def4b7c8b6",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "3a3f1620dbce8bb0"
        ],
        "x": 1985,
        "y": 1680,
        "wires": []
    },
    {
        "id": "fbcbf9510de0509c",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "384ea40a25aa8e76",
            "75f86abbfa78b4ab"
        ],
        "x": 2015,
        "y": 1700,
        "wires": []
    },
    {
        "id": "5bf7f51448d5e055",
        "type": "Kafka Admin",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "x": 610,
        "y": 1060,
        "wires": [
            [
                "7b578c41f67e5310"
            ],
            [
                "7b578c41f67e5310"
            ]
        ]
    },
    {
        "id": "395ec4e45f0e2746",
        "type": "http in",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "url": "/kafka_ui_test_post",
        "method": "get",
        "upload": true,
        "swaggerDoc": "",
        "x": 150,
        "y": 1060,
        "wires": [
            [
                "e04eedac58c69ed1"
            ]
        ]
    },
    {
        "id": "e04eedac58c69ed1",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "name": "Get Body",
        "func": "msg.newVars = Object.values(msg.payload)\nmsg.name = 'DB_DATA.csv'\nflow.set(\"moduleFacts\", [])\nflow.set(\"originalData\", [])\n//NK initialize global context\nglobal.set(\"originalData\", [])\nglobal.set(\"moduleFacts\", [])\nglobal.set(\"ptrModuleFacts\", 0)\nglobal.set(\"filename\", '/tmp/DB_DATA.csv')\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 1060,
        "wires": [
            [
                "5bf7f51448d5e055"
            ]
        ]
    },
    {
        "id": "7b578c41f67e5310",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "name": "Get Kafka Records",
        "func": "// flow.set(\"moduleFacts\", [])\n// flow.set(\"originalData\", [])\n// //NK initialize global context\n// global.set(\"originalData\", [])\n// global.set(\"moduleFacts\", [])\n// global.set(\"ptrModuleFacts\",0)\n// global.set(\"filename\", '/tmp/DB_DATA.csv')\n\n\n// const result = msg.payload.map(obj => Object.fromEntries(Object.entries(obj).map(([key, val]) => [key.toUpperCase(), val])));\n// msg.payload.csv = result;\n// msg.payload.length = msg.pgsql.rowCount\n// // console.log(msg.payload.csv)\n\n// let p = msg.payload.csv;\n// msg.payload = p;\n\n// let ptr = global.get(\"ptrModuleFacts\"); //HF\n\n// flow.set('moduleFacts', p)\n// global.set('moduleFacts', p)\n// global.set('originalData', p[ptr]) //HF\n// // global.set('originalData', p[0]) //NK\n// msg.topic = 'csv'\n// msg.ui_control = {\n//     max: p.length // Assuming msg.payload contains the row count\n// };\n// msg.payload = JSON.stringify(msg.payload, null, 2);\n\n// msg.newVars = JSON.stringify({newVars: msg.newVars}, null, 2);\n\n// // console.log({getD: msg.newVars, postD: JSON.stringify({j: msg.newVars}), postDD: msg.newVars})\nconsole.log({\n    msg: msg.payload\n})\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 1060,
        "wires": [
            [
                "614849ea184b04aa"
            ]
        ]
    },
    {
        "id": "614849ea184b04aa",
        "type": "template",
        "z": "dad88d9a3132fed6",
        "name": "html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Upload CSV File</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css\">\n    <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js\"></script>\n    <style>\n        /* Add custom styles for responsiveness */\n         .table-container {\n            width: 95%;\n            overflow-x: auto;\n            margin: 2%;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n\n        th, td {\n            border: 1px solid #dddddd;\n            text-align: left;\n            padding: 8px;\n        }\n\n        tr:nth-child(even) {\n            background-color: #f2f2f2;\n        }\n    </style>\n</head>\n<body>\n<nav>\n    <div class=\"blue nav-wrapper\">\n      <a href=\"#\" data-target=\"mobile-demo\" class=\"sidenav-trigger\"><i class=\"material-icons\">menu</i></a>\n      <ul class=\"left hide-on-med-and-down\">\n        <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n      </ul>\n    </div>\n  </nav>\n\n  <ul class=\"blue sidenav\" id=\"mobile-demo\">\n      <li><a class=\"bold\" href=\"/update_params\">Params</a></li>\n        <li><a class=\"bold\" href=\"/upload_page\">Upload csv</a></li>\n        <li><a class=\"bold\" href=\"/ui_wrapper\">UI</a></li>\n        <li><a class=\"bold\" href=\"/test_ui\">Load DB</a></li>\n  </ul>\n\n  <div class=\"container\">\n    {{!-- <h1 class=\"center-align\">Uploaded</h1> --}}\n  </div>\n  <div id=\"hide_this_to_load\">{{payload}}</div>\n    <div class=\"table-container\">\n  <div id=\"load_table\"></div>\n  </div>\n  <p id=\"file_name\">{{name}}</p>\n   <p id=\"new_vars\">{{newVars}}</p>\n    <div class=\"input-field center-align\">\n    <button onclick='saveCsv()' class=\"btn waves-effect waves-light\" type=\"submit\">Save\n    </button>\n     <a href='/ui_wrapper' class=\"btn waves-effect waves-light\" type=\"submit\">Go {{name}}\n    </a>\n  </div>\n<script>\n  let data = document.getElementById('hide_this_to_load').innerHTML\n  let file_name = document.getElementById('file_name').innerHTML\n  let new_vars = document.getElementById('new_vars').innerHTML\n  \n  document.getElementById('new_vars').style.display = 'none';\n  document.getElementById('hide_this_to_load').style.display = 'none';\n  document.getElementById('file_name').style.display = 'none';\n  data = JSON.parse(data);\n  new_vars = JSON.parse(new_vars);\n  let headers; \n  document.addEventListener('DOMContentLoaded', function() {\n    const loadTableDiv = document.getElementById('load_table');\n    const table = document.createElement('table');\n    table.classList.add('striped');\n    const tableHeader = document.createElement('thead');\n    const headerRow = document.createElement('tr');\n    headers = [...new_vars.newVars.map(i=>i.toUpperCase()), ...(Object.keys(data[0]))]; // Set headers here\n    headers.forEach(headerText => {\n      const th = document.createElement('th');\n      th.textContent = headerText;\n      headerRow.appendChild(th);\n    });\n    tableHeader.appendChild(headerRow);\n    table.appendChild(tableHeader);\n    const tableBody = document.createElement('tbody');\n    data.forEach((item, index) => {\n      const row = document.createElement('tr');\n      headers.forEach(header => {\n        const cell = document.createElement('td');\n        cell.style.minWidth = '200px';\n        if (index !== -1) { // Make fields editable for all rows except the header row\n          const input = document.createElement('input');\n          input.value = item[header] == undefined ? 'NULL': item[header];\n          input.addEventListener('input', function() {\n            item[header] = this.value;\n            const updatedJData = getUpdatedData();\n            // console.log(updatedJData);\n          });\n          cell.appendChild(input);\n        } else {\n          cell.textContent = item[header];\n        }\n        row.appendChild(cell);\n      });\n      tableBody.appendChild(row);\n    });\n    table.appendChild(tableBody);\n    loadTableDiv.appendChild(table);\n  });\n\n  function getUpdatedData() {\n    const updatedData = [];\n    const rows = document.querySelectorAll('#load_table tbody tr');\n    rows.forEach(row => {\n      const rowData = {};\n      const cells = row.querySelectorAll('td');\n      cells.forEach((cell, index) => {\n        const header = headers[index];\n        if (header) {\n          rowData[header] = cell.firstChild.value || cell.textContent;\n        }\n      });\n      updatedData.push(rowData);\n    });\n    return updatedData;\n  }\n  const jsonToCSV = (jsonArray) => {\n    const headers = Object.keys(jsonArray[0]);\n\n    let csv = headers.join(',') + '\\n';\n\n    jsonArray.forEach(obj => {\n        const values = headers.map(header => {\n            const escapedValue = obj[header].replace(/\"/g, '\\\\\"');\n            return `\"${escapedValue}\"`;\n        });\n        csv += values.join(',') + '\\n';\n    });\n\n    return csv;\n};\n\n  function saveCsv(){\n    console.log(JSON.stringify({filename: file_name, csvData:jsonToCSV(getUpdatedData())}))\n     fetch('/saveCsv', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({filename: '/tmp/' + file_name, csvData:jsonToCSV(getUpdatedData())})\n    })\n    .then(response => {\n      if (response.ok) {\n        console.log('Update successful!');\n      } else {\n        console.error('Error updating params:', response.status);\n      }\n    })\n    .catch(error => {\n      console.error('Error:', error);\n    });\n  }\n</script>\n\n\n</body>\n</html>\n",
        "output": "str",
        "x": 1030,
        "y": 1060,
        "wires": [
            [
                "bf57c5e0dbaa9486"
            ]
        ]
    },
    {
        "id": "bf57c5e0dbaa9486",
        "type": "http response",
        "z": "dad88d9a3132fed6",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1190,
        "y": 1060,
        "wires": []
    },
    {
        "id": "05b67576d444bda4",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "df20d97837fa1d09"
        ],
        "x": 2055,
        "y": 1720,
        "wires": []
    },
    {
        "id": "039e4172b173ea18",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "24fea5e6f5d0c6b0"
        ],
        "x": 2085,
        "y": 1740,
        "wires": []
    },
    {
        "id": "45b768d58693d73d",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "c8919561eea2a059",
            "b0b456eac2b51685"
        ],
        "x": 2125,
        "y": 1760,
        "wires": []
    },
    {
        "id": "854cd7a417cbbc6e",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out post edit",
        "mode": "link",
        "links": [
            "8671a6e9c3be6ad6"
        ],
        "x": 2165,
        "y": 1800,
        "wires": []
    },
    {
        "id": "6c8827ce7a4c83d8",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out InteractiveMode",
        "mode": "link",
        "links": [
            "d389bc5bbb58e3cb",
            "4a7b9cb4a8c69f57"
        ],
        "x": 2205,
        "y": 1820,
        "wires": []
    },
    {
        "id": "6386460ff91d3960",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out batchMode1",
        "mode": "link",
        "links": [
            "a7f0c8bc56765c6a"
        ],
        "x": 2165,
        "y": 1840,
        "wires": []
    },
    {
        "id": "6982bc340b585149",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out batchMode2",
        "mode": "link",
        "links": [
            "f0c5660583e686c0"
        ],
        "x": 2125,
        "y": 1860,
        "wires": []
    },
    {
        "id": "48c2bbd321b77688",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out NONNORM: Init Set ACTVMIO & OPSTATS",
        "mode": "link",
        "links": [
            "447f05b7589104a7"
        ],
        "x": 2085,
        "y": 1880,
        "wires": []
    },
    {
        "id": "a0a9a69afb297619",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out NONNORM: Router",
        "mode": "link",
        "links": [
            "918d1db8979aef15"
        ],
        "x": 2045,
        "y": 1900,
        "wires": []
    },
    {
        "id": "879c5a04e7f7b3ba",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out NONNORM: Set OPSTATS & ACTVMIO",
        "mode": "link",
        "links": [
            "7439226c767a87a3"
        ],
        "x": 1995,
        "y": 1920,
        "wires": []
    },
    {
        "id": "601d06243349006e",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out NONNORM: Set NONORM",
        "mode": "link",
        "links": [
            "bc67815db9dee1e7"
        ],
        "x": 1935,
        "y": 1940,
        "wires": []
    },
    {
        "id": "9924458ebb7935cd",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out NONNORM: Set Basic to 0",
        "mode": "link",
        "links": [
            "b7d9dea2a407d5ab"
        ],
        "x": 1875,
        "y": 1960,
        "wires": []
    },
    {
        "id": "51d4f6e460537ff8",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "link out NONNORM: Special Season final",
        "mode": "link",
        "links": [
            "7191fc9544f07b32"
        ],
        "x": 1825,
        "y": 1980,
        "wires": []
    },
    {
        "id": "8cc4aec631b9f7ab",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "mfg_payqtr1",
        "mode": "link",
        "links": [
            "7fd7c15cd9b5a645"
        ],
        "x": 1775,
        "y": 2000,
        "wires": []
    },
    {
        "id": "6e0891f1d9b0f50b",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "mfg_payann",
        "mode": "link",
        "links": [
            "d638deea262939f1"
        ],
        "x": 1715,
        "y": 2020,
        "wires": []
    },
    {
        "id": "405380585cc28809",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "mfg_empq1",
        "mode": "link",
        "links": [
            "c6e825877bca50ae"
        ],
        "x": 1665,
        "y": 2040,
        "wires": []
    },
    {
        "id": "8ab5edfeddc79fdc",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "kau_to_company_additivity_check_link",
        "mode": "link",
        "links": [
            "cd68a9923d85636d"
        ],
        "x": 1615,
        "y": 2060,
        "wires": []
    },
    {
        "id": "be79a45237eac5df",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "inventories_balance_link",
        "mode": "link",
        "links": [
            "b2b244030212674a"
        ],
        "x": 1555,
        "y": 2080,
        "wires": []
    },
    {
        "id": "961d21f9c9d6935d",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "lifo_valuation_method_link",
        "mode": "link",
        "links": [
            "0e055cc10b2d1df5"
        ],
        "x": 1495,
        "y": 2100,
        "wires": []
    },
    {
        "id": "256113e429ce586b",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "evaluate_lifo_reverse_module_link",
        "mode": "link",
        "links": [
            "62eb4cacd21b3528"
        ],
        "x": 1445,
        "y": 2120,
        "wires": []
    },
    {
        "id": "6e4d6926b48c4bfc",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "evaluate_lifo_module_link",
        "mode": "link",
        "links": [
            "f64b690f11b0f463"
        ],
        "x": 1385,
        "y": 2140,
        "wires": []
    },
    {
        "id": "6a7a578fbd272b1f",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "non_lifo_valuation_methods_module_link",
        "mode": "link",
        "links": [
            "b55a0bc87142a940"
        ],
        "x": 1325,
        "y": 2160,
        "wires": []
    },
    {
        "id": "ac696618fbdb5b2b",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "evaluatenon_lifo_valuation_methods_module_link",
        "mode": "link",
        "links": [
            "c72b098afa64f560"
        ],
        "x": 1265,
        "y": 2180,
        "wires": []
    },
    {
        "id": "ff930476a898868c",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "evaluate_detail_valuation_methods_link",
        "mode": "link",
        "links": [
            "e0fccd45e6604bda"
        ],
        "x": 1225,
        "y": 2200,
        "wires": []
    },
    {
        "id": "17eb7e821e3b7ea0",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": " evaluate_non_lifo_valuation_method_module_link",
        "mode": "link",
        "links": [
            "d81c18d7166b9e59"
        ],
        "x": 1175,
        "y": 2220,
        "wires": []
    },
    {
        "id": "9a0ffed7eefbb31e",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "non_lifo_random_module_link",
        "mode": "link",
        "links": [
            "61e767d06ab72a43"
        ],
        "x": 1115,
        "y": 2240,
        "wires": []
    },
    {
        "id": "f2d1653b5ba3e5d2",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "napcs_balance",
        "mode": "link",
        "links": [
            "2e8dc577c6d85be5"
        ],
        "x": 1065,
        "y": 2260,
        "wires": []
    },
    {
        "id": "03b4a30c8b73aaa1",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "napcs_balance",
        "mode": "link",
        "links": [
            "5749501cd685bc0c"
        ],
        "x": 1015,
        "y": 2280,
        "wires": []
    },
    {
        "id": "184f643c8c0c9483",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "napcs_balance",
        "mode": "link",
        "links": [
            "aca56c4b68c05d08"
        ],
        "x": 975,
        "y": 2300,
        "wires": []
    },
    {
        "id": "13026c6f9554fd48",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "napcs_recalculate_napcs_fields",
        "mode": "link",
        "links": [
            "ebd6fd2b33dd0765"
        ],
        "x": 935,
        "y": 2320,
        "wires": []
    },
    {
        "id": "628a357ebf92b85e",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "napcs_no_donor",
        "mode": "link",
        "links": [
            "23a30ef7226c1c9c"
        ],
        "x": 895,
        "y": 2340,
        "wires": []
    },
    {
        "id": "23110971cf0ed68c",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "napcs_m_goco",
        "mode": "link",
        "links": [
            "b93299e2e56af480"
        ],
        "x": 855,
        "y": 2360,
        "wires": []
    },
    {
        "id": "f96645ae14ef8fb7",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "napcs_hdicat_link",
        "mode": "link",
        "links": [
            "8bc3b4ce5f96ef53"
        ],
        "x": 815,
        "y": 2380,
        "wires": []
    },
    {
        "id": "1b801f920c932ed1",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "mk_link",
        "mode": "link",
        "links": [
            "f81fcc6d468aec4e"
        ],
        "x": 785,
        "y": 2400,
        "wires": []
    },
    {
        "id": "9e0c70dcbb4236fd",
        "type": "subflow:e28cd8ccfbe21b33",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "",
        "x": 620,
        "y": 1200,
        "wires": [
            [
                "aecaf71d99c7d88b",
                "4009a991edd2db54"
            ]
        ]
    },
    {
        "id": "4009a991edd2db54",
        "type": "debug",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "DB DEBUG",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 1120,
        "wires": []
    },
    {
        "id": "3243d670e9d24a2d",
        "type": "debug",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "DB AFTER CAHANGE",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1080,
        "y": 1140,
        "wires": []
    },
    {
        "id": "070b2c6eb42b2ee1",
        "type": "function",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "GetENV",
        "func": "// msg.payload.url = env.get('CENSUS_API')\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 940,
        "wires": [
            [
                "399608507ce305d7"
            ]
        ]
    },
    {
        "id": "f49fb32690ddbe1a",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "load_referrals_link",
        "mode": "link",
        "links": [
            "c0fb97b1232af4ac"
        ],
        "x": 755,
        "y": 2420,
        "wires": []
    },
    {
        "id": "bf91ad9e062838cc",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "napcs_prep_link",
        "mode": "link",
        "links": [
            "43159eefde8b9ec7"
        ],
        "x": 715,
        "y": 2440,
        "wires": []
    },
    {
        "id": "bbfea30cdba9957b",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "derive_mfg_naics_link",
        "mode": "link",
        "links": [
            "49960e045e84befd"
        ],
        "x": 665,
        "y": 2460,
        "wires": []
    },
    {
        "id": "2c7eaaca104f6a2c",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "estab_to_kau_additivity_link",
        "mode": "link",
        "links": [
            "5505999b0ff57b05"
        ],
        "x": 655,
        "y": 2500,
        "wires": []
    },
    {
        "id": "5e674b959c1b250a",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "g": "4099bf03141f3710",
        "name": "estab_to_kau_raking_link",
        "mode": "link",
        "links": [
            "07849dc89cea33b4"
        ],
        "x": 635,
        "y": 2540,
        "wires": []
    },
    {
        "id": "2ae1f1be82166f95",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "name": "su_to_ent",
        "mode": "link",
        "links": [
            "22c4c2d2376a93a9"
        ],
        "x": 605,
        "y": 2580,
        "wires": []
    },
    {
        "id": "3acafa8baa321281",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "name": "nonmfg_su_to_kau",
        "mode": "link",
        "links": [
            "e91a8662150f860b"
        ],
        "x": 575,
        "y": 2620,
        "wires": []
    },
    {
        "id": "63be9b3202d985e3",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "name": "mfg_mu_su_to_kau",
        "mode": "link",
        "links": [
            "5078aca6043b1cc4"
        ],
        "x": 555,
        "y": 2660,
        "wires": []
    },
    {
        "id": "537b24e51dc942ff",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "name": "kau_to_su",
        "mode": "link",
        "links": [
            "eee8901d3c3ad4a5"
        ],
        "x": 535,
        "y": 2700,
        "wires": []
    },
    {
        "id": "7da3e97012eb822e",
        "type": "link out",
        "z": "dad88d9a3132fed6",
        "name": "histstat",
        "mode": "link",
        "links": [
            "d78cf76e54ce1388"
        ],
        "x": 515,
        "y": 2740,
        "wires": []
    },
    {
        "id": "11fe39a5537b93ed",
        "type": "link out",
        "z": "c3ae207e8a0fdafa",
        "name": "link out 93",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 925,
        "y": 100,
        "wires": []
    },
    {
        "id": "5505999b0ff57b05",
        "type": "link in",
        "z": "c3ae207e8a0fdafa",
        "name": "link in 52",
        "links": [
            "fa7a570c778cff30",
            "2c7eaaca104f6a2c"
        ],
        "x": 645,
        "y": 100,
        "wires": [
            [
                "190d933faaf76f92"
            ]
        ]
    },
    {
        "id": "190d933faaf76f92",
        "type": "subflow:6e56f7f07e320f38",
        "z": "c3ae207e8a0fdafa",
        "name": "",
        "x": 790,
        "y": 100,
        "wires": [
            [
                "11fe39a5537b93ed"
            ]
        ]
    },
    {
        "id": "6c2616b9f8b16717",
        "type": "link out",
        "z": "8790b12c7efb6fa0",
        "name": "Output of Interactive mode",
        "mode": "link",
        "links": [
            "8ad2ab7c27d8d248"
        ],
        "x": 2245,
        "y": 140,
        "wires": []
    },
    {
        "id": "746909370ced9c62",
        "type": "link in",
        "z": "8790b12c7efb6fa0",
        "name": "link in gotQBES",
        "links": [
            "8eb6f6b4ca5cb88d",
            "35871e68a9f50691"
        ],
        "x": 355,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "4a7b9cb4a8c69f57",
        "type": "link in",
        "z": "8790b12c7efb6fa0",
        "name": "Interactive Mode Test UI Input",
        "links": [
            "6c8827ce7a4c83d8"
        ],
        "x": 895,
        "y": 1020,
        "wires": [
            [
                "b29f65e4584b8767"
            ]
        ]
    },
    {
        "id": "0422aeccc8321ad8",
        "type": "link out",
        "z": "8790b12c7efb6fa0",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 2665,
        "y": 940,
        "wires": []
    },
    {
        "id": "a48bbfee066abb7a",
        "type": "function",
        "z": "8790b12c7efb6fa0",
        "name": "Fetch all params",
        "func": "msg.url = 'http://a301cb45559c445acaec11ab01bbbee1-2115632777.us-gov-east-1.elb.amazonaws.com/api/params/params'\nmsg.backup = msg.payload\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nlet msg = {}\nmsg.url = 'https://mc.edl-7529180-ite.ite.edl.census.gov/api/params/params'\n// msg.url = 'https://mc.edl-7529180-ite.ite.edl.census.gov/api/'\nmsg.backup = msg.payload\n// msg.payload.startTime = global.set(\"currentTime\", new Date())\n\nreturn msg;",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 80,
        "wires": [
            [
                "e75551794bd4e9c1"
            ]
        ]
    },
    {
        "id": "e75551794bd4e9c1",
        "type": "http request",
        "z": "8790b12c7efb6fa0",
        "name": "Lookup data API",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 1590,
        "y": 80,
        "wires": [
            [
                "db960fa2db841295"
            ]
        ]
    },
    {
        "id": "db960fa2db841295",
        "type": "function",
        "z": "8790b12c7efb6fa0",
        "name": "cache result",
        "func": "let cache = global.get(\"lookupCache\");\ncache = Array.isArray(cache?.data) ? cache : { \"data\": [] }\nif (msg.payload.status === \"success\") {\n    cache.data = msg.payload.data\n    msg.payload.dataArr = cache.data\n}\nglobal.set(\"lookupCache\", cache)\n// msg.payload = {\n//     ...msg.payload,\n//     ...msg.backup\n// }\n// return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1790,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "bc058c7d26276884",
        "type": "inject",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1190,
        "y": 80,
        "wires": [
            [
                "a48bbfee066abb7a"
            ]
        ]
    },
    {
        "id": "b29f65e4584b8767",
        "type": "change",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "action",
                "pt": "global",
                "to": "\"\"",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1060,
        "y": 1020,
        "wires": [
            [
                "e97ff6b724a4e2b5"
            ]
        ]
    },
    {
        "id": "66fdc22c898d5af9",
        "type": "function",
        "z": "8790b12c7efb6fa0",
        "name": "Merge calls",
        "func": "let backup_origin = global.get(\"backup_origin\")\nmsg.payload.backup_origin = backup_origin != undefined && backup_origin\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2670,
        "y": 380,
        "wires": [
            [
                "0422aeccc8321ad8"
            ]
        ]
    },
    {
        "id": "56807c0e8b3a451e",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "reporting_id_typ_txt",
        "property": "reporting_id_typ_txt",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "SU",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "MU",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "KAU",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ENT",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 5,
        "x": 1110,
        "y": 1300,
        "wires": [
            [
                "f92e3ab0936c7619"
            ],
            [
                "f92e3ab0936c7619"
            ],
            [
                "e328a8ef88170408"
            ],
            [
                "97f9d2f0703ef24a"
            ],
            [
                "da921bef22345a06"
            ]
        ]
    },
    {
        "id": "c0ae812afe3b8630",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2010,
        "y": 1300,
        "wires": [
            [
                "da921bef22345a06"
            ],
            [
                "da921bef22345a06"
            ]
        ]
    },
    {
        "id": "e97ff6b724a4e2b5",
        "type": "change",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "err",
                "pt": "global",
                "to": "\"\"",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 1140,
        "wires": [
            [
                "7393df42ef696382"
            ]
        ]
    },
    {
        "id": "33f528d747418689",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2000,
        "y": 1240,
        "wires": [
            [
                "da921bef22345a06"
            ],
            [
                "c0ae812afe3b8630"
            ]
        ]
    },
    {
        "id": "f92e3ab0936c7619",
        "type": "subflow:e14f077595377a58",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 1750,
        "y": 240,
        "wires": [
            [
                "9f354b9270261617"
            ]
        ]
    },
    {
        "id": "9f354b9270261617",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1990,
        "y": 240,
        "wires": [
            [
                "66fdc22c898d5af9"
            ],
            [
                "c643eca0dfb1c646"
            ]
        ]
    },
    {
        "id": "c643eca0dfb1c646",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2000,
        "y": 280,
        "wires": [
            [
                "893a3c0221e36028"
            ],
            [
                "0b7cc3acbec1c3e3"
            ]
        ]
    },
    {
        "id": "e328a8ef88170408",
        "type": "subflow:88823d21c11ae7b5",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 1760,
        "y": 820,
        "wires": [
            [
                "fd8f636ad49cade0"
            ]
        ]
    },
    {
        "id": "fd8f636ad49cade0",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2000,
        "y": 820,
        "wires": [
            [
                "7801b65b30d7f5d3"
            ],
            [
                "f7ebffa4f4d46b88"
            ]
        ]
    },
    {
        "id": "f7ebffa4f4d46b88",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1770,
        "y": 880,
        "wires": [
            [
                "186d08aa36ecf129"
            ],
            [
                "4cf602eb8c214878"
            ]
        ]
    },
    {
        "id": "97f9d2f0703ef24a",
        "type": "subflow:a2511614f51e5116",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 1760,
        "y": 1240,
        "wires": [
            [
                "33f528d747418689"
            ]
        ]
    },
    {
        "id": "0b7cc3acbec1c3e3",
        "type": "subflow:e825fc8e32eb1364",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 1770,
        "y": 340,
        "wires": [
            [
                "9866b63bc4275454"
            ]
        ]
    },
    {
        "id": "9866b63bc4275454",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2000,
        "y": 340,
        "wires": [
            [
                "66fdc22c898d5af9"
            ],
            [
                "d4f45bc6d26dc500"
            ]
        ]
    },
    {
        "id": "d4f45bc6d26dc500",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2010,
        "y": 400,
        "wires": [
            [
                "893a3c0221e36028"
            ],
            [
                "916ac88149df008a"
            ]
        ]
    },
    {
        "id": "7393df42ef696382",
        "type": "function",
        "z": "8790b12c7efb6fa0",
        "name": "Reporting_id_typ_txt",
        "func": "let record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\nglobal.set('reporting_id_typ_txt',record?.REPORTING_ID_TYP_TXT)\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 1200,
        "wires": [
            [
                "56807c0e8b3a451e"
            ]
        ]
    },
    {
        "id": "7801b65b30d7f5d3",
        "type": "function",
        "z": "8790b12c7efb6fa0",
        "name": "Merge calls",
        "func": "let backup_origin = global.get(\"backup_origin\")\nmsg.payload.backup_origin = backup_origin != undefined && backup_origin\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2420,
        "y": 880,
        "wires": [
            [
                "0422aeccc8321ad8"
            ]
        ]
    },
    {
        "id": "da921bef22345a06",
        "type": "function",
        "z": "8790b12c7efb6fa0",
        "name": "Merge calls",
        "func": "let backup_origin = global.get(\"backup_origin\")\nmsg.payload.backup_origin = backup_origin != undefined && backup_origin\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2400,
        "y": 1340,
        "wires": [
            [
                "0422aeccc8321ad8"
            ]
        ]
    },
    {
        "id": "916ac88149df008a",
        "type": "subflow:010b1368b661e966",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 1780,
        "y": 460,
        "wires": [
            [
                "31cac2b9b139ec52"
            ]
        ]
    },
    {
        "id": "dc42b62910d4bb13",
        "type": "subflow:326ee5d4d26564c7",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 2000,
        "y": 580,
        "wires": [
            [
                "66fdc22c898d5af9"
            ]
        ]
    },
    {
        "id": "31cac2b9b139ec52",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2000,
        "y": 460,
        "wires": [
            [
                "66fdc22c898d5af9"
            ],
            [
                "562c2983a0c8e40f"
            ]
        ]
    },
    {
        "id": "562c2983a0c8e40f",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Exit Check",
        "property": "action",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2010,
        "y": 520,
        "wires": [
            [
                "893a3c0221e36028"
            ],
            [
                "dc42b62910d4bb13"
            ]
        ]
    },
    {
        "id": "e82dc4d5d1d543cf",
        "type": "subflow:9327a343376a53f9",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 1770,
        "y": 760,
        "wires": [
            [
                "c3f7613ebb2431d9"
            ]
        ]
    },
    {
        "id": "c3f7613ebb2431d9",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1990,
        "y": 760,
        "wires": [
            [
                "7801b65b30d7f5d3"
            ],
            [
                "7801b65b30d7f5d3"
            ]
        ]
    },
    {
        "id": "4cf602eb8c214878",
        "type": "subflow:2313e47e41070980",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 1780,
        "y": 940,
        "wires": [
            [
                "1e6af3c397d17e33"
            ]
        ]
    },
    {
        "id": "1e6af3c397d17e33",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2000,
        "y": 940,
        "wires": [
            [
                "7801b65b30d7f5d3"
            ],
            [
                "73cd649911613fee"
            ]
        ]
    },
    {
        "id": "b3b943eb3796408a",
        "type": "switch",
        "z": "8790b12c7efb6fa0",
        "name": "Error Exit Check",
        "property": "err",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Exit Edit",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "Exit Edit",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1990,
        "y": 1060,
        "wires": [
            [
                "7801b65b30d7f5d3"
            ],
            [
                "7801b65b30d7f5d3"
            ]
        ]
    },
    {
        "id": "73cd649911613fee",
        "type": "subflow:c1249a800f33a884",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 1770,
        "y": 1060,
        "wires": [
            [
                "b3b943eb3796408a"
            ]
        ]
    },
    {
        "id": "186d08aa36ecf129",
        "type": "subflow:96f29b19e2260e65",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 2030,
        "y": 880,
        "wires": [
            [
                "7801b65b30d7f5d3"
            ]
        ]
    },
    {
        "id": "893a3c0221e36028",
        "type": "subflow:96f29b19e2260e65",
        "z": "8790b12c7efb6fa0",
        "name": "",
        "x": 2390,
        "y": 260,
        "wires": [
            [
                "66fdc22c898d5af9"
            ]
        ]
    },
    {
        "id": "bed4b9a48e50c41c",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "kafka consumer: gotQBES",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 400,
        "wires": []
    },
    {
        "id": "3ec01d49fbdfba54",
        "type": "link out",
        "z": "d7d109e0d89be1c6",
        "name": "link out gotQBES",
        "mode": "link",
        "links": [
            "4480a2673228edf6",
            "f765d14d056bec8a",
            "e0d75497828e672b"
        ],
        "x": 555,
        "y": 340,
        "wires": []
    },
    {
        "id": "8ad2ab7c27d8d248",
        "type": "link in",
        "z": "d7d109e0d89be1c6",
        "name": "link in gotFLOW",
        "links": [
            "36ac45a273e5509f",
            "084da167bd2adffa",
            "7cdbce6d4b28412b",
            "9aee892d0909f5a2",
            "c481f6b945425e82",
            "6c2616b9f8b16717"
        ],
        "x": 495,
        "y": 740,
        "wires": [
            [
                "60346d8f3d1bcd94",
                "e894cadacc02eb73"
            ]
        ]
    },
    {
        "id": "f9b02de75682c807",
        "type": "function",
        "z": "d7d109e0d89be1c6",
        "name": "function 25",
        "func": "msg.payload = JSON.parse(msg.payload.value)\n\nconst currentStepIndex = msg.payload.recipe.currentStepIndex;\nconst startTime = new Date().getTime();\n\nmsg.payload.recipe.steps[currentStepIndex].tsStart = startTime;\n\nmsg.payload.facts = [msg.payload.fact]\nmsg.payload.qflowInputFacts = JSON.parse(JSON.stringify(msg.payload.facts))\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 290,
        "y": 400,
        "wires": [
            [
                "bed4b9a48e50c41c",
                "3ec01d49fbdfba54"
            ]
        ]
    },
    {
        "id": "60346d8f3d1bcd94",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "gotFlow",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 780,
        "wires": []
    },
    {
        "id": "e894cadacc02eb73",
        "type": "function",
        "z": "d7d109e0d89be1c6",
        "name": "updateResultToPayload",
        "func": "\nconst findChangedKeyValuePairs = (oldObj, newObj) => {\n    const changedKeyValuePairs = [];\n\n    for (const key in newObj) {\n        if (oldObj[key] !== newObj[key]) {\n            changedKeyValuePairs.push({\n                key,\n                oldValue: oldObj[key],\n                newValue: newObj[key],\n                service: {\n                    name: 'qflow',\n                    timestamp: new Date()\n                }\n            });\n        }\n    }\n\n    return changedKeyValuePairs;\n}\n\nconst qFlowdelta = findChangedKeyValuePairs(msg.payload.qflowInputFacts[0], msg.payload.facts[0]);\n\nmsg.payload.delta.push(...qFlowdelta);\nmsg.payload.fact = msg.payload.facts[0];\n// delete msg.payload.facts;\n// delete msg.payload.qflowInputFacts;\n\nvar currentStepIndex = msg.payload.recipe.currentStepIndex;\nconst startTime = msg.payload.recipe.steps[currentStepIndex].tsStart;\n\nconst endTime = new Date().getTime();\n\nmsg.payload.recipe.steps[currentStepIndex].tsEnd = endTime;\nmsg.payload.recipe.steps[currentStepIndex].processedTime = endTime - startTime;\n\nmsg.payload.recipe.steps[currentStepIndex].delta = qFlowdelta;\nmsg.payload.recipe.currentStepIndex = currentStepIndex + 1\nmsg.topicName = msg.payload.recipe.steps[currentStepIndex+1].msName;\n\nmsg.payload = JSON.stringify(msg.payload)\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 720,
        "wires": [
            [
                "65ddc89844c5a58f",
                "3fec20bb8aaae008",
                "2cddb7a50f4f69d9"
            ]
        ]
    },
    {
        "id": "65ddc89844c5a58f",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "Got updateResultToPayload",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 620,
        "wires": []
    },
    {
        "id": "3fec20bb8aaae008",
        "type": "switch",
        "z": "d7d109e0d89be1c6",
        "name": "Switch the topic push",
        "property": "topicName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "qbes",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "qflow",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "jobOutput",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1010,
        "y": 740,
        "wires": [
            [
                "8b0e07553bb5ee94"
            ],
            [
                "5006976f1193b7e2"
            ],
            [
                "d0b38c1e210e2c2b"
            ]
        ]
    },
    {
        "id": "8b0e07553bb5ee94",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "Producer Qubes",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1280,
        "y": 640,
        "wires": []
    },
    {
        "id": "5006976f1193b7e2",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "Producer QFlow",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1280,
        "y": 740,
        "wires": []
    },
    {
        "id": "d0b38c1e210e2c2b",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "Producer JobOutput",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1300,
        "y": 840,
        "wires": []
    },
    {
        "id": "38b1aa58eaaa6a28",
        "type": "function",
        "z": "d7d109e0d89be1c6",
        "name": "Getting Data and Makeing Index",
        "func": "msg.payload = JSON.parse(msg.payload.value)\n\nconst currentStepIndex = msg.payload.recipe.currentStepIndex;\nconst startTime = new Date().getTime();\n\nmsg.payload.recipe.steps[currentStepIndex].tsStart = startTime;\n\nmsg.payload.facts = [msg.payload.fact]\n\n\nmsg.payload.qflowInputFacts = JSON.parse(JSON.stringify(msg.payload.facts))\n\nmsg.payload.csv = JSON.parse(JSON.stringify(msg.payload.facts))\n\nglobal.set(\"ptrModuleFacts\", 0);\n\nmsg.modeName = msg.payload.recipe.steps[currentStepIndex].hasOwnProperty('testModule') ? msg.payload.recipe.steps[currentStepIndex].testModule : 'interactive_mode';\n\nglobal.set(\"backup_origin\", JSON.stringify(msg.payload));\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1030,
        "y": 1020,
        "wires": [
            [
                "dd4e4b47f3bb384d",
                "8549c72d66cffc9d"
            ]
        ]
    },
    {
        "id": "dd4e4b47f3bb384d",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "Got Kafka Connection",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1320,
        "y": 1080,
        "wires": []
    },
    {
        "id": "bc67b88faaeac7a5",
        "type": "inject",
        "z": "d7d109e0d89be1c6",
        "name": "Test Input for Qflow",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 370,
        "y": 1020,
        "wires": [
            [
                "79a0b1bc0114c75c"
            ]
        ]
    },
    {
        "id": "79a0b1bc0114c75c",
        "type": "function",
        "z": "d7d109e0d89be1c6",
        "name": "Raw data",
        "func": "msg.payload.csv = [\n    {\n    \"job\": {\n        \"history\": [],\n        \"jobName\": \"mark1\",\n        \"recipeID\": 1,\n        \"initiatedTs\": \"2023-09-11T17:51:55.574Z\"\n    },\n    \"fact\": {\n        \"ID\": 33133,\n        \"ENT_ID\": \"2099021295\",\n        \"KAU_ID\": \"3000003933\",\n        \"NR_ADJ\": \"1\",\n        \"NR_WGT\": \"1\",\n        \"PS_ADJ\": \"1\",\n        \"PS_WGT\": \"1\",\n        \"SMPCDE\": \"6\",\n        \"SMPWGT\": \"1\",\n        \"WSWTCH\": \"C\",\n        \"DUPFACT\": \"1\",\n        \"EIN_NUM\": \"730584841SUCCESS\",\n        \"OUTLIER\": \"1\",\n        \"SMPOWGT\": \"1\",\n        \"SUBSAMP\": \"1\",\n        \"TABSTAT\": \"Y\",\n        \"UNB_WGT\": \"1\",\n        \"VERSION\": \"PO\",\n        \"EXP_DPCT\": null,\n        \"INV_STAT\": null,\n        \"NONTABFL\": \"ABC\",\n        \"ZERO_VAL\": \"0\",\n        \"BIRTH_ADJ\": \"1\",\n        \"NAICS_NUM\": 51212000,\n        \"OPSTAT_STAT\": \"Y    \",\n        \"PAY_ANN_VAL\": 62229,\n        \"ACTV_MIO_NUM\": 2,\n        \"EXPS_TAX_VAL\": null,\n        \"EXPS_TOT_VAL\": null,\n        \"ITEM_OUTLIER\": \"1\",\n        \"NAICS_SECTOR\": \"51\",\n        \"PAY_QTR1_VAL\": 15525,\n        \"RATIO_FACTOR\": \"1\",\n        \"RCPT_TOT_VAL\": 52698,\n        \"RCPT_UFO_VAL\": null,\n        \"REPORTING_ID\": 2099024640,\n        \"ADD_OPEN_DATE\": \"2018-12-04T00:00:00\",\n        \"EMP_MAR12_NUM\": 115,\n        \"EXPS_ELEC_VAL\": null,\n        \"EXPS_FUEL_VAL\": null,\n        \"GROUP_KEY_TXT\": \"5121200000Y\",\n        \"INV_B_AVG_VAL\": null,\n        \"INV_B_FIN_VAL\": null,\n        \"INV_B_MAT_VAL\": null,\n        \"INV_B_STD_VAL\": null,\n        \"INV_B_TOT_VAL\": null,\n        \"INV_B_WIP_VAL\": null,\n        \"INV_E_AVG_VAL\": null,\n        \"INV_E_FIN_VAL\": null,\n        \"INV_E_MAT_VAL\": null,\n        \"INV_E_STD_VAL\": null,\n        \"INV_E_TOT_VAL\": null,\n        \"INV_E_WIP_VAL\": null,\n        \"NONPROFT_STAT\": \"N    \",\n        \"PAY_ANN_VAL_F\": \"t\",\n        \"RCPT_UFO_STAT\": null,\n        \"REPORTING_ID2\": \"2099024640\",\n        \"CAPEX_AUTO_VAL\": null,\n        \"CAPEX_TOT_DVAL\": null,\n        \"EXPS_OTHER_VAL\": null,\n        \"EXPS_SLVR_DVAL\": 0,\n        \"EXPS_TAX_VAL_F\": \"t\",\n        \"EXPS_TOT_VAL_F\": \"r\",\n        \"INV_B_FIFO_VAL\": null,\n        \"INV_B_LIFO_VAL\": null,\n        \"INV_E_FIFO_VAL\": null,\n        \"INV_E_LIFO_VAL\": null,\n        \"OPSTAT_SY_STAT\": \"4    \",\n        \"PAYANN_EMP_RAT\": \"541.0347826086957\",\n        \"PAY_QTR1_VAL_F\": \"k\",\n        \"RCPT_ESHIP_PCT\": null,\n        \"RCPT_TOT_VAL_F\": \"k\",\n        \"RCPT_UFO_VAL_F\": \"k\",\n        \"RECORD_TYP_TXT\": \"20\",\n        \"EMP_MAR12_NUM_F\": \"r\",\n        \"EXPS_ADVERT_VAL\": null,\n        \"EXPS_ELEC_VAL_F\": \"k\",\n        \"EXPS_EXSOFT_VAL\": null,\n        \"EXPS_FUEL_VAL_F\": \"k\",\n        \"EXPS_MAT_V1_VAL\": null,\n        \"EXPS_PCHTT_DVAL\": null,\n        \"EXPS_REFUSE_VAL\": null,\n        \"EXPS_RESALE_VAL\": null,\n        \"EXPS_RPTOT_DVAL\": null,\n        \"INV_B_AVG_VAL_F\": \"t\",\n        \"INV_B_FIN_VAL_F\": \"t\",\n        \"INV_B_MAT_VAL_F\": \"t\",\n        \"INV_B_OTHNL_VAL\": null,\n        \"INV_B_STD_VAL_F\": \"r\",\n        \"INV_B_TOT_VAL_F\": \"r\",\n        \"INV_B_WIP_VAL_F\": \"t\",\n        \"INV_E_AVG_VAL_F\": \"t\",\n        \"INV_E_FIN_VAL_F\": \"t\",\n        \"INV_E_MAT_VAL_F\": \"r\",\n        \"INV_E_OTHNL_VAL\": null,\n        \"INV_E_STD_VAL_F\": \"r\",\n        \"INV_E_TOT_VAL_F\": \"k\",\n        \"INV_E_WIP_VAL_F\": \"t\",\n        \"NAICS_WRTIN_TXT\": \"lorem ipsum\",\n        \"PAY_ANN_OM_DVAL\": null,\n        \"RCPT_TOT_PY_VAL\": 42721,\n        \"ROBOT_INDST_VAL\": null,\n        \"ROBOT_WRTIN_TXT\": null,\n        \"TAX_EXEMPT_STAT\": \"N    \",\n        \"TYPOP_CODE_STAT\": null,\n        \"CAPEX_AUTO_VAL_F\": \"t\",\n        \"CAPEX_COMPTR_VAL\": null,\n        \"ELEC_GEN_KWH_NUM\": null,\n        \"EXPS_COMMSVC_VAL\": null,\n        \"EXPS_OTHER_VAL_F\": \"k\",\n        \"HOURS_PRDWRK_NUM\": null,\n        \"INV_B_FIFO_VAL_F\": \"k\",\n        \"INV_B_LIFO_VAL_F\": \"r\",\n        \"INV_E_FIFO_VAL_F\": \"k\",\n        \"INV_E_LIFO_VAL_F\": \"k\",\n        \"INV_FIN_DIF_DVAL\": null,\n        \"INV_WIP_DIF_DVAL\": null,\n        \"RCPT_ESHIP_PCT_F\": \"t\",\n        \"REPORTING_TYP_ID\": \"MU\",\n        \"VALUE_ADDED_DVAL\": null,\n        \"CAPEX_OTHMACH_VAL\": null,\n        \"CAPEX_OTH_NEW_VAL\": null,\n        \"ELEC_PRCH_KWH_NUM\": null,\n        \"ELEC_SOLD_KWH_NUM\": null,\n        \"EMP_MAR12_OM_DNUM\": null,\n        \"EXPS_ADVERT_VAL_F\": \"t\",\n        \"EXPS_CONTRACT_VAL\": null,\n        \"EXPS_CSTMTOT_DVAL\": null,\n        \"EXPS_DATAPROC_VAL\": null,\n        \"EXPS_EXSOFT_VAL_F\": \"t\",\n        \"EXPS_MACH_REP_VAL\": null,\n        \"EXPS_MAT_V1_VAL_F\": \"k\",\n        \"EXPS_PROFTECH_VAL\": null,\n        \"EXPS_REFUSE_VAL_F\": \"t\",\n        \"EXPS_RESALE_VAL_F\": \"t\",\n        \"EXPS_TEMPSTAF_VAL\": null,\n        \"INV_B_NL_TOT_DVAL\": null,\n        \"INV_B_OTHNL_VAL_F\": \"t\",\n        \"INV_E_NL_TOT_DVAL\": null,\n        \"INV_E_OTHNL_VAL_F\": \"t\",\n        \"PAY_ANN_SLVR_DVAL\": 46694,\n        \"RCPT_TOT_PY_VAL_F\": \"k\",\n        \"ROBOT_INDST_VAL_F\": \"t\",\n        \"CAPEX_COMPTR_VAL_F\": \"t\",\n        \"CAPEX_NEW_TOT_DVAL\": null,\n        \"CAPEX_OTH_TOT_DVAL\": null,\n        \"CAPEX_OTH_USED_VAL\": null,\n        \"ELEC_GEN_KWH_NUM_F\": \"r\",\n        \"EXPS_BUILD_REP_VAL\": null,\n        \"EXPS_COMMSVC_VAL_F\": \"k\",\n        \"EXPS_RENT_MACH_VAL\": null,\n        \"HOURS_PRDWRK_NUM_F\": \"k\",\n        \"INV_B_LIFO_RSV_VAL\": null,\n        \"INV_E_LIFO_RSV_VAL\": null,\n        \"NEG_INV_B_TOT_DVAL\": null,\n        \"PAY_ANN_PRDWRK_VAL\": null,\n        \"CAPEX_BUILD_NEW_VAL\": null,\n        \"CAPEX_MACH_TOT_DVAL\": null,\n        \"CAPEX_MACH_USED_VAL\": null,\n        \"CAPEX_OTHMACH_VAL_F\": \"r\",\n        \"CAPEX_OTH_NEW_VAL_F\": \"t\",\n        \"CAPEX_USED_TOT_DVAL\": null,\n        \"ELEC_PRCH_KWH_NUM_F\": \"r\",\n        \"ELEC_SOLD_KWH_NUM_F\": \"k\",\n        \"EXPS_CONTRACT_VAL_F\": \"r\",\n        \"EXPS_DATAPROC_VAL_F\": \"k\",\n        \"EXPS_MACH_REP_VAL_F\": \"k\",\n        \"EXPS_PROFTECH_VAL_F\": \"t\",\n        \"EXPS_RENT_BUILD_VAL\": null,\n        \"EXPS_TEMPSTAF_VAL_F\": \"t\",\n        \"INV_B_IVAL_TOT_DVAL\": null,\n        \"INV_B_NL_TOT_DVAL_F\": \"r\",\n        \"INV_E_IVAL_TOT_DVAL\": null,\n        \"INV_E_LIFO_NET_DVAL\": null,\n        \"INV_E_NL_TOT_DVAL_F\": \"r\",\n        \"MAJOR_ACT_CODE_STAT\": \"18\",\n        \"PAY_QTR1_PRDWRK_VAL\": null,\n        \"PHYSLOC_ADDR_ST_TXT\": \"KS\",\n        \"TYPOP_OTH_WRTIN_TXT\": null,\n        \"CAPEX_BUILD_TOT_DVAL\": null,\n        \"CAPEX_BUILD_USED_VAL\": null,\n        \"CAPEX_OTH_TOT_DVAL_F\": \"r\",\n        \"CAPEX_OTH_USED_VAL_F\": \"r\",\n        \"EMP_MAR12_PRDWRK_NUM\": null,\n        \"EXPS_BUILD_REP_VAL_F\": \"k\",\n        \"EXPS_OTHER_WRTIN_TXT\": null,\n        \"EXPS_RENT_MACH_VAL_F\": \"r\",\n        \"INV_B_LIFO_RSV_VAL_F\": \"k\",\n        \"INV_E_LIFO_RSV_VAL_F\": \"t\",\n        \"PAY_ANN_PRDWRK_VAL_F\": \"r\",\n        \"ROBOT_INDST_INOP_NUM\": null,\n        \"ROBOT_INDST_PRCH_NUM\": null,\n        \"CAPEX_BUILD_NEW_VAL_F\": \"k\",\n        \"CAPEX_MACH_USED_VAL_F\": \"k\",\n        \"EXPS_COMPTR_OTHEQ_VAL\": null,\n        \"EXPS_FRNG_BENEFIT_VAL\": null,\n        \"EXPS_RENT_BUILD_VAL_F\": \"t\",\n        \"INV_B_IVAL_TOT_DVAL_F\": \"k\",\n        \"INV_E_IVAL_TOT_DVAL_F\": \"r\",\n        \"NEG_EXPS_CSTMTOT_DVAL\": null,\n        \"PAY_ANN_NONPRDWRK_VAL\": null,\n        \"PAY_QTR1_PRDWRK_VAL_F\": \"r\",\n        \"CAPEX_BUILD_USED_VAL_F\": \"t\",\n        \"EMP_MAR12_PRDWRK_NUM_F\": \"r\",\n        \"PAY_QTR1_NONPRDWRK_VAL\": null,\n        \"ROBOT_INDST_INOP_NUM_F\": \"r\",\n        \"ROBOT_INDST_PRCH_NUM_F\": \"k\",\n        \"CAPEX_OTH_NEW_WRTIN_TXT\": null,\n        \"EMP_MAR12_NONPRDWRK_NUM\": null,\n        \"EXPS_COMPTR_OTHEQ_VAL_F\": \"t\",\n        \"EXPS_FRNG_BENEFIT_VAL_F\": \"r\",\n        \"PAY_ANN_NONPRDWRK_VAL_F\": \"r\",\n        \"CAPEX_OTH_USED_WRTIN_TXT\": null,\n        \"MAJOR_ACT_CODE_WRTIN_TXT\": \"lorem ipsum\",\n        \"PAY_QTR1_NONPRDWRK_VAL_F\": \"r\",\n        \"EMP_MAR12_NONPRDWRK_NUM_F\": \"k\",\n        \"ROBOT_INDST_INOP_WRTIN_TXT\": null,\n        \"ROBOT_INDST_PRCH_WRTIN_TXT\": null\n    },\n    \"meta\": {\n        \"id\": 758671,\n        \"type\": \"ESTAB\",\n        \"ent_id\": \"2099021295\",\n        \"kau_id\": \"3000003933\",\n        \"version\": null,\n        \"estab_id\": \"33133\"\n    },\n    \"delta\": [\n        {\n            \"key\": \"EIN_NUM\",\n            \"service\": {\n                \"name\": \"qbes\",\n                \"timestamp\": \"2023-09-11T17:52:03.848Z\"\n            },\n            \"newValue\": \"730584841SUCCESS\",\n            \"oldValue\": 730584841\n        },\n        {\n            \"key\": \"PAY_ANN_VAL\",\n            \"service\": {\n                \"name\": \"qbes\",\n                \"timestamp\": \"2023-09-11T17:52:03.848Z\"\n            },\n            \"newValue\": 62229,\n            \"oldValue\": 62219\n        }\n    ],\n    \"rules\": [\n        {\n            \"event\": {\n                \"name\": \"Set review flag for estab\",\n                \"type\": 238,\n                \"active\": true,\n                \"params\": {\n                    \"action\": [\n                        {\n                            \"Action\": \"\\\"Set Review for Flag\\\"\"\n                        }\n                    ],\n                    \"message\": \"Setting the review flag for ESTAB.\",\n                    \"rvsJSON\": [\n                        \"TYPOP_CODE_STAT\"\n                    ],\n                    \"apiSource\": {},\n                    \"actionType\": \"impute\",\n                    \"apiChecked\": false\n                },\n                \"ruleId\": 238,\n                \"actionType\": \"impute\",\n                \"rulePriority\": \"5\",\n                \"validationType\": \"estab\"\n            },\n            \"index\": -1,\n            \"priority\": 5,\n            \"conditions\": {\n                \"all\": [\n                    {\n                        \"fact\": \"checkCondition\",\n                        \"path\": \"$.value\",\n                        \"value\": true,\n                        \"params\": {\n                            \"conditionstring\": \"VERSION == \\\"ADJ\\\"\"\n                        },\n                        \"operator\": \"equal\"\n                    }\n                ]\n            }\n        },\n        {\n            \"event\": {\n                \"name\": \"Append Success to EIN NUMBER\",\n                \"type\": 239,\n                \"active\": true,\n                \"params\": {\n                    \"action\": [\n                        {\n                            \"EIN_NUM\": \"concat(EIN_NUM, \\\"SUCCESS\\\")\"\n                        }\n                    ],\n                    \"message\": \"Setting the review flag for ESTAB.\",\n                    \"rvsJSON\": [\n                        \"TYPOP_CODE_STAT\"\n                    ],\n                    \"apiSource\": {},\n                    \"actionType\": \"impute\",\n                    \"apiChecked\": false\n                },\n                \"ruleId\": 238,\n                \"actionType\": \"impute\",\n                \"rulePriority\": \"5\",\n                \"validationType\": \"estab\"\n            },\n            \"index\": -1,\n            \"priority\": 5,\n            \"conditions\": {\n                \"all\": [\n                    {\n                        \"fact\": \"checkCondition\",\n                        \"path\": \"$.value\",\n                        \"value\": true,\n                        \"params\": {\n                            \"conditionstring\": \"EIN_NUM != \\\"\\\"\"\n                        },\n                        \"operator\": \"equal\"\n                    }\n                ]\n            }\n        },\n        {\n            \"event\": {\n                \"name\": \"PAY_ANN_VAL test 1\",\n                \"type\": \"new_1\",\n                \"active\": true,\n                \"params\": {\n                    \"rvs\": [],\n                    \"action\": [\n                        {\n                            \"PAY_ANN_VAL\": \"PAY_ANN_VAL + 1\"\n                        }\n                    ],\n                    \"message\": \"PAY_ANN_VAL TEST\",\n                    \"rvsJSON\": []\n                },\n                \"actionType\": \"impute\",\n                \"validationType\": \"new_1\"\n            },\n            \"index\": -1,\n            \"priority\": null,\n            \"conditions\": {\n                \"all\": [\n                    {\n                        \"fact\": \"checkCondition\",\n                        \"path\": \"$.value\",\n                        \"value\": true,\n                        \"params\": {\n                            \"conditionString\": \"1 == 1\"\n                        },\n                        \"operator\": \"equal\"\n                    }\n                ]\n            }\n        },\n        {\n            \"event\": {\n                \"name\": \"PAY_ANN RULE\",\n                \"type\": \"new_1\",\n                \"active\": true,\n                \"params\": {\n                    \"rvs\": [\n                        \"PAY_ANN_VAL\"\n                    ],\n                    \"action\": [\n                        {\n                            \"PAY_ANN_VAL\": \"PAY_ANN_VAL + 10\"\n                        }\n                    ],\n                    \"message\": \"PAY_ANN_VAL_1\",\n                    \"rvsJSON\": [\n                        \"PAY_ANN_VAL\"\n                    ]\n                },\n                \"actionType\": \"impute\",\n                \"rulePriority\": \"4\",\n                \"validationType\": \"new_1\"\n            },\n            \"index\": -1,\n            \"priority\": 4,\n            \"conditions\": {\n                \"all\": [\n                    {\n                        \"fact\": \"checkCondition\",\n                        \"path\": \"$.value\",\n                        \"value\": true,\n                        \"params\": {\n                            \"conditionstring\": \"PAY_ANN_VAL != \\\"\\\"\"\n                        },\n                        \"operator\": \"equal\"\n                    }\n                ]\n            }\n        }\n    ],\n    \"recipe\": {\n        \"steps\": [\n            {\n                \"delta\": [\n                    {\n                        \"key\": \"EIN_NUM\",\n                        \"service\": {\n                            \"name\": \"qbes\",\n                            \"timestamp\": \"2023-09-11T17:52:03.848Z\"\n                        },\n                        \"newValue\": \"730584841SUCCESS\",\n                        \"oldValue\": 730584841\n                    },\n                    {\n                        \"key\": \"PAY_ANN_VAL\",\n                        \"service\": {\n                            \"name\": \"qbes\",\n                            \"timestamp\": \"2023-09-11T17:52:03.848Z\"\n                        },\n                        \"newValue\": 62229,\n                        \"oldValue\": 62219\n                    }\n                ],\n                \"tsEnd\": 1694454723848,\n                \"msName\": \"qbes\",\n                \"tsStart\": 1694454723842,\n                \"validRules\": [\n                    {\n                        \"id\": 239,\n                        \"rvs\": [],\n                        \"action\": [\n                            {\n                                \"EIN_NUM\": \"concat(EIN_NUM, \\\"SUCCESS\\\")\"\n                            }\n                        ],\n                        \"message\": \"Setting the review flag for ESTAB.\",\n                        \"computedRVS\": {\n                            \"EIN_NUM\": \"730584841SUCCESS\"\n                        }\n                    },\n                    {\n                        \"id\": \"new_1\",\n                        \"rvs\": [],\n                        \"action\": [\n                            {\n                                \"PAY_ANN_VAL\": \"PAY_ANN_VAL + 10\"\n                            }\n                        ],\n                        \"message\": \"PAY_ANN_VAL_1\",\n                        \"computedRVS\": {\n                            \"EIN_NUM\": \"730584841SUCCESS\",\n                            \"PAY_ANN_VAL\": 62229\n                        }\n                    }\n                ],\n                \"invalidRules\": [\n                    {\n                        \"id\": 238,\n                        \"rvs\": [],\n                        \"action\": [\n                            {\n                                \"Action\": \"\\\"Set Review for Flag\\\"\"\n                            }\n                        ],\n                        \"message\": \"Setting the review flag for ESTAB.\"\n                    },\n                    {\n                        \"id\": \"new_1\",\n                        \"rvs\": [],\n                        \"action\": [\n                            {\n                                \"PAY_ANN_VAL\": \"PAY_ANN_VAL + 1\"\n                            }\n                        ],\n                        \"message\": \"PAY_ANN_VAL TEST\"\n                    }\n                ],\n                \"processedTime\": 6\n            },\n            {\n                \"tsEnd\": 0,\n                \"msName\": \"jobOutput\",\n                \"jobType\": \"spadJob\",\n                \"tsStart\": 0,\n                \"destinationTable\": \"product_aies.spad_2\"\n            }\n        ],\n        \"currentStepIndex\": 1\n    },\n    \"upsert\": true\n}]\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "8549c72d66cffc9d",
        "type": "switch",
        "z": "d7d109e0d89be1c6",
        "name": "Switch for Mode",
        "property": "modeName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "interactive_mode",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "batch_mode_1",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "batch_mode_2",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1340,
        "y": 1020,
        "wires": [
            [
                "35871e68a9f50691",
                "4cde7fe113a4df66"
            ],
            [
                "54cb70dfe4b43956",
                "a46cb4be6617824c"
            ],
            [
                "d6116234e9829874",
                "eda398efc16a87d5"
            ]
        ]
    },
    {
        "id": "35871e68a9f50691",
        "type": "link out",
        "z": "d7d109e0d89be1c6",
        "name": "Go To InteractiveMode",
        "mode": "link",
        "links": [
            "f5168b892485e327",
            "746909370ced9c62"
        ],
        "x": 1505,
        "y": 980,
        "wires": []
    },
    {
        "id": "54cb70dfe4b43956",
        "type": "link out",
        "z": "d7d109e0d89be1c6",
        "name": "Go To BatchMode1",
        "mode": "link",
        "links": [
            "513713eac5d2b9ba"
        ],
        "x": 1505,
        "y": 1040,
        "wires": []
    },
    {
        "id": "d6116234e9829874",
        "type": "link out",
        "z": "d7d109e0d89be1c6",
        "name": "Go To BatchMode2",
        "mode": "link",
        "links": [
            "7524317b716e4316"
        ],
        "x": 1505,
        "y": 1120,
        "wires": []
    },
    {
        "id": "4cde7fe113a4df66",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "InteractiveMode",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1580,
        "y": 940,
        "wires": []
    },
    {
        "id": "a46cb4be6617824c",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "batchMode1",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1630,
        "y": 1020,
        "wires": []
    },
    {
        "id": "eda398efc16a87d5",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "batchMode2",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1610,
        "y": 1080,
        "wires": []
    },
    {
        "id": "5ff02ea5b7b5458d",
        "type": "postgresql",
        "z": "d7d109e0d89be1c6",
        "name": "Update FACTS",
        "query": "",
        "postgreSQLConfig": "481a641c4005d1c8",
        "split": false,
        "rowsPerMsg": "1",
        "outputs": 1,
        "x": 980,
        "y": 920,
        "wires": [
            [
                "65bbab8d594f837a"
            ]
        ]
    },
    {
        "id": "2cddb7a50f4f69d9",
        "type": "function",
        "z": "d7d109e0d89be1c6",
        "name": "insert_query",
        "func": "\n\n\nconst findChangedKeyValuePairs = (oldObj, newObj) => {\n  const changedKeyValuePairs = [];\n\n  for (const key in newObj) {\n    if (oldObj[key] !== newObj[key]) {\n      changedKeyValuePairs.push({\n        key,\n        oldValue: oldObj[key],\n        newValue: newObj[key],\n        service: {\n          name: 'qflow',\n          timestamp: new Date()\n        }\n      });\n    }\n  }\n  return changedKeyValuePairs;\n}\n\nconst qFlowdelta = findChangedKeyValuePairs(msg.payload.qflowInputFacts[0], msg.payload.facts[0]);\n\nvar currentStepIndex = msg.payload.recipe.currentStepIndex;\n\nmsg.payload.recipe.steps[currentStepIndex].delta = qFlowdelta;\n\nconst jsonData = msg.payload.recipe.steps[currentStepIndex]\n\nconst formatUpdateQueryFromMessage = (messageObject) => {\n  const { destinationTable } = getCurrentStepData(messageObject);\n  let query = `UPDATE ${destinationTable} SET `;\n  query += `results = '${escapeForSQL(JSON.stringify(messageObject))}'::jsonb, `;\n  query += `facts = '${escapeForSQL(JSON.stringify(messageObject.fact))}'::jsonb, `;\n  query += `delta = '${escapeForSQL(JSON.stringify(messageObject.delta))}'::jsonb `;\n  query += `WHERE id = '${messageObject.meta.id}';`;\n  return query;\n};\nconst getCurrentStepData = (formattedJSON) => {\n  const currentStepIndex = formattedJSON.recipe.currentStepIndex;\n  return formattedJSON.recipe.steps[currentStepIndex];\n};\nconst escapeForSQL = (jsonString) => {\n  return jsonString.replaceAll(\"'\", \"''\");\n};\n\nconst getChangeObjectFromDelta = (deltaList) =>\n  deltaList.reduce((acc, curr) => {\n    acc[curr.key] = curr.newValue;\n    return acc;\n  }, {});\n\nconst getDeltaFromMessage = (messageObject) => {\n  return messageObject.delta || [];\n};\nconst getOriginalFact = (formattedJSON) => {\n  return formattedJSON.origFact;\n};\nconst getKeyListOriginalFact = (origFact) => {\n  return Object.keys(origFact);\n};\nconst generateKeyValString = (changeObject) =>\n  Object.entries(changeObject).map(([key, value]) => {\n    let formattedValue;\n\n    if (typeof value === 'string') {\n      formattedValue = `'${value.replaceAll(\"'\", \"''\")}'`;\n    } else if (typeof value === 'number' || typeof value === 'boolean') {\n      formattedValue = value;\n    } else if (typeof value === 'object' && value !== null) {\n      formattedValue = `'${JSON.stringify(value).replaceAll(\"'\", \"''\")}'`;\n    } else {\n      formattedValue = value;\n    }\n\n    return `${key} = ${formattedValue}`;\n  });\n\nconst formatDBUpdateQueryFromMessage = (messageObject, tableName, updateMatch) => {\n  const changeObject = getChangeObjectFromDelta(getDeltaFromMessage(messageObject));\n  const whereClause = updateMatch\n  const origFact = getOriginalFact(messageObject);\n  const origFactKeyList = getKeyListOriginalFact(origFact);\n  for (const key in changeObject) {\n    // Check if key is in the original fact\n    if (!origFactKeyList.includes(key)) {\n      // // If not, add it to the original fact\n      // console.info(\n      //   `Job Output | Detected new key ${key} with value ${changeObject[key]} for job ${messageObject.job.jobName} where update query is ${whereClause}`\n      // );\n      delete changeObject[key];\n      continue;\n    }\n\n    // If original fact value is null, or\n    // If changeObject value is null, skip\n    // Because null cannot determine the type\n    if (origFact[key] == null || changeObject[key] == null) {\n      continue;\n    }\n\n    if (typeof changeObject[key] !== typeof origFact[key]) {\n      // console.info(\n      //   `Job Output | Detected invalid value type for ${key} with value ${changeObject[key]\n      //   } | ${typeof changeObject[key]} where original value was ${origFact[key]\n      //   } | ${typeof origFact[key]} for job ${messageObject.job.jobName\n      //   } where update query is ${whereClause}`\n      // );\n      delete changeObject[key];\n    }\n  }\n\n  if (Object.keys(changeObject).length === 0) {\n    return;\n  }\n\n  let query = `UPDATE ${tableName} SET `;\n  query += generateKeyValString(changeObject).join(', ');\n  query += ` WHERE ${whereClause};`;\n  return query;\n};\n\nmsg.query = formatDBUpdateQueryFromMessage(msg.payload.recipe.steps[currentStepIndex], msg.payload.recipe.steps[currentStepIndex].source.tableName, 'reporting_id = ' + msg.payload.csv[0].REPORTING_ID + 'and reporting_id_typ_txt = ' + msg.payload.csv[0].REPORTING_ID_TYP_TXT + 'and version = PO')\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 920,
        "wires": [
            [
                "5ff02ea5b7b5458d",
                "0a7d3ce3f2f29738"
            ]
        ]
    },
    {
        "id": "65bbab8d594f837a",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "INSERT Result",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1200,
        "y": 920,
        "wires": []
    },
    {
        "id": "08df2c7b7f0720f7",
        "type": "inject",
        "z": "d7d109e0d89be1c6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 380,
        "y": 920,
        "wires": [
            [
                "1b620f15d59c7bf1"
            ]
        ]
    },
    {
        "id": "1b620f15d59c7bf1",
        "type": "function",
        "z": "d7d109e0d89be1c6",
        "name": "function 38",
        "func": "msg.payload.recipe = {\n    \"csv\": [\n        {\n            \"ID\": \"10969\",\n            \"ENT_ID\": \"2099023193\",\n            \"RD_STAT\": \"N    \",\n            \"VERSION\": \"REP\",\n            \"DEPR_VAL\": 58193,\n            \"DEPR_VAL_F\": \"r\",\n            \"LSD_50_STAT\": \"1.0  \",\n            \"PAY_ANN_VAL\": 686038,\n            \"CAPEX_CL_VAL\": 67725,\n            \"CAPEX_CO_VAL\": 57741,\n            \"PAY_QTR1_VAL\": 171360,\n            \"RCPT_TOT_VAL\": 768370,\n            \"RD_EXPS_STAT\": \"1.0  \",\n            \"ASSET_BGN_VAL\": 28675,\n            \"CAPEX_TOT_SUM\": 640794,\n            \"EMP_MAR12_NUM\": 1380,\n            \"PAY_ANN_VAL_F\": \"t\",\n            \"ASSET_SOLD_VAL\": 56646,\n            \"CAPEX_CL_VAL_F\": \"k\",\n            \"CAPEX_CO_VAL_F\": \"t\",\n            \"CAPEX_TOT_DVAL\": 640794,\n            \"PAY_QTR1_VAL_F\": \"r\",\n            \"RCPT_TOT_VAL_F\": \"r\",\n            \"RECORD_TYP_TXT\": \"10\",\n            \"ASSET_BGN_VAL_F\": \"r\",\n            \"ASSET_CAPEX_VAL\": 70814,\n            \"EMP_MAR12_NUM_F\": \"k\",\n            \"PAY_ANN_VAL_SUM\": 686038,\n            \"RCPT_TOT_PY_VAL\": 49472,\n            \"ASSET_OTHACQ_VAL\": 58346,\n            \"ASSET_SOLD_VAL_F\": \"r\",\n            \"PAY_QTR1_VAL_SUM\": 171360,\n            \"RCPT_TOT_VAL_SUM\": 768370,\n            \"REPORTING_TYP_ID\": \"ENT\",\n            \"ASSET_CAPEX_VAL_F\": \"t\",\n            \"CAPEX_NEW_TOT_SUM\": 609210,\n            \"EMP_MAR12_NUM_SUM\": 1380,\n            \"PAY_ANN_SLVR_DVAL\": 514678,\n            \"RCPT_TOT_PY_VAL_F\": \"r\",\n            \"ASSET_END_TOT_DVAL\": 45029,\n            \"ASSET_OTHACQ_VAL_F\": \"t\",\n            \"CAPEX_CL_WRTIN_TXT\": \"lorem ipsum\",\n            \"CAPEX_MACH_TOT_SUM\": 514804,\n            \"CAPEX_NEW_TOT_DVAL\": 609210,\n            \"CAPEX_MACH_TOT_DVAL\": 514804,\n            \"ASSET_END_TOT_DVAL_F\": \"r\",\n            \"ASSET_OTHACQ_WRTIN_TXT\": \"lorem ipsum\",\n            \"CAPEX_SOFTWARE_TOT_DVAL\": 36178,\n            \"CAPEX_SOFTWARE_VEND_VAL\": 37422,\n            \"CAPEX_SOFTWARE_INTDEV_VAL\": 59043,\n            \"CAPEX_SOFTWARE_PREPKG_VAL\": 55149,\n            \"CAPEX_SOFTWARE_VEND_VAL_F\": \"t\",\n            \"CAPEX_SOFTWARE_INTDEV_VAL_F\": \"r\",\n            \"CAPEX_SOFTWARE_PREPKG_VAL_F\": \"t\"\n        }\n    ],\n    \"job\": {\n        \"history\": [],\n        \"jobName\": \"rohit_batch_test_262\",\n        \"recipeID\": 2,\n        \"initiatedTs\": \"2024-01-17T18:09:46.820Z\"\n    },\n    \"fact\": {\n        \"ID\": \"10969\",\n        \"ENT_ID\": \"2099023193\",\n        \"RD_STAT\": \"N    \",\n        \"VERSION\": \"REP\",\n        \"DEPR_VAL\": 58193,\n        \"DEPR_VAL_F\": \"r\",\n        \"LSD_50_STAT\": \"1.0  \",\n        \"PAY_ANN_VAL\": 686038,\n        \"CAPEX_CL_VAL\": 67725,\n        \"CAPEX_CO_VAL\": 57741,\n        \"PAY_QTR1_VAL\": 171360,\n        \"RCPT_TOT_VAL\": 768370,\n        \"RD_EXPS_STAT\": \"1.0  \",\n        \"ASSET_BGN_VAL\": 28675,\n        \"CAPEX_TOT_SUM\": 640794,\n        \"EMP_MAR12_NUM\": 1380,\n        \"PAY_ANN_VAL_F\": \"t\",\n        \"ASSET_SOLD_VAL\": 56646,\n        \"CAPEX_CL_VAL_F\": \"k\",\n        \"CAPEX_CO_VAL_F\": \"t\",\n        \"CAPEX_TOT_DVAL\": 640794,\n        \"PAY_QTR1_VAL_F\": \"r\",\n        \"RCPT_TOT_VAL_F\": \"r\",\n        \"RECORD_TYP_TXT\": \"10\",\n        \"ASSET_BGN_VAL_F\": \"r\",\n        \"ASSET_CAPEX_VAL\": 70814,\n        \"EMP_MAR12_NUM_F\": \"k\",\n        \"PAY_ANN_VAL_SUM\": 686038,\n        \"RCPT_TOT_PY_VAL\": 49472,\n        \"ASSET_OTHACQ_VAL\": 58346,\n        \"ASSET_SOLD_VAL_F\": \"r\",\n        \"PAY_QTR1_VAL_SUM\": 171360,\n        \"RCPT_TOT_VAL_SUM\": 768370,\n        \"REPORTING_TYP_ID\": \"ENT\",\n        \"ASSET_CAPEX_VAL_F\": \"t\",\n        \"CAPEX_NEW_TOT_SUM\": 609210,\n        \"EMP_MAR12_NUM_SUM\": 1380,\n        \"PAY_ANN_SLVR_DVAL\": 514678,\n        \"RCPT_TOT_PY_VAL_F\": \"r\",\n        \"ASSET_END_TOT_DVAL\": 45029,\n        \"ASSET_OTHACQ_VAL_F\": \"t\",\n        \"CAPEX_CL_WRTIN_TXT\": \"lorem ipsum\",\n        \"CAPEX_MACH_TOT_SUM\": 514804,\n        \"CAPEX_NEW_TOT_DVAL\": 609210,\n        \"CAPEX_MACH_TOT_DVAL\": 514804,\n        \"ASSET_END_TOT_DVAL_F\": \"r\",\n        \"ASSET_OTHACQ_WRTIN_TXT\": \"lorem ipsum\",\n        \"CAPEX_SOFTWARE_TOT_DVAL\": 36178,\n        \"CAPEX_SOFTWARE_VEND_VAL\": 37422,\n        \"CAPEX_SOFTWARE_INTDEV_VAL\": 59043,\n        \"CAPEX_SOFTWARE_PREPKG_VAL\": 55149,\n        \"CAPEX_SOFTWARE_VEND_VAL_F\": \"t\",\n        \"CAPEX_SOFTWARE_INTDEV_VAL_F\": \"r\",\n        \"CAPEX_SOFTWARE_PREPKG_VAL_F\": \"t\"\n    },\n    \"meta\": {\n        \"type\": \"ENT\",\n        \"ENT_ID\": \"2099023193\",\n        \"version\": \"REP\"\n    },\n    \"delta\": [\n        {\n            \"key\": \"rd_exps_stat\",\n            \"oldValue\": 30,\n            \"newValue\": 31,\n            \"service\": { \"name\": \"qflow\", \"timestamp\": \"2024-01-30T06:59:59.613Z\" }\n        },\n        {\n            \"key\": \"capex_tot_sum\",\n            \"oldValue\": \"New York\",\n            \"newValue\": \"Los Angeles\",\n            \"service\": { \"name\": \"qflow\", \"timestamp\": \"2024-01-30T06:59:59.613Z\" }\n        }\n    ],\n    \"rules\": [\n        {\n            \"event\": {\n                \"name\": \"add_pay_ann\",\n                \"type\": 0,\n                \"active\": true,\n                \"params\": {\n                    \"rvs\": \"[]\",\n                    \"action\": [\n                        {\n                            \"PAY_ANN_VAL\": \"PAY_ANN_VAL + 10\"\n                        }\n                    ],\n                    \"message\": \"Adding to revenue\",\n                    \"rvsJSON\": [],\n                    \"actionType\": \"impute\"\n                },\n                \"ruleId\": 0,\n                \"actionType\": \"impute\",\n                \"rulePriority\": \"\",\n                \"validationType\": \"new\"\n            },\n            \"index\": -1,\n            \"conditions\": {\n                \"all\": [\n                    {\n                        \"fact\": \"checkCondition\",\n                        \"path\": \"$.value\",\n                        \"value\": true,\n                        \"params\": {\n                            \"conditionstring\": \"1 == 1\"\n                        },\n                        \"operator\": \"equal\"\n                    }\n                ]\n            }\n        },\n        {\n            \"event\": {\n                \"name\": \"pay_qtr1_val\",\n                \"type\": 0,\n                \"active\": true,\n                \"params\": {\n                    \"rvs\": \"[]\",\n                    \"action\": [\n                        {\n                            \"PAY_QTR1_VAL\": \"PAY_QTR1_VAL + 30\"\n                        }\n                    ],\n                    \"message\": \"Add to PAY QTR total\",\n                    \"rvsJSON\": [],\n                    \"actionType\": \"impute\"\n                },\n                \"ruleId\": 0,\n                \"actionType\": \"impute\",\n                \"rulePriority\": \"\",\n                \"validationType\": \"new\"\n            },\n            \"index\": -1,\n            \"conditions\": {\n                \"all\": [\n                    {\n                        \"fact\": \"checkCondition\",\n                        \"path\": \"$.value\",\n                        \"value\": true,\n                        \"params\": {\n                            \"conditionstring\": \"1 == 1\"\n                        },\n                        \"operator\": \"equal\"\n                    }\n                ]\n            }\n        },\n        {\n            \"event\": {\n                \"name\": \"emp_mar12_num\",\n                \"type\": 0,\n                \"active\": true,\n                \"params\": {\n                    \"rvs\": \"[]\",\n                    \"action\": [\n                        {\n                            \"EMP_MAR12_NUM\": \"EMP_MAR12_NUM + 40\"\n                        }\n                    ],\n                    \"message\": \"Add to PAY QTR total\",\n                    \"rvsJSON\": [],\n                    \"actionType\": \"impute\"\n                },\n                \"ruleId\": 0,\n                \"actionType\": \"impute\",\n                \"rulePriority\": \"\",\n                \"validationType\": \"new\"\n            },\n            \"index\": -1,\n            \"conditions\": {\n                \"all\": [\n                    {\n                        \"fact\": \"checkCondition\",\n                        \"path\": \"$.value\",\n                        \"value\": true,\n                        \"params\": {\n                            \"conditionstring\": \"1 == 1\"\n                        },\n                        \"operator\": \"equal\"\n                    }\n                ]\n            }\n        },\n        {\n            \"event\": {\n                \"name\": \"rcpt_tot_val\",\n                \"type\": 0,\n                \"active\": true,\n                \"params\": {\n                    \"rvs\": \"[]\",\n                    \"action\": [\n                        {\n                            \"RCPT_TOT_VAL\": \"RCPT_TOT_VAL + 20\"\n                        }\n                    ],\n                    \"message\": \"Add to receipt total\",\n                    \"rvsJSON\": [],\n                    \"actionType\": \"impute\"\n                },\n                \"ruleId\": 0,\n                \"actionType\": \"impute\",\n                \"rulePriority\": 5,\n                \"validationType\": \"new\"\n            },\n            \"index\": -1,\n            \"conditions\": {\n                \"all\": [\n                    {\n                        \"fact\": \"checkCondition\",\n                        \"path\": \"$.value\",\n                        \"value\": true,\n                        \"params\": {\n                            \"conditionstring\": \"1 == 1\"\n                        },\n                        \"operator\": \"equal\"\n                    }\n                ]\n            }\n        },\n        {\n            \"event\": {\n                \"name\": \"Add an extra fiels\",\n                \"type\": 0,\n                \"active\": true,\n                \"params\": {\n                    \"rvs\": \"[]\",\n                    \"action\": [\n                        {\n                            \"hello\": \"\\\"123\\\"\"\n                        }\n                    ],\n                    \"message\": \"Adding extra field\",\n                    \"rvsJSON\": [],\n                    \"actionType\": \"impute\"\n                },\n                \"ruleId\": 0,\n                \"actionType\": \"impute\",\n                \"rulePriority\": \"\",\n                \"validationType\": \"new\"\n            },\n            \"index\": -1,\n            \"conditions\": {\n                \"all\": [\n                    {\n                        \"fact\": \"checkCondition\",\n                        \"path\": \"$.value\",\n                        \"value\": true,\n                        \"params\": {\n                            \"conditionstring\": \"1 == 1\"\n                        },\n                        \"operator\": \"equal\"\n                    }\n                ]\n            }\n        },\n        {\n            \"event\": {\n                \"name\": \"Add an extra fiels\",\n                \"type\": 0,\n                \"active\": true,\n                \"params\": {\n                    \"rvs\": \"[]\",\n                    \"action\": [\n                        {\n                            \"hello_x\": \"\\\"1234\\\"\"\n                        }\n                    ],\n                    \"message\": \"Adding extra field\",\n                    \"rvsJSON\": [],\n                    \"actionType\": \"impute\"\n                },\n                \"ruleId\": 0,\n                \"actionType\": \"impute\",\n                \"rulePriority\": \"\",\n                \"validationType\": \"new\"\n            },\n            \"index\": -1,\n            \"conditions\": {\n                \"all\": [\n                    {\n                        \"fact\": \"checkCondition\",\n                        \"path\": \"$.value\",\n                        \"value\": true,\n                        \"params\": {\n                            \"conditionstring\": \"1 == 1\"\n                        },\n                        \"operator\": \"equal\"\n                    }\n                ]\n            }\n        }\n    ],\n    \"recipe\": {\n        \"steps\": [\n            {\n                \"delta\": [\n                    {\n                        \"key\": \"rd_exps_stat\",\n                        \"oldValue\": 30,\n                        \"newValue\": 31,\n                        \"service\": { \"name\": \"qflow\", \"timestamp\": \"2024-01-30T06:59:59.613Z\" }\n                    },\n                    {\n                        \"key\": \"capex_tot_sum\",\n                        \"oldValue\": \"New York\",\n                        \"newValue\": \"Los Angeles\",\n                        \"service\": { \"name\": \"qflow\", \"timestamp\": \"2024-01-30T06:59:59.613Z\" }\n                    }\n                ],\n                \"tsEnd\": 1705514990542,\n                \"msName\": \"qflow\",\n                \"tsStart\": 1705514990501,\n                \"processedTime\": 41\n            },\n            {\n                \"tsEnd\": 0,\n                \"msName\": \"jobOutput\",\n                \"jobType\": \"spadJob\",\n                \"tsStart\": 0,\n                \"destinationTable\": \"product_aies.spad_2\"\n            }\n        ],\n        \"currentStepIndex\": 1\n    },\n    \"source\": {\n        \"tableName\": \"product_aies.item_ents_2023a1\"\n    },\n    \"origFact\": {\n        \"ID\": \"10969\",\n        \"ENT_ID\": \"2099023193\",\n        \"RD_STAT\": \"N    \",\n        \"VERSION\": \"REP\",\n        \"DEPR_VAL\": 58193,\n        \"DEPR_VAL_F\": \"r\",\n        \"LSD_50_STAT\": \"1.0  \",\n        \"PAY_ANN_VAL\": 686038,\n        \"CAPEX_CL_VAL\": 67725,\n        \"CAPEX_CO_VAL\": 57741,\n        \"PAY_QTR1_VAL\": 171360,\n        \"RCPT_TOT_VAL\": 768370,\n        \"RD_EXPS_STAT\": \"1.0  \",\n        \"ASSET_BGN_VAL\": 28675,\n        \"CAPEX_TOT_SUM\": 640794,\n        \"EMP_MAR12_NUM\": 1380,\n        \"PAY_ANN_VAL_F\": \"t\",\n        \"ASSET_SOLD_VAL\": 56646,\n        \"CAPEX_CL_VAL_F\": \"k\",\n        \"CAPEX_CO_VAL_F\": \"t\",\n        \"CAPEX_TOT_DVAL\": 640794,\n        \"PAY_QTR1_VAL_F\": \"r\",\n        \"RCPT_TOT_VAL_F\": \"r\",\n        \"RECORD_TYP_TXT\": \"10\",\n        \"ASSET_BGN_VAL_F\": \"r\",\n        \"ASSET_CAPEX_VAL\": 70814,\n        \"EMP_MAR12_NUM_F\": \"k\",\n        \"PAY_ANN_VAL_SUM\": 686038,\n        \"RCPT_TOT_PY_VAL\": 49472,\n        \"ASSET_OTHACQ_VAL\": 58346,\n        \"ASSET_SOLD_VAL_F\": \"r\",\n        \"PAY_QTR1_VAL_SUM\": 171360,\n        \"RCPT_TOT_VAL_SUM\": 768370,\n        \"REPORTING_TYP_ID\": \"ENT\",\n        \"ASSET_CAPEX_VAL_F\": \"t\",\n        \"CAPEX_NEW_TOT_SUM\": 609210,\n        \"EMP_MAR12_NUM_SUM\": 1380,\n        \"PAY_ANN_SLVR_DVAL\": 514678,\n        \"RCPT_TOT_PY_VAL_F\": \"r\",\n        \"ASSET_END_TOT_DVAL\": 45029,\n        \"ASSET_OTHACQ_VAL_F\": \"t\",\n        \"CAPEX_CL_WRTIN_TXT\": \"lorem ipsum\",\n        \"CAPEX_MACH_TOT_SUM\": 514804,\n        \"CAPEX_NEW_TOT_DVAL\": 609210,\n        \"CAPEX_MACH_TOT_DVAL\": 514804,\n        \"ASSET_END_TOT_DVAL_F\": \"r\",\n        \"ASSET_OTHACQ_WRTIN_TXT\": \"lorem ipsum\",\n        \"CAPEX_SOFTWARE_TOT_DVAL\": 36178,\n        \"CAPEX_SOFTWARE_VEND_VAL\": 37422,\n        \"CAPEX_SOFTWARE_INTDEV_VAL\": 59043,\n        \"CAPEX_SOFTWARE_PREPKG_VAL\": 55149,\n        \"CAPEX_SOFTWARE_VEND_VAL_F\": \"t\",\n        \"CAPEX_SOFTWARE_INTDEV_VAL_F\": \"r\",\n        \"CAPEX_SOFTWARE_PREPKG_VAL_F\": \"t\"\n    }\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 920,
        "wires": [
            [
                "2cddb7a50f4f69d9"
            ]
        ]
    },
    {
        "id": "0a7d3ce3f2f29738",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "debug 111",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "query",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 840,
        "wires": []
    },
    {
        "id": "1a1af744611d0eaa",
        "type": "function",
        "z": "d7d109e0d89be1c6",
        "name": "function 39",
        "func": "const { Pool } = global.get('pg');\n// Database connection configuration\nconst pool = new Pool({\n    user: 'postgres',\n    host: 'aies-cloud-aurora-pg-dev-instance-1.cjflqg3bd6i9.us-gov-east-1.rds.amazonaws.com',\n    database: 'space_ite',\n    password: 'RootNew123!!',\n    port: 5432,\n});\n// Query\nmsg.pool =  await pool.query('SELECT * FROM product_aies.item_estabs_2023a1 LIMIT 10');\nawait pool.end()\nmsg.pool = msg.pool.rows\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 1240,
        "wires": [
            [
                "f18a422a542265b7"
            ]
        ]
    },
    {
        "id": "587ce1e6af4bdba4",
        "type": "inject",
        "z": "d7d109e0d89be1c6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 400,
        "y": 1240,
        "wires": [
            [
                "1a1af744611d0eaa"
            ]
        ]
    },
    {
        "id": "f18a422a542265b7",
        "type": "debug",
        "z": "d7d109e0d89be1c6",
        "name": "debug 112",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "pool",
        "targetType": "msg",
        "statusVal": "pool",
        "statusType": "auto",
        "x": 770,
        "y": 1220,
        "wires": []
    },
    {
        "id": "594809ec2f361bca",
        "type": "link out",
        "z": "01ca257e61eeb577",
        "name": "Output of Interactive mode",
        "mode": "link",
        "links": [
            "8ad2ab7c27d8d248"
        ],
        "x": 1665,
        "y": 320,
        "wires": []
    },
    {
        "id": "ab47a2a547f6dc89",
        "type": "link in",
        "z": "01ca257e61eeb577",
        "name": "link in gotQBES",
        "links": [
            "8eb6f6b4ca5cb88d",
            "35871e68a9f50691"
        ],
        "x": 55,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "1801efa07ac9b111",
        "type": "link in",
        "z": "01ca257e61eeb577",
        "name": "Interactive Mode Test UI Input",
        "links": [
            "6c8827ce7a4c83d8"
        ],
        "x": 255,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "2ab9a77b24c2e058",
        "type": "link out",
        "z": "01ca257e61eeb577",
        "name": "link out classification",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 1285,
        "y": 620,
        "wires": []
    },
    {
        "id": "81604581b3019f86",
        "type": "function",
        "z": "01ca257e61eeb577",
        "name": "Fetch all params",
        "func": "msg.url = 'http://a301cb45559c445acaec11ab01bbbee1-2115632777.us-gov-east-1.elb.amazonaws.com/api/params/params'\nmsg.backup = msg.payload\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nlet msg = {}\nmsg.url = 'https://mc.edl-7529180-ite.ite.edl.census.gov/api/params/params'\n// msg.url = 'https://mc.edl-7529180-ite.ite.edl.census.gov/api/'\nmsg.backup = msg.payload\n// msg.payload.startTime = global.set(\"currentTime\", new Date())\n\nreturn msg;",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 200,
        "wires": [
            [
                "af5990074955e52a"
            ]
        ]
    },
    {
        "id": "af5990074955e52a",
        "type": "http request",
        "z": "01ca257e61eeb577",
        "name": "Lookup data API",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "basic",
        "senderr": false,
        "headers": [],
        "x": 1290,
        "y": 200,
        "wires": [
            [
                "19d0d47011349236"
            ]
        ]
    },
    {
        "id": "19d0d47011349236",
        "type": "function",
        "z": "01ca257e61eeb577",
        "name": "cache result",
        "func": "let cache = global.get(\"lookupCache\");\ncache = Array.isArray(cache?.data) ? cache : { \"data\": [] }\nif (msg.payload.status === \"success\") {\n    cache.data = msg.payload.data\n    msg.payload.dataArr = cache.data\n}\nglobal.set(\"lookupCache\", cache)\n// msg.payload = {\n//     ...msg.payload,\n//     ...msg.backup\n// }\n// return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "aeb4b3185c32f145",
        "type": "inject",
        "z": "01ca257e61eeb577",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 890,
        "y": 200,
        "wires": [
            [
                "81604581b3019f86"
            ]
        ]
    },
    {
        "id": "4c9ba515b42446ad",
        "type": "change",
        "z": "01ca257e61eeb577",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "action",
                "pt": "global",
                "to": "\"\"",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 400,
        "wires": [
            [
                "a3c3fd25157f1c8e"
            ]
        ]
    },
    {
        "id": "7251a0114de9076f",
        "type": "function",
        "z": "01ca257e61eeb577",
        "name": "Merge calls",
        "func": "let backup_origin = global.get(\"backup_origin\")\nmsg.payload.backup_origin = backup_origin != undefined && backup_origin\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "a3c3fd25157f1c8e",
        "type": "change",
        "z": "01ca257e61eeb577",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "err",
                "pt": "global",
                "to": "\"\"",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 460,
        "wires": [
            [
                "db9d8ecd1f2d933f"
            ]
        ]
    },
    {
        "id": "30bb416360c9b8c6",
        "type": "switch",
        "z": "01ca257e61eeb577",
        "name": "batch_interactive",
        "property": "batchInteractive",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "Batch",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Interactive",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 450,
        "y": 600,
        "wires": [
            [
                "60ff4065a8f28695"
            ],
            [
                "7cb27f75b392c77b"
            ],
            [
                "7251a0114de9076f"
            ]
        ]
    },
    {
        "id": "60ff4065a8f28695",
        "type": "subflow:5da8a5ef555890fb",
        "z": "01ca257e61eeb577",
        "name": "",
        "x": 750,
        "y": 520,
        "wires": [
            [
                "7251a0114de9076f"
            ]
        ]
    },
    {
        "id": "7cb27f75b392c77b",
        "type": "subflow:e3961d077dbf1770",
        "z": "01ca257e61eeb577",
        "name": "",
        "x": 760,
        "y": 580,
        "wires": [
            [
                "7251a0114de9076f"
            ]
        ]
    },
    {
        "id": "db9d8ecd1f2d933f",
        "type": "function",
        "z": "01ca257e61eeb577",
        "name": "set globals",
        "func": "global.set('flowPath', msg.payload.job)\nglobal.set('batchInteractive', msg.payload.recipe)\n\nlet record_idx = global.get(\"ptrModuleFacts\");\nlet record = msg.payload.csv[record_idx];\n\nglobal.set('reporting_id_typ_txt', record?.REPORTING_ID_TYP_TXT)\nglobal.set('tabstat', record?.TABSTAT)\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "07849dc89cea33b4",
        "type": "link in",
        "z": "e491b71b4df205b0",
        "name": "link in 53",
        "links": [
            "fa7a570c778cff30",
            "5e674b959c1b250a"
        ],
        "x": 625,
        "y": 200,
        "wires": [
            [
                "a7c74f61ef5568d2"
            ]
        ]
    },
    {
        "id": "d72287bcf3f34206",
        "type": "link out",
        "z": "e491b71b4df205b0",
        "name": "link out 94",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 985,
        "y": 200,
        "wires": []
    },
    {
        "id": "a7c74f61ef5568d2",
        "type": "subflow:50ae5f8d28de46c8",
        "z": "e491b71b4df205b0",
        "name": "",
        "x": 800,
        "y": 200,
        "wires": [
            [
                "d72287bcf3f34206"
            ]
        ]
    },
    {
        "id": "851ffb58b54519b5",
        "type": "subflow:0179503501c47e39",
        "z": "63ad4b8acb7dc59d",
        "name": "",
        "x": 590,
        "y": 260,
        "wires": [
            [
                "1d11154531f64d4c"
            ]
        ]
    },
    {
        "id": "1d11154531f64d4c",
        "type": "link out",
        "z": "63ad4b8acb7dc59d",
        "name": "link out 95",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 755,
        "y": 260,
        "wires": []
    },
    {
        "id": "5078aca6043b1cc4",
        "type": "link in",
        "z": "63ad4b8acb7dc59d",
        "name": "link in 57",
        "links": [
            "fa7a570c778cff30",
            "63be9b3202d985e3"
        ],
        "x": 435,
        "y": 260,
        "wires": [
            [
                "851ffb58b54519b5"
            ]
        ]
    },
    {
        "id": "4819fb4eb5d9db98",
        "type": "subflow:f9cd233b8803b29d",
        "z": "14722d65464a3727",
        "name": "",
        "x": 470,
        "y": 240,
        "wires": [
            [
                "f66f6ac43184ea78"
            ]
        ]
    },
    {
        "id": "f66f6ac43184ea78",
        "type": "link out",
        "z": "14722d65464a3727",
        "name": "link out 96",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 625,
        "y": 240,
        "wires": []
    },
    {
        "id": "e91a8662150f860b",
        "type": "link in",
        "z": "14722d65464a3727",
        "name": "link in 56",
        "links": [
            "fa7a570c778cff30",
            "3acafa8baa321281"
        ],
        "x": 325,
        "y": 240,
        "wires": [
            [
                "4819fb4eb5d9db98"
            ]
        ]
    },
    {
        "id": "5a4aae890eefb033",
        "type": "subflow:1ff4019fd0378d4a",
        "z": "6aaf6e8f6ac2727e",
        "name": "",
        "x": 360,
        "y": 300,
        "wires": [
            [
                "45c55d6a472cb198"
            ]
        ]
    },
    {
        "id": "45c55d6a472cb198",
        "type": "link out",
        "z": "6aaf6e8f6ac2727e",
        "name": "link out 97",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 545,
        "y": 300,
        "wires": []
    },
    {
        "id": "22c4c2d2376a93a9",
        "type": "link in",
        "z": "6aaf6e8f6ac2727e",
        "name": "link in 55",
        "links": [
            "fa7a570c778cff30",
            "2ae1f1be82166f95"
        ],
        "x": 185,
        "y": 300,
        "wires": [
            [
                "5a4aae890eefb033"
            ]
        ]
    },
    {
        "id": "fa123b5c161e6c6b",
        "type": "subflow:6ace7023ea973ebe",
        "z": "968bb86866f42913",
        "name": "",
        "x": 520,
        "y": 320,
        "wires": [
            [
                "aa56e68e83817d61"
            ]
        ]
    },
    {
        "id": "aa56e68e83817d61",
        "type": "link out",
        "z": "968bb86866f42913",
        "name": "link out 98",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 665,
        "y": 320,
        "wires": []
    },
    {
        "id": "eee8901d3c3ad4a5",
        "type": "link in",
        "z": "968bb86866f42913",
        "name": "link in 54",
        "links": [
            "fa7a570c778cff30",
            "537b24e51dc942ff"
        ],
        "x": 385,
        "y": 320,
        "wires": [
            [
                "fa123b5c161e6c6b"
            ]
        ]
    },
    {
        "id": "7a94579055cc72b8",
        "type": "link out",
        "z": "4b3e389076bee580",
        "name": "link out 99",
        "mode": "link",
        "links": [
            "7d91540d69ac16c1",
            "688a39b3e0070fe9"
        ],
        "x": 615,
        "y": 260,
        "wires": []
    },
    {
        "id": "d78cf76e54ce1388",
        "type": "link in",
        "z": "4b3e389076bee580",
        "name": "link in 58",
        "links": [
            "fa7a570c778cff30",
            "7da3e97012eb822e"
        ],
        "x": 335,
        "y": 260,
        "wires": [
            [
                "6086b215f83051f9"
            ]
        ]
    },
    {
        "id": "6086b215f83051f9",
        "type": "subflow:1088c7f7eed8781b",
        "z": "4b3e389076bee580",
        "name": "",
        "x": 470,
        "y": 260,
        "wires": [
            [
                "7a94579055cc72b8"
            ]
        ]
    }
]